(function(a,b){if(typeof define==="function"&&define.amd){define(["angular"],function(c){return(nf.ng.Bridge=b(c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Bridge=b(require("angular")))}else{nf.ng.Bridge=b(a.angular)}}}(this,function(a){function b(){this.rootScope;this.injector}b.prototype={constructor:b,call:function(e,d){var h=e.split(".");var i=this.rootScope;a.forEach(h,function(j){i=i[j]});var f=d.split(".");d=this.rootScope;a.forEach(f,function(j){d=d[j]});var g=Array.prototype.slice.call(arguments,2);var c=d.apply(i,g);if(c){return c}},get:function(c){var d=c.split(".");var e=this.rootScope;a.forEach(d,function(f){e=e[f]});return e},digest:function(){this.rootScope.$digest()}};return new b()}));
(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return(nf.ng.ServiceProvider=b())})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.ServiceProvider=b())}else{nf.ng.ServiceProvider=b()}}}(this,function(){return function(){function a(){}a.prototype={constructor:a,register:function(c,b){this[c]=b},remove:function(b){delete this[b]}};return new a()}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],function(c){return(nf.ClusterSummary=b(c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ClusterSummary=b(require("jquery")))}else{nf.ClusterSummary=b(a.$)}}}(this,function(e){var d=false;var c=false;var f=false;var b=false;var a={urls:{clusterSummary:"../nifi-api/flow/cluster/summary"}};return{loadClusterSummary:function(){return e.ajax({type:"GET",url:a.urls.clusterSummary,dataType:"json"}).done(function(g){var h=g;var i=h.clusterSummary;if(d===true){if(f!==i.connectedToCluster){b=true}}else{if(i.clustered&&!i.connectedToCluster){b=true}}c=i.clustered;f=i.connectedToCluster;d=true})},isClustered:function(){return c===true},isConnectedToCluster:function(){return f===true},didConnectedStateChange:function(){var g=b;b=false;return g}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return(nf.Storage=b())})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Storage=b())}else{nf.Storage=b()}}}(this,function(){var h=false;var g=86400000;var f=g*2;var b=function(i){return typeof i==="undefined"};var e=function(i){return i===null};var d=function(i){return !b(i)&&!e(i)};var c=function(k){if(d(k.expires)){var i=new Date(k.expires);var j=new Date();return i.valueOf()<j.valueOf()}else{return false}};var a=function(i){try{var j=JSON.parse(localStorage.getItem(i));if(d(j)){return j}else{return null}}catch(k){return null}};return{init:function(){for(var k=0;k<localStorage.length;k++){try{var j=localStorage.key(k);this.getItem(j)}catch(l){}}},acknowledgeDisconnection:function(){h=true},resetDisconnectionAcknowledgement:function(){h=false},isDisconnectionAcknowledged:function(){return h},setItem:function(j,l,i){i=d(i)?i:new Date().valueOf()+f;var k={expires:i,item:l};localStorage.setItem(j,JSON.stringify(k))},hasItem:function(i){return a(i)!==null},getItem:function(i){var j=a(i);if(j===null){return null}if(c(j)){this.removeItem(i);return null}if(d(j.item)){return j.item}else{return null}},getItemExpiration:function(i){var j=a(i);if(j===null){return null}if(d(j.expires)){return j.expires}else{return null}},removeItem:function(i){localStorage.removeItem(i)}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Storage"],function(d,c){return(nf.AjaxSetup=b(d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.AjaxSetup=b(require("jquery"),require("nf.Storage")))}else{nf.AjaxSetup=b(a.$,a.nf.Storage)}}}(this,function(b,a){b(document).ready(function(c){c.ajaxSetup({beforeSend:function(f){var d=a.hasItem("jwt");var e=a.getItem("jwt");if(e!==null){f.setRequestHeader("Authorization","Bearer "+e)}else{if(d===true){return false}}}})})}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],function(c){return(nf.UniversalCapture=b(c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.UniversalCapture=b(require("jquery")))}else{nf.UniversalCapture=b(a.$)}}}(this,function(b){b(document).ready(function(c){c(window).on("keydown",function(d){var i=d.ctrlKey||d.metaKey;if(!i&&d.keyCode===27){var g=c("div.value-combo");if(g.is(":visible")&&g.parent().hasClass("combo-editor")){return}if(c("div.property-detail").is(":visible")){a.removeAllPropertyDetailDialogs();d.stopImmediatePropagation();d.preventDefault()}else{var h=c(d.target);if(h.length){var j=c(".cancellable");if(j.length){var e=null;var f=null;c.each(j,function(k,m){var l=c(m);var n=l.css("zIndex");if(l.is(":visible")&&(n!==null&&typeof n!=="undefined")){n=parseInt(n,10);if(e===null||n>e){e=n;f=l}}});if(f!==null){if(f.hasClass("modal")){f.modal("hide")}else{f.hide()}d.stopImmediatePropagation();d.preventDefault();return}}if(top!==window){if(typeof parent.nf!=="undefined"&&typeof parent.nf.Shell!=="undefined"){parent.$("#shell-close-button").click();d.stopImmediatePropagation();d.preventDefault();return}}}}}else{if(i){if(d.keyCode===82){d.preventDefault()}}else{if(!c("input, textarea").is(":focus")&&(d.keyCode==8||d.keyCode===46)){d.preventDefault()}}}})});var a={removeAllPropertyDetailDialogs:function(){var c=b("body").find("div.property-detail");c.find("div.nf-editor").nfeditor("destroy");c.find("div.value-combo").combo("destroy");c.hide().remove()}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],function(c){return(nf.Dialog=b(c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Dialog=b(require("jquery")))}else{nf.Dialog=b(a.$)}}}(this,function(b){b(document).ready(function(){b("#nf-ok-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){b("#nf-ok-dialog-content").empty()}}});b("#nf-yes-no-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){b("#nf-yes-no-dialog-content").empty();b("#nf-yes-no-dialog").modal("setButtonModel",[])}}})});var a={showOkDialog:function(c){c=b.extend({headerText:"",dialogContent:""},c);var d=b("<p></p>").append(c.dialogContent);b("#nf-ok-dialog-content").append(d).append("</br>");b("#nf-ok-dialog").modal("setButtonModel",[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){b("#nf-ok-dialog").modal("hide");if(typeof c.okHandler==="function"){c.okHandler.call(this)}}}}]);b("#nf-ok-dialog").modal("setHeaderText",c.headerText).modal("show")},showYesNoDialog:function(c){c=b.extend({headerText:"",dialogContent:"",yesText:"Yes",noText:"No"},c);var d=b("<p></p>").append(c.dialogContent);b("#nf-yes-no-dialog-content").append(d);b("#nf-yes-no-dialog").modal("setButtonModel",[{buttonText:c.yesText,color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){b("#nf-yes-no-dialog").modal("hide");if(typeof c.yesHandler==="function"){c.yesHandler.call(this)}}}},{buttonText:c.noText,color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){b("#nf-yes-no-dialog").modal("hide");if(typeof c.noHandler==="function"){c.noHandler.call(this)}}}}]);b("#nf-yes-no-dialog").modal("setHeaderText",c.headerText).modal("show")},showDisconnectedFromClusterMessage:function(c){a.showOkDialog({headerText:"Cluster Connection",dialogContent:"This node is currently not connected to the cluster. Any modifications to the data flow made here will not replicate across the cluster.",okHandler:function(){if(typeof c==="function"){c.call(this)}}})},showConnectedToClusterMessage:function(c){a.showOkDialog({headerText:"Cluster Connection",dialogContent:"This node just joined the cluster. Any modifications to the data flow made here will replicate across the cluster.",okHandler:function(){if(typeof c==="function"){c.call(this)}}})}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Storage","lodash-core","moment"],function(f,e,d,c,g){return(nf.Common=b(f,e,d,c,g))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Common=b(require("jquery"),require("d3"),require("nf.Storage"),require("lodash-core"),require("moment")))}else{nf.Common=b(a.$,a.d3,a.nf.Storage,a._,a.moment)}}}(this,function(f,e,c,b,h){f(document).ready(function(){var i="images/bg-error.png";f("<img/>").attr("src",i).on("load",function(){f("div.message-pane").css("background-image",i)});f(document).on("mouseenter","span.link",function(){f(this).addClass("link-over")}).on("mouseleave","span.link",function(){f(this).removeClass("link-over")});f(document).on("click","div.nf-checkbox",function(){var k=f(this);var j=k.hasClass("checkbox-unchecked");if(j){k.removeClass("checkbox-unchecked").addClass("checkbox-checked")}else{k.removeClass("checkbox-checked").addClass("checkbox-unchecked")}k.trigger("change",{isChecked:j})});f(document).on("click",".nf-checkbox-label",function(j){f(j.target).parent().find(".nf-checkbox").click()});f(document).ajaxStart(function(){f("div.loading-container").addClass("ajax-loading")}).ajaxStop(function(){f("div.loading-container").removeClass("ajax-loading")});if(c.getItem("jwt")!==null){f("#user-logout-container").css("display","block");g.scheduleTokenRefresh()}f("#user-logout").on("click",function(){c.removeItem("jwt");window.location="../nifi/logout"});f("#user-home").on("click",function(){if(top!==window){parent.window.location="../nifi"}else{window.location="../nifi"}})});var d=null;var a=[{text:"view the user interface",value:"flow",description:"Allows users to view the user interface"},{text:"access the controller",value:"controller",description:"Allows users to view/modify the controller including Reporting Tasks, Controller Services, Parameter Contexts, and Nodes in the Cluster"},{text:"access parameter contexts",value:"parameter-contexts",description:"Allows users to view/modify Parameter Contexts"},{text:"query provenance",value:"provenance",description:"Allows users to submit a Provenance Search and request Event Lineage"},{text:"access restricted components",value:"restricted-components",description:"Allows users to create/modify restricted components assuming other permissions are sufficient"},{text:"access all policies",value:"policies",description:"Allows users to view/modify the policies for all components"},{text:"access users/user groups",value:"tenants",description:"Allows users to view/modify the users and user groups"},{text:"retrieve site-to-site details",value:"site-to-site",description:"Allows other NiFi instances to retrieve Site-To-Site details of this NiFi"},{text:"view system diagnostics",value:"system",description:"Allows users to view System Diagnostics"},{text:"proxy user requests",value:"proxy",description:"Allows proxy machines to send requests on the behalf of others"},{text:"access counters",value:"counters",description:"Allows users to view/modify Counters"}];var g={ANONYMOUS_USER_TEXT:"Anonymous user",config:{sensitiveText:"Sensitive value set",tooltipConfig:{style:{classes:"nifi-tooltip"},show:{solo:true,effect:function(i){f(this).slideDown(100)}},hide:{effect:function(i){f(this).slideUp(100)}},position:{at:"top center",my:"bottom center"}}},SUPPORTS_SVG:!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,currentUser:undefined,sortVersion:function(j,t){if(j===t){return 0}var p=j.split(/-/);var u=t.split(/-/);if(p.length>=1&&u.length>=1){var r=p[0].split(/\./);var o=u[0].split(/\./);if(r.length>=1&&o.length>=1){var m=Math.min(r.length,o.length);for(var n=0;n<m;n++){var s=parseInt(r[n],10);var l=parseInt(o[n],10);if(isNaN(s)&&isNaN(l)){continue}else{if(isNaN(s)){return -1}else{if(isNaN(l)){return 1}}}if(s!==l){return s-l}}if(r.length===o.length){if(p.length===u.length){var q=g.substringAfterFirst(j,p[0]);var k=g.substringAfterFirst(t,u[0]);return q===k?0:q>k?1:-1}else{return u.length-p.length}}else{return r.length-o.length}}else{if(r.length>=1){return 1}else{if(o.length>=1){return -1}else{return 0}}}}else{if(p.length>=1){return 1}else{if(u.length>=1){return -1}else{return 0}}}},sortType:function(i,l){var j=function(o,m){var p=g.formatBundle(o.bundle);var n=g.formatBundle(m.bundle);return p===n?0:p>n?1:-1};var k=function(t,s){if(i.columnId==="version"){var r=g.isDefinedAndNotNull(t.bundle[i.columnId])?t.bundle[i.columnId]:"";var p=g.isDefinedAndNotNull(s.bundle[i.columnId])?s.bundle[i.columnId]:"";var n=g.sortVersion(r,p);return n===0?j(t,s):n}else{if(i.columnId==="type"){var q=g.substringAfterLast(t[i.columnId],".");var o=g.substringAfterLast(s[i.columnId],".");return q===o?0:q>o?1:-1}else{var m=g.isDefinedAndNotNull(t[i.columnId])?t[i.columnId]:"";var u=g.isDefinedAndNotNull(s[i.columnId])?s[i.columnId]:"";return m===u?j(t,s):m>u?1:-1}}};l.sort(k,i.sortAsc)},typeFormatter:function(n,j,m,l,i){var k="";if(i.restricted===true){k+='<div class="view-usage-restriction fa fa-shield"></div><span class="hidden row-id">'+g.escapeHtml(i.id)+"</span>"}else{k+='<div class="fa"></div>'}k+=g.escapeHtml(m);return k},genericValueFormatter:function(m,j,l,k,i){return g.escapeHtml(l)},typeBundleFormatter:function(m,j,l,k,i){return g.escapeHtml(g.formatBundle(i.bundle))},typeVersionFormatter:function(n,j,m,l,i){var k="";if(g.isDefinedAndNotNull(i.bundle)){k+=('<div style="float: left;">'+g.escapeHtml(i.bundle.version)+"</div>")}else{k+='<div style="float: left;">unversioned</div>'}if(!g.isEmpty(i.controllerServiceApis)){k+='<div class="controller-service-apis fa fa-list" title="Compatible Controller Service" style="margin-left: 4px;"></div><span class="hidden row-id">'+g.escapeHtml(i.id)+"</span>"}k+='<div class="clear"></div>';return k},instanceTypeFormatter:function(m,j,l,k,i){if(!i.permissions.canRead){return""}return g.escapeHtml(g.formatType(i.component))},instanceBundleFormatter:function(m,j,l,k,i){if(!i.permissions.canRead){return""}return g.typeBundleFormatter(m,j,l,k,i.component)},getVersionControlTooltip:function(i){return i.stateExplanation},formatClassName:function(i){return g.substringAfterLast(i.type,".")},formatType:function(i){var j=g.formatClassName(i);if(i.bundle.version!=="unversioned"){j+=(" "+i.bundle.version)}return j},formatBundle:function(i){var j="";if(i.group!=="default"){j=i.group+" - "}return j+i.artifact},setCurrentUser:function(i){g.currentUser=i},scheduleTokenRefresh:function(){if(d!==null){clearInterval(d)}var i=g.MILLIS_PER_MINUTE;var j=function(){var l=c.getItemExpiration("jwt");if(l!==null){var n=new Date(l);var m=new Date();var k=n.valueOf()-m.valueOf()-(30*g.MILLIS_PER_SECOND);if(k<i){if(f("#current-user").text()!==g.ANONYMOUS_USER_TEXT&&!f("#anonymous-user-alert").is(":visible")){f("#anonymous-user-alert").show().qtip(f.extend({},g.config.tooltipConfig,{content:"Your session will expire soon. Please log in again to avoid being automatically logged out.",position:{my:"top right",at:"bottom left"}}))}}}};j();d=setInterval(j,i)},setAnonymousUserLabel:function(){var i=f("#anonymous-user-alert");if(i.data("qtip")){i.qtip("api").destroy(true)}i.show().qtip(f.extend({},g.config.tooltipConfig,{content:"You are accessing with limited authority. Log in or request an account to access with additional authority granted to you by an administrator.",position:{my:"top right",at:"bottom left"}}));f("#current-user").text(g.ANONYMOUS_USER_TEXT).show()},getJwtPayload:function(j){if(g.isDefinedAndNotNull(j)){var i=j.split(/\./);if(i.length!==3){return""}var l=f.base64.atob(i[1]);var k=JSON.parse(l);if(g.isDefinedAndNotNull(k)){return k}else{return null}}return null},canVersionFlows:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.canVersionFlows===true}else{return false}},canAccessProvenance:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.provenancePermissions.canRead===true}else{return false}},canAccessRestrictedComponents:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.restrictedComponentsPermissions.canWrite===true}else{return false}},canAccessComponentRestrictions:function(j){if(g.isDefinedAndNotNull(g.currentUser)){if(g.currentUser.restrictedComponentsPermissions.canWrite===true){return true}var i=function(m){if(g.isEmpty(g.currentUser.componentRestrictionPermissions)){return false}var l=false;f.each(g.currentUser.componentRestrictionPermissions,function(n,o){if(o.requiredPermission.id===m.id){if(o.permissions.canWrite===true){l=true;return false}}});return l};var k=true;if(g.isEmpty(j)){k=false}else{f.each(j,function(l,m){if(!i(m.requiredPermission)){k=false;return false}})}return k}else{return false}},canAccessCounters:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.countersPermissions.canRead===true}else{return false}},canModifyCounters:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.countersPermissions.canRead===true&&g.currentUser.countersPermissions.canWrite===true}else{return false}},canAccessTenants:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.tenantsPermissions.canRead===true}else{return false}},canModifyTenants:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.tenantsPermissions.canRead===true&&g.currentUser.tenantsPermissions.canWrite===true}else{return false}},canModifyParameterContexts:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.parameterContextPermissions.canRead===true&&g.currentUser.parameterContextPermissions.canWrite===true}else{return false}},canAccessPolicies:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.policiesPermissions.canRead===true}else{return false}},canModifyPolicies:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.policiesPermissions.canRead===true&&g.currentUser.policiesPermissions.canWrite===true}else{return false}},canAccessController:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.controllerPermissions.canRead===true}else{return false}},canModifyController:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.controllerPermissions.canRead===true&&g.currentUser.controllerPermissions.canWrite===true}else{return false}},canAccessSystem:function(){if(g.isDefinedAndNotNull(g.currentUser)){return g.currentUser.systemPermissions.canRead===true}else{return false}},addHoverEffect:function(i,k,j){f(document).on("mouseenter",i,function(){f(this).removeClass(k).addClass(j)}).on("mouseleave",i,function(){f(this).removeClass(j).addClass(k)});return f(i).addClass(k)},toggleScrollable:function(i){if(f(i).is(":visible")){if(i.offsetHeight<i.scrollHeight||i.offsetWidth<i.scrollWidth){f(i).addClass("scrollable")}else{f(i).removeClass("scrollable")}}},determineContrastColor:function(i){if(parseInt(i,16)>16777215/1.5){return"#000000"}return"#ffffff"},showLogoutLink:function(){if(c.getItem("jwt")===null){f("#user-logout-container").css("display","none")}else{f("#user-logout-container").css("display","block")}},isContentViewConfigured:function(){var i=f("#nifi-content-viewer-url").text();return !g.isBlank(i)},populateField:function(j,i){if(g.isUndefined(i)||g.isNull(i)){return f("#"+j).addClass("unset").text("No value set")}else{if(i===""){return f("#"+j).addClass("blank").text("Empty string set")}else{return f("#"+j).text(i)}}},clearField:function(i){return f("#"+i).removeClass("unset blank").text("")},cleanUpTooltips:function(i,j){i.find(j).each(function(){var l=f(this);if(l.data("qtip")){var k=l.qtip("api");k.destroy(true)}})},formatPropertyTooltip:function(j,l){var m=[];if(g.isDefinedAndNotNull(j)){if(!g.isBlank(j.description)){m.push(g.escapeHtml(j.description))}if(!g.isBlank(j.defaultValue)){m.push("<b>Default value:</b> "+g.escapeHtml(j.defaultValue))}if(!g.isBlank(j.supportsEl)){m.push("<b>Expression language scope:</b> "+g.escapeHtml(j.expressionLanguageScope))}if(!g.isBlank(j.identifiesControllerService)){var i=g.formatType({type:j.identifiesControllerService,bundle:j.identifiesControllerServiceBundle});var k=g.formatBundle(j.identifiesControllerServiceBundle);m.push("<b>Requires Controller Service:</b> "+g.escapeHtml(i+" from "+k))}}if(g.isDefinedAndNotNull(l)){if(!g.isEmpty(l.previousValues)){var n=[];f.each(l.previousValues,function(p,o){n.push("<li>"+g.escapeHtml(o.previousValue)+" - "+g.escapeHtml(o.timestamp)+" ("+g.escapeHtml(o.userIdentity)+")</li>")});m.push('<b>History:</b><ul class="property-info">'+n.join("")+"</ul>")}}if(m.length>0){return m.join("<br/><br/>")}else{return null}},formatProperty:function(i,j){return'<div><span class="label">'+g.formatValue(i)+": </span>"+g.formatValue(j)+"</div>"},formatValue:function(i){if(g.isDefinedAndNotNull(i)){if(i===""){return'<span class="blank" style="font-size: 13px; padding-top: 2px;">Empty string set</span>'}else{return g.escapeHtml(i)}}else{return'<span class="unset" style="font-size: 13px; padding-top: 2px;">No value set</span>'}},escapeHtml:(function(){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2f;"};return function(j){if(g.isDefinedAndNotNull(j)){return String(j).replace(/[&<>"'\/]/g,function(k){return i[k]})}else{return""}}}()),isSensitiveProperty:function(i){if(g.isDefinedAndNotNull(i)){return i.sensitive===true}else{return false}},isRequiredProperty:function(i){if(g.isDefinedAndNotNull(i)){return i.required===true}else{return false}},isDynamicProperty:function(i){if(g.isDefinedAndNotNull(i)){return i.dynamic===true}else{return false}},getAllowableValues:function(i){if(g.isDefinedAndNotNull(i)){return i.allowableValues}else{return null}},supportsEl:function(i){if(g.isDefinedAndNotNull(i)){return i.supportsEl===true}else{return false}},formatUnorderedList:function(j){if(f.isArray(j)){var i=f('<ul class="result"></ul>');f.each(j,function(l,m){var k=f("<li></li>").appendTo(i);if(m instanceof jQuery){k.append(m)}else{k.text(m)}});return i}else{return null}},substringAfterLast:function(m,l){var j="";var k=m.lastIndexOf(l);if(k>=0){var i=k+l.length;if(i<m.length){j=m.substr(i)}}return j},substringAfterFirst:function(m,l){var j="";var k=m.indexOf(l);if(k>=0){var i=k+l.length;if(i<m.length){j=m.substr(i)}}return j},substringBeforeLast:function(l,k){var i="";var j=l.lastIndexOf(k);if(j>=0){i=l.substr(0,j)}return i},substringBeforeFirst:function(l,k){var i="";var j=l.indexOf(k);if(j>=0){i=l.substr(0,j)}return i},setCursor:function(j,i){if(i){f("#"+j).addClass("pointer")}else{f("#"+j).removeClass("pointer")}},getAccessToken:function(i){return f.Deferred(function(j){if(c.hasItem("jwt")){f.ajax({type:"POST",url:i}).done(function(k){j.resolve(k)}).fail(function(){j.reject()})}else{j.resolve("")}}).promise()},MILLIS_PER_DAY:86400000,MILLIS_PER_HOUR:3600000,MILLIS_PER_MINUTE:60000,MILLIS_PER_SECOND:1000,loadBalanceStrategyOptions:[{text:"Do not load balance",value:"DO_NOT_LOAD_BALANCE",description:"Do not load balance FlowFiles between nodes in the cluster."},{text:"Partition by attribute",value:"PARTITION_BY_ATTRIBUTE",description:"Determine which node to send a given FlowFile to based on the value of a user-specified FlowFile Attribute. All FlowFiles that have the same value for said Attribute will be sent to the same node in the cluster."},{text:"Round robin",value:"ROUND_ROBIN",description:"FlowFiles will be distributed to nodes in the cluster in a Round-Robin fashion."},{text:"Single node",value:"SINGLE_NODE",description:"All FlowFiles will be sent to the same node. Which node they are sent to is not defined."}],loadBalanceCompressionOptions:[{text:"Do not compress",value:"DO_NOT_COMPRESS",description:"FlowFiles will not be compressed"},{text:"Compress attributes only",value:"COMPRESS_ATTRIBUTES_ONLY",description:"FlowFiles' attributes will be compressed, but the FlowFiles' contents will not be"},{text:"Compress attributes and content",value:"COMPRESS_ATTRIBUTES_AND_CONTENT",description:"FlowFiles' attributes and content will be compressed"}],formatDuration:function(l){l=l<1?0:l;var n=l/g.MILLIS_PER_DAY;n=n>=1?parseInt(n,10):0;l%=g.MILLIS_PER_DAY;var i=l/g.MILLIS_PER_HOUR;i=i>=1?parseInt(i,10):0;l%=g.MILLIS_PER_HOUR;var j=l/g.MILLIS_PER_MINUTE;j=j>=1?parseInt(j,10):0;l%=g.MILLIS_PER_MINUTE;var m=l/g.MILLIS_PER_SECOND;m=m>=1?parseInt(m,10):0;l=Math.floor(l%g.MILLIS_PER_SECOND);var k=g.pad(i,2,"0")+":"+g.pad(j,2,"0")+":"+g.pad(m,2,"0")+"."+g.pad(l,3,"0");if(n>0){return n+" days and "+k}else{return k}},formatPredictedDuration:function(i){if(i===0){return"now"}return h.duration(i,"ms").humanize()},BYTES_IN_KILOBYTE:1024,BYTES_IN_MEGABYTE:1048576,BYTES_IN_GIGABYTE:1073741824,BYTES_IN_TERABYTE:1099511627776,formatDataSize:function(j){var i=parseFloat(j/g.BYTES_IN_TERABYTE);if(i>1){return i.toFixed(2)+" TB"}i=parseFloat(j/g.BYTES_IN_GIGABYTE);if(i>1){return i.toFixed(2)+" GB"}i=parseFloat(j/g.BYTES_IN_MEGABYTE);if(i>1){return i.toFixed(2)+" MB"}i=parseFloat(j/g.BYTES_IN_KILOBYTE);if(i>1){return i.toFixed(2)+" KB"}return parseFloat(j).toFixed(2)+" bytes"},formatInteger:function(j){var i=j+"";var k=/(\d+)(\d{3})/;while(k.test(i)){i=i.replace(k,"$1,$2")}return g.escapeHtml(i)},formatFloat:function(i){if(g.isUndefinedOrNull(i)){return 0+""}return i.toFixed(2)+""},pad:function(l,j,k){var i=l+"";while(i.length<j){i=k+i}return i},formatDateTime:function(i){return g.pad(i.getMonth()+1,2,"0")+"/"+g.pad(i.getDate(),2,"0")+"/"+g.pad(i.getFullYear(),2,"0")+" "+g.pad(i.getHours(),2,"0")+":"+g.pad(i.getMinutes(),2,"0")+":"+g.pad(i.getSeconds(),2,"0")+"."+g.pad(i.getMilliseconds(),3,"0")},parseDateTime:function(m){if(!g.isDefinedAndNotNull(m)){return new Date()}if(m==="No value set"){return new Date()}if(m==="Empty string set"){return new Date()}var t=m.split(/ /);if(t.length!==3){return new Date()}var j=t[0].split(/\//);var i=t[1].split(/:/);if(j.length!==3||i.length!==3){return new Date()}var o=parseInt(j[2],10);var n=parseInt(j[0],10)-1;var p=parseInt(j[1],10);var q=parseInt(i[0],10);var l=parseInt(i[1],10);var s=i[2].split(/\./);var r=parseInt(s[0],10);var k=0;if(s.length===2){k=parseInt(s[1],10)}return new Date(o,n,p,q,l,r,k)},parseDuration:function(i){var j=i.split(/:/);if(j.length!==3){return 0}var k=j[2].split(/\./);if(k.length===2){return new Date(1970,0,1,parseInt(j[0],10),parseInt(j[1],10),parseInt(k[0],10),parseInt(k[1],10)).getTime()}else{return new Date(1970,0,1,parseInt(j[0],10),parseInt(j[1],10),parseInt(j[2],10),0).getTime()}},parseSize:function(k){var l=k.split(/ /);var j=parseFloat(l[0].replace(/,/g,""));var i=l[1];if(i==="KB"){return j*1024}else{if(i==="MB"){return j*1024*1024}else{if(i==="GB"){return j*1024*1024*1024}else{if(i==="TB"){return j*1024*1024*1024*1024}else{return j}}}}},parseCount:function(k){var j=k.split(/ /,1);if(j.length!==1){return 0}var i=parseInt(j[0].replace(/,/g,""),10);if(isNaN(i)){return 0}return i},isDefinedAndNotNull:function(i){return !g.isUndefined(i)&&!g.isNull(i)},isUndefinedOrNull:function(i){return g.isUndefined(i)||g.isNull(i)},isUndefined:function(i){return typeof i==="undefined"},isBlank:function(i){return g.isUndefined(i)||g.isNull(i)||f.trim(i)===""},isNull:function(i){return i===null},isEmpty:function(i){return f.isArray(i)?i.length===0:true},doBulletinsDiffer:function(k,l){if(f.isArray(k)&&f.isArray(l)){if(k.length===l.length){for(var j=0;j<k.length;j++){if(k[j].id!==l[j].id||k[j].canRead!==l[j].canRead){return true}}}else{return true}}else{if(f.isArray(k)||f.isArray(l)){return true}}return false},getFormattedBulletins:function(j){var i=[];f.each(j,function(l,m){if(m.canRead===true){var k=m.bulletin;var p="";if(g.isDefinedAndNotNull(k.nodeAddress)){p="-&nbsp;"+g.escapeHtml(k.nodeAddress)+"&nbsp;-&nbsp;"}var o=f("<pre></pre>").css({"white-space":"pre-wrap"}).text(k.message);var n=f("<div>"+g.escapeHtml(k.timestamp)+"&nbsp;"+p+"&nbsp;<b>"+g.escapeHtml(k.level)+"</b>&nbsp;</div>").append(o);i.push(n)}});return i},getFormattedServiceApis:function(j){var i=[];f.each(j,function(m,n){var k=g.formatType({type:n.type,bundle:n.bundle});var l=g.formatBundle(n.bundle);i.push(f("<div></div>").text(k+" from "+l))});return i},getFormattedGarbageCollections:function(j){j.sort(function(l,k){return k.collectionCount-l.collectionCount});var i=[];f.each(j,function(m,k){var l=f('<span style="font-weight: bold;"></span>').text(k.name);var n=f("<span></span>").text(" - "+k.collectionCount+" times ("+k.collectionTime+")");var o=f("<div></div>").append(l).append(n);i.push(o)});return i},isGlobalPolicy:function(i){return g.getPolicyTypeListing(i)!==null},getPolicyTypeListing:function(i){return a.find(function(j){return i===j.value})},getComponentName:function(i){return i.permissions.canRead===true?i.component.name:i.id},getComboOptionText:function(i,k){var j=i.find(function(l){return l.value===k});return g.isDefinedAndNotNull(j)?j.text:undefined},throttle:function(i,j){return b.throttle(i,j)},getKeyValue:function(j,i){return i.split(".").reduce(function(l,k){return(typeof l===undefined||l===null)?l:(typeof l[k]=="function")?l[k]():l[k]},j)}};return g}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Dialog","nf.Common"],function(d,c,e){return(nf.ErrorHandler=b(d,c,e))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ErrorHandler=b(require("jquery"),require("nf.Dialog"),require("nf.Common")))}else{nf.ErrorHandler=b(a.$,a.nf.Dialog,a.nf.Common)}}}(this,function(c,b,d){var a={handleAjaxError:function(h,e,f){if(e==="canceled"){if(c("#splash").is(":visible")){c("#message-title").text("Session Expired");c("#message-content").text("Your session has expired. Please reload to log in again.");c("#message-pane").show()}else{b.showOkDialog({headerText:"Session Expired",dialogContent:"Your session has expired. Please press Ok to log in again.",okHandler:function(){window.location="/nifi"}})}return}if(c("#splash").is(":visible")){if(h.status===401){c("#message-title").text("Unauthorized")}else{if(h.status===403){c("#message-title").text("Insufficient Permissions")}else{if(h.status===409){c("#message-title").text("Invalid State")}else{c("#message-title").text("An unexpected error has occurred")}}}if(c.trim(h.responseText)===""){c("#message-content").text("Please check the logs.")}else{c("#message-content").text(h.responseText)}c("#message-pane").show();return}if(h.status===400||h.status===404||h.status===409||h.status===503){b.showOkDialog({headerText:"Error",dialogContent:d.escapeHtml(h.responseText)})}else{if(h.status===403){b.showOkDialog({headerText:"Insufficient Permissions",dialogContent:d.escapeHtml(h.responseText)})}else{if(h.status<99||h.status===12007||h.status===12029){var g="Please ensure the application is running and check the logs for any errors.";if(d.isDefinedAndNotNull(e)){if(e==="timeout"){g="Request has timed out. Please ensure the application is running and check the logs for any errors."}else{if(e==="abort"){g="Request has been aborted."}else{if(e==="No Transport"){g="Request transport mechanism failed. Please ensure the host where the application is running is accessible."}}}}c("#message-title").text("Unable to communicate with NiFi");c("#message-content").text(g)}else{if(h.status===401){c("#message-title").text("Unauthorized");if(c.trim(h.responseText)===""){c("#message-content").text("Authentication is required to use this NiFi.")}else{c("#message-content").text(h.responseText)}}else{if(h.status===500){c("#message-title").text("An unexpected error has occurred");if(c.trim(h.responseText)===""){c("#message-content").text("An error occurred communicating with the application core. Please check the logs and fix any configuration issues before restarting.")}else{c("#message-content").text(h.responseText)}}else{if(h.status===200||h.status===201){c("#message-title").text("Parse Error");if(c.trim(h.responseText)===""){c("#message-content").text("Unable to interpret response from NiFi.")}else{c("#message-content").text(h.responseText)}}else{c("#message-title").text(h.status+": Unexpected Response");c("#message-content").text("An unexpected error has occurred. Please check the logs.")}}}}c("#message-pane").show()}}},handleConfigurationUpdateAjaxError:function(h,e,f){if(h.status===400){var i=h.responseText.split("\n");var g;if(i.length===1){g=c("<span></span>").text(i[0])}else{g=d.formatUnorderedList(i)}b.showOkDialog({dialogContent:g,headerText:"Configuration Error"})}else{a.handleAjaxError(h,e,f)}}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","nf.ClusterSummary","nf.ErrorHandler","nf.Dialog","nf.Common"],function(e,h,c,g,d,f){return(nf.ComponentState=b(e,h,c,g,d,f))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ComponentState=b(require("jquery"),require("Slick"),require("nf.ClusterSummary"),require("nf.ErrorHandler"),require("nf.Dialog"),require("nf.Common")))}else{nf.ComponentState=b(a.$,a.Slick,a.nf.ClusterSummary,a.nf.ErrorHandler,a.nf.Dialog,a.nf.Common)}}}(this,function(f,b,k,j,d,c){var l=function(){var o=[{id:"key",field:"key",name:"Key",sortable:true,resizable:true,formatter:c.genericValueFormatter},{id:"value",field:"value",name:"Value",sortable:true,resizable:true,formatter:c.genericValueFormatter}];if(k.isConnectedToCluster()){o.push({id:"scope",field:"scope",name:"Scope",sortable:true,resizable:true,formatter:c.genericValueFormatter})}return o};var g=function(){var o=f("#component-state-table").data("gridInstance");if(c.isDefinedAndNotNull(o)){var p=o.getData();p.setFilterArgs({searchString:m()});p.refresh()}};var a=function(q,p){if(p.searchString===""){return true}try{var u=new RegExp(p.searchString,"i")}catch(r){return false}var t=q.key.search(u)>=0;var o=q.value.search(u)>=0;var s=false;if(c.isDefinedAndNotNull(q.scope)){s=q.scope.search(u)>=0}return t||o||s};var e=function(o,q){var p=function(t,r){var s=c.isDefinedAndNotNull(t[o.columnId])?t[o.columnId]:"";var u=c.isDefinedAndNotNull(r[o.columnId])?r[o.columnId]:"";return s===u?0:s>u?1:-1};q.sort(p,o.sortAsc)};var m=function(){return f("#component-state-filter").val()};var i=function(){var o=f("#component-state-table").data("gridInstance");var p=o.getData();p.setItems([]);f("#component-state-partial-results-container").hide();f("#displayed-component-state-entries").text("0");f("#total-component-state-entries").text("0")};var h=function(o,p){var q=0;var s=0;var t=false;var r=f("#component-state-table").data("gridInstance");r.setColumns(l());var u=r.getData();u.beginUpdate();if(c.isDefinedAndNotNull(o)){f.each(o.state,function(v,w){u.addItem(f.extend({id:q++,scope:w.clusterNodeAddress},w))});s+=o.totalEntryCount;if(c.isDefinedAndNotNull(o.state)&&o.totalEntryCount!==o.state.length){t=true}}if(c.isDefinedAndNotNull(p)){f.each(p.state,function(v,w){u.addItem(f.extend({id:q++,scope:"Cluster"},w))});s+=p.totalEntryCount;if(c.isDefinedAndNotNull(p.state)&&p.totalEntryCount!==p.state.length){t=true}}u.endUpdate();u.reSort();if(t){f("#component-state-partial-results-container").show()}f("#total-component-state-entries").text(c.formatInteger(s))};var n=function(){f("#component-state-name").text("");f("#component-state-description").text("");f("#component-state-filter").val("");f("#clear-link").removeClass("disabled").attr("title","");i();f("#component-state-table").removeData("component")};return{init:function(){f("#component-state-filter").on("keyup",function(){g()});f("#component-state-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Component State",buttons:[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){f(this).modal("hide")}}}],handler:{close:function(){n()},resize:function(){f("#component-state-description").width(f("#component-state-dialog").find(".dialog-content").innerWidth()-1).text(f("#component-state-description").attr("title")).ellipsis()}}});f("#clear-link").on("click",function(){if(f(this).hasClass("disabled")===false){var s=f("#component-state-table");var u=s.data("gridInstance");var t=u.getDataLength();if(t>0){var r=s.data("component");f.ajax({type:"POST",url:r.uri+"/state/clear-requests",dataType:"json"}).done(function(v){i();h()}).fail(j.handleAjaxError)}else{d.showOkDialog({headerText:"Component State",dialogContent:"This component has no state to clear."})}}});var o={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:false,enableColumnReorder:false,autoEdit:false,rowHeight:24};var q=new b.Data.DataView({inlineFilters:false});q.setItems([]);q.setFilterArgs({searchString:"",property:"key"});q.setFilter(a);e({columnId:"key",sortAsc:true},q);var p=new b.Grid("#component-state-table",q,l(),o);p.setSelectionModel(new b.RowSelectionModel());p.registerPlugin(new b.AutoTooltips());p.setSortColumn("key",true);p.onSort.subscribe(function(s,r){e({columnId:r.sortCol.field,sortAsc:r.sortAsc},q)});q.onRowCountChanged.subscribe(function(s,r){p.updateRowCount();p.render();f("#displayed-component-state-entries").text(r.current)});q.onRowsChanged.subscribe(function(s,r){p.invalidateRows(r.rows);p.render()});f("#component-state-table").data("gridInstance",p);f("#displayed-component-state-entries").text("0");f("#total-component-state-entries").text("0")},showState:function(o,p){return f.ajax({type:"GET",url:o.uri+"/state",dataType:"json"}).done(function(r){var s=r.componentState;var q=f("#component-state-table");h(s.localState,s.clusterState);f("#component-state-dialog").modal("show");f("#component-state-name").text(o.component.name);f("#component-state-description").width(f("#component-state-dialog").find(".dialog-content").innerWidth()-1).text(s.stateDescription).ellipsis();q.data("component",o);if(p===false){f("#clear-link").addClass("disabled").attr("title","Component state can only be cleared when the component is not actively running")}var t=q.data("gridInstance");t.resizeCanvas()}).fail(j.handleAjaxError)}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common"],function(c,d){return(nf.Shell=b(c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Shell=b(require("jquery"),require("nf.Common")))}else{nf.Shell=b(a.$,a.nf.Common)}}}(this,function(b,e){b(document).ready(function(){b("#shell-dialog").modal({scrollableContentStyle:"scrollable",header:false,footer:false,responsive:{x:false,y:false}});b("#shell-close-button").click(function(){b("#shell-dialog").modal("hide")});b("#shell-undock-button").click(function(){var f=b("#shell-iframe").attr("src");if(!e.isBlank(f)){window.open(f);b("#shell-dialog").modal("hide")}})});var d=null;var c=null;var a=null;return{init:function(f){a=f},resizeContent:function(f){var g=f.find(".shell-content-container");g.css({width:f.width(),height:f.height()-28-40});f.trigger("shell:content:resize")},resizeIframe:function(f){var g=f.find("#shell-iframe");g.css({width:f.width(),height:f.height()-28-40});f.trigger("shell:iframe:resize")},showPage:function(f,g){if(e.isDefinedAndNotNull(a)){a.hide()}return b.Deferred(function(h){var i=b("#shell");if(e.isNull(g)||e.isUndefined(g)){g=true}b("#shell-dialog").modal("setCloseHandler",function(){i.empty();h.resolve()});b("#shell-dialog").modal("setOpenHandler",function(){e.toggleScrollable(b("#"+this.find(".tab-container").attr("id")+"-content").get(0))});b("#shell-dialog").modal("show");if(g){b("#shell-undock-button").show()}else{b("#shell-undock-button").hide()}var j=b("<iframe/>",{id:"shell-iframe",frameBorder:"0",src:f}).css({width:i.width(),height:i.height()-28}).appendTo(i)}).promise()},showContent:function(f){if(e.isDefinedAndNotNull(a)){a.hide()}return b.Deferred(function(g){var k=b(f);if(k.length){var h=b("#shell");var j=k.parent();k.detach();b("#shell-dialog").modal("setCloseHandler",function(){var m=b(".combo");for(var n=0,l=m.length;n<l;n++){if(b(m[n]).is(":visible")){b(m[n]).combo("close")}}g.resolve();k.hide().detach().appendTo(j);h.empty()});b("#shell-undock-button").hide();b("#shell-dialog").modal("show");var i=b("<div>").addClass("shell-content-container").css({width:h.width(),height:h.height()}).append(k).appendTo(h);k.show()}}).promise()}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common"],function(c,d){return(nf.Client=b(c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Client=b(require("jquery"),require("nf.Common")))}else{nf.Client=b(a.$,a.nf.Common)}}}(this,function(b,c){var a=null;return{init:function(){return b.ajax({type:"GET",url:"../nifi-api/flow/client-id",}).done(function(d){a=d})},getRevision:function(e){return{clientId:a,version:e.revision.version}},isNewerRevision:function(f,d){if(c.isDefinedAndNotNull(f)){var g=f.revision;var e=d.revision;return e.version>=g.version}else{return true}}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common"],function(c,d){return(nf.Clipboard=b(c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Clipboard=b(require("jquery"),require("nf.Common")))}else{nf.Clipboard=b(a.$,a.nf.Common)}}}(this,function(e,f){var a="copy";var d="paste";var c=null;var b={};return{addListener:function(h,g){b[h]=g},removeListener:function(g){if(f.isDefinedAndNotNull(b[g])){delete b[g]}},copy:function(h){c=h;for(var g in b){b[g].call(g,a,c)}},isCopied:function(){return f.isDefinedAndNotNull(c)},paste:function(){return e.Deferred(function(g){if(f.isDefinedAndNotNull(c)){var i=c;g.resolve(i);c=null;for(var h in b){b[h].call(h,d,i)}}else{g.reject()}}).promise()}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common","nf.Shell","nf.Dialog","nf.Storage","nf.Client"],function(g,h,c,f,e,d){return(nf.CustomUi=b(g,h,c,f,e,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.CustomUi=b(require("jquery"),require("nf.Common"),require("nf.Shell"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client")))}else{nf.CustomUi=b(a.$,a.nf.Common,a.nf.Shell,a.nf.Dialog,a.nf.Storage,a.nf.Client)}}}(this,function(e,f,a,d,c,b){return{showCustomUi:function(g,i,h){return e.Deferred(function(j){f.getAccessToken("../nifi-api/access/ui-extension-token").done(function(l){e("#shell-close-button");var k=b.getRevision(g);var m={id:g.id,revision:k.version,clientId:k.clientId,editable:h,disconnectedNodeAcknowledged:c.isDisconnectionAcknowledged()};if(!f.isBlank(l)){m.access_token=l}a.showPage(".."+i+"?"+e.param(m),false).done(function(){j.resolve()})}).fail(function(){d.showOkDialog({headerText:"Advanced Configuration",dialogContent:"Unable to generate access token for accessing the advanced configuration dialog."});j.resolve()})}).promise()}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["d3","jquery","nf.Common","nf.ErrorHandler","nf.Dialog","nf.Clipboard","nf.Storage"],function(e,g,h,i,f,d,c){return(nf.CanvasUtils=b(e,g,h,i,f,d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.CanvasUtils=b(require("d3"),require("jquery"),require("nf.Common"),require("nf.ErrorHandler"),require("nf.Dialog"),require("nf.Clipboard"),require("nf.Storage")))}else{nf.CanvasUtils=b(a.d3,a.$,a.nf.Common,a.nf.ErrorHandler,a.nf.Dialog,a.nf.Clipboard,a.nf.Storage)}}}(this,function(q,a,g,d,j,e,c){var r;var n;var m;var h;var b;var f=q.map();var s=q.map();var p={storage:{namePrefix:"nifi-view-"},urls:{controller:"../nifi-api/controller"}};var i=2000;var o=2*Math.PI;var k=function(y,w){var v=0;var z=y-1;var x;var u=0;while(v<=z){x=~~((v+z)/2);u=w(x);if(u<0){z=x-1}else{if(u>0){v=x+1}else{break}}}return x};var t=function(v,u){return a.Deferred(function(x){var w=l.getGroupId();var y=m.marshal(v,w);m.create(y).done(function(z){m.move(z.snippet.id,u).done(function(){var B=q.map();var A=function(C,D){if(!B.has(C)){B.set(C,[])}B.get(C).push(D)};v.each(function(C){A(C.type,C.id)});B.each(function(D,C){l.getComponentByType(C).remove(D)});h.refresh();x.resolve()}).fail(d.handleAjaxError).fail(function(){x.reject()})}).fail(d.handleAjaxError).fail(function(){x.reject()})}).promise()};var l={init:function(y,w,v,x,u){r=y;n=w;m=v;h=x;b=u},config:{systemTooltipConfig:{style:{classes:"nifi-tooltip"},show:{solo:true,effect:false},hide:{effect:false},position:{at:"bottom right",my:"top left"}}},getComponentByType:function(u){return b.getComponentByType(u)},getPerimeterPoint:function(u,D){var v=Math.atan2(D.height,D.width);var A=D.width/2;var z=D.height/2;var y=D.x+A;var w=D.y+z;var E=u.x-y;var C=u.y-w;var x=Math.atan2(C,E);x=x%o;if(x<0){x+=o}var B=(Math.PI/2)-x;if((x>=0&&x<v)||(x>=(o-v)&&x<o)){return{x:D.x+D.width,y:w+Math.tan(x)*A}}else{if(x>=v&&x<(Math.PI-v)){return{x:y+Math.tan(B)*z,y:D.y+D.height}}else{if(x>=(Math.PI-v)&&x<(Math.PI+v)){return{x:D.x,y:w-Math.tan(x)*A}}else{return{x:y-Math.tan(B)*z,y:D.y}}}}},queryBulletins:function(w){var u=[];var v=function(B){var z=new URL(window.location);var x=g.substringBeforeLast(z.href,"/nifi");var D=x+"/nifi-api/flow/bulletin-board?"+a.param({sourceId:B.join("|")});if(D.length>i){var y=Math.ceil(B.length/2);var C=B.slice(0,y);if(C.length>0){v(C)}var A=B.slice(y);if(A.length>0){v(A)}}else{u.push(a.ajax({type:"GET",url:D,dataType:"json"}))}};v(w);if(u.length===1){return a.Deferred(function(x){u[0].done(function(y){x.resolve(y)}).fail(function(){x.reject()}).fail(d.handleAjaxError)}).promise()}else{return a.Deferred(function(x){a.when.apply(window,u).done(function(){var z=a.makeArray(arguments);var y=null;var A=[];a.each(z,function(D,B){var C=B[0];var E=C.bulletinBoard;if(y===null){y=E.generated}Array.prototype.push.apply(A,E.bulletins)});A.sort(function(C,B){return B.id-C.id});x.resolve({bulletinBoard:{generated:y,bulletins:A}})}).fail(function(){x.reject()}).fail(d.handleAjaxError)}).promise()}},showComponent:function(v,u){if(g.isDefinedAndNotNull(v)){var w=a.Deferred(function(x){if(v!==r.getGroupId()){r.reload({},v).done(function(){x.resolve()}).fail(function(A,y,z){j.showOkDialog({headerText:"Error",dialogContent:"Unable to load the group for the specified component."});x.reject(A,y,z)})}else{x.resolve()}}).promise();w.done(function(){var x=q.select("#id-"+u);if(!x.empty()){n.show(x)}else{j.showOkDialog({headerText:"Error",dialogContent:"Unable to find the specified component."})}});return w}else{return a.Deferred(function(x){x.reject()}).promise()}},showDeepLink:function(u){l.getSelection().classed("selected",false);if(a("#nf-ok-dialog").is(":visible")===true){a("#nf-ok-dialog").modal("hide")}if("URLSearchParams" in window){var x=new URL(window.location).searchParams;if(!nf.Common.isDefinedAndNotNull(x)){x=new URLSearchParams(new URL(window.location).search)}var v=l.getGroupId();if(nf.Common.isDefinedAndNotNull(x)){var w=[];if(x.get("processGroupId")){v=x.get("processGroupId")}if(x.get("componentIds")){w=x.get("componentIds").split(",")}if(w.length>=1){return l.showComponents(v,w,u)}else{return l.getComponentByType("ProcessGroup").enterGroup(v)}}else{return l.getComponentByType("ProcessGroup").enterGroup(v)}}},showComponents:function(v,x,u){if(g.isDefinedAndNotNull(v)){var w=a.Deferred(function(y){if(v!==r.getGroupId()||u){r.reload({},v).done(function(){y.resolve()}).fail(function(B,z,A){j.showOkDialog({headerText:"Error",dialogContent:"Unable to enter the selected group."});y.reject(B,z,A)})}else{y.resolve()}}).promise();w.done(function(){var y=q.selectAll("g.component, g.connection").filter(function(A){if(x.indexOf(A.id)>=0){x.splice(x.indexOf(A.id),1);return A}});if(x.length>0){var z=a("<p></p>").text("Specified component(s) not found: "+x.join(", ")+".").append("<br/><br/>").append(a("<p>Unable to select component(s).</p>"));j.showOkDialog({headerText:"Error",dialogContent:z})}n.show(y)});return w}},setURLParameters:function(w,x){if("URLSearchParams" in window){if(!g.isDefinedAndNotNull(w)){w=l.getGroupId()}if(!g.isDefinedAndNotNull(x)){x=l.getSelection()}var u=[];x.each(function(A){u.push(A.id)});var v=new URL(window.location);var z=new URL(window.location).searchParams;if(!nf.Common.isDefinedAndNotNull(z)){z=new URLSearchParams(v.search)}if(nf.Common.isDefinedAndNotNull(z)){var z=new URLSearchParams(v.search);z.set("processGroupId",w);z.set("componentIds",u.sort());var y=v.origin+v.pathname;if(g.isDefinedAndNotNull(l.getParentGroupId())||u.length>0){if(!g.isDefinedAndNotNull(l.getParentGroupId())){z.set("processGroupId","root")}if((v.origin+v.pathname+"?"+z.toString()).length<=i){y=v.origin+v.pathname+"?"+z.toString()}else{if(g.isDefinedAndNotNull(l.getParentGroupId())){z.set("componentIds","");y=v.origin+v.pathname+"?"+z.toString()}}}window.history.replaceState({previous_url:v.href},window.document.title,y)}}},getSelection:function(){return q.selectAll("g.component.selected, g.connection.selected")},getSelectionById:function(u){return q.select("#id-"+u)},getCenterForBoundingBox:function(v){var x=r.View.getScale();if(g.isDefinedAndNotNull(v.scale)){x=v.scale}var z=a("#canvas-container");var w=z.width()/x;var y=z.height()/x;var u=[(w/2)-(v.width/2),(y/2)-(v.height/2)];return u},isBoundingBoxInViewport:function(D,G){var A=r.View.getScale();var z=r.View.getTranslate();var C=r.CANVAS_OFFSET;var E=a("#canvas-container");var v=Math.floor(E.width()/A);var w=Math.floor(E.height()/A);var B=Math.ceil(-z[0]/A);var x=Math.ceil(-z[1]/A);var H=B+v;var J=x+w;var y=Math.ceil(D.x);var I=Math.floor(D.x+D.width);var F=Math.ceil(D.y-(C)/A);var u=Math.floor(D.y-(C/A)+D.height);if(G){return !(y<B||I>H||F<x||u>J)}else{return((y>B&&y<H)||(I<H&&I>B))&&((F>x&&F<J)||(u<J&&u>x))}},centerBoundingBox:function(v){var w=r.View.getScale();if(g.isDefinedAndNotNull(v.scale)){w=v.scale}var u=l.getCenterForBoundingBox(v);r.View.transform([(u[0]-v.x)*w,(u[1]-v.y)*w],w)},editable:function(u,v,w){if(l.canModify(u)){if(!u.classed("connectable")){u.call(v.activate)}if(!u.classed("moveable")){u.call(w.activate)}}else{if(u.classed("connectable")){u.call(v.deactivate)}if(u.classed("moveable")){u.call(w.deactivate)}}},transition:function(u,v){if(v&&!u.empty()){return u.transition().duration(400)}else{return u}},position:function(u,v){if(u.empty()){return}return l.transition(u,v).attr("transform",function(w){return"translate("+w.position.x+", "+w.position.y+")"})},ellipsis:function(w,y){y=y.trim();var v=parseInt(w.attr("width"),10);var x=w.node();w.text(y);if(y.length>0&&x.getSubStringLength(0,y.length-1)>v){v-=5;var u=k(y.length,function(z){var A=x.getSubStringLength(0,z);if(A>v){return -1}else{if(A<v){return 1}}return 0});w.text(y.substring(0,u)+String.fromCharCode(8230))}},multilineEllipsis:function(D,G,F){var w=1;var z=F.split(/\s+/).reverse();var C=parseInt(D.attr("x"),10);var B=parseInt(D.attr("y"),10);var v=parseInt(D.attr("width"),10);var H=[];var A=D.append("tspan").attrs({x:C,y:B,width:v});var u=z.pop();while(g.isDefinedAndNotNull(u)){H.push(u);A.text(H.join(" "));if(A.node().getComputedTextLength()>v){H.pop();A.text(H.join(" "));A=D.append("tspan").attrs({x:C,dy:"1.2em",width:v});if(++w>=G){var E=[u].concat(z.reverse());l.ellipsis(A,E.join(" "));break}else{A.text(u);H=[u]}}u=z.pop()}},activeThreadCount:function(w,z,A){var y=z.status.aggregateSnapshot.activeThreadCount;var u=z.status.aggregateSnapshot.terminatedThreadCount;if(y>0||u>0){var v=function(){var B=y+" active threads";if(u>0){B+=" ("+u+" terminated)"}return B};var x=w.select("text.active-thread-count").text(function(){if(u>0){return y+" ("+u+")"}else{return y}}).style("display","block").each(function(){var C=q.select(this);var B=this.getBBox();C.attr("x",function(){return z.dimensions.width-B.width-15});C.selectAll("title").remove()});x.append("title").text(v);w.select("text.active-thread-count-icon").attr("x",function(){var B=x.node().getBBox();if(typeof A==="function"){A(B.width+6)}return z.dimensions.width-B.width-20}).style("fill",function(){if(u>0){return"#ba554a"}else{return"#728e9b"}}).style("display","block").each(function(){var B=q.select(this);B.selectAll("title").remove()}).append("title").text(v)}else{w.selectAll("text.active-thread-count, text.active-thread-count-icon").style("display","none").each(function(){q.select(this).selectAll("title").remove()})}},disableImageHref:function(u){u.on("click.disableImageHref",function(){if(q.event.ctrlKey||q.event.shiftKey){q.event.preventDefault()}})},bulletins:function(u,A,B,z){z=g.isDefinedAndNotNull(z)?z:0;var x=q.select("#bulletin-tip-"+A.id);var w=false;if(!g.isEmpty(A.bulletins)){var y=g.getFormattedBulletins(A.bulletins);w=y.length>0;if(w){var v=g.formatUnorderedList(y)}}if(w){u.select("text.bulletin-icon").each(function(){if(x.empty()){x=B().append("div").attr("id",function(){return"bulletin-tip-"+A.id}).attr("class","tooltip nifi-tooltip")}x.html(function(){return a("<div></div>").append(v).html()});l.canvasTooltip(x,q.select(this))});u.select("text.bulletin-icon").style("visibility","visible");u.select("rect.bulletin-background").style("visibility","visible")}else{if(!x.empty()){x.remove()}u.select("text.bulletin-icon").style("visibility","hidden");u.select("rect.bulletin-background").style("visibility","hidden")}},canvasTooltip:function(u,v){v.on("mouseenter",function(){u.style("top",(q.event.pageY+15)+"px").style("left",(q.event.pageX+15)+"px").style("display","block")}).on("mousemove",function(){u.style("top",(q.event.pageY+15)+"px").style("left",(q.event.pageX+15)+"px")}).on("mouseleave",function(){u.style("display","none")})},canAlign:function(w){var v=true;var u=w.filter(function(y){var x=q.select(this);return l.isConnection(x)});if(w.size()-u.size()<2){v=false}if(l.canModify(w)===false){v=false}return v},isColorable:function(w){if(w.empty()){return false}if(l.canRead(w)===false||l.canModify(w)===false){return false}var v=w.filter(function(A){var z=q.select(this);return l.isProcessor(z)&&l.canModify(z)});var y=w.filter(function(A){var z=q.select(this);return l.isLabel(z)&&l.canModify(z)});var u=v.size()===w.size();var x=y.size()===w.size();return u||x},isConnection:function(u){return u.classed("connection")},isRemoteProcessGroup:function(u){return u.classed("remote-process-group")},isProcessor:function(u){return u.classed("processor")},isLabel:function(u){return u.classed("label")},isInputPort:function(u){return u.classed("input-port")},isOutputPort:function(u){return u.classed("output-port")},isProcessGroup:function(u){return u.classed("process-group")},isFunnel:function(u){return u.classed("funnel")},areRunnable:function(u){if(u.empty()){return true}var v=true;u.each(function(){if(!l.isRunnable(q.select(this))){v=false;return false}});return v},isRunnable:function(u){if(u.size()!==1){return false}if(l.isProcessGroup(u)){return true}if(l.canOperate(u)===false){return false}var w=false;var v=u.datum();if(l.isProcessor(u)||l.isInputPort(u)||l.isOutputPort(u)){w=l.supportsModification(u)&&v.status.aggregateSnapshot.runStatus==="Stopped"}return w},areStoppable:function(u){if(u.empty()){return true}var v=true;u.each(function(){if(!l.isStoppable(q.select(this))){v=false;return false}});return v},isStoppable:function(u){if(u.size()!==1){return false}if(l.isProcessGroup(u)){return true}if(l.canOperate(u)===false){return false}var w=false;var v=u.datum();if(l.isProcessor(u)||l.isInputPort(u)||l.isOutputPort(u)){w=v.status.aggregateSnapshot.runStatus==="Running"}return w},filterEnable:function(u){return u.filter(function(x){var v=q.select(this);var w=v.datum();if(l.isProcessGroup(v)){return true}if(l.canOperate(v)===false){return false}return((l.isProcessor(v)||l.isInputPort(v)||l.isOutputPort(v))&&l.supportsModification(v)&&w.status.aggregateSnapshot.runStatus==="Disabled")})},canEnable:function(u){if(u.empty()){return true}return l.filterEnable(u).size()===u.size()},filterDisable:function(u){return u.filter(function(x){var v=q.select(this);var w=v.datum();if(l.isProcessGroup(v)){return true}if(l.canOperate(v)===false){return false}return((l.isProcessor(v)||l.isInputPort(v)||l.isOutputPort(v))&&l.supportsModification(v)&&(w.status.aggregateSnapshot.runStatus==="Stopped"||w.status.aggregateSnapshot.runStatus==="Invalid"))})},canDisable:function(u){if(u.empty()){return true}return l.filterDisable(u).size()===u.size()},canAllStartTransmitting:function(u){if(u.empty()){return false}var v=true;u.each(function(){if(!l.canStartTransmitting(q.select(this))){v=false}});return v},canStartTransmitting:function(u){if(u.size()!==1){return false}if((l.canModify(u)===false||l.canRead(u)===false)&&l.canOperate(u)===false){return false}return l.isRemoteProcessGroup(u)},canAllStopTransmitting:function(u){if(u.empty()){return false}var v=true;u.each(function(){if(!l.canStopTransmitting(q.select(this))){v=false}});return v},canStopTransmitting:function(u){if(u.size()!==1){return false}if((l.canModify(u)===false||l.canRead(u)===false)&&l.canOperate(u)===false){return false}return l.isRemoteProcessGroup(u)},areDeletable:function(u){if(u.empty()){return false}var v=true;u.each(function(){if(!l.isDeletable(q.select(this))){v=false}});return v},isDeletable:function(u){if(u.size()!==1){return false}if(r.canWrite()===false){return false}if(l.canModify(u)===false){return false}return l.supportsModification(u)},isConfigurable:function(u){if(u.size()!==1){if(u.empty()){return true}else{return false}}if(l.isProcessGroup(u)){return true}if(l.canRead(u)===false||l.canModify(u)===false){return false}if(l.isFunnel(u)){return false}return l.supportsModification(u)},hasDetails:function(u){if(u.size()!==1){return false}if(l.canRead(u)===false){return false}if(l.canModify(u)){if(l.isProcessor(u)||l.isInputPort(u)||l.isOutputPort(u)||l.isRemoteProcessGroup(u)||l.isConnection(u)){return !l.isConfigurable(u)}}else{return l.isProcessor(u)||l.isConnection(u)||l.isInputPort(u)||l.isOutputPort(u)||l.isRemoteProcessGroup(u)}return false},canManagePolicies:function(){var u=l.getSelection();if(u.size()<=1){if(!u.empty()&&l.isConnection(u)){return false}return g.canAccessTenants()}return false},canModify:function(w){var v=w.size();var u=w.filter(function(x){return x.permissions.canWrite}).size();return v===u},canRead:function(v){var u=v.size();var w=v.filter(function(x){return x.permissions.canRead}).size();return u===w},canOperate:function(w){var v=w.size();var u=w.filter(function(x){return x.permissions.canWrite||(x.operatePermissions&&x.operatePermissions.canWrite)}).size();return v===u},supportsModification:function(B){if(B.size()!==1){return false}var z=B.datum();var x=false;if(l.isProcessor(B)||l.isInputPort(B)||l.isOutputPort(B)){x=!(z.status.aggregateSnapshot.runStatus==="Running"||z.status.aggregateSnapshot.activeThreadCount>0)}else{if(l.isRemoteProcessGroup(B)){x=!(z.status.transmissionStatus==="Transmitting"||z.status.aggregateSnapshot.activeThreadCount>0)}else{if(l.isProcessGroup(B)){x=true}else{if(l.isFunnel(B)){x=true}else{if(l.isLabel(B)){x=true}else{if(l.isConnection(B)){var A=false;var v=false;var C=l.getConnectionSourceComponentId(z);var u=q.select("#id-"+C);if(!u.empty()){if(l.isRemoteProcessGroup(u)||l.isProcessGroup(u)){A=true}else{A=l.supportsModification(u)}}var w=l.getConnectionDestinationComponentId(z);var y=q.select("#id-"+w);if(!y.empty()){if(l.isRemoteProcessGroup(y)||l.isProcessGroup(y)){v=true}else{v=l.supportsModification(y)}}x=A&&v}}}}}}return x},getConnectableTypeForSource:function(v){var u;if(l.isProcessor(v)){u="PROCESSOR"}else{if(l.isRemoteProcessGroup(v)){u="REMOTE_OUTPUT_PORT"}else{if(l.isProcessGroup(v)){u="OUTPUT_PORT"}else{if(l.isInputPort(v)){u="INPUT_PORT"}else{if(l.isFunnel(v)){u="FUNNEL"}}}}}return u},getConnectableTypeForDestination:function(v){var u;if(l.isProcessor(v)){u="PROCESSOR"}else{if(l.isRemoteProcessGroup(v)){u="REMOTE_INPUT_PORT"}else{if(l.isProcessGroup(v)){u="INPUT_PORT"}else{if(l.isOutputPort(v)){u="OUTPUT_PORT"}else{if(l.isFunnel(v)){u="FUNNEL"}}}}}return u},isCopyable:function(v){if(v.empty()){return false}if(l.canRead(v)===false){return false}var u=v.filter(function(z){var x=q.select(this);if(l.isConnection(x)){var w=!v.filter(function(A){var B=l.getConnectionSourceComponentId(z);return B===A.id}).empty();var y=!v.filter(function(A){var B=l.getConnectionDestinationComponentId(z);return B===A.id}).empty();return w&&y}else{return l.isProcessor(x)||l.isFunnel(x)||l.isLabel(x)||l.isProcessGroup(x)||l.isRemoteProcessGroup(x)||l.isInputPort(x)||l.isOutputPort(x)}});return v.size()===u.size()},isPastable:function(){return r.canWrite()&&e.isCopied()},persistUserView:function(){var u=p.storage.namePrefix+r.getGroupId();var w=r.View.getTranslate();var v={scale:r.View.getScale(),translateX:w[0],translateY:w[1]};c.setItem(u,v)},formatConnectionName:function(u){if(!g.isBlank(u.name)){return u.name}else{if(g.isDefinedAndNotNull(u.selectedRelationships)){return u.selectedRelationships.join(", ")}}return""},reloadConnectionSourceAndDestination:function(x,w){if(g.isBlank(x)===false){var v=q.select("#id-"+x);if(v.empty()===false){b.reload(v)}}if(g.isBlank(w)===false){var u=q.select("#id-"+w);if(u.empty()===false){b.reload(u)}}},getConnectionSourceComponentId:function(u){var v=u.sourceId;if(u.sourceGroupId!==r.getGroupId()){v=u.sourceGroupId}return v},getConnectionDestinationComponentId:function(u){var v=u.destinationId;if(u.destinationGroupId!==r.getGroupId()){v=u.destinationGroupId}return v},restoreUserView:function(){var w=false;try{var u=p.storage.namePrefix+r.getGroupId();var v=c.getItem(u);if(g.isDefinedAndNotNull(v)){if(isFinite(v.scale)&&isFinite(v.translateX)&&isFinite(v.translateY)){r.View.transform([v.translateX,v.translateY],v.scale);w=true}}}catch(x){}return w},getOrigin:function(v){var u={};v.each(function(x){var w=q.select(this);if(!l.isConnection(w)){if(g.isUndefined(u.x)||x.position.x<u.x){u.x=x.position.x}if(g.isUndefined(u.y)||x.position.y<u.y){u.y=x.position.y}}});return u},getSelectionBoundingClientRect:function(u){var y=r.View.getScale();var x=r.View.getTranslate();var w={x:Number.MAX_VALUE,y:Number.MAX_VALUE,right:Number.MIN_VALUE,bottom:Number.MIN_VALUE,translate:r.View.getTranslate()};var v=u.nodes().reduce(function(B,A){var z=A.getBoundingClientRect();B.x=Math.min(z.x,B.x);B.y=Math.min(z.y,B.y);B.right=Math.max(z.right,B.right);B.bottom=Math.max(z.bottom,B.bottom);return B},w);v.x=(v.x-x[0])/y;v.y=(v.y-x[1])/y;v.right=(v.right-x[0])/y;v.bottom=(v.bottom-x[1])/y;v.width=v.right-v.x;v.height=v.bottom-v.y;v.top=v.y;v.left=v.x;return v},translateBoundingClientRect:function(v,u){if(g.isUndefinedOrNull(u)){if(g.isDefinedAndNotNull(v.translate)){u=v.translate}else{u=r.View.getTranslate()}}return{x:v.x-u[0],y:v.y-u[1],left:v.left-u[0],right:v.right-u[0],top:v.top-u[1],bottom:v.bottom-u[1],width:v.width,height:v.height}},moveComponentsToParent:function(v){var u=r.getParentGroupId();if(u===null){j.showOkDialog({headerText:"Process Group",dialogContent:"Components are already in the topmost group."})}else{t(v,u)}},moveComponents:function(v,w){var u=w.datum();t(v,u.id).done(function(){l.getComponentByType("ProcessGroup").reload(u.id)})},trimDanglingEdges:function(u){var v=function(w){var A=l.getConnectionSourceComponentId(w);var z=l.getConnectionDestinationComponentId(w);var y=false;var x=false;u.each(function(B){if(B.id===A){y=true}if(B.id===z){x=true}});return y&&x};return u.filter(function(w){if(w.type==="Connection"){return v(w)}else{return true}})},isValidConnectionSource:function(u){if(u.size()!==1){return false}if(l.isProcessGroup(u)){return true}if(l.canRead(u)===false||l.canModify(u)===false){return false}return l.isProcessor(u)||l.isRemoteProcessGroup(u)||l.isInputPort(u)||l.isFunnel(u)},isValidConnectionDestination:function(v){if(v.size()!==1){return false}if(l.isProcessGroup(v)){return true}if(l.canModify(v)===false){return false}if(l.isRemoteProcessGroup(v)||l.isOutputPort(v)||l.isFunnel(v)){return true}if(l.isProcessor(v)){var u=v.datum();return u.inputRequirement!=="INPUT_FORBIDDEN"}},isManagedAuthorizer:function(){return r.isManagedAuthorizer()},isConfigurableAuthorizer:function(){return r.isConfigurableAuthorizer()},isConfigurableUsersAndGroups:function(){return r.isConfigurableUsersAndGroups()},addComponentRestrictions:function(u,v){u.each(function(w,x){if(!f.has(x)){f.set(x,[])}w.forEach(function(y){f.get(x).push(y)})});v.each(function(w,x){if(!s.has(x)){s.set(x,w)}})},getComponentRestrictions:function(){return{restrictedUsage:f,requiredPermissions:s}},setGroupId:function(u){return r.setGroupId(u)},getGroupId:function(){return r.getGroupId()},setParameterContext:function(u){return r.setParameterContext(u)},getParameterContext:function(){return r.getParameterContext()},getGroupName:function(){return r.getGroupName()},getParentGroupId:function(){return r.getParentGroupId()},reload:function(u){return r.reload({transition:true},u)},canReadCurrentGroup:function(){return r.canRead()},canWriteCurrentGroup:function(){return r.canWrite()},getCanvasScale:function(){return r.View.getScale()},getCanvasTranslate:function(){return r.View.getTranslate()},translateCanvas:function(u){r.View.translate(u)},fitCanvas:function(){return r.View.fit()},zoomInCanvas:function(){return r.View.zoomIn()},zoomOutCanvas:function(){return r.View.zoomOut()},actualSizeCanvas:function(){return r.View.actualSize()},shouldRenderPerScale:function(){return r.View.shouldRenderPerScale()},getCanvasOffset:function(){return r.CANVAS_OFFSET}};return l}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.ErrorHandler","nf.CanvasUtils"],function(d,e,c){return(nf.GoTo=b(d,e,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.GoTo=b(require("jquery"),require("nf.ErrorHandler"),require("nf.CanvasUtils")))}else{nf.GoTo=b(a.$,a.nf.ErrorHandler,a.nf.CanvasUtils)}}}(this,function(h,j,e){var b={urls:{api:"../nifi-api",processGroups:"../nifi-api/flow/process-groups/"}};var a;var f;var c=function(u,q,r,p){var o=h('<div class="source-destination-connection"></div>').appendTo("#connections-container");if(q.sourceType==="OUTPUT_PORT"){d(u,o,q,r)}else{if(q.sourceType==="REMOTE_OUTPUT_PORT"){i(u,o,q,p)}else{g(o,q)}}var t=h('<div class="connection-entry"></div>').appendTo(o);var w="unset";var s="Connection";if(q.permissions.canRead===true){var v=e.formatConnectionName(q.component);if(v!==""){w="";s=v}}h('<div class="search-result-icon icon-connect"></div>').appendTo(t);h('<div class="connection-entry-name go-to-link"></div>').attr("title",s).addClass(w).text(s).on("click",function(){e.showComponent(u,q.id);h("#connections-dialog").modal("hide")}).appendTo(t);h('<div class="clear"></div>').appendTo(t);if(q.destinationType==="INPUT_PORT"){l(u,o,q,r)}else{if(q.destinationType==="REMOTE_INPUT_PORT"){k(u,o,q,p)}else{m(o,q)}}h('<div class="clear"></div>').appendTo(o)};var m=function(o,p){var q="icon-funnel";if(p.destinationType==="PROCESSOR"){q="icon-processor"}else{if(p.destinationType==="OUTPUT_PORT"){q="icon-port-out"}}var r=p.destinationId;if(p.permissions.canRead===true){r=p.component.destination.name}else{if(a===p.destinationId){r=f}}var s=h('<div class="destination-component"></div>').appendTo(o);h('<div class="search-result-icon"></div>').addClass(q).appendTo(s);h('<div class="destination-component-name go-to-link"></div>').attr("title",r).text(r).on("click",function(){e.showComponent(p.destinationGroupId,p.destinationId);h("#connections-dialog").modal("hide")}).appendTo(s);h('<div class="clear"></div>').appendTo(s)};var l=function(w,p,s,t){var v;h.each(t,function(x,y){if(s.destinationGroupId===y.id){v=y;return false}});var o=n(v);var r=h('<div class="destination-component"></div>').appendTo(p);h('<div class="search-result-icon icon-group"></div>').appendTo(r);h('<div class="destination-component-name go-to-link"></div>').attr("title",o).text(o).on("click",function(){e.showComponent(w,v.id);h("#connections-dialog").modal("hide")}).appendTo(r);h('<div class="clear"></div>').appendTo(r);var u=s.destinationId;if(s.permissions.canRead===true){u=s.component.destination.name}else{if(a===s.destinationId){u=f}}var q=h('<div class="destination-input-port"></div>').appendTo(r);h('<div class="search-result-icon icon-port-in"></div>').appendTo(q);h('<div class="destination-input-port-name go-to-link"></div>').attr("title",u).text(u).on("click",function(){e.showComponent(s.destinationGroupId,s.destinationId);h("#connections-dialog").modal("hide")}).appendTo(q);h('<div class="clear"></div>').appendTo(r)};var k=function(t,o,s,r){var v;h.each(r,function(x,y){if(s.destinationGroupId===y.id){v=y;return false}});var u=n(v);var q=h('<div class="destination-component"></div>').appendTo(o);h('<div class="search-result-icon icon-group-remote"></div>').appendTo(q);h('<div class="destination-component-name go-to-link"></div>').attr("title",u).text(u).on("click",function(){e.showComponent(t,v.id);h("#connections-dialog").modal("hide")}).appendTo(q);h('<div class="clear"></div>').appendTo(q);var w=s.destinationId;if(s.permissions.canRead===true){w=s.component.destination.name}else{if(a===s.destinationId){w=f}}var p=h('<div class="destination-input-port"></div>').appendTo(q);h('<div class="search-result-icon icon-port-in"></div>').appendTo(p);h('<div class="destination-input-port-name"></div>').attr("title",w).text(w).appendTo(p);h('<div class="clear"></div>').appendTo(q)};var g=function(o,q){var s="icon-funnel";if(q.sourceType==="PROCESSOR"){s="icon-processor"}else{if(q.sourceType==="INPUT_PORT"){s="icon-port-in"}}var p=q.sourceId;if(q.permissions.canRead===true){p=q.component.source.name}else{if(a===q.sourceId){p=f}}var r=h('<div class="source-component"></div>').appendTo(o);h('<div class="search-result-icon"></div>').addClass(s).appendTo(r);h('<div class="source-component-name go-to-link"></div>').attr("title",p).text(p).on("click",function(){e.showComponent(q.sourceGroupId,q.sourceId);h("#connections-dialog").modal("hide")}).appendTo(r);h('<div class="clear"></div>').appendTo(r)};var d=function(v,p,r,s){var u;h.each(s,function(x,y){if(r.sourceGroupId===y.id){u=y;return false}});var o=n(u);var q=h('<div class="source-component"></div>').appendTo(p);h('<div class="search-result-icon icon-group"></div>').appendTo(q);h('<div class="source-component-name go-to-link"></div>').attr("title",o).text(o).on("click",function(){e.showComponent(v,u.id);h("#connections-dialog").modal("hide")}).appendTo(q);h('<div class="clear"></div>').appendTo(q);var t=r.sourceId;if(r.permissions.canRead===true){t=r.component.source.name}else{if(a===r.sourceId){t=f}}var w=h('<div class="source-output-port"></div>').appendTo(q);h('<div class="search-result-icon icon-port-out"></div>').appendTo(w);h('<div class="source-output-port-name go-to-link"></div>').attr("title",t).text(t).on("click",function(){e.showComponent(r.sourceGroupId,r.sourceId);h("#connections-dialog").modal("hide")}).appendTo(w);h('<div class="clear"></div>').appendTo(q)};var i=function(s,o,r,p){var u;h.each(p,function(x,y){if(r.sourceGroupId===y.id){u=y;return false}});var t=n(u);var q=h('<div class="source-component"></div>').appendTo(o);h('<div class="search-result-icon icon-group-remote"></div>').appendTo(q);h('<div class="source-component-name go-to-link"></div>').attr("title",t).text(t).on("click",function(){e.showComponent(s,u.id);h("#connections-dialog").modal("hide")}).appendTo(q);h('<div class="clear"></div>').appendTo(q);var v=r.sourceId;if(r.permissions.canRead===true){v=r.component.source.name}else{if(r.sourceId===a){v=f}}var w=h('<div class="source-output-port"></div>').appendTo(q);h('<div class="search-result-icon icon-port-out"></div>').appendTo(w);h('<div class="source-output-port-name"></div>').attr("title",v).text(v).appendTo(w);h('<div class="clear"></div>').appendTo(q)};var n=function(o){if(o.permissions.canRead===true){return o.component.name}else{if(a===o.id){return f}else{return o.id}}};return{init:function(){h("#connections-dialog").modal({scrollableContentStyle:"scrollable",buttons:[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){h("#connections-dialog").modal("hide")}}}],handler:{close:function(){h("#connections-context").empty();h("#connections-container").empty()}}})},showDownstreamFromProcessor:function(s){var t=s.datum();var q=e.getComponentByType("Connection").get();var p=e.getComponentByType("ProcessGroup").get();var r=e.getComponentByType("RemoteProcessGroup").get();var o=n(t);a=t.id;f=o;h("#connections-context").append('<div class="search-result-icon icon-processor"></div>').append(h('<div class="connections-component-name"></div>').text(o)).append('<div class="clear"></div>');h.each(q,function(u,v){if(v.sourceId===t.id){c(e.getGroupId(),v,p,r)}});if(h("#connections-container").is(":empty")){h("#connections-container").html('<span class="unset">No downstream components</span>')}h("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")},showUpstreamFromProcessor:function(s){var t=s.datum();var q=e.getComponentByType("Connection").get();var p=e.getComponentByType("ProcessGroup").get();var r=e.getComponentByType("RemoteProcessGroup").get();var o=n(t);a=t.id;f=o;h("#connections-context").append('<div class="search-result-icon icon-processor"></div>').append(h('<div class="connections-component-name"></div>').text(o)).append('<div class="clear"></div>');h.each(q,function(u,v){if(v.destinationId===t.id){c(e.getGroupId(),v,p,r)}});if(h("#connections-container").is(":empty")){h("#connections-container").html('<span class="unset">No upstream components</span>')}h("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")},showDownstreamFromGroup:function(r){var s=r.datum();var p=e.getComponentByType("Connection").get();var o=e.getComponentByType("ProcessGroup").get();var q=e.getComponentByType("RemoteProcessGroup").get();var u="icon-group";if(e.isRemoteProcessGroup(r)){u="icon-group-remote"}var t=n(s);a=s.id;f=t;h("#connections-context").append(h('<div class="search-result-icon"></div>').addClass(u)).append(h('<div class="connections-component-name"></div>').text(t)).append('<div class="clear"></div>');h.each(p,function(v,w){if(w.sourceGroupId===s.id){c(e.getGroupId(),w,o,q)}});if(h("#connections-container").is(":empty")){h("#connections-container").html('<span class="unset">No downstream components</span>')}h("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")},showUpstreamFromGroup:function(r){var s=r.datum();var p=e.getComponentByType("Connection").get();var o=e.getComponentByType("ProcessGroup").get();var q=e.getComponentByType("RemoteProcessGroup").get();var u="icon-group";if(e.isRemoteProcessGroup(r)){u="icon-group-remote"}var t=n(s);a=s.id;f=t;h("#connections-context").append(h('<div class="search-result-icon"></div>').addClass(u)).append(h('<div class="connections-component-name"></div>').text(t)).append('<div class="clear"></div>');h.each(p,function(v,w){if(w.destinationGroupId===s.id){c(e.getGroupId(),w,o,q)}});if(h("#connections-container").is(":empty")){h("#connections-container").html('<span class="unset">No upstream components</span>')}h("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")},showDownstreamFromInputPort:function(t){var q=t.datum();var r=e.getComponentByType("Connection").get();var p=e.getComponentByType("ProcessGroup").get();var s=e.getComponentByType("RemoteProcessGroup").get();var o=n(q);a=q.id;f=o;h("#connections-context").append('<div class="search-result-icon icon-port-in"></div>').append(h('<div class="connections-component-name"></div>').text(o)).append('<div class="clear"></div>');h.each(r,function(u,v){if(v.sourceId===q.id){c(e.getGroupId(),v,p,s)}});if(h("#connections-container").is(":empty")){h("#connections-container").html('<span class="unset">No downstream components</span>')}h("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")},showUpstreamFromInputPort:function(p){var o=p.datum();h.ajax({type:"GET",url:b.urls.processGroups+encodeURIComponent(e.getParentGroupId()),dataType:"json"}).done(function(s){var r=s.processGroupFlow.flow;var u=r.connections;var t=r.processGroups;var v=r.remoteProcessGroups;var q=n(o);a=o.id;f=q;h("#connections-context").append('<div class="search-result-icon icon-group"></div>').append(h('<div class="connections-component-name"></div>').text(e.getGroupName())).append('<div class="clear"></div>').append('<div class="search-result-icon icon-port-in" style="margin-left: 20px;"></div>').append(h('<div class="connections-component-name"></div>').text(q)).append('<div class="clear"></div>');h.each(u,function(w,x){if(x.destinationId===o.id){c(e.getParentGroupId(),x,t,v)}});if(h("#connections-container").is(":empty")){h("#connections-container").html('<span class="unset">No upstream components</span>')}h("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}).fail(j.handleAjaxError)},showDownstreamFromOutputPort:function(p){var o=p.datum();h.ajax({type:"GET",url:b.urls.processGroups+encodeURIComponent(e.getParentGroupId()),dataType:"json"}).done(function(s){var r=s.processGroupFlow.flow;var u=r.connections;var t=r.processGroups;var v=r.remoteProcessGroups;var q=n(o);a=o.id;f=q;h("#connections-context").append('<div class="search-result-icon icon-group"></div>').append(h('<div class="connections-component-name"></div>').text(e.getGroupName())).append('<div class="clear"></div>').append('<div class="search-result-icon icon-port-out" style="margin-left: 20px;"></div>').append(h('<div class="connections-component-name"></div>').text(q)).append('<div class="clear"></div>');h.each(u,function(w,x){if(x.sourceId===o.id){c(e.getParentGroupId(),x,t,v)}});if(h("#connections-container").is(":empty")){h("#connections-container").html('<span class="unset">No downstream components</span>')}h("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")}).fail(j.handleAjaxError)},showUpstreamFromOutputPort:function(t){var q=t.datum();var r=e.getComponentByType("Connection").get();var p=e.getComponentByType("ProcessGroup").get();var s=e.getComponentByType("RemoteProcessGroup").get();var o=n(q);a=q.id;f=o;h("#connections-context").append('<div class="search-result-icon icon-port-out"></div>').append(h('<div class="connections-component-name"></div>').text(o)).append('<div class="clear"></div>');h.each(r,function(u,v){if(v.destinationId===q.id){c(e.getGroupId(),v,p,s)}});if(h("#connections-container").is(":empty")){h("#connections-container").html('<span class="unset">No upstream components</span>')}h("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")},showDownstreamFromFunnel:function(s){var p=s.datum();var q=e.getComponentByType("Connection").get();var o=e.getComponentByType("ProcessGroup").get();var r=e.getComponentByType("RemoteProcessGroup").get();a=p.id;f="Funnel";h("#connections-context").append('<div class="search-result-icon icon-funnel"></div>').append(h('<div class="connections-component-name"></div>').text("Funnel")).append('<div class="clear"></div>');h.each(q,function(t,u){if(u.sourceId===p.id){c(e.getGroupId(),u,o,r)}});if(h("#connections-container").is(":empty")){h("#connections-container").html('<span class="unset">No downstream components</span>')}h("#connections-dialog").modal("setHeaderText","Downstream Connections").modal("show")},showUpstreamFromFunnel:function(s){var p=s.datum();var q=e.getComponentByType("Connection").get();var o=e.getComponentByType("ProcessGroup").get();var r=e.getComponentByType("RemoteProcessGroup").get();a=p.id;f="Funnel";h("#connections-context").append('<div class="search-result-icon icon-funnel"></div>').append(h('<div class="upstream-destination-name"></div>').text("Funnel")).append('<div class="clear"></div>');h.each(q,function(t,u){if(u.destinationId===p.id){c(e.getGroupId(),u,o,r)}});if(h("#connections-container").is(":empty")){h("#connections-container").html('<span class="unset">No upstream components</span>')}h("#connections-dialog").modal("setHeaderText","Upstream Connections").modal("show")}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Storage","nf.CanvasUtils","nf.Client"],function(g,f,d,e,c){return(nf.Snippet=b(g,f,d,e,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Snippet=b(require("jquery"),require("d3"),require("nf.Storage"),require("nf.CanvasUtils"),require("nf.Client")))}else{nf.Snippet=b(a.$,a.d3,a.nf.Storage,a.nf.CanvasUtils,a.nf.Client)}}}(this,function(f,e,c,d,b){var a={urls:{snippets:"../nifi-api/snippets",processGroups:"../nifi-api/process-groups"}};return{marshal:function(h,g){var i={parentGroupId:g,processors:{},funnels:{},inputPorts:{},outputPorts:{},remoteProcessGroups:{},processGroups:{},connections:{},labels:{}};h.each(function(k){var j=e.select(this);if(d.isProcessor(j)){i.processors[k.id]=b.getRevision(j.datum())}else{if(d.isFunnel(j)){i.funnels[k.id]=b.getRevision(j.datum())}else{if(d.isLabel(j)){i.labels[k.id]=b.getRevision(j.datum())}else{if(d.isInputPort(j)){i.inputPorts[k.id]=b.getRevision(j.datum())}else{if(d.isOutputPort(j)){i.outputPorts[k.id]=b.getRevision(j.datum())}else{if(d.isProcessGroup(j)){i.processGroups[k.id]=b.getRevision(j.datum())}else{if(d.isRemoteProcessGroup(j)){i.remoteProcessGroups[k.id]=b.getRevision(j.datum())}else{if(d.isConnection(j)){i.connections[k.id]=b.getRevision(j.datum())}}}}}}}}});return i},create:function(h){var g={disconnectedNodeAcknowledged:c.isDisconnectionAcknowledged(),snippet:h};return f.ajax({type:"POST",url:a.urls.snippets,data:JSON.stringify(g),dataType:"json",contentType:"application/json"})},copy:function(i,g,j){var h={snippetId:i,originX:g.x,originY:g.y,disconnectedNodeAcknowledged:c.isDisconnectionAcknowledged()};return f.ajax({type:"POST",url:a.urls.processGroups+"/"+encodeURIComponent(j)+"/snippet-instance",data:JSON.stringify(h),dataType:"json",contentType:"application/json"})},remove:function(g){return f.ajax({type:"DELETE",url:a.urls.snippets+"/"+encodeURIComponent(g)+"?"+f.param({disconnectedNodeAcknowledged:c.isDisconnectionAcknowledged()})})},move:function(h,i){var g={disconnectedNodeAcknowledged:c.isDisconnectionAcknowledged(),snippet:{id:h,parentGroupId:i}};return f.ajax({type:"PUT",url:a.urls.snippets+"/"+encodeURIComponent(h),data:JSON.stringify(g),dataType:"json",contentType:"application/json"})}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.Dialog","nf.Storage","nf.ErrorHandler","nf.Client","nf.CanvasUtils","lodash-core"],function(f,j,c,e,g,h,k,d,i){return(nf.Connection=b(f,j,c,e,g,h,k,d,i))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Connection=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.ErrorHandler"),require("nf.Client"),require("nf.CanvasUtils"),require("lodash-code")))}else{nf.Connection=b(a.$,a.d3,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.ErrorHandler,a.nf.Client,a.nf.CanvasUtils,a._)}}}(this,function(J,U,S,i,z,d,f,Y,af){var n;var s;var R;var D;var P={width:224};var g=(P.width/2)-15-2;var F=6;var y=(P.width/2)+10+1;var C=8;var j=true;var X=function(ah){var aj=ah.datum();var ag,ak;if(aj.bends.length>0){var ai=Math.min(Math.max(0,aj.labelIndex),aj.bends.length-1);ag=aj.bends[ai].x;ak=aj.bends[ai].y}else{ag=(aj.start.x+aj.end.x)/2;ak=(aj.start.y+aj.end.y)/2}ag-=(P.width/2);ak-=(ah.attr("height")/2);return{x:ag,y:ak}};var p;var E;var A;var r;var ac;var V;var t;var H;var k=function(ah,ag){return Math.pow(ah.x-ag.x,2)+Math.pow(ah.y-ag.y,2)};var u=function(ah,ag){return Math.sqrt(k(ah,ag))};var M=function(ak,aj,ah){var ag=k(aj,ah);if(ag===0){return Math.sqrt(k(ak,aj))}var ai=((ak.x-aj.x)*(ah.x-aj.x)+(ak.y-aj.y)*(ah.y-aj.y))/ag;if(ai<0){return Math.sqrt(k(ak,aj))}if(ai>1){return Math.sqrt(k(ak,ah))}return Math.sqrt(k(ak,{x:aj.x+ai*(ah.x-aj.x),y:aj.y+ai*(ah.y-aj.y)}))};var b=function(ak,am){if(am.bends.length===0){return 0}var ai;var ah;var ag=[am.start].concat(am.bends,[am.end]);for(var aj=0;aj<ag.length;aj++){if(aj+1<ag.length){var al=M(ak,ag[aj],ag[aj+1]);if(S.isUndefined(ai)||al<ai){ai=al;ah=aj}}}return ah};var L=function(ag){return ag.indexOf("INPUT_PORT")>=0};var B=function(ag){return ag.indexOf("OUTPUT_PORT")>=0};var Q=function(ag){return ag.groupId!==Y.getGroupId()&&(L(ag.type)||B(ag.type))};var o=function(ag){if(S.isDefinedAndNotNull(ag.flowFileExpiration)){var ah=ag.flowFileExpiration.match(/^(\d+).*/);if(ah!==null&&ah.length>0){if(parseInt(ah[0],10)>0){return true}}}return false};var ae=function(ag){return S.isDefinedAndNotNull(ag.loadBalanceStrategy)&&"DO_NOT_LOAD_BALANCE"!==ag.loadBalanceStrategy};var aa=function(ag){ag.sort(function(ai,ah){return ai.zIndex===ah.zIndex?0:ai.zIndex>ah.zIndex?1:-1})};var T=function(){return r.selectAll("g.connection").data(p.values(),function(ag){return ag.id})};var W=function(ai,ah){if(ai.empty()){return ai}var ag=ai.append("g").attrs({id:function(aj){return"id-"+aj.id},"class":"connection"}).classed("selected",ah);ag.append("path").attrs({"class":"connection-path","pointer-events":"none"});ag.append("path").attrs({"class":"connection-selection-path","pointer-events":"none"});ag.append("path").attrs({"class":"connection-path-selectable","pointer-events":"stroke"}).on("mousedown.selection",function(){n.select(U.select(this.parentNode));Y.setURLParameters()}).call(D.activate);return ag};var x=function(ah){var ag=false;if(S.isDefinedAndNotNull(ah.component.selectedRelationships)&&S.isDefinedAndNotNull(ah.component.availableRelationships)){J.each(ah.component.selectedRelationships,function(ai,aj){if(J.inArray(aj,ah.component.availableRelationships)===-1){ag=true;return false}})}return ag};var q=function(ah){var ag="normal";if(ah.permissions.canRead){if(O(ah)||m(ah)){ag="full"}else{if(x(ah)){ag="ghost"}}}else{ag="unauthorized"}return"url(#"+ag+")"};var c=function(ag){if(m(ag)||O(ag)){return"url(#connection-full-drop-shadow)"}else{return"url(#component-drop-shadow)"}};var m=function(ag){return ag.status.aggregateSnapshot.percentUseCount===100};var e=function(ah){var ag=ah.status.aggregateSnapshot.percentUseCount;if(S.isDefinedAndNotNull(ag)){return ag>=61&&ag<=85}return false};var l=function(ah){var ag=ah.status.aggregateSnapshot.percentUseCount;if(S.isDefinedAndNotNull(ag)){return ag>85}return false};var O=function(ag){return ag.status.aggregateSnapshot.percentUseBytes===100};var I=function(ah){var ag=ah.status.aggregateSnapshot.percentUseBytes;if(S.isDefinedAndNotNull(ag)){return ag>=61&&ag<=85}return false};var N=function(ah){var ag=ah.status.aggregateSnapshot.percentUseBytes;if(S.isDefinedAndNotNull(ag)){return ag>85}return false};var a=function(ag,ah){if(ag.empty()){return}var ai=true;var aj=true;var ak=false;if(S.isDefinedAndNotNull(ah)){ai=S.isDefinedAndNotNull(ah.updatePath)?ah.updatePath:ai;aj=S.isDefinedAndNotNull(ah.updateLabel)?ah.updateLabel:aj;ak=S.isDefinedAndNotNull(ah.transition)?ah.transition:ak}if(ai===true){ag.classed("grouped",function(am){var al=false;if(am.permissions.canRead){if(S.isDefinedAndNotNull(am.component.selectedRelationships)&&am.component.selectedRelationships.length>1){al=true}}return al}).classed("ghost",function(am){var al=false;if(am.permissions.canRead){if(x(am)){al=true}}return al});ag.select("path.connection-path").classed("unauthorized",function(al){return al.permissions.canRead===false});ag.select("path.connection-path-selectable").on("dblclick",function(aq){if(aq.permissions.canWrite&&aq.permissions.canRead){var al=U.mouse(this.parentNode);var ao=b({x:al[0],y:al[1]},aq);var an=aq.component.bends.slice();an.splice(ao,0,{x:al[0],y:al[1]});var am={id:aq.id,bends:an};var ap=aq.component.labelIndex;if(an.length===1){am.labelIndex=0}else{if(ao<=ap){am.labelIndex=ap+1}}v(aq,am);U.event.stopPropagation()}else{return null}})}ag.each(function(aQ){var aF=U.select(this);if(ai===true){var aP=Y.getConnectionSourceComponentId(aQ);var ar=U.select("#id-"+aP).datum();var at;var aA;if(aQ.bends.length>0){aA=aQ.bends[aQ.bends.length-1]}else{aA={x:ar.position.x+(ar.dimensions.width/2),y:ar.position.y+(ar.dimensions.height/2)}}if(S.isDefinedAndNotNull(aQ.end)&&aQ.end.dragging===true){at=aQ.end;var aR=U.select("g.hover.connectable-destination");if(!aR.empty()){var aJ=aR.datum();var al=Y.getPerimeterPoint(aA,{x:aJ.position.x,y:aJ.position.y,width:aJ.dimensions.width,height:aJ.dimensions.height});at.x=al.x;at.y=al.y}}else{var an=Y.getConnectionDestinationComponentId(aQ);var aT=U.select("#id-"+an).datum();at=Y.getPerimeterPoint(aA,{x:aT.position.x,y:aT.position.y,width:aT.dimensions.width,height:aT.dimensions.height})}var aB;if(aQ.bends.length>0){aB=aQ.bends[0]}else{aB=at}var aw=Y.getPerimeterPoint(aB,{x:ar.position.x,y:ar.position.y,width:ar.dimensions.width,height:ar.dimensions.height});aQ.start=aw;aQ.end=at;Y.transition(aF.select("path.connection-path"),ak).attrs({d:function(){var aU=[aQ.start].concat(aQ.bends,[aQ.end]);return H(aU)}});Y.transition(aF.select("path.connection-selection-path"),ak).attrs({d:function(){var aU=[aQ.start].concat(aQ.bends,[aQ.end]);return H(aU)}});Y.transition(aF.select("path.connection-path-selectable"),ak).attrs({d:function(){var aU=[aQ.start].concat(aQ.bends,[aQ.end]);return H(aU)}});var az=aF.selectAll("rect.startpoint");var ay=aF.selectAll("rect.endpoint");var aH=aF.selectAll("rect.midpoint");if(aQ.permissions.canWrite&&aQ.permissions.canRead){az=az.data([aQ.start]);var aM=az.enter().append("rect").attrs({"class":"startpoint linepoint","pointer-events":"all",width:8,height:8}).on("mousedown.selection",function(){n.select(U.select(this.parentNode));Y.setURLParameters()}).call(D.activate);Y.transition(az.merge(aM),ak).attr("transform",function(aU){return"translate("+(aU.x-4)+", "+(aU.y-4)+")"});az.exit().remove();var ay=ay.data([aQ.end]);var ax=ay.enter().append("rect").attrs({"class":"endpoint linepoint","pointer-events":"all",width:8,height:8}).on("mousedown.selection",function(){n.select(U.select(this.parentNode));Y.setURLParameters()}).call(V).call(D.activate);Y.transition(ay.merge(ax),ak).attr("transform",function(aU){return"translate("+(aU.x-4)+", "+(aU.y-4)+")"});ay.exit().remove();var aH=aH.data(aQ.bends);var aE=aH.enter().append("rect").attrs({"class":"midpoint linepoint","pointer-events":"all",width:8,height:8}).on("dblclick",function(aX){U.event.stopPropagation();var aU=U.select(this.parentNode);var a1=aU.datum();var a0=Y.getConnectionSourceComponentId(a1);var aZ=Y.getConnectionDestinationComponentId(a1);if(a0===aZ&&aQ.component.bends.length<=2){i.showOkDialog({headerText:"Connection",dialogContent:"Looping connections must have at least two bend points."});return}var aW=[];var aV=-1;J.each(a1.component.bends,function(a3,a2){if(aX.x!==a2.x&&aX.y!==a2.y){aW.push(a2)}else{aV=a3}});if(aV<0){return}var aU={id:a1.id,bends:aW};var aY=a1.component.labelIndex;if(aW.length<=1){aU.labelIndex=0}else{if(aV<=aY){aU.labelIndex=Math.max(0,aY-1)}}v(a1,aU)}).on("mousedown.selection",function(){n.select(U.select(this.parentNode));Y.setURLParameters()}).call(ac).call(D.activate);Y.transition(aH.merge(aE),ak).attr("transform",function(aU){return"translate("+(aU.x-4)+", "+(aU.y-4)+")"});aH.exit().remove()}else{az.remove();ay.remove();aH.remove()}}if(aj===true){var au=aF.select("g.connection-label-container");if(aF.classed("visible")){if(au.empty()){au=aF.insert("g","rect.startpoint").attrs({"class":"connection-label-container","pointer-events":"all"}).on("mousedown.selection",function(){n.select(U.select(this.parentNode));Y.setURLParameters()}).call(D.activate).call(R.activate);au.append("rect").attrs({"class":"body",width:P.width,x:0,y:0});au.append("rect").attrs({"class":"border",width:P.width,fill:"transparent",stroke:"transparent"})}var aG=0;var ap=19;var aO=[];var av=[];var aD=au.select("g.connection-from-container");var aS=au.select("g.connection-to-container");var aI=au.select("g.connection-name-container");if(aQ.permissions.canRead){if(Q(aQ.component.source)){if(aD.empty()){aD=au.append("g").attrs({"class":"connection-from-container"});aO.push(aD.append("rect").attrs({"class":"connection-label-background",width:P.width,height:ap}));av.push(aD.append("rect").attrs({"class":"connection-label-border",width:P.width,height:1}));aD.append("text").attrs({"class":"stats-label",x:5,y:14}).text("From");aD.append("text").attrs({"class":"stats-value connection-from",x:43,y:14,width:130});aD.append("text").attrs({"class":"connection-from-run-status",x:208,y:14})}else{aO.push(aD.select("rect.connection-label-background"));av.push(aD.select("rect.connection-label-border"))}aD.attr("transform",function(){var aU=(ap*aG++);return"translate(0, "+aU+")"});aD.select("text.connection-from").each(function(){var aU=U.select(this);aU.text(null).selectAll("title").remove();Y.ellipsis(aU,aQ.component.source.name)}).append("title").text(function(){return aQ.component.source.name});aD.select("text.connection-from-run-status").text(function(){if(aQ.component.source.exists===false){return"\uf071"}else{if(aQ.component.source.running===true){return"\uf04b"}else{return"\uf04d"}}}).classed("running",function(){if(aQ.component.source.exists===false){return false}else{return aQ.component.source.running}}).classed("stopped",function(){if(aQ.component.source.exists===false){return false}else{return !aQ.component.source.running}}).classed("is-missing-port",function(){return aQ.component.source.exists===false})}else{aD.remove()}if(Q(aQ.component.destination)){if(aS.empty()){aS=au.append("g").attrs({"class":"connection-to-container"});aO.push(aS.append("rect").attrs({"class":"connection-label-background",width:P.width,height:ap}));av.push(aS.append("rect").attrs({"class":"connection-label-border",width:P.width,height:1}));aS.append("text").attrs({"class":"stats-label",x:5,y:14}).text("To");aS.append("text").attrs({"class":"stats-value connection-to",x:25,y:14,width:145});aS.append("text").attrs({"class":"connection-to-run-status",x:208,y:14})}else{aO.push(aS.select("rect.connection-label-background"));av.push(aS.select("rect.connection-label-border"))}aS.attr("transform",function(){var aU=(ap*aG++);return"translate(0, "+aU+")"});aS.select("text.connection-to").each(function(aV){var aU=U.select(this);aU.text(null).selectAll("title").remove();Y.ellipsis(aU,aV.component.destination.name)}).append("title").text(function(aU){return aU.component.destination.name});aS.select("text.connection-to-run-status").text(function(){if(aQ.component.destination.exists===false){return"\uf071"}else{if(aQ.component.destination.running===true){return"\uf04b"}else{return"\uf04d"}}}).classed("running",function(){if(aQ.component.destination.exists===false){return false}else{return aQ.component.destination.running}}).classed("stopped",function(){if(aQ.component.destination.exists===false){return false}else{return !aQ.component.destination.running}}).classed("is-missing-port",function(){return aQ.component.destination.exists===false})}else{aS.remove()}var aq=Y.formatConnectionName(aQ.component);if(!S.isBlank(aq)){if(aI.empty()){aI=au.append("g").attrs({"class":"connection-name-container"});aO.push(aI.append("rect").attrs({"class":"connection-label-background",width:P.width,height:ap}));av.push(aI.append("rect").attrs({"class":"connection-label-border",width:P.width,height:1}));aI.append("text").attrs({"class":"stats-label",x:5,y:14}).text("Name");aI.append("text").attrs({"class":"stats-value connection-name",x:45,y:14,width:142})}else{aO.push(aI.select("rect.connection-label-background"));av.push(aI.select("rect.connection-label-border"))}aI.attr("transform",function(){var aU=(ap*aG++);return"translate(0, "+aU+")"});aI.select("text.connection-name").each(function(){var aU=U.select(this);aU.text(null).selectAll("title").remove();Y.ellipsis(aU,aq)}).append("title").text(function(){return aq})}else{aI.remove()}}else{aD.remove();aS.remove();aI.remove()}var aN=3;var am=au.select("g.queued-container");if(am.empty()){am=au.append("g").attrs({"class":"queued-container"});aO.push(am.append("rect").attrs({"class":"connection-label-background",width:P.width,height:ap+aN}));av.push(am.append("rect").attrs({"class":"connection-label-border",width:P.width,height:1}));am.append("text").attrs({"class":"stats-label",x:5,y:14}).text("Queued");var aK=am.append("text").attrs({"class":"stats-value queued",x:55,y:14});aK.append("tspan").attrs({"class":"count"});aK.append("tspan").attrs({"class":"size"});am.append("text").attrs({"class":"load-balance-icon",y:14}).text(function(){return"\uf042"}).append("title");am.append("text").attrs({"class":"expiration-icon",x:208,y:14}).text(function(){return"\uf017"}).append("title");var ao=ap+aN-4;var aL=am.append("g").attrs({transform:"translate("+F+", "+ao+")","class":"backpressure-object-container"});aL.append("rect").attrs({"class":"backpressure-tick object",width:1,height:3,x:0,y:0});aL.append("rect").attrs({"class":"backpressure-object",width:g,height:3,x:0,y:0});aL.append("rect").attrs({"class":"backpressure-tick object",width:1,height:3,x:g,y:0});aL.append("rect").attrs({"class":"backpressure-percent object",width:0,height:3,x:0,y:0});aL.append("rect").attrs({"class":"backpressure-tick object-prediction",width:1,height:3,x:g,y:0});var aC=am.append("g").attrs({transform:"translate("+y+", "+ao+")","class":"backpressure-data-size-container"});aC.append("rect").attrs({"class":"backpressure-tick data-size",width:1,height:3,x:0,y:0});aC.append("rect").attrs({"class":"backpressure-data-size",width:g,height:3,x:0,y:0}).append("title");aC.append("rect").attrs({"class":"backpressure-tick data-size",width:1,height:3,x:g,y:0});aC.append("rect").attrs({"class":"backpressure-percent data-size",width:0,height:3,x:0,y:0});aC.append("rect").attrs({"class":"backpressure-tick data-size-prediction",width:1,height:3,x:g,y:0})}else{aO.push(am.select("rect.connection-label-background"));av.push(am.select("rect.connection-label-border"))}am.attr("transform",function(){var aU=(ap*aG++);return"translate(0, "+aU+")"});au.select("rect.body").attr("height",function(){return(ap*aG)+aN}).classed("unauthorized",function(){return aQ.permissions.canRead===false});au.select("rect.border").attr("height",function(){return(ap*aG)+aN}).classed("unauthorized",function(){return aQ.permissions.canRead===false});J.each(aO,function(aV,aU){if(aV%2===0){aU.attr("fill","#f4f6f7")}else{aU.attr("fill","#ffffff")}});J.each(av,function(aV,aU){if(aV>0){aU.attr("fill","#c7d2d7")}else{aU.attr("fill","transparent")}});au.select("text.load-balance-icon").classed("hidden",function(){if(aQ.permissions.canRead){return !ae(aQ.component)}else{return true}}).classed("load-balance-icon-active fa-rotate-90",function(aU){return aU.permissions.canRead&&aU.component.loadBalanceStatus==="LOAD_BALANCE_ACTIVE"}).classed("load-balance-icon-184",function(){return aQ.permissions.canRead&&o(aQ.component)}).classed("load-balance-icon-200",function(){return aQ.permissions.canRead&&!o(aQ.component)}).attr("x",function(){return aQ.permissions.canRead&&o(aQ.component)?192:208}).select("title").text(function(){if(aQ.permissions.canRead){var aU=S.getComboOptionText(S.loadBalanceStrategyOptions,aQ.component.loadBalanceStrategy);if("PARTITION_BY_ATTRIBUTE"===aQ.component.loadBalanceStrategy){aU+=" ("+aQ.component.loadBalancePartitionAttribute+")"}var aW="no compression";switch(aQ.component.loadBalanceCompression){case"COMPRESS_ATTRIBUTES_ONLY":aW="'Attribute' compression";break;case"COMPRESS_ATTRIBUTES_AND_CONTENT":aW="'Attribute and content' compression";break}var aV="LOAD_BALANCE_ACTIVE"===aQ.component.loadBalanceStatus?" Actively balancing...":"";return"Load Balance is configured with '"+aU+"' strategy and "+aW+"."+aV}else{return""}});au.select("text.expiration-icon").classed("hidden",function(){if(aQ.permissions.canRead){return !o(aQ.component)}else{return true}}).select("title").text(function(){if(aQ.permissions.canRead){return"Expires FlowFiles older than "+aQ.component.flowFileExpiration}else{return""}});au.select("rect.backpressure-object").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseCount)});au.selectAll("rect.backpressure-tick.object").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseCount)});au.selectAll("rect.backpressure-tick.object-prediction").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseCount)});au.select("rect.backpressure-data-size").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseBytes)});au.selectAll("rect.backpressure-tick.data-size").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseBytes)});au.selectAll("rect.backpressure-tick.data-size-prediction").classed("not-configured",function(){return S.isUndefinedOrNull(aQ.status.aggregateSnapshot.percentUseBytes)});if(aQ.permissions.canWrite){au.call(t)}aF.call(K)}else{if(!au.empty()){au.remove()}}}Y.transition(aF.select("g.connection-label-container"),ak).attr("transform",function(){var aV=U.select(this).select("rect.body");var aU=X(aV);return"translate("+aU.x+", "+aU.y+")"})})};var G=function(ai){var ag=af.get(ai,"status.aggregateSnapshot.percentUseCount",0);var ah=af.get(ai,"status.aggregateSnapshot.percentUseBytes",0);return Math.max(ag,ah)>=100};var w=function(am){var ao;var ai=af.get(am,"status.aggregateSnapshot.percentUseCount");if(af.isNumber(ai)){var ag=af.get(am,"component.backPressureObjectThreshold");var ap=af.get(am,"status.aggregateSnapshot.predictions");var ak=["Queue: "+af.clamp(ai,0,100)+"% full (based on "+ag+" object threshold)"];if(!af.isNil(ap)){var ah=af.get(ap,"predictedPercentCount",-1);var al=af.get(ap,"predictedMillisUntilCountBackpressure",-1);var an=af.get(ap,"predictionIntervalSeconds",60*5);if(af.isNumber(ah)&&ah>-1){ak.push("Predicted queue (next "+(an/60)+" mins): "+af.clamp(ah,0,100)+"%")}else{ak.push("Predicted queue (next "+(an/60)+" mins): NA")}if(af.isNumber(al)&&af.inRange(al,0,Number.MAX_SAFE_INTEGER)&&!G(am)){var aj=S.formatPredictedDuration(al);ak.push("Estimated time to back pressure: "+aj)}else{ak.push("Estimated time to back pressure: "+(G(am)?"now":"NA"))}}else{ak.push("Queue Prediction is not configured")}if(af.isEmpty(ak)){return""}else{if(af.size(ak)===1){return ak[0]}else{ao=S.formatUnorderedList(ak)}}}else{ao="Back Pressure Object Threshold is not configured"}return ao};var Z=function(ak){var an;var al=af.get(ak,"status.aggregateSnapshot.percentUseBytes");if(af.isNumber(al)){var ap=af.get(ak,"component.backPressureDataSizeThreshold");var ao=af.get(ak,"status.aggregateSnapshot.predictions");var ah=["Queue: "+af.clamp(al,0,100)+"% full (based on "+ap+" data size threshold)"];if(!af.isNil(ao)){var ai=af.get(ao,"predictedPercentBytes",-1);var aj=af.get(ao,"predictedMillisUntilBytesBackpressure",-1);var am=af.get(ao,"predictionIntervalSeconds",60*5);if(af.isNumber(ai)&&ai>-1){ah.push("Predicted queue (next "+(am/60)+" mins): "+af.clamp(ai,0,100)+"%")}else{ah.push("Predicted queue (next "+(am/60)+" mins): NA")}if(af.isNumber(aj)&&af.inRange(aj,0,Number.MAX_SAFE_INTEGER)&&!G(ak)){var ag=S.formatPredictedDuration(aj);ah.push("Estimated time to back pressure: "+ag)}else{ah.push("Estimated time to back pressure: "+(G(ak)?"now":"NA"))}}else{ah.push("Queue Prediction is not configured")}if(af.isEmpty(ah)){return""}else{if(af.size(ah)===1){return ah[0]}else{an=S.formatUnorderedList(ah)}}}else{an="Back Pressure Data Size Threshold is not configured"}return an};var K=function(ag){if(ag.empty()){return}var ah=J.Deferred(function(aj){ag.select("text.queued tspan.count").text(function(am){return S.substringBeforeFirst(am.status.aggregateSnapshot.queued," ")});var al=ag.select("rect.backpressure-percent.data-size");al.transition().duration(400).attrs({width:function(am){if(S.isDefinedAndNotNull(am.status.aggregateSnapshot.percentUseBytes)){return(g*am.status.aggregateSnapshot.percentUseBytes)/100}else{return 0}}}).on("end",function(){al.classed("warning",function(am){return I(am)}).classed("error",function(am){return N(am)});aj.resolve()});var ak=ag.select("rect.backpressure-tick.data-size-prediction");ak.transition().duration(400).attrs({x:function(an){var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentBytes",0);return(g*af.clamp(am,0,100))/100},display:function(an){var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentBytes",-1);if(am>=0){return"unset"}else{return"none"}}}).on("end",function(){ak.classed("prediction-down",function(an){var ao=af.get(an,"status.aggregateSnapshot.predictions.percentUseBytes",0);var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentBytes",0);return am<ao})});ag.select("g.backpressure-data-size-container").each(function(an){var am=U.select("#back-pressure-size-tip-"+an.id);if(am.empty()){am=U.select("#connection-tooltips").append("div").attr("id",function(){return"back-pressure-size-tip-"+an.id}).attr("class","tooltip nifi-tooltip")}am.html(function(){return J("<div></div>").append(Z(an)).html()});Y.canvasTooltip(am,U.select(this))})}).promise();var ai=J.Deferred(function(aj){ag.select("text.queued tspan.size").text(function(am){return" "+S.substringAfterFirst(am.status.aggregateSnapshot.queued," ")});var al=ag.select("rect.backpressure-percent.object");al.transition().duration(400).attrs({width:function(am){if(S.isDefinedAndNotNull(am.status.aggregateSnapshot.percentUseCount)){return(g*am.status.aggregateSnapshot.percentUseCount)/100}else{return 0}}}).on("end",function(){al.classed("warning",function(am){return e(am)}).classed("error",function(am){return l(am)});aj.resolve()});var ak=ag.select("rect.backpressure-tick.object-prediction");ak.transition().duration(400).attrs({x:function(an){var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentCount",0);return(g*af.clamp(am,0,100))/100},display:function(an){var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentCount",-1);if(am>=0){return"unset"}else{return"none"}}}).on("end",function(){ak.classed("prediction-down",function(an){var ao=af.get(an,"status.aggregateSnapshot.percentUseCount",0);var am=af.get(an,"status.aggregateSnapshot.predictions.predictedPercentCount",0);return am<ao})});ag.select("g.backpressure-object-container").each(function(an){var am=U.select("#back-pressure-count-tip-"+an.id);if(am.empty()){am=U.select("#connection-tooltips").append("div").attr("id",function(){return"back-pressure-count-tip-"+an.id}).attr("class","tooltip nifi-tooltip")}am.html(function(){return J("<div></div>").append(w(an)).html()});Y.canvasTooltip(am,U.select(this))})}).promise();J.when(ah,ai).done(function(){ag.select("path.connection-path").classed("full",function(aj){return m(aj)||O(aj)}).attrs({"marker-end":q});ag.select("rect.border").classed("full",function(aj){return m(aj)||O(aj)});ag.select("rect.body").attrs({filter:c})})};var v=function(ai,ah){var ag={revision:f.getRevision(ai),disconnectedNodeAcknowledged:z.isDisconnectionAcknowledged(),component:ah};return J.ajax({type:"PUT",url:ai.uri,data:JSON.stringify(ag),dataType:"json",contentType:"application/json"}).done(function(aj){ad.set(aj)}).fail(d.handleConfigurationUpdateAjaxError)};var h=function(ag){ag.each(function(aj){var ai=Y.getConnectionSourceComponentId(aj);var ah=Y.getConnectionDestinationComponentId(aj);Y.reloadConnectionSourceAndDestination(ai,ah)});ag.call(ab).remove()};var ab=function(ag){ag.each(function(ah){J("#back-pressure-size-tip-"+ah.id).remove();J("#back-pressure-count-tip-"+ah.id).remove()})};var ad={config:{selfLoopXOffset:(P.width/2)+5,selfLoopYOffset:25},init:function(ag,ah,aj,ai){n=ag;D=ah;R=aj;s=ai;p=U.map();E=U.map();A=U.map();r=U.select("#canvas").append("g").attrs({"pointer-events":"stroke","class":"connections"});H=U.line().x(function(ak){return ak.x}).y(function(ak){return ak.y}).curve(U.curveLinear);ac=U.drag().on("start",function(){U.event.sourceEvent.stopPropagation()}).on("drag",function(ak){j=!U.event.sourceEvent.shiftKey;ak.x=j?(Math.round(U.event.x/C)*C):U.event.x;ak.y=j?(Math.round(U.event.y/C)*C):U.event.y;U.select(this.parentNode).call(a,{updatePath:true,updateLabel:false})}).on("end",function(){var ak=U.select(this.parentNode);var ao=ak.datum();var am=ak.selectAll("rect.midpoint").data();if(am.length===ao.component.bends.length){var an=false;for(var al=0;al<am.length&&!an;al++){if(am[al].x!==ao.component.bends[al].x||am[al].y!==ao.component.bends[al].y){an=true}}if(an){v(ao,{id:ao.id,bends:am}).fail(function(){ao.bends=J.map(ao.component.bends,function(ap){return{x:ap.x,y:ap.y}});ak.call(a,{updatePath:true,updateLabel:false})})}}U.event.sourceEvent.stopPropagation()});V=U.drag().on("start",function(ak){ak.dragging=true;U.event.sourceEvent.stopPropagation()}).on("drag",function(ak){ak.x=U.event.x-8;ak.y=U.event.y-8;U.select("g.hover").classed("connectable-destination",function(){return Y.isValidConnectionDestination(U.select(this))});U.select(this.parentNode).call(a,{updatePath:true,updateLabel:false})}).on("end",function(at){at.dragging=false;var ak=U.select(this.parentNode);var av=ak.datum();var al=Y.getConnectionDestinationComponentId(av);var au=U.select("g.connectable-destination");if(au.empty()){ak.call(a,{updatePath:true,updateLabel:false})}else{if(Y.isProcessGroup(au)||Y.isRemoteProcessGroup(au)){s.showConfiguration(ak,au).done(function(){Y.reloadConnectionSourceAndDestination(null,al)}).fail(function(){ak.call(a,{updatePath:true,updateLabel:false})})}else{var ao=au.datum();var aq=Y.getConnectableTypeForDestination(au);var ap={revision:f.getRevision(av),disconnectedNodeAcknowledged:z.isDisconnectionAcknowledged(),component:{id:av.id,destination:{id:ao.id,groupId:Y.getGroupId(),type:aq}}};if(av.bends.length<2&&av.sourceId===ao.id){var am={x:ao.position.x+(ao.dimensions.width),y:ao.position.y+(ao.dimensions.height/2)};var ar=ad.config.selfLoopXOffset;var an=ad.config.selfLoopYOffset;ap.component.bends=[];ap.component.bends.push({x:(am.x+ar),y:(am.y-an)});ap.component.bends.push({x:(am.x+ar),y:(am.y+an)})}J.ajax({type:"PUT",url:av.uri,data:JSON.stringify(ap),dataType:"json",contentType:"application/json"}).done(function(ax){var aw=ax.component;ad.set(ax);Y.reloadConnectionSourceAndDestination(null,al);var az=Y.getConnectionSourceComponentId(ax);var ay=Y.getConnectionSourceComponentId(ax);Y.reloadConnectionSourceAndDestination(az,ay)}).fail(function(ay,aw,ax){if(ay.status===400||ay.status===401||ay.status===403||ay.status===404||ay.status===409){i.showOkDialog({headerText:"Connection",dialogContent:S.escapeHtml(ay.responseText)});ak.call(a,{updatePath:true,updateLabel:false})}else{d.handleAjaxError(ay,aw,ax)}})}}U.event.sourceEvent.stopPropagation()});t=U.drag().on("start",function(ak){U.event.sourceEvent.stopPropagation()}).on("drag",function(ap){if(ap.bends.length>1){var am=U.select("rect.label-drag");if(am.empty()){var ao=U.select(this).select("rect.body");var an=X(ao);var ak=P.width;var au=ao.attr("height");am=U.select("#canvas").append("rect").attr("x",an.x).attr("y",an.y).attr("class","label-drag").attr("width",ak).attr("height",au).attr("stroke-width",function(){return 1/Y.getCanvasScale()}).attr("stroke-dasharray",function(){return 4/Y.getCanvasScale()}).datum({x:an.x,y:an.y,width:ak,height:au})}else{am.attr("x",function(av){av.x+=U.event.dx;return av.x}).attr("y",function(av){av.y+=U.event.dy;return av.y})}var aq=am.datum();var at={x:aq.x+(aq.width/2),y:aq.y+(aq.height/2)};var al=-1;var ar;J.each(ap.bends,function(ax,aw){var av={x:aw.x,y:aw.y};var ay=u(at,av);if(al===-1||ay<ar){al=ax;ar=ay}});ap.labelIndex=al;U.select(this.parentNode).call(a,{updatePath:true,updateLabel:false})}}).on("end",function(am){if(am.bends.length>1){var al=U.select("rect.label-drag");if(!al.empty()){al.remove()}if(am.labelIndex!==am.component.labelIndex){var ak=U.select(this.parentNode);v(am,{id:am.id,labelIndex:am.labelIndex}).fail(function(){am.labelIndex=am.component.labelIndex;ak.call(a,{updatePath:true,updateLabel:false})})}}U.event.sourceEvent.stopPropagation()})},add:function(ah,aj){var am=false;if(S.isDefinedAndNotNull(aj)){am=S.isDefinedAndNotNull(aj.selectAll)?aj.selectAll:am}var ai=new Date().getTime();var an=function(ao){A.set(ao.id,ai);p.set(ao.id,J.extend({type:"Connection"},ao))};if(J.isArray(ah)){J.each(ah,function(ao,ap){an(ap)})}else{if(S.isDefinedAndNotNull(ah)){an(ah)}}var ak=T();var al=W(ak.enter(),am);var ag=ak.merge(al);ag.call(a,{updatePath:true,updateLabel:false}).call(aa)},isDisconnected:function(ai){if(ai.empty()){return false}var ah=U.map();var aj=U.map();var ag=true;ai.filter(function(ak){return ak.type==="Connection"}).each(function(ak){ah.set(ak.id,ak)});ai.filter(function(ak){return ak.type!=="Connection"}).each(function(ak){aj.set(ak.id,ak.component);J.each(ad.getComponentConnections(ak.id),function(am,al){if(!ah.has(al.id)){ag=false;return false}})});if(ag){ah.each(function(ak,al){if(ag){ag=aj.has(Y.getConnectionSourceComponentId(ak))&&aj.has(Y.getConnectionDestinationComponentId(ak))}})}return ag},set:function(al,ao){var ag=false;var ak=false;var ah=false;if(S.isDefinedAndNotNull(ao)){ag=S.isDefinedAndNotNull(ao.selectAll)?ao.selectAll:ag;ak=S.isDefinedAndNotNull(ao.transition)?ao.transition:ak;ah=S.isDefinedAndNotNull(ao.overrideRevisionCheck)?ao.overrideRevisionCheck:ah}var am=function(ap){var aq=p.get(ap.id);if((f.isNewerRevision(aq,ap)&&!E.has(ap.id))||ah===true){p.set(ap.id,J.extend({type:"Connection"},ap))}};if(J.isArray(al)){J.each(p.keys(),function(aq,ar){var at=p.get(ar);var ap=J.grep(al,function(au){return au.id===at.id});if(ap.length===0&&!A.has(ar)){p.remove(ar)}});J.each(al,function(ap,aq){am(aq)})}else{if(S.isDefinedAndNotNull(al)){am(al)}}var an=T();var aj=W(an.enter(),ag);var ai=an.merge(aj);ai.call(a,{updatePath:true,updateLabel:true,transition:ak}).call(aa);an.exit().call(h)},refresh:function(ag){if(S.isDefinedAndNotNull(ag)){U.select("#id-"+ag).call(a,{updatePath:true,updateLabel:true})}else{U.selectAll("g.connection").call(a,{updatePath:true,updateLabel:true})}},pan:function(){U.selectAll("g.connection.entering, g.connection.leaving").call(a,{updatePath:false,updateLabel:true})},remove:function(ah){var ag=new Date().getTime();if(J.isArray(ah)){J.each(ah,function(ai,aj){E.set(aj,ag);p.remove(aj)})}else{E.set(ah,ag);p.remove(ah)}T().exit().call(h)},removeAll:function(){ad.remove(p.keys())},reload:function(ah){if(p.has(ah)){var ag=p.get(ah);return J.ajax({type:"GET",url:ag.uri,dataType:"json"}).done(function(ai){ad.set(ai)})}},reloadStatus:function(ag){if(p.has(ag)){return J.ajax({type:"GET",url:"../nifi-api/flow/connections/"+encodeURIComponent(ag)+"/status",dataType:"json"}).done(function(ah){var ai=p.get(ag);ai.status=ah.connectionStatus;p.set(ag,ai);T().call(K)})}},getComponentConnections:function(ah){var ag=[];p.each(function(aj,ai){if(Y.getConnectionSourceComponentId(aj)===ah||Y.getConnectionDestinationComponentId(aj)===ah){ag.push(aj)}});return ag},get:function(ag){if(S.isUndefined(ag)){return p.values()}else{return p.get(ag)}},expireCaches:function(ah){var ag=function(ai){ai.each(function(aj,ak){if(ah>aj){ai.remove(ak)}})};ag(A);ag(E)}};return ad}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.Client","nf.CanvasUtils"],function(f,e,g,c,d){return(nf.Funnel=b(f,e,g,c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Funnel=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.Client"),require("nf.CanvasUtils")))}else{nf.Funnel=b(a.$,a.d3,a.nf.Common,a.nf.Client,a.nf.CanvasUtils)}}}(this,function(b,r,d,s,o){var i;var l;var e;var m;var c={width:48,height:48};var j;var q;var a;var p;var k=function(){return p.selectAll("g.funnel").data(j.values(),function(t){return t.id})};var g=function(v,u){if(v.empty()){return v}var t=v.append("g").attrs({id:function(w){return"id-"+w.id},"class":"funnel component"}).classed("selected",u).call(o.position);t.append("rect").attrs({rx:2,ry:2,"class":"border",width:function(w){return w.dimensions.width},height:function(w){return w.dimensions.height},fill:"transparent",stroke:"transparent"});t.append("rect").attrs({rx:2,ry:2,"class":"body",width:function(w){return w.dimensions.width},height:function(w){return w.dimensions.height},filter:"url(#component-drop-shadow)","stroke-width":0});t.append("text").attrs({"class":"funnel-icon",x:9,y:34}).text("\ue803");t.call(e.activate).call(m.activate);return t};var h=function(t){if(t.empty()){return}t.select("rect.border").classed("unauthorized",function(u){return u.permissions.canRead===false});t.select("rect.body").classed("unauthorized",function(u){return u.permissions.canRead===false});t.each(function(){var u=r.select(this);o.editable(u,i,l)})};var f=function(t){t.remove()};var n={init:function(v,w,t,u){i=v;l=w;e=t;m=u;j=r.map();q=r.map();a=r.map();p=r.select("#canvas").append("g").attrs({"pointer-events":"all","class":"funnels"})},add:function(v,u){var y=false;if(d.isDefinedAndNotNull(u)){y=d.isDefinedAndNotNull(u.selectAll)?u.selectAll:y}var t=new Date().getTime();var z=function(A){a.set(A.id,t);j.set(A.id,b.extend({type:"Funnel",dimensions:c},A))};if(b.isArray(v)){b.each(v,function(B,A){z(A)})}else{if(d.isDefinedAndNotNull(v)){z(v)}}var w=k();var x=g(w.enter(),y);h(w.merge(x))},set:function(u,B){var t=false;var y=false;var v=false;if(d.isDefinedAndNotNull(B)){t=d.isDefinedAndNotNull(B.selectAll)?B.selectAll:t;y=d.isDefinedAndNotNull(B.transition)?B.transition:y;v=d.isDefinedAndNotNull(B.overrideRevisionCheck)?B.overrideRevisionCheck:v}var z=function(D){var C=j.get(D.id);if((s.isNewerRevision(C,D)&&!q.has(D.id))||v===true){j.set(D.id,b.extend({type:"Funnel",dimensions:c},D))}};if(b.isArray(u)){b.each(j.keys(),function(D,F){var E=j.get(F);var C=b.grep(u,function(G){return G.id===E.id});if(C.length===0&&!a.has(F)){j.remove(F)}});b.each(u,function(D,C){z(C)})}else{if(d.isDefinedAndNotNull(u)){z(u)}}var A=k();var x=g(A.enter(),t);var w=A.merge(x);w.call(h).call(o.position,y);A.exit().call(f)},get:function(t){if(d.isUndefined(t)){return j.values()}else{return j.get(t)}},refresh:function(t){if(d.isDefinedAndNotNull(t)){r.select("#id-"+t).call(h)}else{r.selectAll("g.funnel").call(h)}},reload:function(u){if(j.has(u)){var t=j.get(u);return b.ajax({type:"GET",url:t.uri,dataType:"json"}).done(function(v){n.set(v)})}},position:function(t){r.select("#id-"+t).call(o.position)},remove:function(u){var t=new Date().getTime();if(b.isArray(u)){b.each(u,function(w,v){q.set(v,t);j.remove(v)})}else{q.set(u,t);j.remove(u)}k().exit().call(f)},removeAll:function(){n.remove(j.keys())},expireCaches:function(u){var t=function(v){v.each(function(w,x){if(u>w){v.remove(x)}})};t(a);t(q)}};return n}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Storage","nf.Common","nf.Client","nf.CanvasUtils"],function(g,f,d,h,c,e){return(nf.Label=b(g,f,d,h,c,e))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Label=b(require("jquery"),require("d3"),require("nf.Storage"),require("nf.Common"),require("nf.Client"),require("nf.CanvasUtils")))}else{nf.Label=b(a.$,a.d3,a.nf.Storage,a.nf.Common,a.nf.Client,a.nf.CanvasUtils)}}}(this,function(e,x,g,k,z,u){var n;var r;var m;var l;var s;var j={width:148,height:148};var a=24;var i=64;var f;var w;var d;var b;var c;var v=8;var p=true;var q=function(){return b.selectAll("g.label").data(f.values(),function(A){return A.id})};var y=function(C,B){if(C.empty()){return C}var A=C.append("g").attrs({id:function(D){return"id-"+D.id},"class":"label component"}).classed("selected",B).call(u.position);A.append("rect").attrs({"class":"border",fill:"transparent",stroke:"transparent"});A.append("rect").attrs({"class":"body",filter:"url(#component-drop-shadow)","stroke-width":0});A.append("text").attrs({"xml:space":"preserve","font-weight":"bold",fill:"black","class":"label-value"});A.call(m.activate).call(s.activate).call(l.activate);return A};var h=function(A){if(A.empty()){return}A.select("rect.border").attrs({width:function(B){return B.dimensions.width},height:function(B){return B.dimensions.height}}).classed("unauthorized",function(B){return B.permissions.canRead===false});A.select("rect.body").attrs({width:function(B){return B.dimensions.width},height:function(B){return B.dimensions.height}}).style("fill",function(C){if(!C.permissions.canRead){return null}var B=o.defaultColor();if(k.isDefinedAndNotNull(C.component.style["background-color"])){B=C.component.style["background-color"]}return B}).classed("unauthorized",function(B){return B.permissions.canRead===false});A.each(function(F){var G=x.select(this);u.editable(G,n,r);var C=G.select("text.label-value");var D=G.selectAll("rect.labelpoint");if(F.permissions.canRead){C.attr("font-size",function(){var K="12px";if(k.isDefinedAndNotNull(F.component.style["font-size"])){K=F.component.style["font-size"]}return K});C.selectAll("tspan").remove();var J=[];if(k.isDefinedAndNotNull(F.component.label)){J=F.component.label.split("\n")}else{J.push("")}var E=o.defaultColor();if(k.isDefinedAndNotNull(F.component.style["background-color"])){E=F.component.style["background-color"]}e.each(J,function(L,K){C.append("tspan").attr("x","0.4em").attr("dy","1.2em").text(function(){return K}).style("fill",function(M){return k.determineContrastColor(k.substringAfterLast(E,"#"))})});if(F.permissions.canWrite){var I=[{x:F.dimensions.width,y:F.dimensions.height}];var H=D.data(I);var B=H.enter().append("rect").attrs({"class":"labelpoint",width:10,height:10}).call(c);H.merge(B).attr("transform",function(K){return"translate("+(K.x-10)+", "+(K.y-10)+")"});H.exit().remove()}}else{C.selectAll("tspan").remove();D.remove()}})};var t=function(A){A.remove()};var o={config:{width:j.width,height:j.height},init:function(C,D,A,B,E){n=C;r=D;m=A;s=B;l=E;f=x.map();w=x.map();d=x.map();b=x.select("#canvas").append("g").attrs({"pointer-events":"all","class":"labels"});c=x.drag().on("start",function(){x.event.sourceEvent.stopPropagation()}).on("drag",function(){var F=x.select(this.parentNode);var G=F.datum();p=!x.event.sourceEvent.shiftKey;G.dimensions.width=Math.max(i,p?(Math.round(x.event.x/v)*v):x.event.x);G.dimensions.height=Math.max(a,p?(Math.round(x.event.y/v)*v):x.event.y);h(F)}).on("end",function(){var G=x.select(this.parentNode);var H=G.datum();var I=false;if(k.isDefinedAndNotNull(H.component.width)||H.dimensions.width!==H.component.width){I=true}if(!I&&k.isDefinedAndNotNull(H.component.height)||H.dimensions.height!==H.component.height){I=true}if(I){var F={revision:z.getRevision(H),disconnectedNodeAcknowledged:g.isDisconnectionAcknowledged(),component:{id:H.id,width:H.dimensions.width,height:H.dimensions.height}};e.ajax({type:"PUT",url:H.uri,data:JSON.stringify(F),dataType:"json",contentType:"application/json"}).done(function(J){o.set(J)}).fail(function(){var K=j.width;if(k.isDefinedAndNotNull(H.component.width)){K=H.component.width}var J=j.height;if(k.isDefinedAndNotNull(H.component.height)){J=H.component.height}H.dimensions={width:K,height:J};G.call(h)})}x.event.sourceEvent.stopPropagation()})},add:function(D,B){var F=false;if(k.isDefinedAndNotNull(B)){F=k.isDefinedAndNotNull(B.selectAll)?B.selectAll:F}var A=new Date().getTime();var G=function(H){d.set(H.id,A);f.set(H.id,e.extend({type:"Label"},H))};if(e.isArray(D)){e.each(D,function(I,H){G(H)})}else{if(k.isDefinedAndNotNull(D)){G(D)}}var C=q();var E=y(C.enter(),F);h(C.merge(E))},set:function(B,I){var A=false;var F=false;var C=false;if(k.isDefinedAndNotNull(I)){A=k.isDefinedAndNotNull(I.selectAll)?I.selectAll:A;F=k.isDefinedAndNotNull(I.transition)?I.transition:F;C=k.isDefinedAndNotNull(I.overrideRevisionCheck)?I.overrideRevisionCheck:C}var G=function(J){var K=f.get(J.id);if((z.isNewerRevision(K,J)&&!w.has(J.id))||C===true){f.set(J.id,e.extend({type:"Label"},J))}};if(e.isArray(B)){e.each(f.keys(),function(K,M){var L=f.get(M);var J=e.grep(B,function(N){return N.id===L.id});if(J.length===0&&!d.has(M)){f.remove(M)}});e.each(B,function(K,J){G(J)})}else{if(k.isDefinedAndNotNull(B)){G(B)}}var H=q();var E=y(H.enter(),A);var D=H.merge(E);D.call(h).call(u.position,F);H.exit().call(t)},get:function(A){if(k.isUndefined(A)){return f.values()}else{return f.get(A)}},refresh:function(A){if(k.isDefinedAndNotNull(A)){x.select("#id-"+A).call(h)}else{x.selectAll("g.label").call(h)}},reload:function(B){if(f.has(B)){var A=f.get(B);return e.ajax({type:"GET",url:A.uri,dataType:"json"}).done(function(C){o.set(C)})}},position:function(A){x.select("#id-"+A).call(u.position)},remove:function(B){var A=new Date().getTime();if(e.isArray(B)){e.each(B,function(C,D){w.set(D,A);f.remove(D)})}else{w.set(B,A);f.remove(B)}q().exit().call(t)},removeAll:function(){o.remove(f.keys())},expireCaches:function(B){var A=function(C){C.each(function(D,E){if(B>D){C.remove(E)}})};A(d);A(w)},defaultColor:function(){return"#fff7d7"}};return o}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Connection","nf.Common","nf.Client","nf.CanvasUtils"],function(f,e,h,g,c,d){return(nf.Port=b(f,e,h,g,c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Port=b(require("jquery"),require("d3"),require("nf.Connection"),require("nf.Common"),require("nf.Client"),require("nf.CanvasUtils")))}else{nf.Port=b(a.$,a.d3,a.nf.Connection,a.nf.Common,a.nf.Client,a.nf.CanvasUtils)}}}(this,function(d,A,k,i,C,w){var o;var t;var l;var j;var u;var p=15;var m=25;var y={width:240,height:48};var q={width:240,height:80};var h=function(D){return D.allowRemoteAccess===true?q:y};var e;var z;var c;var g;var s=function(){return g.selectAll("g.input-port, g.output-port").data(e.values(),function(D){return D.id})};var B=function(D){return D.allowRemoteAccess!==true};var x=function(D){return function(E){return D+(B(E)?0:m)}};var n=function(F,E){if(F.empty()){return F}var D=F.append("g").attrs({id:function(G){return"id-"+G.id},"class":function(G){if(G.portType==="INPUT_PORT"){return"input-port component"}else{return"output-port component"}}}).classed("selected",E).call(w.position);D.append("rect").attrs({"class":"border",width:function(G){return G.dimensions.width},height:function(G){return G.dimensions.height},fill:"transparent",stroke:"transparent"});D.append("rect").attrs({"class":"body",width:function(G){return G.dimensions.width},height:function(G){return G.dimensions.height},filter:"url(#component-drop-shadow)","stroke-width":0});D.append("rect").attrs({"class":"remote-banner",width:q.width,height:m,fill:"#e3e8eb"}).classed("hidden",B);D.append("text").attrs({"class":"port-icon",x:10,y:x(38)}).text(function(G){if(G.portType==="INPUT_PORT"){return"\ue832"}else{return"\ue833"}});D.append("text").attrs({x:70,y:x(25),width:95,height:30,"class":"port-name"});D.call(l.activate).call(u.activate).call(j.activate);D.filter(function(G){return G.permissions.canWrite&&G.permissions.canRead}).call(t.activate).call(o.activate);return D};var r=function(D){if(D.empty()){return}D.select("rect.border").classed("unauthorized",function(E){return E.permissions.canRead===false}).attrs({height:function(E){return E.dimensions.height}});D.select("rect.body").classed("unauthorized",function(E){return E.permissions.canRead===false}).attrs({height:function(E){return E.dimensions.height}});D.each(function(F){var E=A.select(this);var G=E.select("g.port-details");w.editable(E,o,t);if(E.classed("visible")){if(G.empty()){G=E.append("g").attr("class","port-details");G.append("text").attrs({"class":"port-transmission-icon",x:10,y:18}).classed("hidden",B);G.append("rect").attrs({"class":"bulletin-background",x:q.width-m,width:m,height:m}).classed("hidden",B);G.append("text").attrs({"class":"bulletin-icon",x:q.width-18,y:18}).text("\uf24a").classed("hidden",B);G.append("text").attrs({"class":"run-status-icon",x:50,y:x(25)});G.append("path").attrs({"class":"component-comments",transform:"translate("+(F.dimensions.width-2)+", "+(F.dimensions.height-10)+")",d:"m0,0 l0,8 l-8,0 z"});G.append("text").attrs({"class":"active-thread-count-icon",y:x(43)}).text("\ue83f");G.append("text").attrs({"class":"active-thread-count",y:x(43)})}if(F.permissions.canRead){E.select("rect.remote-banner").classed("hidden",B);E.select("text.port-icon").attrs({y:x(38)});G.select("text.port-transmission-icon").classed("hidden",B);G.select("rect.bulletin-background").classed("hidden",B);G.select("rect.bulletin-icon").classed("hidden",B);E.select("text.port-name").each(function(K){var J=A.select(this);var H=K.component.name;var I=H.split(/\s+/);J.text(null).selectAll("tspan, title").remove();if(I.length===1){w.ellipsis(J,H)}else{w.multilineEllipsis(J,2,H)}}).attrs({y:x(25)}).append("title").text(function(H){return H.component.name});E.select("path.component-comments").style("visibility",i.isBlank(F.component.comments)?"hidden":"visible").attr("transform","translate("+(F.dimensions.width-2)+", "+(F.dimensions.height-10)+")").each(function(){var H=A.select("#comments-tip-"+F.id);if(i.isBlank(F.component.comments)){if(!H.empty()){H.remove()}}else{if(H.empty()){H=A.select("#port-tooltips").append("div").attr("id",function(){return"comments-tip-"+F.id}).attr("class","tooltip nifi-tooltip")}H.text(F.component.comments);w.canvasTooltip(H,A.select(this))}})}else{E.select("text.port-name").text(null);E.select("path.component-comments").style("visibility","hidden");E.call(b)}E.call(f);k.getComponentConnections(F.id).forEach(function(H){k.refresh(H.id)})}else{if(F.permissions.canRead){E.select("text.port-name").text(function(I){var H=I.component.name;if(H.length>p){return H.substring(0,p)+String.fromCharCode(8230)}else{return H}})}else{E.select("text.port-name").text(null)}E.call(b);if(!G.empty()){G.remove()}}})};var f=function(D){if(D.empty()){return}D.select("text.run-status-icon").attrs({fill:function(F){var E="#728e9b";if(F.status.aggregateSnapshot.runStatus==="Invalid"){E="#cf9f5d"}else{if(F.status.aggregateSnapshot.runStatus==="Running"){E="#7dc7a0"}else{if(F.status.aggregateSnapshot.runStatus==="Stopped"){E="#d18686"}}}return E},"font-family":function(F){var E="FontAwesome";if(F.status.aggregateSnapshot.runStatus==="Disabled"){E="flowfont"}return E},y:x(25)}).text(function(F){var E="";if(F.status.aggregateSnapshot.runStatus==="Disabled"){E="\ue802"}else{if(F.status.aggregateSnapshot.runStatus==="Invalid"){E="\uf071"}else{if(F.status.aggregateSnapshot.runStatus==="Running"){E="\uf04b"}else{if(F.status.aggregateSnapshot.runStatus==="Stopped"){E="\uf04d"}}}}return E}).each(function(F){var E=A.select("#run-status-tip-"+F.id);if(F.permissions.canRead&&!i.isEmpty(F.component.validationErrors)){if(E.empty()){E=A.select("#port-tooltips").append("div").attr("id",function(){return"run-status-tip-"+F.id}).attr("class","tooltip nifi-tooltip")}E.html(function(){var G=i.formatUnorderedList(F.component.validationErrors);if(G===null||G.length===0){return""}else{return d("<div></div>").append(G).html()}});w.canvasTooltip(E,A.select(this))}else{if(!E.empty()){E.remove()}}});D.select("text.port-transmission-icon").attrs({"font-family":function(E){if(E.status.transmitting===true){return"FontAwesome"}else{return"flowfont"}}}).text(function(E){if(E.status.transmitting===true){return"\uf140"}else{return"\ue80a"}}).classed("transmitting",function(E){if(E.status.transmitting===true){return true}else{return false}}).classed("not-transmitting",function(E){if(E.status.transmitting!==true){return true}else{return false}});D.each(function(G){var E=A.select(this);var F=0;w.activeThreadCount(E,G,function(H){F=H});E.select("text.active-thread-count-icon").attr("y",x(43));E.select("text.active-thread-count").attr("y",x(43));E.select("rect.bulletin-background").classed("has-bulletins",function(){return !i.isEmpty(G.status.aggregateSnapshot.bulletins)});w.bulletins(E,G,function(){return A.select("#port-tooltips")},F)})};var v=function(D){if(D.empty()){return}D.call(b).remove()};var b=function(D){D.each(function(E){d("#run-status-tip-"+E.id).remove();d("#bulletin-tip-"+E.id).remove();d("#comments-tip-"+E.id).remove()})};var a={init:function(F,G,D,E,H){o=F;t=G;l=D;u=E;j=H;e=A.map();z=A.map();c=A.map();g=A.select("#canvas").append("g").attrs({"pointer-events":"all","class":"ports"})},add:function(G,E){var I=false;if(i.isDefinedAndNotNull(E)){I=i.isDefinedAndNotNull(E.selectAll)?E.selectAll:I}var D=new Date().getTime();var J=function(K){c.set(K.id,D);e.set(K.id,d.extend({type:"Port",dimensions:h(K),status:{activeThreadCount:0}},K))};if(d.isArray(G)){d.each(G,function(L,K){J(K)})}else{if(i.isDefinedAndNotNull(G)){J(G)}}var F=s();var H=n(F.enter(),I);r(F.merge(H))},set:function(D,L){var E=false;var I=false;var F=false;if(i.isDefinedAndNotNull(L)){E=i.isDefinedAndNotNull(L.selectAll)?L.selectAll:E;I=i.isDefinedAndNotNull(L.transition)?L.transition:I;F=i.isDefinedAndNotNull(L.overrideRevisionCheck)?L.overrideRevisionCheck:F}var J=function(M){var N=e.get(M.id);if((C.isNewerRevision(N,M)&&!z.has(M.id))||F===true){e.set(M.id,d.extend({type:"Port",dimensions:h(M),status:{activeThreadCount:0}},M))}};if(d.isArray(D)){d.each(e.keys(),function(N,O){var P=e.get(O);var M=d.grep(D,function(Q){return Q.id===P.id});if(M.length===0&&!c.has(O)){e.remove(O)}});d.each(D,function(N,M){J(M)})}else{if(i.isDefinedAndNotNull(D)){J(D)}}var K=s();var H=n(K.enter(),E);var G=K.merge(H);G.call(r).call(w.position,I);K.exit().call(v)},get:function(D){if(i.isUndefined(D)){return e.values()}else{return e.get(D)}},refresh:function(D){if(i.isDefinedAndNotNull(D)){A.select("#id-"+D).call(r)}else{A.selectAll("g.input-port, g.output-port").call(r)}},pan:function(){A.selectAll("g.input-port.entering, g.output-port.entering, g.input-port.leaving, g.output-port.leaving").call(r)},reload:function(E){if(e.has(E)){var D=e.get(E);return d.ajax({type:"GET",url:D.uri,dataType:"json"}).done(function(F){a.set(F)})}},position:function(D){A.select("#id-"+D).call(w.position)},remove:function(E){var D=new Date().getTime();if(d.isArray(E)){d.each(E,function(F,G){z.set(G,D);e.remove(G)})}else{z.set(E,D);e.remove(E)}s().exit().call(v)},removeAll:function(){a.remove(e.keys())},expireCaches:function(E){var D=function(F){F.each(function(G,H){if(E>G){F.remove(H)}})};D(c);D(z)}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Connection","nf.Common","nf.Client","nf.CanvasUtils","nf.Dialog"],function(g,e,i,h,c,d,f){return(nf.ProcessGroup=b(g,e,i,h,c,d,f))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ProcessGroup=b(require("jquery"),require("d3"),require("nf.Connection"),require("nf.Common"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.Dialog")))}else{nf.ProcessGroup=b(a.$,a.d3,a.nf.Connection,a.nf.Common,a.nf.Client,a.nf.CanvasUtils,a.nf.Dialog)}}}(this,function(g,z,k,j,A,v,p){var n;var t;var l;var u;var o=30;var i={width:384,height:176};var d;var y;var e;var q;var m=function(B){return j.isDefinedAndNotNull(B.versionedFlowState)};var s=function(){return q.selectAll("g.process-group").data(d.values(),function(B){return B.id})};var w=function(D,B){if(D.empty()){return D}var C=D.append("g").attrs({id:function(E){return"id-"+E.id},"class":"process-group component"}).classed("selected",B).call(v.position);C.append("rect").attrs({"class":"border",width:function(E){return E.dimensions.width},height:function(E){return E.dimensions.height},fill:"transparent",stroke:"transparent"});C.append("rect").attrs({"class":"body",width:function(E){return E.dimensions.width},height:function(E){return E.dimensions.height},filter:"url(#component-drop-shadow)","stroke-width":0});C.append("rect").attrs({width:function(E){return E.dimensions.width},height:32,fill:"#b8c6cd"});C.append("text").attrs({x:10,y:20,width:300,height:16,"class":"process-group-name"});C.append("text").attrs({x:10,y:21,"class":"version-control"});C.on("dblclick",function(E){h.enterGroup(E.id)}).call(l.activate).call(u.activate);C.filter(function(E){return E.permissions.canWrite&&E.permissions.canRead}).on("mouseover.drop",function(I){var G=z.select(this);if(!G.classed("drop")){var H=G.datum();var F=z.select("rect.drag-selection");if(!F.empty()){var E=v.getSelection().filter(function(J){return H.id===J.id});if(E.empty()){G.classed("drop",function(){return k.isDisconnected(v.getSelection())})}}}}).on("mouseout.drop",function(E){z.select(this).classed("drop",false)}).call(t.activate).call(n.activate);return C};var b=10;var a=5;var x=function(B){if(B.empty()){return}B.select("rect.border").classed("unauthorized",function(C){return C.permissions.canRead===false});B.select("rect.body").classed("unauthorized",function(C){return C.permissions.canRead===false});B.each(function(K){var ab=z.select(this);var X=ab.select("g.process-group-details");v.editable(ab,n,t);if(ab.classed("visible")){if(X.empty()){X=ab.append("g").attr("class","process-group-details");X.append("rect").attrs({x:0,y:32,width:function(){return K.dimensions.width},height:24,fill:"#e3e8eb"});X.append("rect").attrs({x:0,y:function(){return K.dimensions.height-24},width:function(){return K.dimensions.width},height:24,fill:"#e3e8eb"});X.append("text").attrs({x:10,y:49,"class":"process-group-transmitting process-group-contents-icon","font-family":"FontAwesome"}).text("\uf140").append("title").text("Transmitting Remote Process Groups");X.append("text").attrs({y:49,"class":"process-group-transmitting-count process-group-contents-count"});X.append("text").attrs({y:49,"class":"process-group-not-transmitting process-group-contents-icon","font-family":"flowfont"}).text("\ue80a").append("title").text("Not Transmitting Remote Process Groups");X.append("text").attrs({y:49,"class":"process-group-not-transmitting-count process-group-contents-count"});X.append("text").attrs({y:49,"class":"process-group-running process-group-contents-icon","font-family":"FontAwesome"}).text("\uf04b").append("title").text("Running Components");X.append("text").attrs({y:49,"class":"process-group-running-count process-group-contents-count"});X.append("text").attrs({y:49,"class":"process-group-stopped process-group-contents-icon","font-family":"FontAwesome"}).text("\uf04d").append("title").text("Stopped Components");X.append("text").attrs({y:49,"class":"process-group-stopped-count process-group-contents-count"});X.append("text").attrs({y:49,"class":"process-group-invalid process-group-contents-icon","font-family":"FontAwesome"}).text("\uf071").append("title").text("Invalid Components");X.append("text").attrs({y:49,"class":"process-group-invalid-count process-group-contents-count"});X.append("text").attrs({y:49,"class":"process-group-disabled process-group-contents-icon","font-family":"flowfont"}).text("\ue802").append("title").text("Disabled Components");X.append("text").attrs({y:49,"class":"process-group-disabled-count process-group-contents-count"});X.append("text").attrs({x:10,y:function(){return K.dimensions.height-7},"class":"process-group-up-to-date process-group-contents-icon","font-family":"FontAwesome"}).text("\uf00c").append("title").text("Up to date Versioned Process Groups");X.append("text").attrs({y:function(){return K.dimensions.height-7},"class":"process-group-up-to-date-count process-group-contents-count"});X.append("text").attrs({y:function(){return K.dimensions.height-7},"class":"process-group-locally-modified process-group-contents-icon","font-family":"FontAwesome"}).text("\uf069").append("title").text("Locally modified Versioned Process Groups");X.append("text").attrs({y:function(){return K.dimensions.height-7},"class":"process-group-locally-modified-count process-group-contents-count"});X.append("text").attrs({y:function(){return K.dimensions.height-7},"class":"process-group-stale process-group-contents-icon","font-family":"FontAwesome"}).text("\uf0aa").append("title").text("Stale Versioned Process Groups");X.append("text").attrs({y:function(){return K.dimensions.height-7},"class":"process-group-stale-count process-group-contents-count"});X.append("text").attrs({y:function(){return K.dimensions.height-7},"class":"process-group-locally-modified-and-stale process-group-contents-icon","font-family":"FontAwesome"}).text("\uf06a").append("title").text("Locally modified and stale Versioned Process Groups");X.append("text").attrs({y:function(){return K.dimensions.height-7},"class":"process-group-locally-modified-and-stale-count process-group-contents-count"});X.append("text").attrs({y:function(){return K.dimensions.height-7},"class":"process-group-sync-failure process-group-contents-icon","font-family":"FontAwesome"}).text("\uf128").append("title").text("Sync failure Versioned Process Groups");X.append("text").attrs({y:function(){return K.dimensions.height-7},"class":"process-group-sync-failure-count process-group-contents-count"});X.append("rect").attrs({width:function(){return K.dimensions.width},height:19,x:0,y:66,fill:"#f4f6f7"});X.append("rect").attrs({width:function(){return K.dimensions.width},height:1,x:0,y:84,fill:"#c7d2d7"});X.append("rect").attrs({width:function(){return K.dimensions.width},height:19,x:0,y:85,fill:"#ffffff"});X.append("rect").attrs({width:function(){return K.dimensions.width},height:1,x:0,y:103,fill:"#c7d2d7"});X.append("rect").attrs({width:function(){return K.dimensions.width},height:19,x:0,y:104,fill:"#f4f6f7"});X.append("rect").attrs({width:function(){return K.dimensions.width},height:1,x:0,y:122,fill:"#c7d2d7"});X.append("rect").attrs({width:function(){return K.dimensions.width},height:19,x:0,y:123,fill:"#ffffff"});var W=X.append("g").attrs({transform:"translate(6, 75)"});W.append("text").attrs({width:73,height:10,x:4,y:5,"class":"stats-label"}).text("Queued");W.append("text").attrs({width:73,height:10,x:4,y:24,"class":"stats-label"}).text("In");W.append("text").attrs({width:73,height:10,x:4,y:42,"class":"stats-label"}).text("Read/Write");W.append("text").attrs({width:73,height:10,x:4,y:60,"class":"stats-label"}).text("Out");var F=X.append("g").attrs({transform:"translate(95, 75)"});var T=F.append("text").attrs({width:180,height:10,x:4,y:5,"class":"process-group-queued stats-value"});T.append("tspan").attrs({"class":"count"});T.append("tspan").attrs({"class":"size"});var O=F.append("text").attrs({width:180,height:10,x:4,y:24,"class":"process-group-in stats-value"});O.append("tspan").attrs({"class":"count"});O.append("tspan").attrs({"class":"size"});O.append("tspan").attrs({"class":"ports"});O.append("tspan").attrs({"class":"public-ports"});F.append("text").attrs({width:180,height:10,x:4,y:42,"class":"process-group-read-write stats-value"});var R=F.append("text").attrs({width:180,height:10,x:4,y:60,"class":"process-group-out stats-value"});R.append("tspan").attrs({"class":"ports"});R.append("tspan").attrs({"class":"public-ports"});R.append("tspan").attrs({"class":"count"});R.append("tspan").attrs({"class":"size"});var N=X.append("g").attrs({transform:"translate(335, 75)"});N.append("text").attrs({width:25,height:10,x:4,y:24,"class":"stats-info"}).text("5 min");N.append("text").attrs({width:25,height:10,x:4,y:42,"class":"stats-info"}).text("5 min");N.append("text").attrs({width:25,height:10,x:4,y:60,"class":"stats-info"}).text("5 min");X.append("path").attrs({"class":"component-comments",transform:"translate("+(K.dimensions.width-2)+", "+(K.dimensions.height-10)+")",d:"m0,0 l0,8 l-8,0 z"});X.append("text").attrs({"class":"active-thread-count-icon",y:20}).text("\ue83f");X.append("text").attrs({"class":"active-thread-count",y:20});X.append("rect").attrs({"class":"bulletin-background",x:function(){return K.dimensions.width-24},y:32,width:24,height:24});X.append("text").attrs({"class":"bulletin-icon",x:function(){return K.dimensions.width-17},y:49}).text("\uf24a")}var V=X.select("text.process-group-transmitting").classed("transmitting",function(ai){return ai.permissions.canRead&&ai.activeRemotePortCount>0}).classed("zero",function(ai){return ai.permissions.canRead&&ai.activeRemotePortCount===0});var ae=X.select("text.process-group-transmitting-count").attr("x",function(){var ai=parseInt(V.attr("x"),10);return ai+Math.round(V.node().getComputedTextLength())+a}).text(function(ai){return ai.activeRemotePortCount});ae.append("title").text("Transmitting Remote Process Groups");var E=X.select("text.process-group-not-transmitting").classed("not-transmitting",function(ai){return ai.permissions.canRead&&ai.inactiveRemotePortCount>0}).classed("zero",function(ai){return ai.permissions.canRead&&ai.inactiveRemotePortCount===0}).attr("x",function(){var ai=parseInt(ae.attr("x"),10);return ai+Math.round(ae.node().getComputedTextLength())+b});var ac=X.select("text.process-group-not-transmitting-count").attr("x",function(){var ai=parseInt(E.attr("x"),10);return ai+Math.round(E.node().getComputedTextLength())+a}).text(function(ai){return ai.inactiveRemotePortCount});ac.append("title").text("Not transmitting Remote Process Groups");var G=X.select("text.process-group-running").classed("running",function(ai){return ai.permissions.canRead&&ai.component.runningCount>0}).classed("zero",function(ai){return ai.permissions.canRead&&ai.component.runningCount===0}).attr("x",function(){var ai=parseInt(ac.attr("x"),10);return ai+Math.round(ac.node().getComputedTextLength())+b});var M=X.select("text.process-group-running-count").attr("x",function(){var ai=parseInt(G.attr("x"),10);return ai+Math.round(G.node().getComputedTextLength())+a}).text(function(ai){return ai.runningCount});M.append("title").text("Running Components");var H=X.select("text.process-group-stopped").classed("stopped",function(ai){return ai.permissions.canRead&&ai.component.stoppedCount>0}).classed("zero",function(ai){return ai.permissions.canRead&&ai.component.stoppedCount===0}).attr("x",function(){var ai=parseInt(M.attr("x"),10);return ai+Math.round(M.node().getComputedTextLength())+b});var ad=X.select("text.process-group-stopped-count").attr("x",function(){var ai=parseInt(H.attr("x"),10);return ai+Math.round(H.node().getComputedTextLength())+a}).text(function(ai){return ai.stoppedCount});ad.append("title").text("Stopped Components");var aa=X.select("text.process-group-invalid").classed("invalid",function(ai){return ai.permissions.canRead&&ai.component.invalidCount>0}).classed("zero",function(ai){return ai.permissions.canRead&&ai.component.invalidCount===0}).attr("x",function(){var ai=parseInt(ad.attr("x"),10);return ai+Math.round(ad.node().getComputedTextLength())+b});var Q=X.select("text.process-group-invalid-count").attr("x",function(){var ai=parseInt(aa.attr("x"),10);return ai+Math.round(aa.node().getComputedTextLength())+a}).text(function(ai){return ai.invalidCount});Q.append("title").text("Invalid Components");var I=X.select("text.process-group-disabled").classed("disabled",function(ai){return ai.permissions.canRead&&ai.component.disabledCount>0}).classed("zero",function(ai){return ai.permissions.canRead&&ai.component.disabledCount===0}).attr("x",function(){var ai=parseInt(Q.attr("x"),10);return ai+Math.round(Q.node().getComputedTextLength())+b});var Z=X.select("text.process-group-disabled-count").attr("x",function(){var ai=parseInt(I.attr("x"),10);return ai+Math.round(I.node().getComputedTextLength())+a}).text(function(ai){return ai.disabledCount});Z.append("title").text("Disabled Components");var ah=X.select("text.process-group-up-to-date").classed("up-to-date",function(ai){return ai.permissions.canRead&&ai.component.upToDateCount>0}).classed("zero",function(ai){return ai.permissions.canRead&&ai.component.upToDateCount===0});var L=X.select("text.process-group-up-to-date-count").attr("x",function(){var ai=parseInt(ah.attr("x"),10);return ai+Math.round(ah.node().getComputedTextLength())+a}).text(function(ai){return ai.upToDateCount});L.append("title").text("Up to date Versioned Process Groups");var U=X.select("text.process-group-locally-modified").classed("locally-modified",function(ai){return ai.permissions.canRead&&ai.component.locallyModifiedCount>0}).classed("zero",function(ai){return ai.permissions.canRead&&ai.component.locallyModifiedCount===0}).attr("x",function(){var ai=parseInt(L.attr("x"),10);return ai+Math.round(L.node().getComputedTextLength())+b});var D=X.select("text.process-group-locally-modified-count").attr("x",function(){var ai=parseInt(U.attr("x"),10);return ai+Math.round(U.node().getComputedTextLength())+a}).text(function(ai){return ai.locallyModifiedCount});D.append("title").text("Locally modified Versioned Process Groups");var P=X.select("text.process-group-stale").classed("stale",function(ai){return ai.permissions.canRead&&ai.component.staleCount>0}).classed("zero",function(ai){return ai.permissions.canRead&&ai.component.staleCount===0}).attr("x",function(){var ai=parseInt(D.attr("x"),10);return ai+Math.round(D.node().getComputedTextLength())+b});var J=X.select("text.process-group-stale-count").attr("x",function(){var ai=parseInt(P.attr("x"),10);return ai+Math.round(P.node().getComputedTextLength())+a}).text(function(ai){return ai.staleCount});J.append("title").text("Stale Versioned Process Groups");var C=X.select("text.process-group-locally-modified-and-stale").classed("locally-modified-and-stale",function(ai){return ai.permissions.canRead&&ai.component.locallyModifiedAndStaleCount>0}).classed("zero",function(ai){return ai.permissions.canRead&&ai.component.locallyModifiedAndStaleCount===0}).attr("x",function(){var ai=parseInt(J.attr("x"),10);return ai+Math.round(J.node().getComputedTextLength())+b});var S=X.select("text.process-group-locally-modified-and-stale-count").attr("x",function(){var ai=parseInt(C.attr("x"),10);return ai+Math.round(C.node().getComputedTextLength())+a}).text(function(ai){return ai.locallyModifiedAndStaleCount});S.append("title").text("Locally modified and stale Versioned Process Groups");var af=X.select("text.process-group-sync-failure").classed("sync-failure",function(ai){return ai.permissions.canRead&&ai.component.syncFailureCount>0}).classed("zero",function(ai){return ai.permissions.canRead&&ai.component.syncFailureCount===0}).attr("x",function(){var ai=parseInt(S.attr("x"),10);return ai+Math.round(S.node().getComputedTextLength())+b-2});var Y=X.select("text.process-group-sync-failure-count").attr("x",function(){var ai=parseInt(af.attr("x"),10);return ai+Math.round(af.node().getComputedTextLength())+a}).text(function(ai){return ai.syncFailureCount});Y.append("title").text("Sync failure Versioned Process Groups");var ag=ab.select("text.version-control").styles({visibility:m(K)?"visible":"hidden",fill:function(){if(m(K)){var ai=K.versionedFlowState;if(ai==="SYNC_FAILURE"){return"#666666"}else{if(ai==="LOCALLY_MODIFIED_AND_STALE"){return"#BA554A"}else{if(ai==="STALE"){return"#BA554A"}else{if(ai==="LOCALLY_MODIFIED"){return"#666666"}else{return"#1A9964"}}}}}else{return"#000"}}}).text(function(){if(m(K)){var ai=K.versionedFlowState;if(ai==="SYNC_FAILURE"){return"\uf128"}else{if(ai==="LOCALLY_MODIFIED_AND_STALE"){return"\uf06a"}else{if(ai==="STALE"){return"\uf0aa"}else{if(ai==="LOCALLY_MODIFIED"){return"\uf069"}else{return"\uf00c"}}}}}else{return""}});if(K.permissions.canRead){ag.each(function(){var ai=z.select("#version-control-tip-"+K.id);if(m(K)){if(ai.empty()){ai=z.select("#process-group-tooltips").append("div").attr("id",function(){return"version-control-tip-"+K.id}).attr("class","tooltip nifi-tooltip")}ai.html(function(){var aj=K.component.versionControlInformation;var al=g("<div></div>").text('Tracking to "'+aj.flowName+'" version '+aj.version+' in "'+aj.registryName+" - "+aj.bucketName+'"');var ak=g("<div></div>").text(j.getVersionControlTooltip(aj));return g("<div></div>").append(al).append("<br/>").append(ak).html()});v.canvasTooltip(ai,z.select(this))}else{if(!ai.empty()){ai.remove()}}});ab.select("path.component-comments").style("visibility",j.isBlank(K.component.comments)?"hidden":"visible").each(function(){var ai=z.select("#comments-tip-"+K.id);if(j.isBlank(K.component.comments)){if(!ai.empty()){ai.remove()}}else{if(ai.empty()){ai=z.select("#process-group-tooltips").append("div").attr("id",function(){return"comments-tip-"+K.id}).attr("class","tooltip nifi-tooltip")}ai.text(K.component.comments);v.canvasTooltip(ai,z.select(this))}});ab.select("text.process-group-name").attrs({x:function(){if(m(K)){var ai=parseInt(ag.attr("x"),10);return ai+Math.round(ag.node().getComputedTextLength())+a}else{return 10}},width:function(){if(m(K)){var aj=parseInt(ag.attr("x"),10);var ai=parseInt(z.select(this).attr("x"),10);return 300-(ai-aj)}else{return 300}}}).each(function(aj){var ai=z.select(this);ai.text(null).selectAll("title").remove();v.ellipsis(ai,aj.component.name)}).append("title").text(function(ai){return ai.component.name})}else{ab.select("path.component-comments").style("visibility","hidden");ab.select("text.process-group-name").attrs({x:10,width:316}).text(null);ab.call(c)}ab.call(f)}else{if(K.permissions.canRead){ab.select("text.process-group-name").text(function(aj){var ai=aj.component.name;if(ai.length>o){return ai.substring(0,o)+String.fromCharCode(8230)}else{return ai}})}else{ab.select("text.process-group-name").text(null)}ab.call(c);if(!X.empty()){X.remove()}}})};var f=function(B){if(B.empty()){return}B.select("text.process-group-queued tspan.count").text(function(C){return j.substringBeforeFirst(C.status.aggregateSnapshot.queued," ")});B.select("text.process-group-queued tspan.size").text(function(C){return" "+j.substringAfterFirst(C.status.aggregateSnapshot.queued," ")});B.select("text.process-group-in tspan.count").text(function(C){return j.substringBeforeFirst(C.status.aggregateSnapshot.input," ")});B.select("text.process-group-in tspan.size").text(function(C){return" "+j.substringAfterFirst(C.status.aggregateSnapshot.input," ")});B.select("text.process-group-in tspan.ports").text(function(C){return" "+String.fromCharCode(8594)+" "+C.inputPortCount});B.select("text.process-group-in tspan.public-ports").text(function(C){return C.publicInputPortCount>0?" ("+C.publicInputPortCount+" remote)":""});B.select("text.process-group-read-write").text(function(C){return C.status.aggregateSnapshot.read+" / "+C.status.aggregateSnapshot.written});B.select("text.process-group-out tspan.ports").text(function(C){return C.outputPortCount});B.select("text.process-group-out tspan.public-ports").text(function(C){return C.publicOutputPortCount>0?" ("+C.publicOutputPortCount+" remote) ":""});B.select("text.process-group-out tspan.count").text(function(C){return" "+String.fromCharCode(8594)+" "+j.substringBeforeFirst(C.status.aggregateSnapshot.output," ")});B.select("text.process-group-out tspan.size").text(function(C){return" "+j.substringAfterFirst(C.status.aggregateSnapshot.output," ")});B.each(function(E){var C=z.select(this);var D=0;v.activeThreadCount(C,E,function(F){D=F});C.select("rect.bulletin-background").classed("has-bulletins",function(){return !j.isEmpty(E.status.aggregateSnapshot.bulletins)});v.bulletins(C,E,function(){return z.select("#process-group-tooltips")},D)})};var r=function(B){if(B.empty()){return}B.call(c).remove()};var c=function(B){B.each(function(C){g("#bulletin-tip-"+C.id).remove();g("#version-control-tip-"+C.id).remove();g("#comments-tip-"+C.id).remove()})};var h={init:function(D,E,B,C){n=D;t=E;l=B;u=C;d=z.map();y=z.map();e=z.map();q=z.select("#canvas").append("g").attrs({"pointer-events":"all","class":"process-groups"})},add:function(H,C){var F=false;if(j.isDefinedAndNotNull(C)){F=j.isDefinedAndNotNull(C.selectAll)?C.selectAll:F}var B=new Date().getTime();var G=function(I){e.set(I.id,B);d.set(I.id,g.extend({type:"ProcessGroup",dimensions:i},I))};if(g.isArray(H)){g.each(H,function(I,J){G(J)})}else{if(j.isDefinedAndNotNull(H)){G(H)}}var D=s();var E=w(D.enter(),F);x(D.merge(E))},set:function(D,J){var B=false;var G=false;var C=false;if(j.isDefinedAndNotNull(J)){B=j.isDefinedAndNotNull(J.selectAll)?J.selectAll:B;G=j.isDefinedAndNotNull(J.transition)?J.transition:G;C=j.isDefinedAndNotNull(J.overrideRevisionCheck)?J.overrideRevisionCheck:C}var H=function(K){var L=d.get(K.id);if((A.isNewerRevision(L,K)&&!y.has(K.id))||C===true){d.set(K.id,g.extend({type:"ProcessGroup",dimensions:i},K))}};if(g.isArray(D)){g.each(d.keys(),function(L,M){var N=d.get(M);var K=g.grep(D,function(O){return O.id===N.id});if(K.length===0&&!e.has(M)){d.remove(M)}});g.each(D,function(K,L){H(L)})}else{if(j.isDefinedAndNotNull(D)){H(D)}}var I=s();var F=w(I.enter(),B);var E=I.merge(F);E.call(x).call(v.position,G);I.exit().call(r)},get:function(B){if(j.isUndefined(B)){return d.values()}else{return d.get(B)}},refresh:function(B){if(j.isDefinedAndNotNull(B)){z.select("#id-"+B).call(x)}else{z.selectAll("g.process-group").call(x)}},pan:function(){z.selectAll("g.process-group.entering, g.process-group.leaving").call(x)},reload:function(C){if(d.has(C)){var B=d.get(C);return g.ajax({type:"GET",url:B.uri,dataType:"json"}).done(function(D){h.set(D)})}},position:function(B){z.select("#id-"+B).call(v.position)},remove:function(C){var B=new Date().getTime();if(g.isArray(C)){g.each(C,function(E,D){y.set(D,B);d.remove(D)})}else{y.set(C,B);d.remove(C)}s().exit().call(r)},removeAll:function(){h.remove(d.keys())},expireCaches:function(C){var B=function(D){D.each(function(E,F){if(C>E){D.remove(F)}})};B(e);B(y)},enterGroup:function(B){u.hide();return v.reload(B).done(function(){var C=v.restoreUserView();if(C===false){v.fitCanvas()}v.setURLParameters(B,z.select())}).fail(function(){p.showOkDialog({headerText:"Process Group",dialogContent:"Unable to enter the selected group."})})}};return h}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Connection","nf.Common","nf.Client","nf.CanvasUtils"],function(f,e,h,g,c,d){return(nf.RemoteProcessGroup=b(f,e,h,g,c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.RemoteProcessGroup=b(require("jquery"),require("d3"),require("nf.Connection"),require("nf.Common"),require("nf.Client"),require("nf.CanvasUtils")))}else{nf.RemoteProcessGroup=b(a.$,a.d3,a.nf.Connection,a.nf.Common,a.nf.Client,a.nf.CanvasUtils)}}}(this,function(g,y,l,j,z,v){var n;var t;var m;var k;var u;var o=30;var h={width:384,height:176};var c;var w;var d;var x;var s=function(){return x.selectAll("g.remote-process-group").data(c.values(),function(A){return A.id})};var f=function(C,A){if(C.empty()){return C}var B=C.append("g").attrs({id:function(D){return"id-"+D.id},"class":"remote-process-group component"}).classed("selected",A).call(v.position);B.append("rect").attrs({"class":"border",width:function(D){return D.dimensions.width},height:function(D){return D.dimensions.height},fill:"transparent",stroke:"transparent"});B.append("rect").attrs({"class":"body",width:function(D){return D.dimensions.width},height:function(D){return D.dimensions.height},filter:"url(#component-drop-shadow)","stroke-width":0});B.append("rect").attrs({width:function(D){return D.dimensions.width},height:32,fill:"#b8c6cd"});B.append("text").attrs({x:30,y:20,width:305,height:16,"class":"remote-process-group-name"});B.call(m.activate).call(u.activate).call(k.activate);return B};var r=function(A){if(A.empty()){return}A.select("rect.border").classed("unauthorized",function(B){return B.permissions.canRead===false});A.select("rect.body").classed("unauthorized",function(B){return B.permissions.canRead===false});A.each(function(G){var H=y.select(this);var E=H.select("g.remote-process-group-details");v.editable(H,n,t);if(H.classed("visible")){if(E.empty()){E=H.append("g").attr("class","remote-process-group-details");E.append("text").attrs({"class":"remote-process-group-transmission-status",x:10,y:20});E.append("rect").attrs({x:0,y:32,width:function(){return G.dimensions.width},height:24,fill:"#e3e8eb"});E.append("text").attrs({"class":"remote-process-group-transmission-secure",x:10,y:48});E.append("text").attrs({x:30,y:48,width:305,height:12,"class":"remote-process-group-uri"});E.append("rect").attrs({width:function(){return G.dimensions.width},height:19,x:0,y:66,fill:"#f4f6f7"});E.append("rect").attrs({width:function(){return G.dimensions.width},height:1,x:0,y:84,fill:"#c7d2d7"});E.append("rect").attrs({width:function(){return G.dimensions.width},height:19,x:0,y:85,fill:"#ffffff"});var F=E.append("g").attrs({transform:"translate(6, 75)"});F.append("text").attrs({width:73,height:10,x:4,y:5,"class":"stats-label"}).text("Sent");F.append("text").attrs({width:73,height:10,x:4,y:23,"class":"stats-label"}).text("Received");var I=E.append("g").attrs({transform:"translate(95, 75)"});var B=I.append("text").attrs({width:180,height:10,x:4,y:5,"class":"remote-process-group-sent stats-value"});B.append("tspan").attrs({"class":"count"});B.append("tspan").attrs({"class":"size"});B.append("tspan").attrs({"class":"ports"});var C=I.append("text").attrs({width:180,height:10,x:4,y:23,"class":"remote-process-group-received stats-value"});C.append("tspan").attrs({"class":"ports"});C.append("tspan").attrs({"class":"count"});C.append("tspan").attrs({"class":"size"});var D=E.append("g").attrs({transform:"translate(335, 75)"});D.append("text").attrs({width:25,height:10,x:4,y:5,"class":"stats-info"}).text("5 min");D.append("text").attrs({width:25,height:10,x:4,y:23,"class":"stats-info"}).text("5 min");E.append("rect").attrs({x:0,y:function(){return G.dimensions.height-24},width:function(){return G.dimensions.width},height:24,fill:"#e3e8eb"});E.append("text").attrs({x:10,y:168,"class":"remote-process-group-last-refresh"});E.append("path").attrs({"class":"component-comments",transform:"translate("+(G.dimensions.width-2)+", "+(G.dimensions.height-10)+")",d:"m0,0 l0,8 l-8,0 z"});E.append("text").attrs({"class":"active-thread-count-icon",y:20}).text("\ue83f");E.append("text").attrs({"class":"active-thread-count",y:20});E.append("rect").attrs({"class":"bulletin-background",x:function(){return G.dimensions.width-24},y:32,width:24,height:24});E.append("text").attrs({"class":"bulletin-icon",x:function(){return G.dimensions.width-17},y:49}).text("\uf24a")}if(G.permissions.canRead){E.select("text.remote-process-group-uri").each(function(K){var J=y.select(this);J.text(null).selectAll("title").remove();v.ellipsis(J,K.component.targetUris)}).append("title").text(function(J){return J.component.name});E.select("text.remote-process-group-transmission-secure").text(function(K){var J="";if(K.component.targetSecure===true){J="\uf023"}else{J="\uf09c"}return J}).each(function(K){var J=y.select("#transmission-secure-"+K.id);if(J.empty()){J=y.select("#remote-process-group-tooltips").append("div").attr("id",function(){return"transmission-secure-"+K.id}).attr("class","tooltip nifi-tooltip")}J.text(function(){if(K.component.targetSecure===true){return"Site-to-Site is secure."}else{return"Site-to-Site is NOT secure."}});v.canvasTooltip(J,y.select(this))});E.select("path.component-comments").style("visibility",j.isBlank(G.component.comments)?"hidden":"visible").each(function(){var J=y.select("#comments-tip-"+G.id);if(j.isBlank(G.component.comments)){if(!J.empty()){J.remove()}}else{if(J.empty()){J=y.select("#remote-process-group-tooltips").append("div").attr("id",function(){return"comments-tip-"+G.id}).attr("class","tooltip nifi-tooltip")}J.text(G.component.comments);v.canvasTooltip(J,y.select(this))}});E.select("text.remote-process-group-last-refresh").text(function(J){if(j.isDefinedAndNotNull(J.component.flowRefreshed)){return J.component.flowRefreshed}else{return"Remote flow not current"}});H.select("text.remote-process-group-name").each(function(K){var J=y.select(this);J.text(null).selectAll("title").remove();v.ellipsis(J,K.component.name)}).append("title").text(function(J){return J.component.name})}else{E.select("text.remote-process-group-uri").text(null);E.select("text.remote-process-group-transmission-secure").text(null);E.select("path.component-comments").style("visibility","hidden");E.select("text.remote-process-group-last-refresh").text(null);H.select("text.remote-process-group-name").text(null);H.call(a)}H.call(e)}else{if(G.permissions.canRead){H.select("text.remote-process-group-name").text(function(K){var J=K.component.name;if(J.length>o){return J.substring(0,o)+String.fromCharCode(8230)}else{return J}})}else{H.select("text.remote-process-group-name").text(null)}H.call(a);if(!E.empty()){E.remove()}}})};var b=function(A){return A.status.validationStatus==="INVALID"};var p=function(B){var A=[];if(!j.isEmpty(B.component.authorizationIssues)){A=A.concat(B.component.authorizationIssues)}if(!j.isEmpty(B.component.validationErrors)){A=A.concat(B.component.validationErrors)}return A};var e=function(A){if(A.empty()){return}A.select("text.remote-process-group-sent tspan.count").text(function(B){return j.substringBeforeFirst(B.status.aggregateSnapshot.sent," ")});A.select("text.remote-process-group-sent tspan.size").text(function(B){return" "+j.substringAfterFirst(B.status.aggregateSnapshot.sent," ")});A.select("text.remote-process-group-sent tspan.ports").text(function(B){return" "+String.fromCharCode(8594)+" "+B.inputPortCount});A.select("text.remote-process-group-received tspan.ports").text(function(B){return B.outputPortCount+" "+String.fromCharCode(8594)+" "});A.select("text.remote-process-group-received tspan.count").text(function(B){return j.substringBeforeFirst(B.status.aggregateSnapshot.received," ")});A.select("text.remote-process-group-received tspan.size").text(function(B){return" "+j.substringAfterFirst(B.status.aggregateSnapshot.received," ")});A.select("text.remote-process-group-transmission-status").text(function(C){var B="";if(b(C)){B="\uf071"}else{if(C.status.transmissionStatus==="Transmitting"){B="\uf140"}else{B="\ue80a"}}return B}).attr("font-family",function(C){var B="";if(b(C)||C.status.transmissionStatus==="Transmitting"){B="FontAwesome"}else{B="flowfont"}return B}).classed("invalid",function(B){return b(B)}).classed("transmitting",function(B){return !b(B)&&B.status.transmissionStatus==="Transmitting"}).classed("not-transmitting",function(B){return !b(B)&&B.status.transmissionStatus!=="Transmitting"}).each(function(C){var B=y.select("#authorization-issues-"+C.id);if(C.permissions.canRead&&b(C)){if(B.empty()){B=y.select("#remote-process-group-tooltips").append("div").attr("id",function(){return"authorization-issues-"+C.id}).attr("class","tooltip nifi-tooltip")}B.html(function(){var D=j.formatUnorderedList(p(C));if(D===null||D.length===0){return""}else{return g("<div></div>").append(D).html()}});v.canvasTooltip(B,y.select(this))}else{if(!B.empty()){B.remove()}}});A.each(function(D){var B=y.select(this);var C=0;v.activeThreadCount(B,D,function(E){C=E});B.select("rect.bulletin-background").classed("has-bulletins",function(){return !j.isEmpty(D.status.aggregateSnapshot.bulletins)});v.bulletins(B,D,function(){return y.select("#remote-process-group-tooltips")},C)})};var i=function(A){if(A.empty()){return}A.call(a).remove()};var a=function(A){A.each(function(B){g("#bulletin-tip-"+B.id).remove();g("#authorization-issues-"+B.id).remove();g("#transmission-secure-"+B.id).remove();g("#comments-tip-"+B.id).remove()})};var q={init:function(C,D,A,B,E){n=C;t=D;m=A;u=B;k=E;c=y.map();w=y.map();d=y.map();x=y.select("#canvas").append("g").attrs({"pointer-events":"all","class":"remote-process-groups"})},add:function(G,B){var E=false;if(j.isDefinedAndNotNull(B)){E=j.isDefinedAndNotNull(B.selectAll)?B.selectAll:E}var A=new Date().getTime();var F=function(H){d.set(H.id,A);c.set(H.id,g.extend({type:"RemoteProcessGroup",dimensions:h},H))};if(g.isArray(G)){g.each(G,function(H,I){F(I)})}else{if(j.isDefinedAndNotNull(G)){F(G)}}var C=s();var D=f(C.enter(),E);r(C.merge(D))},set:function(A,I){var B=false;var F=false;var C=false;if(j.isDefinedAndNotNull(I)){B=j.isDefinedAndNotNull(I.selectAll)?I.selectAll:B;F=j.isDefinedAndNotNull(I.transition)?I.transition:F;C=j.isDefinedAndNotNull(I.overrideRevisionCheck)?I.overrideRevisionCheck:C}var G=function(J){var K=c.get(J.id);if((z.isNewerRevision(K,J)&&!w.has(J.id))||C===true){c.set(J.id,g.extend({type:"RemoteProcessGroup",dimensions:h},J))}};if(g.isArray(A)){g.each(c.keys(),function(K,L){var M=c.get(L);var J=g.grep(A,function(N){return N.id===M.id});if(J.length===0&&!d.has(L)){c.remove(L)}});g.each(A,function(J,K){G(K)})}else{if(j.isDefinedAndNotNull(A)){G(A)}}var H=s();var E=f(H.enter(),B);var D=H.merge(E);D.call(r).call(v.position,F);H.exit().call(i)},get:function(A){if(j.isUndefined(A)){return c.values()}else{return c.get(A)}},refresh:function(A){if(j.isDefinedAndNotNull(A)){y.select("#id-"+A).call(r)}else{y.selectAll("g.remote-process-group").call(r)}},pan:function(){y.selectAll("g.remote-process-group.entering, g.remote-process-group.leaving").call(r)},reload:function(B){if(c.has(B)){var A=c.get(B);return g.ajax({type:"GET",url:A.uri,dataType:"json"}).done(function(C){q.set(C);var D=l.getComponentConnections(B);g.each(D,function(F,E){if(E.permissions.canRead){l.reload(E.id)}})})}},position:function(A){y.select("#id-"+A).call(v.position)},remove:function(B){var A=new Date().getTime();if(g.isArray(B)){g.each(B,function(D,C){w.set(C,A);c.remove(C)})}else{w.set(B,A);c.remove(B)}s().exit().call(i)},removeAll:function(){q.remove(c.keys())},expireCaches:function(B){var A=function(C){C.each(function(D,E){if(B>D){C.remove(E)}})};A(d);A(w)}};return q}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.Client","nf.ClusterSummary","nf.CanvasUtils"],function(g,f,h,d,c,e){return(nf.Processor=b(g,f,h,d,c,e))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Processor=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.Client"),require("nf.ClusterSummary"),require("nf.CanvasUtils")))}else{nf.Processor=b(a.$,a.d3,a.nf.Common,a.nf.Client,a.nf.ClusterSummary,a.nf.CanvasUtils)}}}(this,function(e,A,i,B,h,v){var m;var r;var k;var j;var u;var n=25;var g={width:352,height:128};var y;var z;var c;var s;var q=function(){return s.selectAll("g.processor").data(y.values(),function(C){return C.id})};var d=function(E,D){if(E.empty()){return E}var C=E.append("g").attrs({id:function(F){return"id-"+F.id},"class":"processor component"}).classed("selected",D).call(v.position);C.append("rect").attrs({"class":"border",width:function(F){return F.dimensions.width},height:function(F){return F.dimensions.height},fill:"transparent",stroke:"transparent"});C.append("rect").attrs({"class":"body",width:function(F){return F.dimensions.width},height:function(F){return F.dimensions.height},filter:"url(#component-drop-shadow)","stroke-width":0});C.append("text").attrs({x:75,y:18,width:230,height:14,"class":"processor-name"});C.append("rect").attrs({x:0,y:0,width:50,height:50,"class":"processor-icon-container"});C.append("text").attrs({x:9,y:35,"class":"processor-icon"}).text("\ue807");C.append("circle").attrs({r:9,cx:12,cy:12,"class":"restricted-background"});C.append("text").attrs({x:7.75,y:17,"class":"restricted"}).text("\uf132");C.append("circle").attrs({r:9,cx:38,cy:36,"class":"is-primary-background"});C.append("text").attrs({x:34.75,y:40,"class":"is-primary"}).text("P").append("title").text(function(F){return"This component is only scheduled to execute on the Primary Node"});C.call(k.activate).call(u.activate).call(j.activate);return C};var x=function(C){if(C.empty()){return}C.select("rect.border").classed("unauthorized",function(D){return D.permissions.canRead===false}).classed("ghost",function(D){return D.permissions.canRead===true&&D.component.extensionMissing===true});C.select("rect.body").classed("unauthorized",function(D){return D.permissions.canRead===false});C.each(function(I){var F=A.select(this);var D=F.select("g.processor-canvas-details");v.editable(F,m,r);if(F.classed("visible")){if(D.empty()){D=F.append("g").attr("class","processor-canvas-details");D.append("text").attrs({"class":"run-status-icon",x:55,y:23,width:14,height:14});D.append("text").attrs({"class":"processor-type",x:75,y:32,width:230,height:12});D.append("text").attrs({"class":"processor-bundle",x:75,y:45,width:200,height:12});D.append("rect").attrs({width:function(){return I.dimensions.width},height:19,x:0,y:50,fill:"#f4f6f7"});D.append("rect").attrs({width:function(){return I.dimensions.width},height:1,x:0,y:68,fill:"#c7d2d7"});D.append("rect").attrs({width:function(){return I.dimensions.width},height:19,x:0,y:69,fill:"#ffffff"});D.append("rect").attrs({width:function(){return I.dimensions.width},height:1,x:0,y:87,fill:"#c7d2d7"});D.append("rect").attrs({width:function(){return I.dimensions.width},height:20,x:0,y:88,fill:"#f4f6f7"});D.append("rect").attrs({width:function(){return I.dimensions.width},height:1,x:0,y:106,fill:"#c7d2d7"});D.append("rect").attrs({width:function(){return I.dimensions.width},height:19,x:0,y:107,fill:"#ffffff"});var L=D.append("g").attrs({transform:"translate(10, 55)"});L.append("text").attrs({width:73,height:10,y:9,"class":"stats-label"}).text("In");L.append("text").attrs({width:73,height:10,y:27,"class":"stats-label"}).text("Read/Write");L.append("text").attrs({width:73,height:10,y:46,"class":"stats-label"}).text("Out");L.append("text").attrs({width:73,height:10,y:65,"class":"stats-label"}).text("Tasks/Time");var E=D.append("g").attrs({transform:"translate(85, 55)"});var K=E.append("text").attrs({width:180,height:9,y:9,"class":"processor-in stats-value"});K.append("tspan").attrs({"class":"count"});K.append("tspan").attrs({"class":"size"});E.append("text").attrs({width:180,height:10,y:27,"class":"processor-read-write stats-value"});var G=E.append("text").attrs({width:180,height:10,y:46,"class":"processor-out stats-value"});G.append("tspan").attrs({"class":"count"});G.append("tspan").attrs({"class":"size"});E.append("text").attrs({width:180,height:10,y:65,"class":"processor-tasks-time stats-value"});var J=D.append("g").attr("transform","translate(305, 55)");J.append("text").attrs({width:25,height:10,y:9,"class":"stats-info"}).text("5 min");J.append("text").attrs({width:25,height:10,y:27,"class":"stats-info"}).text("5 min");J.append("text").attrs({width:25,height:10,y:46,"class":"stats-info"}).text("5 min");J.append("text").attrs({width:25,height:10,y:65,"class":"stats-info"}).text("5 min");D.append("path").attrs({"class":"component-comments",transform:"translate("+(I.dimensions.width-2)+", "+(I.dimensions.height-10)+")",d:"m0,0 l0,8 l-8,0 z"});D.append("text").attrs({"class":"active-thread-count-icon",y:46}).text("\ue83f");D.append("text").attrs({"class":"active-thread-count",y:46});D.append("rect").attrs({"class":"bulletin-background",x:function(M){return I.dimensions.width-24},width:24,height:24});D.append("text").attrs({"class":"bulletin-icon",x:function(M){return I.dimensions.width-17},y:17}).text("\uf24a")}if(I.permissions.canRead){F.select("text.processor-name").each(function(N){var M=A.select(this);M.text(null).selectAll("title").remove();v.ellipsis(M,N.component.name)}).append("title").text(function(M){return M.component.name});F.select("text.processor-type").each(function(N){var M=A.select(this);M.text(null).selectAll("title").remove();v.ellipsis(M,i.formatType(N.component))}).append("title").text(function(M){return i.formatType(M.component)});F.select("text.processor-bundle").each(function(N){var M=A.select(this);M.text(null).selectAll("title").remove();v.ellipsis(M,i.formatBundle(N.component.bundle))}).append("title").text(function(M){return i.formatBundle(M.component.bundle)});F.select("path.component-comments").style("visibility",i.isBlank(I.component.config.comments)?"hidden":"visible").each(function(){var M=A.select("#comments-tip-"+I.id);if(i.isBlank(I.component.config.comments)){if(!M.empty()){M.remove()}}else{if(M.empty()){M=A.select("#processor-tooltips").append("div").attr("id",function(){return"comments-tip-"+I.id}).attr("class","tooltip nifi-tooltip")}M.text(I.component.config.comments);v.canvasTooltip(M,A.select(this))}})}else{F.select("text.processor-name").text(null);F.select("text.processor-type").text(null);F.select("text.processor-bundle").text(null);F.select("path.component-comments").style("visibility","hidden");F.call(b)}F.call(f)}else{if(I.permissions.canRead){F.select("text.processor-name").text(function(N){var M=N.component.name;if(M.length>n){return M.substring(0,n)+String.fromCharCode(8230)}else{return M}})}else{F.select("text.processor-name").text(null)}F.call(b);if(!D.empty()){D.remove()}}F.select("rect.processor-icon-container").classed("unauthorized",!I.permissions.canRead);F.select("text.processor-icon").classed("unauthorized",!I.permissions.canRead);F.select("rect.border").classed("unauthorized",!I.permissions.canRead);if(I.permissions.canRead){if(i.isDefinedAndNotNull(I.component.style["background-color"])){var H=I.component.style["background-color"];F.select("rect.processor-icon-container").style("fill",function(M){return H});F.select("rect.border").style("stroke",function(M){return H})}}F.select("text.processor-icon").style("fill",function(N){var M=p.defaultIconColor();if(!N.permissions.canRead){return M}if(i.isDefinedAndNotNull(N.component.style["background-color"])){M=N.component.style["background-color"];if(M.toLowerCase()==="#ffffff"){M=p.defaultIconColor()}else{M=i.determineContrastColor(i.substringAfterLast(M,"#"))}}return M});F.select("circle.restricted-background").style("visibility",l);F.select("text.restricted").style("visibility",l);F.select("circle.is-primary-background").style("visibility",o);F.select("text.is-primary").style("visibility",o)})};var l=function(C){if(!C.permissions.canRead){return"hidden"}return C.component.restricted?"visible":"hidden"};var o=function(C){return h.isClustered()&&C.status.aggregateSnapshot.executionNode==="PRIMARY"?"visible":"hidden"};var w=function(C){return(C.permissions.canRead&&!i.isEmpty(C.component.validationErrors))||C.status.aggregateSnapshot.runStatus==="Validating"};var a=function(D){if(D.permissions.canRead&&!i.isEmpty(D.component.validationErrors)){var C=i.formatUnorderedList(D.component.validationErrors);if(C===null||C.length===0){return""}else{return C}}else{return"Validating..."}};var f=function(C){if(C.empty()){return}C.select("text.run-status-icon").attrs({fill:function(E){var D="#728e9b";if(E.status.aggregateSnapshot.runStatus==="Validating"){D="#a8a8a8"}else{if(E.status.aggregateSnapshot.runStatus==="Invalid"){D="#cf9f5d"}else{if(E.status.aggregateSnapshot.runStatus==="Running"){D="#7dc7a0"}else{if(E.status.aggregateSnapshot.runStatus==="Stopped"){D="#d18686"}}}}return D},"font-family":function(E){var D="FontAwesome";if(E.status.aggregateSnapshot.runStatus==="Disabled"){D="flowfont"}return D}}).classed("fa-spin",function(D){return D.status.aggregateSnapshot.runStatus==="Validating"}).text(function(E){var D="";if(E.status.aggregateSnapshot.runStatus==="Disabled"){D="\ue802"}else{if(E.status.aggregateSnapshot.runStatus==="Validating"){D="\uf1ce"}else{if(E.status.aggregateSnapshot.runStatus==="Invalid"){D="\uf071"}else{if(E.status.aggregateSnapshot.runStatus==="Running"){D="\uf04b"}else{if(E.status.aggregateSnapshot.runStatus==="Stopped"){D="\uf04d"}}}}}return D}).each(function(E){var D=A.select("#run-status-tip-"+E.id);if(w(E)){if(D.empty()){D=A.select("#processor-tooltips").append("div").attr("id",function(){return"run-status-tip-"+E.id}).attr("class","tooltip nifi-tooltip")}D.html(function(){return e("<div></div>").append(a(E)).html()});v.canvasTooltip(D,A.select(this))}else{if(!D.empty()){D.remove()}}});C.select("text.processor-in tspan.count").text(function(D){return i.substringBeforeFirst(D.status.aggregateSnapshot.input," ")});C.select("text.processor-in tspan.size").text(function(D){return" "+i.substringAfterFirst(D.status.aggregateSnapshot.input," ")});C.select("text.processor-read-write").text(function(D){return D.status.aggregateSnapshot.read+" / "+D.status.aggregateSnapshot.written});C.select("text.processor-out tspan.count").text(function(D){return i.substringBeforeFirst(D.status.aggregateSnapshot.output," ")});C.select("text.processor-out tspan.size").text(function(D){return" "+i.substringAfterFirst(D.status.aggregateSnapshot.output," ")});C.select("text.processor-tasks-time").text(function(D){return D.status.aggregateSnapshot.tasks+" / "+D.status.aggregateSnapshot.tasksDuration});C.each(function(E){var D=A.select(this);v.activeThreadCount(D,E);D.select("rect.bulletin-background").classed("has-bulletins",function(){return !i.isEmpty(E.status.aggregateSnapshot.bulletins)});v.bulletins(D,E,function(){return A.select("#processor-tooltips")},286)})};var t=function(C){if(C.empty()){return}C.call(b).remove()};var b=function(C){C.each(function(D){e("#run-status-tip-"+D.id).remove();e("#bulletin-tip-"+D.id).remove();e("#comments-tip-"+D.id).remove()})};var p={init:function(E,F,C,D,G){m=E;r=F;k=C;u=D;j=G;y=A.map();z=A.map();c=A.map();s=A.select("#canvas").append("g").attrs({"pointer-events":"all","class":"processors"})},add:function(C,E){var H=false;if(i.isDefinedAndNotNull(E)){H=i.isDefinedAndNotNull(E.selectAll)?E.selectAll:H}var D=new Date().getTime();var I=function(J){c.set(J.id,D);y.set(J.id,e.extend({type:"Processor",dimensions:g},J))};if(e.isArray(C)){e.each(C,function(J,K){I(K)})}else{if(i.isDefinedAndNotNull(C)){I(C)}}var F=q();var G=d(F.enter(),H);x(F.merge(G))},set:function(H,K){var C=false;var G=false;var D=false;if(i.isDefinedAndNotNull(K)){C=i.isDefinedAndNotNull(K.selectAll)?K.selectAll:C;G=i.isDefinedAndNotNull(K.transition)?K.transition:G;D=i.isDefinedAndNotNull(K.overrideRevisionCheck)?K.overrideRevisionCheck:D}var I=function(M){var L=y.get(M.id);if((B.isNewerRevision(L,M)&&!z.has(M.id))||D===true){y.set(M.id,e.extend({type:"Processor",dimensions:g},M))}};if(e.isArray(H)){e.each(y.keys(),function(M,N){var O=y.get(N);var L=e.grep(H,function(P){return P.id===O.id});if(L.length===0&&!c.has(N)){y.remove(N)}});e.each(H,function(L,M){I(M)})}else{if(i.isDefinedAndNotNull(H)){I(H)}}var J=q();var F=d(J.enter(),C);var E=J.merge(F);E.call(x);E.call(v.position,G);J.exit().call(t)},get:function(C){if(i.isUndefined(C)){return y.values()}else{return y.get(C)}},refresh:function(C){if(i.isDefinedAndNotNull(C)){A.select("#id-"+C).call(x)}else{A.selectAll("g.processor").call(x)}},position:function(C){A.select("#id-"+C).call(v.position)},pan:function(){A.selectAll("g.processor.entering, g.processor.leaving").call(x)},reload:function(D){if(y.has(D)){var C=y.get(D);return e.ajax({type:"GET",url:C.uri,dataType:"json"}).done(function(E){p.set(E)})}},remove:function(D){var C=new Date().getTime();if(e.isArray(D)){e.each(D,function(E,F){z.set(F,C);y.remove(F)})}else{z.set(D,C);y.remove(D)}q().exit().call(t)},removeAll:function(){p.remove(y.keys())},expireCaches:function(D){var C=function(E){E.each(function(F,G){if(D>F){E.remove(G)}})};C(c);C(z)},defaultFillColor:function(){return"#FFFFFF"},defaultIconColor:function(){return"#ad9897"}};return p}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.CanvasUtils","nf.ng.Bridge","nf.Processor","nf.ClusterSummary","nf.CustomUi","nf.UniversalCapture","nf.Connection"],function(f,n,c,e,g,o,d,h,m,l,k,i,j){return(nf.ProcessorConfiguration=b(f,n,c,e,g,o,d,h,m,l,k,i,j))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ProcessorConfiguration=b(require("jquery"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.ng.Bridge"),require("nf.Processor"),require("nf.ClusterSummary"),require("nf.CustomUi"),require("nf.UniversalCapture"),require("nf.Connection")))}else{nf.ProcessorConfiguration=b(a.$,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.CanvasUtils,a.nf.ng.Bridge,a.nf.Processor,a.nf.ClusterSummary,a.nf.CustomUi,a.nf.UniversalCapture,a.nf.Connection)}}}(this,function(e,h,j,o,f,A,v,B,n,i,a,u,k){var y;var l=[0,25,50,100,250,500,1000,2000];var x="status.aggregateSnapshot.activeThreadCount",g="status.aggregateSnapshot.runStatus",c="bulletins";var q=function(C){var D=[{text:"Timer driven",value:"TIMER_DRIVEN",description:"Processor will be scheduled to run on an interval defined by the run schedule."}];if(C.supportsEventDriven===true){D.push({text:"Event driven",value:"EVENT_DRIVEN",description:"Processor will be scheduled to run when triggered by an event (e.g. a FlowFile enters an incoming queue). This scheduling strategy is experimental."})}else{if(C.config.schedulingStrategy==="EVENT_DRIVEN"){D.push({text:"Event driven",value:"EVENT_DRIVEN",description:"Processor will be scheduled to run when triggered by an event (e.g. a FlowFile enters an incoming queue). This scheduling strategy is experimental.",disabled:true})}}if(C.config.schedulingStrategy==="PRIMARY_NODE_ONLY"){D.push({text:"On primary node",value:"PRIMARY_NODE_ONLY",description:"Processor will be scheduled on the primary node on an interval defined by the run schedule. This option has been deprecated, please use the Execution setting below.",disabled:true})}D.push({text:"CRON driven",value:"CRON_DRIVEN",description:"Processor will be scheduled to run on at specific times based on the specified CRON string."});return D};var d=function(C){return[{text:"All nodes",value:"ALL",description:"Processor will be scheduled to run on all nodes",disabled:C.executionNodeRestricted===true},{text:"Primary node",value:"PRIMARY",description:"Processor will be scheduled to run only on the primary node"}]};var p=function(H){var C=e('<div class="relationship-name nf-checkbox-label ellipsis"></div>').text(H.name);var E=e('<span class="relationship-name-value hidden"></span>').text(H.name);var F=e('<div class="processor-relationship nf-checkbox"></div>');if(H.autoTerminate===true){F.addClass("checkbox-checked")}else{F.addClass("checkbox-unchecked")}var G=e('<div class="processor-relationship-container"></div>').append(F).append(C).append(E).appendTo("#auto-terminate-relationship-names");if(!j.isBlank(H.description)){var D=e('<div class="relationship-description"></div>').text(H.description);G.append(D)}return G};var z=function(){var E=e("#processor-configuration").data("processorDetails");var F=false;var G=s();e.each(E.relationships,function(I,J){if(J.autoTerminate===true){if(e.inArray(J.name,G)===-1){F=true;return false}}else{if(J.autoTerminate===false){if(e.inArray(J.name,G)>=0){F=true;return false}}}});if(F){return true}var H=e("#scheduling-strategy-combo").combo("getSelectedOption").value;if(H!==(E.config.schedulingStrategy+"")){return true}if(E.supportsParallelProcessing===true){var C;if(H==="EVENT_DRIVEN"){C=e("#event-driven-concurrently-schedulable-tasks")}else{if(H==="CRON_DRIVEN"){C=e("#cron-driven-concurrently-schedulable-tasks")}else{C=e("#timer-driven-concurrently-schedulable-tasks")}}if(C.val()!==(E.config.concurrentlySchedulableTaskCount+"")){return true}}var D;if(H==="CRON_DRIVEN"){D=e("#cron-driven-scheduling-period")}else{if(H!=="EVENT_DRIVEN"){D=e("#timer-driven-scheduling-period")}}if(j.isDefinedAndNotNull(D)&&D.val()!==(E.config.schedulingPeriod+"")){return true}if(e("#execution-node-combo").combo("getSelectedOption").value!==(E.config.executionNode+"")){return true}if(e("#processor-name").val()!==E.name){return true}if(e("#processor-enabled").hasClass("checkbox-checked")&&E.state==="DISABLED"){return true}else{if(e("#processor-enabled").hasClass("checkbox-unchecked")&&(E.state==="RUNNING"||E.state==="STOPPED")){return true}}if(e("#penalty-duration").val()!==(E.config.penaltyDuration+"")){return true}if(e("#yield-duration").val()!==(E.config.yieldDuration+"")){return true}if(e("#bulletin-level-combo").combo("getSelectedOption").value!==(E.config.bulletinLevel+"")){return true}if(e("#processor-comments").val()!==E.config.comments){return true}return e("#processor-properties").propertytable("isSaveRequired")};var m=function(E){var G={};var C=e("#scheduling-strategy-combo").combo("getSelectedOption").value;var J;if(C==="EVENT_DRIVEN"){J=e("#event-driven-concurrently-schedulable-tasks")}else{if(C==="CRON_DRIVEN"){J=e("#cron-driven-concurrently-schedulable-tasks")}else{J=e("#timer-driven-concurrently-schedulable-tasks")}}if(!J.is(":disabled")){G.concurrentlySchedulableTaskCount=J.val()}var H;if(C==="CRON_DRIVEN"){H=e("#cron-driven-scheduling-period")}else{if(C!=="EVENT_DRIVEN"){H=e("#timer-driven-scheduling-period")}}if(j.isDefinedAndNotNull(H)){G.schedulingPeriod=H.val()}G.executionNode=e("#execution-node-combo").combo("getSelectedOption").value;G.penaltyDuration=e("#penalty-duration").val();G.yieldDuration=e("#yield-duration").val();G.bulletinLevel=e("#bulletin-level-combo").combo("getSelectedOption").value;G.schedulingStrategy=C;G.comments=e("#processor-comments").val();if(E.supportsBatching===true){var D=e("#run-duration-slider").slider("value");G.runDurationMillis=l[D]}G.autoTerminatedRelationships=s();var I=e("#processor-properties").propertytable("marshalProperties");if(e.isEmptyObject(I)===false){G.properties=I}var F={};F.id=e("#processor-id").text();F.name=e("#processor-name").val();F.config=G;if(e("#processor-enabled").hasClass("checkbox-unchecked")){F.state="DISABLED"}else{if(e("#processor-enabled").hasClass("checkbox-checked")){F.state="STOPPED"}}var K={};K.component=F;return K};var s=function(){var D=e("#auto-terminate-relationship-names");var C=[];e.each(D.children(),function(E,H){var G=e(H);var F=G.children("div.processor-relationship");if(F.hasClass("checkbox-checked")){C.push(G.children("span.relationship-name-value").text())}});return C};var w=function(D){var F=[];var E=D.component;var C=E.config;if(j.isDefinedAndNotNull(C.concurrentlySchedulableTaskCount)&&!e.isNumeric(C.concurrentlySchedulableTaskCount)){F.push("Concurrent tasks must be an integer value")}if(j.isDefinedAndNotNull(C.schedulingPeriod)&&j.isBlank(C.schedulingPeriod)){F.push("Run schedule must be specified")}if(j.isBlank(C.penaltyDuration)){F.push("Penalty duration must be specified")}if(j.isBlank(C.yieldDuration)){F.push("Yield duration must be specified")}if(F.length>0){o.showOkDialog({dialogContent:j.formatUnorderedList(F),headerText:"Configuration Error"});return false}else{return true}};var b=function(D){var C=k.getComponentConnections(D.id);e.each(C,function(F,E){if(E.permissions.canRead){if(E.sourceId===D.id){k.reload(E.id)}}})};var r=function(){return e.Deferred(function(C){e("#processor-properties").propertytable("saveRow");if(z()){o.showYesNoDialog({headerText:"Processor Configuration",dialogContent:"Save changes before going to this Controller Service?",noHandler:function(){C.resolve()},yesHandler:function(){var D=e("#processor-configuration").data("processorDetails");t(D).done(function(){C.resolve()}).fail(function(){C.reject()})}})}else{C.resolve()}}).promise()};var t=function(C){var D=m(C);if(w(D)){var E=n.get(C.id);D.revision=A.getRevision(E);D.disconnectedNodeAcknowledged=f.isDisconnectionAcknowledged();return e.ajax({type:"PUT",data:JSON.stringify(D),url:E.uri,dataType:"json",contentType:"application/json"}).done(function(F){n.set(F)}).fail(h.handleConfigurationUpdateAjaxError)}else{return e.Deferred(function(F){F.reject()}).promise()}};return{init:function(C){y=C;e("#processor-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"processor-standard-settings-tab-content"},{name:"Scheduling",tabContentId:"processor-scheduling-tab-content"},{name:"Properties",tabContentId:"processor-properties-tab-content"},{name:"Comments",tabContentId:"processor-comments-tab-content"}],select:function(){u.removeAllPropertyDetailDialogs();if(e(this).text()==="Properties"){e("#processor-properties").propertytable("resetTableSize")}e("#processor-properties").propertytable("saveRow");var D=e("#auto-terminate-relationship-names");if(D.is(":visible")&&D.get(0).scrollHeight>Math.round(D.innerHeight())){D.css("border-width","1px")}}});e("#processor-configuration").modal({scrollableContentStyle:"scrollable",headerText:"Configure Processor",handler:{close:function(){e("#auto-terminate-relationship-names").css("border-width","0").empty();e("#processor-properties").propertytable("cancelEdit").propertytable("clear");e("#processor-configuration").removeData("processorDetails");if(y.supportsStatusBar){e("#processor-configuration-status-bar").statusbar("disconnect")}},open:function(){j.toggleScrollable(e("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});if(y.supportsStatusBar){e("#processor-configuration-status-bar").statusbar()}e("#bulletin-level-combo").combo({options:[{text:"DEBUG",value:"DEBUG"},{text:"INFO",value:"INFO"},{text:"WARN",value:"WARN"},{text:"ERROR",value:"ERROR"},{text:"NONE",value:"NONE"}]});e("#run-duration-slider").slider({min:0,max:l.length-1,change:function(E,F){var D=e("#processor-configuration").data("processorDetails");if(F.value>0&&(D.inputRequirement==="INPUT_FORBIDDEN"||D.inputRequirement==="INPUT_ALLOWED")){e("#run-duration-data-loss").show()}else{e("#run-duration-data-loss").hide()}}});e("#processor-properties").propertytable({readOnly:false,supportsGoTo:true,dialogContainer:"#new-processor-property-container",descriptorDeferred:function(D){var E=e("#processor-configuration").data("processorDetails");var F=n.get(E.id);return e.ajax({type:"GET",url:F.uri+"/descriptors",data:{propertyName:D},dataType:"json"}).fail(h.handleAjaxError)},parameterDeferred:function(D,E){return e.Deferred(function(F){if(j.isDefinedAndNotNull(E)){var G=v.getParameterContext();if(j.isDefinedAndNotNull(G)){e.ajax({type:"GET",url:"../nifi-api/parameter-contexts/"+encodeURIComponent(G.id),dataType:"json"}).done(function(I){var H=j.isSensitiveProperty(D);F.resolve(I.component.parameters.map(function(J){return J.parameter}).filter(function(J){return J.sensitive===H}))}).fail(function(){F.resolve([])})}else{F.resolve([])}}else{F.resolve([])}}).promise()},goToServiceDeferred:r,getParameterContext:function(D){return v.getParameterContext()}})},showConfiguration:function(E,C){if(v.isProcessor(E)){var F=E.datum();var D=F.component;var G=[];G.push(n.reload(D.id));G.push(e.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(D.id),dataType:"json"}));e.when.apply(window,G).done(function(P,S){var Q=P[0];D=Q.component;var M=S[0].componentHistory;e("#processor-configuration").data("processorDetails",D);var L="checkbox-checked";if(D.state==="DISABLED"){L="checkbox-unchecked"}e("#processor-id").text(D.id);e("#processor-type").text(j.formatType(D));e("#processor-bundle").text(j.formatBundle(D.bundle));e("#processor-name").val(D.name);e("#processor-enabled").removeClass("checkbox-unchecked checkbox-checked").addClass(L);e("#penalty-duration").val(D.config.penaltyDuration);e("#yield-duration").val(D.config.yieldDuration);e("#processor-comments").val(D.config.comments);if(D.supportsBatching===true){e("#run-duration-setting-container").show();var R=l.indexOf(D.config.runDurationMillis);e("#run-duration-slider").slider("value",R)}else{e("#run-duration-setting-container").hide()}e("#bulletin-level-combo").combo("setSelectedOption",{value:D.config.bulletinLevel});var J=D.config.schedulingStrategy;e("#scheduling-strategy-combo").combo({options:q(D),selectedOption:{value:J},select:function(U){if(U.value==="EVENT_DRIVEN"){e("#event-driven-warning").show();e("#timer-driven-options").hide();e("#event-driven-options").show();e("#cron-driven-options").hide()}else{e("#event-driven-warning").hide();if(U.value==="CRON_DRIVEN"){e("#timer-driven-options").hide();e("#event-driven-options").hide();e("#cron-driven-options").show()}else{e("#timer-driven-options").show();e("#event-driven-options").hide();e("#cron-driven-options").hide()}}}});var I=D.config.executionNode;e("#execution-node-combo").combo({options:d(D),selectedOption:{value:I}});e("#execution-node-options").show();var T=D.config.defaultConcurrentTasks;e("#timer-driven-concurrently-schedulable-tasks").val(T.TIMER_DRIVEN);e("#event-driven-concurrently-schedulable-tasks").val(T.EVENT_DRIVEN);e("#cron-driven-concurrently-schedulable-tasks").val(T.CRON_DRIVEN);var O;if(J==="EVENT_DRIVEN"){O=e("#event-driven-concurrently-schedulable-tasks").val(D.config.concurrentlySchedulableTaskCount)}else{if(J==="CRON_DRIVEN"){O=e("#cron-driven-concurrently-schedulable-tasks").val(D.config.concurrentlySchedulableTaskCount)}else{O=e("#timer-driven-concurrently-schedulable-tasks").val(D.config.concurrentlySchedulableTaskCount)}}if(j.isDefinedAndNotNull(O)){if(D.supportsParallelProcessing===true){O.prop("disabled",false)}else{O.prop("disabled",true)}}var K=D.config.defaultSchedulingPeriod;e("#cron-driven-scheduling-period").val(K.CRON_DRIVEN);e("#timer-driven-scheduling-period").val(K.TIMER_DRIVEN);if(D.config.schedulingStrategy==="CRON_DRIVEN"){e("#cron-driven-scheduling-period").val(D.config.schedulingPeriod)}else{if(D.config.schedulingStrategy!=="EVENT_DRIVEN"){e("#timer-driven-scheduling-period").val(D.config.schedulingPeriod)}}if(!j.isEmpty(D.relationships)){e.each(D.relationships,function(U,V){p(V)})}else{e("#auto-terminate-relationship-names").append('<div class="unset">This processor has no relationships.</div>')}var N=[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){return !v.supportsModification(E)},handler:{click:function(){e("#processor-properties").propertytable("saveRow");t(D).done(function(U){b(D);e("#processor-configuration").modal("hide");B.digest()})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){e("#processor-configuration").modal("hide")}}}];if(j.isDefinedAndNotNull(D.config.customUiUrl)&&D.config.customUiUrl!==""){N.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){var U=function(){e("#processor-configuration").modal("hide");a.showCustomUi(Q,D.config.customUiUrl,true).done(function(){n.reload(D.id);b(D)})};e("#processor-properties").propertytable("saveRow");if(z()){o.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before opening the advanced configuration?",noHandler:U,yesHandler:function(){t(D).done(function(V){U()})}})}else{U()}}}})}if(y.supportsStatusBar){e("#processor-configuration-status-bar").statusbar("observe",D.id,function(){e("#processor-configuration").modal("refreshButtons")});if(j.isDefinedAndNotNull(y.nfActions)&&j.getKeyValue(Q,x)!=0){e("#processor-configuration-status-bar").statusbar("buttons",[{buttonText:"Terminate",clazz:"fa fa-hourglass-end button-icon",color:{hover:"#C7D2D7",base:"transparent",text:"#004849"},disabled:function(){return v.supportsModification(E)},handler:{click:function(){var U=function(){var V=n.get(D.id);if(j.getKeyValue(V,x)!=0){o.showOkDialog({dialogContent:"Terminate threads request was processed, but active threads still persist. Please try again later.",headerText:"Unable to Terminate"})}else{e("#processor-configuration-status-bar").statusbar("refreshButtons");e("#processor-configuration").modal("refreshButtons")}e("#processor-configuration-status-bar").statusbar("showButtons")};e("#processor-configuration-status-bar").statusbar("hideButtons");y.nfActions.terminate(E,U)}}}])}}e("#processor-configuration").modal("setButtonModel",N);e("#processor-properties").propertytable("setGroupId",D.parentGroupId).propertytable("loadProperties",D.config.properties,D.config.descriptors,M.propertyHistory);e("#processor-configuration").modal("show");e("#processor-configuration div.relationship-name").ellipsis();var H=e("#auto-terminate-relationship-names");if(H.is(":visible")&&H.get(0).scrollHeight>Math.round(H.innerHeight())){H.css("border-width","1px")}if(e("#processor-configuration-tabs").find(".selected-tab").text()==="Properties"&&e("#processor-properties").find(".slick-viewport").height()==0){e("#processor-properties").propertytable("resetTableSize")}if(typeof C=="function"){C()}}).fail(h.handleAjaxError)}}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common","nf.UniversalCapture","nf.Dialog","nf.ErrorHandler","nf.CustomUi","nf.ClusterSummary","nf.CanvasUtils"],function(g,h,j,f,i,e,c,d){return(nf.ProcessorDetails=b(g,h,j,f,i,e,c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ProcessorDetails=b(require("jquery"),require("nf.Common"),require("nf.UniversalCapture"),require("nf.Dialog"),require("nf.ErrorHandler"),require("nf.CustomUi"),require("nf.ClusterSummary"),require("nf.CanvasUtils")))}else{nf.ProcessorDetails=b(a.$,a.nf.Common,a.nf.UniversalCapture,a.nf.Dialog,a.nf.ErrorHandler,a.nf.CustomUi,a.nf.ClusterSummary,a.nf.CanvasUtils)}}}(this,function(e,b,f,d,g,h,i,c){var a;var j=function(n){var k=e('<div class="relationship-name ellipsis"></div>').text(n.name);if(n.autoTerminate===true){k.css("font-weight","bold")}var m=e('<div class="processor-relationship-container"></div>').append(k).appendTo("#read-only-auto-terminate-relationship-names");if(!b.isBlank(n.description)){var l=e('<div class="relationship-description"></div>').text(n.description);m.append(l)}return m};return{init:function(k){a=k;e("#processor-details-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"details-standard-settings-tab-content"},{name:"Scheduling",tabContentId:"details-scheduling-tab-content"},{name:"Properties",tabContentId:"details-processor-properties-tab-content"},{name:"Comments",tabContentId:"details-processor-comments-tab-content"}],select:function(){f.removeAllPropertyDetailDialogs();if(e(this).text()==="Properties"){e("#read-only-processor-properties").propertytable("resetTableSize")}var l=e("#read-only-auto-terminate-relationship-names");if(l.is(":visible")&&l.get(0).scrollHeight>Math.round(l.innerHeight())){l.css("border-width","1px")}}});e("#processor-details").modal({headerText:"Processor Details",scrollableContentStyle:"scrollable",handler:{close:function(){e("#read-only-auto-terminate-relationship-names").css("border-width","0").empty();e("#read-only-processor-properties").propertytable("clear");b.clearField("read-only-processor-id");b.clearField("read-only-processor-type");b.clearField("read-only-processor-name");b.clearField("read-only-concurrently-schedulable-tasks");b.clearField("read-only-scheduling-period");b.clearField("read-only-penalty-duration");b.clearField("read-only-yield-duration");b.clearField("read-only-run-duration");b.clearField("read-only-bulletin-level");b.clearField("read-only-execution-node");b.clearField("read-only-execution-status");b.clearField("read-only-processor-comments");e("#processor-details").removeData("processorDetails");e("#processor-details").removeData("processorHistory");if(a.supportsStatusBar){e("#processor-details-status-bar").statusbar("disconnect")}},open:function(){b.toggleScrollable(e("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});if(a.supportsStatusBar){e("#processor-details-status-bar").statusbar()}e("#read-only-processor-properties").propertytable({supportsGoTo:a.supportsGoTo,readOnly:true,getParameterContext:function(l){return c.getParameterContext()}})},showDetails:function(m,n){var l=e.ajax({type:"GET",url:"../nifi-api/processors/"+encodeURIComponent(n),dataType:"json"}).done(function(p){if(b.isDefinedAndNotNull(p.component)){var q=p.component;e("#processor-details").data("processorDetails",q);b.populateField("read-only-processor-id",q.id);b.populateField("read-only-processor-type",b.formatType(q));b.populateField("read-only-processor-bundle",b.formatBundle(q.bundle));b.populateField("read-only-processor-name",q.name);b.populateField("read-only-concurrently-schedulable-tasks",q.config.concurrentlySchedulableTaskCount);b.populateField("read-only-scheduling-period",q.config.schedulingPeriod);b.populateField("read-only-penalty-duration",q.config.penaltyDuration);b.populateField("read-only-yield-duration",q.config.yieldDuration);b.populateField("read-only-run-duration",b.formatDuration(q.config.runDurationMillis));b.populateField("read-only-bulletin-level",q.config.bulletinLevel);b.populateField("read-only-processor-comments",q.config.comments);var o=true;var s=q.config.schedulingStrategy;if(s==="EVENT_DRIVEN"){o=false;s="Event driven"}else{if(s==="CRON_DRIVEN"){s="CRON driven"}else{if(s==="TIMER_DRIVEN"){s="Timer driven"}else{s="On primary node"}}}b.populateField("read-only-scheduling-strategy",s);if(o===true){e("#read-only-run-schedule").show()}else{e("#read-only-run-schedule").hide()}var r=q.config.executionNode;if(r==="ALL"){r="All nodes"}else{if(r==="PRIMARY"){r="Primary node only"}}b.populateField("read-only-execution-node",r);e("#read-only-execution-node-options").show();if(!b.isEmpty(q.relationships)){e.each(q.relationships,function(t,u){j(u)})}else{e("#read-only-auto-terminate-relationship-names").append('<div class="unset">This processor has no relationships.</div>')}}});var k=e.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(n),dataType:"json"}).done(function(o){var p=o.componentHistory;e("#processor-details").data("processorHistory",p)});e.when(l,k).done(function(t,x){var u=t[0];var p=u.component;var w=x[0];var r=w.componentHistory;var v;e("#read-only-processor-properties").propertytable("loadProperties",p.config.properties,p.config.descriptors,r.propertyHistory);var s=[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){e("#processor-details").modal("hide")}}}];if(top===window&&b.isDefinedAndNotNull(h)&&b.isDefinedAndNotNull(p.config.customUiUrl)&&p.config.customUiUrl!==""){s.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){e("#processor-details").modal("hide");h.showCustomUi(u,p.config.customUiUrl,false)}}})}if(a.supportsStatusBar&&b.isDefinedAndNotNull(a.nfCanvasUtils)){e("#processor-details-status-bar").statusbar("observe",p.id);v=a.nfCanvasUtils.getSelectionById(p.id);if(b.isDefinedAndNotNull(a.nfActions)&&a.nfCanvasUtils.isProcessor(v)&&a.nfCanvasUtils.canModify(v)){var q=function(){var y=e("#processor-details-tabs").find(".selected-tab").text();e("#processor-configuration-tabs").find('.tab:contains("'+y+'")').trigger("click");e("#processor-details").modal("hide");e("#processor-details-status-bar").statusbar("showButtons")};e("#processor-details-status-bar").statusbar("buttons",[{buttonHtml:'<i class="fa fa-stop stop-configure-icon" aria-hidden="true"></i><span>Stop & Configure</span>',clazz:"button button-icon auto-width",color:{hover:"#C7D2D7",base:"transparent",text:"#004849"},disabled:function(){return !a.nfCanvasUtils.isStoppable(v)},handler:{click:function(){e("#processor-details-status-bar").statusbar("hideButtons");a.nfActions.stopAndConfigure(v,q)}}},{buttonText:"Configure",clazz:"fa fa-cog button-icon",color:{hover:"#C7D2D7",base:"transparent",text:"#004849"},disabled:function(){return a.nfCanvasUtils.isStoppable(v)},handler:{click:function(){e("#processor-details-status-bar").statusbar("hideButtons");a.nfActions.showConfiguration(v,q)}}}])}}e("#processor-details").modal("setButtonModel",s).modal("show");e("#processor-details div.relationship-name").ellipsis();var o=e("#read-only-auto-terminate-relationship-names");if(o.is(":visible")&&o.get(0).scrollHeight>Math.round(o.innerHeight())){o.css("border-width","1px")}}).fail(g.handleAjaxError)}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Storage","nf.ErrorHandler","nf.Common","nf.Client","nf.CanvasUtils","nf.ng.Bridge","nf.Label"],function(f,j,g,i,c,k,d,h,e){return(nf.LabelConfiguration=b(f,j,g,i,c,k,d,h,e))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.LabelConfiguration=b(require("jquery"),require("d3"),require("nf.Storage"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.ng.Bridge"),require("nf.Label")))}else{nf.LabelConfiguration=b(a.$,a.d3,a.nf.Storage,a.nf.ErrorHandler,a.nf.Common,a.nf.Client,a.nf.CanvasUtils,a.nf.ng.Bridge,a.nf.Label)}}}(this,function(e,i,f,h,b,j,c,g,d){var a="";return{init:function(){e("#label-configuration").modal({scrollableContentStyle:"scrollable",headerText:"Configure Label",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var o=this;var p=i.select("#id-"+a).datum();var n=e("#label-value").val();var q=e("#label-font-size").combo("getSelectedOption");var m={revision:j.getRevision(p),disconnectedNodeAcknowledged:f.isDisconnectionAcknowledged(),component:{id:a,label:n,style:{"font-size":q.value}}};e.ajax({type:"PUT",url:p.uri,data:JSON.stringify(m),dataType:"json",contentType:"application/json"}).done(function(r){d.set(r);g.digest();o.modal("hide")}).fail(h.handleConfigurationUpdateAjaxError)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){this.modal("hide")}}}],handler:{close:function(){a=""},open:function(){e("#label-value").focus()}}});var l=[];for(var k=12;k<=24;k+=2){l.push({text:k+"px",value:k+"px"})}e("#label-font-size").combo({options:l,selectedOption:{value:"12px"},select:function(n){var m=e("#label-value");m.css({"font-size":n.value,"line-height":n.value}).val(m.val())}})},showConfiguration:function(l){if(c.isLabel(l)){var n=l.datum();var k="";if(b.isDefinedAndNotNull(n.component.label)){k=n.component.label}var m="12px";if(b.isDefinedAndNotNull(n.component.style["font-size"])){m=n.component.style["font-size"]}a=n.id;e("#label-value").val(k);e("#label-font-size").combo("setSelectedOption",{value:m});e("#label-configuration").modal("show")}}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.CanvasUtils","nf.ng.Bridge","nf.Port"],function(g,k,j,c,e,h,l,d,i,f){return(nf.PortConfiguration=b(g,k,j,c,e,h,l,d,i,f))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.PortConfiguration=b(require("jquery"),require("d3"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.ng.Bridge"),require("nf.Port")))}else{nf.PortConfiguration=b(a.$,a.d3,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.CanvasUtils,a.nf.ng.Bridge,a.nf.Port)}}}(this,function(f,j,i,b,d,g,k,c,h,e){var a=function(){f("#port-configuration").modal({scrollableContentStyle:"scrollable",headerText:"Configure Port",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var o=f("#port-id").text();var m=j.select("#id-"+o).datum();var l={id:o,name:f("#port-name").val(),comments:f("#port-comments").val()};if(f("#port-concurrent-task-container").is(":visible")){l.concurrentlySchedulableTaskCount=f("#port-concurrent-tasks").val()}if(f("#port-enabled").hasClass("checkbox-unchecked")){l.state="DISABLED"}else{if(f("#port-enabled").hasClass("checkbox-checked")){l.state="STOPPED"}}var n={revision:k.getRevision(m),disconnectedNodeAcknowledged:g.isDisconnectionAcknowledged(),component:l};f.ajax({type:"PUT",data:JSON.stringify(n),url:m.uri,dataType:"json",contentType:"application/json"}).done(function(p){e.set(p);h.digest();f("#port-configuration").modal("hide")}).fail(i.handleConfigurationUpdateAjaxError)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){f("#port-configuration").modal("hide")}}}],handler:{close:function(){f("#port-id").text("");f("#port-name").val("");f("#port-enabled").removeClass("checkbox-unchecked checkbox-checked");f("#port-concurrent-tasks").val("");f("#port-comments").val("")}}})};return{init:function(){a()},showConfiguration:function(m){if(c.isInputPort(m)||c.isOutputPort(m)){var n=m.datum();var l="checkbox-checked";if(n.component.state==="DISABLED"){l="checkbox-unchecked"}if(n.allowRemoteAccess===true){f("#port-concurrent-task-container").show()}else{f("#port-concurrent-task-container").hide()}f("#port-id").text(n.id);f("#port-name").val(n.component.name);f("#port-enabled").removeClass("checkbox-unchecked checkbox-checked").addClass(l);f("#port-concurrent-tasks").val(n.component.concurrentlySchedulableTaskCount);f("#port-comments").val(n.component.comments);f("#port-configuration").modal("show")}}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common","nf.CanvasUtils"],function(d,e,c){return(nf.PortDetails=b(d,e,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.PortDetails=b(require("jquery"),require("nf.Common"),require("nf.CanvasUtils")))}else{nf.PortDetails=b(a.$,a.nf.Common,a.nf.CanvasUtils)}}}(this,function(b,c,a){return{init:function(){b("#port-details").modal({scrollableContentStyle:"scrollable",headerText:"Port Details",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){b("#port-details").modal("hide")}}}],handler:{close:function(){c.clearField("read-only-port-name");c.clearField("read-only-port-id");c.clearField("read-only-port-comments")}}})},showDetails:function(d){if(a.isInputPort(d)||a.isOutputPort(d)){var e=d.datum();c.populateField("read-only-port-name",e.component.name);c.populateField("read-only-port-id",e.id);c.populateField("read-only-port-allow-remote-access",true===e.allowRemoteAccess?"true":"false");c.populateField("read-only-port-concurrent-tasks",e.component.concurrentlySchedulableTaskCount);c.populateField("read-only-port-comments",e.component.comments);b("#port-details").modal("show")}}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.ProcessGroup","nf.Shell","nf.CanvasUtils"],function(h,k,j,f,g,i,l,c,d,e){return(nf.ProcessGroupConfiguration=b(h,k,j,f,g,i,l,c,d,e))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ProcessGroupConfiguration=b(require("jquery"),require("d3"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.ProcessGroup"),require("nf.Shell"),require("nf.CanvasUtils")))}else{nf.ProcessGroupConfiguration=b(a.$,a.d3,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.ProcessGroup,a.nf.Shell,a.nf.CanvasUtils)}}}(this,function(d,s,f,h,j,e,t,g,q,n){var c;var l;var r={urls:{api:"../nifi-api",parameterContexts:"../nifi-api/flow/parameter-contexts"}};var k=function(){};var b=function(){return d("#process-group-controller-services-table")};var a=function(u,w){var v={revision:t.getRevision({revision:{version:u}}),disconnectedNodeAcknowledged:e.isDisconnectionAcknowledged(),component:{id:w,name:d("#process-group-name").val(),comments:d("#process-group-comments").val(),parameterContext:{id:d("#process-group-parameter-context-combo").combo("getSelectedOption").value}}};d.ajax({type:"PUT",data:JSON.stringify(v),url:r.urls.api+"/process-groups/"+encodeURIComponent(w),dataType:"json",contentType:"application/json"}).done(function(y){if(y.permissions.canRead&&y.component.parentGroupId===n.getGroupId()){g.set(y)}j.showOkDialog({headerText:"Process Group Configuration",dialogContent:"Process group configuration successfully saved."});d("#process-group-configuration-save").off("click").on("click",function(){a(y.revision.version,w)});var x=r.urls.api+"/flow/process-groups/"+encodeURIComponent(w)+"/controller-services";d.ajax({type:"GET",url:x,dataType:"json"}).done(function(z){var B=b();h.cleanUpTooltips(B,"div.has-errors");var A=B.data("gridInstance");var C=A.getData();d.each(z.controllerServices,function(E,D){C.updateItem(D.id,D)})});n.reload()}).fail(f.handleConfigurationUpdateAjaxError)};var m=function(w){var z=function(){d("#read-only-process-group-name").text("Unauthorized");d("#read-only-process-group-comments").text("Unauthorized")};var y=function(B){if(B){d("#process-group-configuration div.editable").show();d("#process-group-configuration div.read-only").hide();d("#process-group-configuration-save").show()}else{d("#process-group-configuration div.editable").hide();d("#process-group-configuration div.read-only").show();d("#process-group-configuration-save").hide()}};d("#process-group-id").text(w);d("#process-group-configuration-refresh-button").off("click").on("click",function(){m(w)});d("#add-process-group-configuration-controller-service").off("click").on("click",function(){var C=d("#process-group-configuration-tabs li.selected-tab").text();if(C==="Controller Services"){var B=r.urls.api+"/process-groups/"+encodeURIComponent(w)+"/controller-services";c.promptNewControllerService(B,b())}});var x=d.Deferred(function(B){d.ajax({type:"GET",url:r.urls.api+"/process-groups/"+encodeURIComponent(w),dataType:"json"}).done(function(C){d("#process-group-configuration").data("process-group",C);var D=C.component;if(C.permissions.canWrite){d("#process-group-name").removeClass("unset").val(D.name);d("#process-group-comments").removeClass("unset").val(D.comments);d("#process-group-configuration-header-text").text(D.name+" Configuration");y(true);d("#process-group-configuration-save").off("click").on("click",function(){a(C.revision.version,C.id)})}else{if(C.permissions.canRead){d("#read-only-process-group-name").text(D.name);d("#read-only-process-group-comments").text(D.comments);d("#process-group-configuration-header-text").text(D.name+" Configuration")}else{z()}y(false)}B.resolve(C)}).fail(function(F,C,D){if(F.status===403){var E;if(w===n.getGroupId()){E={permissions:{canRead:false,canWrite:n.canWriteCurrentGroup()}}}else{E=g.get(w)}d("#process-group-configuration").data("process-group",E);z();y(false);B.resolve(E)}else{B.reject(F,C,D)}})}).promise();var u=r.urls.api+"/flow/process-groups/"+encodeURIComponent(w)+"/controller-services";var v=c.loadControllerServices(u,b());var A=d.ajax({type:"GET",url:r.urls.parameterContexts,dataType:"json"});return d.when(x,v,A).done(function(F,J,D){var L=J[0];var N=D[0];d("#process-group-configuration-last-refreshed").text(L.currentTime);var E=N.parameterContexts;var O=[{text:"No parameter context",value:null}];var C=E.filter(function(P){return P.permissions.canRead});var K=E.filter(function(P){return !P.permissions.canRead});var M=C.sort(function(Q,P){if(Q.component.name<P.component.name){return -1}if(Q.component.name>P.component.name){return 1}return 0});var I=K.sort(function(Q,P){if(Q.id<P.id){return -1}if(Q.id>P.id){return 1}return 0});var B=M.concat(I);B.forEach(function(Q){var P;if(Q.permissions.canRead){P={text:Q.component.name,value:Q.id,description:Q.component.description}}else{P={disabled:true,text:Q.id,value:Q.id}}O.push(P)});var H={text:"Create new parameter context...",value:undefined,optionClass:"unset"};if(h.canModifyParameterContexts()){O.push(H)}var G={options:O,select:function(P){var Q=this;if(typeof P.value==="undefined"){d("#parameter-context-dialog").modal("setHeaderText","Add Parameter Context").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){if(d("#parameter-context-name").val()!==""){return false}return true},handler:{click:function(){l.addParameterContext(function(S){O.pop();var R={text:S.component.name,value:S.component.id,description:S.component.description};O.push(R);if(h.canModifyParameterContexts()){O.push(H)}G.selectedOption={value:S.component.id};Q.combo("destroy").combo(G)})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){d(this).modal("hide")}}}]).modal("show");if(d("#parameter-context-dialog").hasClass("read-only")){d("#parameter-context-dialog").removeClass("read-only");d("#parameter-context-dialog").addClass("edit-mode")}if(!d("#parameter-context-id-setting").hasClass("hidden")){d("#parameter-context-id-setting").addClass("hidden")}d("#parameter-context-name").focus()}}};if(h.isDefinedAndNotNull(F.parameterContext)){G.selectedOption={value:F.parameterContext.id}}d("#process-group-parameter-context-combo").combo("destroy").combo(G)}).fail(f.handleAjaxError)};var o=function(){q.showContent("#process-group-configuration").done(function(){p()});d("#process-group-configuration-tabs").find(".selected-tab").click();i.resetTableSize()};var p=function(){d("#process-group-configuration").removeData("process-group");d("#process-group-configuration-save").mouseout();d("#process-group-id").text("");d("#process-group-name").val("");d("#process-group-comments").val("");d("#process-group-configuration-header-text").text("Process Group Configuration")};var i={init:function(v,u){c=v;l=u;d("#process-group-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"General",tabContentId:"general-process-group-configuration-tab-content"},{name:"Controller Services",tabContentId:"process-group-controller-services-tab-content"}],select:function(){var x=d("#process-group-configuration").data("process-group");var y=h.isDefinedAndNotNull(x)?x.permissions.canWrite:false;var w=d(this).text();if(w==="General"){d("#flow-cs-availability").hide();d("#add-process-group-configuration-controller-service").hide();if(y){d("#process-group-configuration-save").show()}else{d("#process-group-configuration-save").hide()}}else{d("#flow-cs-availability").show();d("#process-group-configuration-save").hide();if(y){d("#add-process-group-configuration-controller-service").show();d("#process-group-controller-services-tab-content").css("top","32px")}else{d("#add-process-group-configuration-controller-service").hide();d("#process-group-controller-services-tab-content").css("top","0")}i.resetTableSize()}}});k();c.init(b())},resetTableSize:function(){c.resetTableSize(b())},showConfiguration:function(u){return m(u).done(o)},loadConfiguration:function(u){return m(u)},selectControllerService:function(u){var v=b().data("gridInstance");var w=v.getData();var x=w.getRowById(u);v.setSelectedRows([x]);v.scrollRowIntoView(x);d("#process-group-configuration-tabs").find("li:eq(1)").click()}};return i}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","Slick","nf.Canvas","nf.CanvasUtils","nf.ErrorHandler","nf.Dialog","nf.Storage","nf.Client","nf.Common","nf.ng.Bridge","nf.Processor","nf.ProcessGroup","nf.ProcessGroupConfiguration","nf.Shell"],function(j,q,g,o,h,n,i,k,p,f,l,m,c,e,d){return(nf.ComponentState=b(j,q,g,o,h,n,i,k,p,f,l,m,c,e,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ComponentState=b(require("jquery"),require("d3"),require("Slick"),require("nf.Canvas"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.Common"),require("nf.ng.Bridge"),require("nf.Processor"),require("nf.ProcessGroup"),require("nf.ProcessGroupConfiguration"),require("nf.Shell")))}else{nf.VariableRegistry=b(a.$,a.d3,a.Slick,a.nf.Canvas,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.Common,a.nf.ng.Bridge,a.nf.Processor,a.nf.ProcessGroup,a.nf.ProcessGroupConfiguration,a.nf.Shell)}}}(this,function(A,J,b,v,M,e,h,t,g,I,o,s,y,B,H){var D=null;var i=function(S){var T=this;var P="";var Q;var V;var U;var R;this.init=function(){var X=A("body");Q=S.item[S.column.field];V=A("<div></div>").addClass("slickgrid-editor").css({"z-index":100000,position:"absolute","border-radius":"2px","box-shadow":"rgba(0, 0, 0, 0.247059) 0px 2px 5px","background-color":"rgb(255, 255, 255)",overflow:"hidden",padding:"10px 20px",cursor:"move",transform:"translate3d(0px, 0px, 0px)"}).appendTo(X);R=A('<textarea hidefocus rows="5"/>').css({height:"80px",width:S.position.width+"px","min-width":"212px","margin-bottom":"5px","margin-top":"10px","white-space":"pre"}).tab().on("keydown",T.handleKeyDown).appendTo(V);V.draggable({cancel:".button, textarea, .nf-checkbox",containment:"parent"});var W=A('<div class="string-check-container">');W.appendTo(V);U=A('<div class="nf-checkbox string-check"/>').on("change",function(ab,aa){if(aa.isChecked){R.prop("disabled",true).val("")}else{R.prop("disabled",false).val(Q)}}).appendTo(W);A('<span class="string-check-label nf-checkbox-label">&nbsp;Set empty string</span>').appendTo(W);var Y=A('<div class="button">Ok</div>').css({color:"#fff",background:"#728E9B"}).hover(function(){A(this).css("background","#004849")},function(){A(this).css("background","#728E9B")}).on("click",T.save);var Z=A('<div class="secondary-button">Cancel</div>').css({color:"#004849",background:"#E3E8EB"}).hover(function(){A(this).css("background","#C7D2D7")},function(){A(this).css("background","#E3E8EB")}).on("click",T.cancel);A("<div></div>").css({position:"relative",top:"10px",left:"20px",width:"212px",clear:"both","float":"right"}).append(Y).append(Z).append('<div class="clear"></div>').appendTo(V);T.position(S.position);R.focus().select()};this.handleKeyDown=function(W){if(W.which===A.ui.keyCode.ENTER&&!W.shiftKey){T.save()}else{if(W.which===A.ui.keyCode.ESCAPE){T.cancel();W.stopImmediatePropagation();W.preventDefault()}}};this.save=function(){S.commitChanges()};this.cancel=function(){R.val(P);S.cancelChanges()};this.hide=function(){V.hide()};this.show=function(){V.show()};this.position=function(W){V.css({top:W.top-27,left:W.left-20})};this.destroy=function(){V.remove()};this.focus=function(){R.focus()};this.loadValue=function(X){var Y=false;if(I.isDefinedAndNotNull(X[S.column.field])){P=X[S.column.field];Y=P===""}var W=Y?"checkbox-checked":"checkbox-unchecked";U.addClass(W);R.val(P);R.select()};this.serializeValue=function(){if(R.val()===""){if(U.hasClass("checkbox-checked")){return""}else{return null}}else{return R.val()}};this.applyValue=function(W,X){W[S.column.field]=X};this.isValueChanged=function(){return T.serializeValue()!==Q};this.validate=function(){return{valid:true,msg:null}};this.init()};var k=function(R,V,X,W){var S=A(V.getCellNode(X,W));var T=S.offset();var P=A('<div class="property-detail"></div>').css({"z-index":1999,position:"absolute",padding:"10px 20px",overflow:"hidden","border-radius":"2px","box-shadow":"rgba(0, 0, 0, 0.247059) 0px 2px 5px","background-color":"rgb(255, 255, 255)",cursor:"move",transform:"translate3d(0px, 0px, 0px)",top:T.top-26,left:T.left-20}).draggable({containment:"parent"}).appendTo("body");A('<textarea hidefocus rows="5" readonly="readonly"/>').css({height:"80px",resize:"both",width:S.width()+"px",margin:"10px 0px","white-space":"pre"}).text(R.value).on("keydown",function(Y){if(Y.which===A.ui.keyCode.ESCAPE){Q();Y.stopImmediatePropagation();Y.preventDefault()}}).appendTo(P);var Q=function(){P.hide().remove()};var U=A('<div class="button">Ok</div>').css({position:"relative",top:"10px",left:"20px"}).hover(function(){A(this).css("background","#004849")},function(){A(this).css("background","#728E9B")}).on("click",function(){Q()});A("<div></div>").append(U).append('<div class="clear"></div>').appendTo(P)};var z={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,editable:true,enableAddRow:false,autoEdit:false,multiSelect:false,rowHeight:24};var m=function(P){var S=M.getSelection();if(S.empty()===false){var T=S.datum();if(T.id===P){if(T.permissions.canRead){return I.escapeHtml(T.component.name)}else{return I.escapeHtml(T.id)}}}var Q=o.injector.get("breadcrumbsCtrl").getBreadcrumbs();var R=P;A.each(Q,function(U,V){if(V.id===P){R=V.label;return false}});return R};var a=function(){var R=A("#variable-registry-table");var T=function(ab,Y,aa,Z,X){return I.escapeHtml(aa)};var Q=function(ab,Y,aa,Z,X){if(X.isOverridden){return'<div class="overridden" title="This value has been overridden by another variable in a descendant Process Group">'+I.escapeHtml(aa)+"</div>"}else{if(aa===""){return'<span class="table-cell blank">Empty string set</span>'}else{if(aa===null){return'<span class="unset">No value set</span>'}else{return I.escapeHtml(aa)}}}};var W=function(ab,Y,aa,Z,X){if(I.isDefinedAndNotNull(aa)){return I.escapeHtml(m(aa))}else{return"Controller"}};var S=function(ad,Y,ac,ab,X){var aa="";if(X.isEditable===true){aa+='<div title="Delete" class="delete-variable pointer fa fa-trash"></div>'}else{var Z=A("#variable-registry-process-group-id").text();if(X.processGroupId!==Z){aa+='<div title="Go To" class="go-to-variable pointer fa fa-long-arrow-right"></div>'}}return aa};var U=[{id:"scope",name:"Scope",field:"processGroupId",formatter:W,sortable:true,resizable:true},{id:"name",name:"Name",field:"name",formatter:T,sortable:true,resizable:true},{id:"value",name:"Value",field:"value",formatter:Q,sortable:true,resizable:true,cssClass:"pointer"},{id:"actions",name:"&nbsp;",resizable:false,formatter:S,sortable:false,width:45,maxWidth:45}];var P=new b.Data.DataView({inlineFilters:false});P.setFilterArgs({searchString:"",property:"hidden"});P.setFilter(function(Y,X){return Y.hidden===false});P.getItemMetadata=function(X){return{columns:{value:{editor:i}}}};O({columnId:"name",sortAsc:true},P);var V=new b.Grid(R,P,U,z);V.setSelectionModel(new b.RowSelectionModel());V.registerPlugin(new b.AutoTooltips());V.setSortColumn("name",true);V.onSort.subscribe(function(Y,X){O({columnId:X.sortCol.id,sortAsc:X.sortAsc},P)});V.onClick.subscribe(function(ab,Y){var X=P.getItem(Y.row);if(V.getColumns()[Y.cell].id==="value"){if(X.isEditable===true){V.gotoCell(Y.row,Y.cell,true)}else{V.setSelectedRows([Y.row]);k(X,V,Y.row,Y.cell)}ab.stopImmediatePropagation()}else{if(V.getColumns()[Y.cell].id==="actions"){var aa=A(ab.target);if(aa.hasClass("delete-variable")){P.updateItem(X.id,A.extend(X,{hidden:true}));var ac=P.getItems();A.each(ac,function(ad,ae){if(ae.isOverridden===true&&!f(ac,ae)){P.updateItem(ae.id,A.extend(ae,{isOverridden:false}))}});var Z=V.getSelectedRows();if(Z.length===0){V.setSelectedRows([0])}ab.stopImmediatePropagation()}else{if(aa.hasClass("go-to-variable")){w().done(function(){var ad=o.injector.get("breadcrumbsCtrl").getBreadcrumbs();A.each(ad,function(ae,af){if(af.id===X.processGroupId){if(I.isDefinedAndNotNull(af.parentBreadcrumb)){M.showComponent(af.parentBreadcrumb.id,af.id).done(function(){setTimeout(function(){x(X.processGroupId,X.name)},500)})}else{M.getComponentByType("ProcessGroup").enterGroup(af.id).done(function(){setTimeout(function(){x(X.processGroupId,X.name)},500)})}return false}})})}}}}});V.onSelectedRowsChanged.subscribe(function(Z,Y){if(A.isArray(Y.rows)&&Y.rows.length===1){if(V.getDataLength()>0){var aa=Y.rows[0];var X=V.getDataItem(aa);if(D===null||D!==X.id){A("#variable-affected-components-context").removeClass("unset").text(X.name);E(X.affectedComponents);D=X.id}}}});V.onBeforeCellEditorDestroy.subscribe(function(Y,X){setTimeout(function(){V.resizeCanvas()},50)});P.onRowCountChanged.subscribe(function(Y,X){V.updateRowCount();V.render()});P.onRowsChanged.subscribe(function(Y,X){V.invalidateRows(X.rows);V.render()});P.syncGridSelection(V,true);R.data("gridInstance",V)};var w=function(){var Q=A("#variable-registry-table").data("gridInstance");if(I.isDefinedAndNotNull(Q)){var P=Q.getEditController();P.commitCurrentEdit()}return A.Deferred(function(R){if(A("#variable-update-status").is(":visible")){F();R.resolve()}else{var S=n();if(A.isEmptyObject(S)){F();R.resolve()}else{h.showYesNoDialog({headerText:"Variables",dialogContent:"Save changes before leaving variable configuration?",noHandler:function(){F();R.resolve()},yesHandler:function(){N().done(function(){R.resolve()}).fail(function(){R.reject()})}})}}}).promise()};var O=function(P,R){var Q=function(U,S){if(P.columnId==="scope"){var X=I.isDefinedAndNotNull(U.processGroupId)?m(U.processGroupId):"";var W=I.isDefinedAndNotNull(S.processGroupId)?m(S.processGroupId):"";return X===W?0:X>W?1:-1}else{var T=I.isDefinedAndNotNull(U[P.columnId])?U[P.columnId]:"";var V=I.isDefinedAndNotNull(S[P.columnId])?S[P.columnId]:"";return T===V?0:T>V?1:-1}};R.sort(Q,P.sortAsc)};var L=function(Q,P){return Q.component.name.localeCompare(P.component.name)};var p=function(Q,P){var S=A('<li class="affected-component-container"></li>').appendTo(P);var R=Q.component;A('<div class="referencing-component-state"></div>').addClass(function(){if(I.isDefinedAndNotNull(R.state)){var T=A(this);var V=R.state.toLowerCase();if(V==="stopped"&&!I.isEmpty(R.validationErrors)){V="invalid";var U=I.formatUnorderedList(R.validationErrors);T.qtip(A.extend({},M.config.systemTooltipConfig,{content:U}))}return V}else{return""}}).appendTo(S);A('<span class="referencing-component-name link"></span>').text(R.name).on("click",function(){w().done(function(){M.showComponent(R.processGroupId,R.id)})}).appendTo(S);A('<div class="referencing-component-bulletins"></div>').addClass(R.id+"-affected-bulletins").appendTo(S);A('<span class="referencing-component-active-thread-count"></span>').text(function(){if(I.isDefinedAndNotNull(R.activeThreadCount)&&R.activeThreadCount>0){return"("+R.activeThreadCount+")"}else{return""}}).appendTo(S)};var d=function(R,Q){var S=A('<li class="affected-component-container"></li>').appendTo(Q);var P=R.component;A('<div class="referencing-component-state"></div>').addClass(function(){if(I.isDefinedAndNotNull(P.state)){var T=A(this);var V=P.state==="ENABLED"?"enabled":"disabled";if(V==="disabled"&&!I.isEmpty(P.validationErrors)){V="invalid";var U=I.formatUnorderedList(P.validationErrors);T.qtip(A.extend({},M.config.systemTooltipConfig,{content:U}))}return V}else{return""}}).appendTo(S);A('<div class="referencing-component-bulletins"></div>').addClass(P.id+"-affected-bulletins").appendTo(S);A('<span class="referencing-component-name link"></span>').text(P.name).on("click",function(){w().done(function(){B.showConfiguration(P.processGroupId).done(function(){B.selectControllerService(P.id)})})}).appendTo(S)};var E=function(T){var Q=[];var R=[];var P=[];var W=A("#variable-registry-affected-processors");I.cleanUpTooltips(W,"div.referencing-component-state");I.cleanUpTooltips(W,"div.referencing-component-bulletins");W.empty();var V=A("#variable-registry-affected-controller-services");I.cleanUpTooltips(V,"div.referencing-component-state");I.cleanUpTooltips(V,"div.referencing-component-bulletins");V.empty();var S=A("#variable-registry-affected-unauthorized-components").empty();if(I.isUndefined(T)){A('<li class="affected-component-container"><span class="unset">Pending Apply</span></li>').appendTo(W);A('<li class="affected-component-container"><span class="unset">Pending Apply</span></li>').appendTo(V);A('<li class="affected-component-container"><span class="unset">Pending Apply</span></li>').appendTo(S)}else{var U=[];A.each(T,function(X,Y){if(Y.permissions.canRead===true&&Y.permissions.canWrite===true){U.push(Y.id);if(Y.component.referenceType==="PROCESSOR"){Q.push(Y)}else{R.push(Y)}}else{if(Y.permissions.canRead===true){U.push(Y.id)}P.push(Y)}});if(Q.length===0){A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(W)}else{Q.sort(L);A.each(Q,function(X,Y){p(Y,W)})}if(R.length===0){A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(V)}else{R.sort(L);A.each(R,function(X,Y){d(Y,V)})}if(P.length===0){A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(S)}else{P.sort(function(Y,X){if(Y.permissions.canRead===true&&X.permissions.canRead===true){var Z=Y.component.referenceType===X.component.referenceType?0:Y.component.referenceType>X.component.referenceType?-1:1;if(Z===0){Z=Y.component.name===X.component.name?0:Y.component.name>X.component.name?1:-1}return Z}else{if(Y.permissions.canRead===false&&X.permissions.canRead===false){return Y.id>X.id?1:-1}else{if(Y.permissions.canRead===true){return -1}else{return 1}}}});A.each(P,function(Z,X){if(X.permissions.canRead===true){if(X.component.referenceType==="PROCESSOR"){p(X,S)}else{d(X,S)}}else{var Y=A('<li class="affected-component-container"></li>').appendTo(S);A('<span class="referencing-component-name link ellipsis"></span>').prop("title",X.id).text(X.id).on("click",function(){w().done(function(){A("#shell-dialog").modal("hide");if(X.referenceType==="PROCESSOR"){M.showComponent(X.processGroup.id,X.id)}else{if(X.referenceType==="CONTROLLER_SERVICE"){B.showConfiguration(X.processGroup.id).done(function(){y.enterGroup(X.processGroup.id);B.selectControllerService(X.id)})}}})}).appendTo(Y)}})}if(U.length>0){M.queryBulletins(U).done(function(Y){var Z=Y.bulletinBoard.bulletins;var X=J.nest().key(function(aa){return aa.sourceId}).map(Z,J.map);X.each(function(aa,ab){A("div."+ab+"-affected-bulletins").each(function(){var ad=A(this);if(aa.length>0){var ac=I.getFormattedBulletins(aa);var ae=I.formatUnorderedList(ac);ad.addClass("has-bulletins").show().qtip(A.extend({},M.config.systemTooltipConfig,{content:ae}))}})})})}}};var x=function(P,Q){return A.ajax({type:"GET",url:"../nifi-api/process-groups/"+encodeURIComponent(P)+"/variable-registry",dataType:"json"}).done(function(R){A("#process-group-variable-registry").text(m(P));A("#variable-registry-process-group-id").text(P).data("revision",R.processGroupRevision);l(R.variableRegistry,Q);A("#variable-registry-dialog").modal("show")}).fail(e.handleAjaxError)};var f=function(V,U){var T=[];A.each(V,function(X,W){if(U.name===W.name&&W.hidden===false){T.push(W)}});var S=false;if(T.length>1){var R=[];var Q=o.injector.get("breadcrumbsCtrl").getBreadcrumbs();A.each(Q,function(W,X){R.push(X.id)});var P=A("#variable-registry-process-group-id").text();if(R.indexOf(P)===-1){R.push(P)}A.each(R,function(X,W){for(var Y=0;Y<T.length;Y++){if(W===T[Y].processGroupId){if(U===T[Y]){S=true}T.splice(Y,1);if(T.length===1){return false}}}})}return S};var c=function(R){if(R.canWrite===true){var Q=A("#variable-registry-process-group-id").text();if(R.processGroupId===Q){var S=M.getSelection();if(S.empty()===false&&nf.CanvasUtils.isProcessGroup(S)){var U=S.datum();if(U.id===Q){return U.permissions.canWrite===true}}var T=false;var P=o.injector.get("breadcrumbsCtrl").getBreadcrumbs();A.each(P,function(V,W){if(W.id===Q){T=W.permissions.canWrite===true;return false}});return T}}return false};var K=0;var l=function(S,U){if(I.isDefinedAndNotNull(S)){var T=0;var V=A("#variable-registry-table").data("gridInstance");var Q=V.getData();Q.beginUpdate();var W=[];A.each(S.variables,function(aa,Y){var Z=Y.variable;W.push({id:K++,hidden:false,canWrite:Y.canWrite,name:Z.name,value:Z.value,previousValue:Z.value,processGroupId:Z.processGroupId,affectedComponents:Z.affectedComponents})});A.each(W,function(Z,Y){Q.addItem(A.extend({isOverridden:f(W,Y),isEditable:c(Y)},Y))});Q.endUpdate();Q.reSort();if(I.isDefinedAndNotNull(U)){A.each(W,function(Z,Y){if(S.processGroupId===Y.processGroupId&&Y.name===U){T=Q.getRowById(Y.id)}})}if(W.length===0){var P=A("#variable-registry-affected-processors");I.cleanUpTooltips(P,"div.referencing-component-state");I.cleanUpTooltips(P,"div.referencing-component-bulletins");P.empty();var X=A("#variable-registry-affected-controller-services");I.cleanUpTooltips(X,"div.referencing-component-state");I.cleanUpTooltips(X,"div.referencing-component-bulletins");X.empty();var R=A("#variable-registry-affected-unauthorized-components").empty();A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(P);A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(X);A('<li class="affected-component-container"><span class="unset">None</span></li>').appendTo(R);A("#variable-affected-components-context").addClass("unset").text("None")}else{V.setSelectedRows([T])}}};var q=function(S,R,Q){var P=A("#variable-update-steps").empty();A.each(S,function(V,U){var T=A("<li></li>").text(U.description).appendTo(P);A('<div class="variable-step"></div>').addClass(function(){if(I.isDefinedAndNotNull(U.failureReason)){return"ajax-error"}else{if(U.complete===true){return"ajax-complete"}else{return R===true||Q===true?"ajax-error":"ajax-loading"}}}).appendTo(T);A('<div class="clear"></div>').appendTo(T)})};var N=function(){var R=n();if(R.length===0){F();return}var Q=R.map(function(S){return S.variable.name});A("#variable-affected-components-context").removeClass("unset").text(Q.join(", "));var P=A("#variable-registry-process-group-id").text();return A.Deferred(function(S){var V=function(){A("#variable-registry-dialog").modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){S.resolve();F()}}}])};var T=false;A("#variable-registry-dialog").modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){T=true;V()}}}]);var W;var U=function(Z,X,Y){if(I.isDefinedAndNotNull(W)){G(P,W)}A("#variable-update-steps").find("div.variable-step.ajax-loading").removeClass("ajax-loading").addClass("ajax-error");V()};u(P,R).done(function(X){var Y=function(ab){var aa=ab.request;var Z=I.isDefinedAndNotNull(aa.failureReason);W=aa.requestId;E(aa.affectedComponents);q(aa.updateSteps,T,Z);if(T){G(aa.processGroupId,W)}else{if(aa.complete===true){if(Z){h.showOkDialog({headerText:"Variable Update Error",dialogContent:"Unable to complete variable update request: "+I.escapeHtml(aa.failureReason)})}A.each(aa.affectedComponents,function(ac,ae){if(ae.permissions.canRead===true){var ad=ae.component;if(ad.referenceType==="PROCESSOR"&&M.getGroupId()===ad.processGroupId){s.reload(ad.id)}}});if(M.getGroupId()!==aa.processGroupId){y.reload(aa.processGroupId)}G(aa.processGroupId,W);V()}else{setTimeout(function(){r(aa.processGroupId,W).done(function(ac){Y(ac)}).fail(U)},2000)}}};A("#variable-registry-table, #add-variable").hide();A("#variable-update-status").show();Y(X)}).fail(U)}).promise()};var u=function(P,S){var R=A("#variable-registry-process-group-id").data("revision");var Q={processGroupRevision:g.getRevision({revision:{version:R.version}}),disconnectedNodeAcknowledged:t.isDisconnectionAcknowledged(),variableRegistry:{processGroupId:P,variables:S}};return A.ajax({type:"POST",data:JSON.stringify(Q),url:"../nifi-api/process-groups/"+encodeURIComponent(P)+"/variable-registry/update-requests",dataType:"json",contentType:"application/json"}).fail(e.handleAjaxError)};var r=function(P,Q){return A.ajax({type:"GET",url:"../nifi-api/process-groups/"+encodeURIComponent(P)+"/variable-registry/update-requests/"+encodeURIComponent(Q),dataType:"json"}).fail(e.handleAjaxError)};var G=function(P,Q){return A.ajax({type:"DELETE",url:"../nifi-api/process-groups/"+encodeURIComponent(P)+"/variable-registry/update-requests/"+encodeURIComponent(Q)+"?"+A.param({disconnectedNodeAcknowledged:t.isDisconnectionAcknowledged()}),dataType:"json"}).fail(e.handleAjaxError)};var n=function(){var R=[];var Q=A("#variable-registry-table").data("gridInstance");var P=Q.getData();A.each(P.getItems(),function(){var T={name:this.name};var S=false;if(this.hidden===true&&this.previousValue!==null){T.value=null;S=true}else{if(this.value!==this.previousValue){T.value=this.value;S=true}}if(S){R.push({variable:T})}});return R};var C=function(){var W=A("#variable-registry-process-group-id").text();var U=A.trim(A("#new-variable-name").val());if(U!==""){var T=A("#variable-registry-table").data("gridInstance");var Q=T.getData();var R=[];var X=null;A.each(Q.getItems(),function(Y,Z){if(U===Z.name){if(W===Z.processGroupId){X=Z}else{R.push(Z)}}});if(X===null){Q.addItem({id:K,hidden:false,canWrite:true,name:U,value:null,previousValue:null,processGroupId:W,isEditable:true,isOverridden:false});A.each(R,function(Y,Z){Q.updateItem(Z.id,A.extend(Z,{isOverridden:true}))});Q.reSort();var V=Q.getRowById(K);T.setActiveCell(V,T.getColumnIndex("value"));T.editActiveCell();K++}else{if(X.hidden===true){Q.updateItem(X.id,A.extend(X,{hidden:false,value:null}));var S=Q.getRowById(X.id);T.setActiveCell(S,T.getColumnIndex("value"));T.editActiveCell()}else{h.showOkDialog({headerText:"Variable Exists",dialogContent:"A variable with this name already exists."});var P=Q.getRowById(X.id);T.setSelectedRows([P]);T.scrollRowIntoView(P)}}A("#new-variable-dialog").modal("hide")}else{h.showOkDialog({headerText:"Configuration Error",dialogContent:"The name of the variable must be specified."})}};var F=function(){A("#variable-registry-dialog").modal("hide")};var j=function(){A("#variable-registry-table, #add-variable").show();A("#variable-update-status").hide();A("#process-group-variable-registry").text("");A("#variable-registry-process-group-id").text("").removeData("revision");A("#variable-affected-components-context").removeClass("unset").text("");var S=A("#variable-registry-table").data("gridInstance");var P=S.getData();P.setItems([]);var R=A("#variable-registry-affected-processors");I.cleanUpTooltips(R,"div.referencing-component-state");I.cleanUpTooltips(R,"div.referencing-component-bulletins");R.empty();var Q=A("#variable-registry-affected-controller-services");I.cleanUpTooltips(Q,"div.referencing-component-state");I.cleanUpTooltips(Q,"div.referencing-component-bulletins");Q.empty();A("#variable-registry-affected-unauthorized-components").empty();D=null};return{init:function(){A("#variable-registry-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Variables",handler:{close:function(){j()},open:function(){var P=A("#variable-registry-table").data("gridInstance");if(I.isDefinedAndNotNull(P)){P.resizeCanvas()}}}});A("#new-variable-dialog").modal({headerText:"New Variable",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){C()}}}],handler:{close:function(){A("#new-variable-name").val("")},open:function(){A("#new-variable-name").focus()}}});A("#new-variable-name").on("keydown",function(Q){var P=Q.keyCode?Q.keyCode:Q.which;if(P===A.ui.keyCode.ENTER){C();Q.stopImmediatePropagation();Q.preventDefault()}});A("#add-variable").on("click",function(){A("#new-variable-dialog").modal("show")});A("#parameters-documentation-link").on("click",function(){H.showPage("../nifi-docs/html/user-guide.html#Parameters")});a()},showVariables:function(P){A("#variable-registry-dialog").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){N()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){F()}}}]);return x(P)}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.ErrorHandler","nf.Common","nf.Storage","nf.Client","nf.CanvasUtils","nf.ProcessGroupConfiguration","nf.ng.Bridge"],function(g,d,j,e,h,k,f,c,i){return(nf.ComponentState=b(g,j,e,h,k,f,c,i))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ComponentState=b(require("jquery"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Storage"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.ProcessGroupConfiguration"),require("nf.ng.Bridge")))}else{nf.ComponentVersion=b(a.$,a.nf.ErrorHandler,a.nf.Common,a.nf.Storage,a.nf.Client,a.nf.CanvasUtils,a.nf.ProcessGroupConfiguration,a.nf.ng.Bridge)}}}(this,function(h,k,e,i,n,f,c,j){var a;var d;var b=function(o){if(o.type==="ReportingTask"){return"../nifi-api/flow/reporting-task-types"}else{if(o.type==="ControllerService"){return"../nifi-api/flow/controller-service-types"}else{return"../nifi-api/flow/processor-types"}}};var g=function(o){if(o.type==="ReportingTask"){return"reportingTaskTypes"}else{if(o.type==="ControllerService"){return"controllerServiceTypes"}else{return"processorTypes"}}};var m=function(){var o=a.keys();h.each(o,function(q,p){a.remove(p)});h("#component-version-controller-service-apis").empty();h("#component-version-controller-service-apis-container").hide();h("#component-version-name").text("");h("#component-version-bundle").text("");h("#component-version-tags").text("");h("#component-version-restriction").removeClass("unset").text("");h("#component-version-description").text("");h("#component-version-selector").combo("destroy");h("#component-version-dialog").removeData("component")};var l=function(q){var r=a.get(q.value);if(e.isDefinedAndNotNull(r.usageRestriction)){h("#component-version-restriction").text(r.usageRestriction)}else{h("#component-version-restriction").addClass("unset").text("No restriction")}if(!e.isEmpty(r.controllerServiceApis)){var o=e.getFormattedServiceApis(r.controllerServiceApis);var p=e.formatUnorderedList(o);h("#component-version-controller-service-apis").empty().append(p);h("#component-version-controller-service-apis-container").show()}h("#component-version-tags").text(r.tags.join(", "));h("#component-version-description").text(r.description)};return{init:function(o){a=d3.map();d=o;h("#component-version-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Component Version",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var r=h("#component-version-selector").combo("getSelectedOption");var s=a.get(r.value);var q=h("#component-version-dialog").data("component");var p={revision:n.getRevision(q),disconnectedNodeAcknowledged:i.isDisconnectionAcknowledged(),component:{id:q.id,bundle:{group:s.bundle.group,artifact:s.bundle.artifact,version:s.bundle.version}}};h.ajax({type:"PUT",url:q.uri,data:JSON.stringify(p),dataType:"json",contentType:"application/json"}).done(function(u){if(q.type==="Processor"){f.getComponentByType(q.type).set(u);j.digest()}else{if(q.type==="ControllerService"){var t=q.component.parentGroupId;h.Deferred(function(v){if(e.isDefinedAndNotNull(t)){if(h("#process-group-configuration").is(":visible")){c.loadConfiguration(t).done(function(){v.resolve()})}else{c.showConfiguration(t).done(function(){v.resolve()})}}else{if(h("#settings").is(":visible")){d.loadSettings().done(function(){v.resolve()})}else{d.showSettings().done(function(){v.resolve()})}}}).done(function(){if(e.isDefinedAndNotNull(t)){c.selectControllerService(q.id)}else{d.selectControllerService(q.id)}})}else{if(q.type==="ReportingTask"){h.Deferred(function(v){if(h("#settings").is(":visible")){d.loadSettings().done(function(){v.resolve()})}else{d.showSettings().done(function(){v.resolve()})}}).done(function(){d.selectReportingTask(q.id)})}}}}).fail(k.handleAjaxError);this.modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){this.modal("hide")}}}],handler:{close:function(){m()}}})},promptForVersionChange:function(o){var p={bundleGroupFilter:o.component.bundle.group,bundleArtifactFilter:o.component.bundle.artifact};if(g(o)==="controllerServiceTypes"){p.typeFilter=o.component.type}else{p.type=o.component.type}return h.ajax({type:"GET",url:b(o)+"?"+h.param(p),dataType:"json"}).done(function(q){var r=[];var s;h.each(q[g(o)],function(t,w){var v=w.type;a.set(w.bundle.version,w);var u={text:w.bundle.version,value:w.bundle.version,description:e.escapeHtml(w.description)};if(w.bundle.version===o.component.bundle.version){s=u}r.push(u)});r.sort(function(u,t){return -e.sortVersion(u.text,t.text)});h("#component-version-name").text(o.component.name);h("#component-version-bundle").text(e.formatBundle(o.component.bundle));h("#component-version-selector").combo({options:r,selectedOption:s,select:l});h("#component-version-dialog").data("component",o).modal("show")}).fail(k.handleAjaxError)}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.CanvasUtils","nf.ng.Bridge","nf.RemoteProcessGroup"],function(g,k,j,d,f,h,l,e,i,c){return(nf.RemoteProcessGroupConfiguration=b(g,k,j,d,f,h,l,e,i,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.RemoteProcessGroupConfiguration=b(require("jquery"),require("d3"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.ng.Bridge"),require("nf.RemoteProcessGroup")))}else{nf.RemoteProcessGroupConfiguration=b(a.$,a.d3,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.CanvasUtils,a.nf.ng.Bridge,a.nf.RemoteProcessGroup)}}}(this,function(e,i,h,b,d,f,j,c,g,a){return{init:function(){e("#remote-process-group-configuration").modal({headerText:"Configure Remote Process Group",scrollableContentStyle:"scrollable",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var k=e("#remote-process-group-id").text();var l=i.select("#id-"+k).datum();var m={revision:j.getRevision(l),disconnectedNodeAcknowledged:f.isDisconnectionAcknowledged(),component:{id:k,targetUris:e("#remote-process-group-urls").val(),communicationsTimeout:e("#remote-process-group-timeout").val(),yieldDuration:e("#remote-process-group-yield-duration").val(),transportProtocol:e("#remote-process-group-transport-protocol-combo").combo("getSelectedOption").value,proxyHost:e("#remote-process-group-proxy-host").val(),proxyPort:e("#remote-process-group-proxy-port").val(),proxyUser:e("#remote-process-group-proxy-user").val(),proxyPassword:e("#remote-process-group-proxy-password").val(),localNetworkInterface:e("#remote-process-group-local-network-interface").val()}};e.ajax({type:"PUT",data:JSON.stringify(m),url:l.uri,dataType:"json",contentType:"application/json"}).done(function(n){a.set(n);g.digest();e("#remote-process-group-configuration").modal("hide")}).fail(h.handleConfigurationUpdateAjaxError)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){e("#remote-process-group-configuration").modal("hide")}}}],handler:{close:function(){e("#remote-process-group-id").text("");e("#remote-process-group-name").text("");e("#remote-process-group-urls").val("");e("#remote-process-group-timeout").val("");e("#remote-process-group-yield-duration").val("");e("#remote-process-group-transport-protocol-combo").combo("setSelectedOption",{value:"RAW"});e("#remote-process-group-local-network-interface").val("");e("#remote-process-group-proxy-host").val("");e("#remote-process-group-proxy-port").val("");e("#remote-process-group-proxy-user").val("");e("#remote-process-group-proxy-password").val("")}}});e("#remote-process-group-transport-protocol-combo").combo({options:[{text:"RAW",value:"RAW"},{text:"HTTP",value:"HTTP"}]})},showConfiguration:function(k){if(c.isRemoteProcessGroup(k)){var l=k.datum();e("#remote-process-group-id").text(l.id);e("#remote-process-group-name").text(l.component.name);e("#remote-process-group-urls").val(l.component.targetUris);e("#remote-process-group-timeout").val(l.component.communicationsTimeout);e("#remote-process-group-yield-duration").val(l.component.yieldDuration);e("#remote-process-group-proxy-host").val(l.component.proxyHost);e("#remote-process-group-proxy-port").val(l.component.proxyPort);e("#remote-process-group-proxy-user").val(l.component.proxyUser);e("#remote-process-group-proxy-password").val(l.component.proxyPassword);e("#remote-process-group-local-network-interface").val(l.component.localNetworkInterface);e("#remote-process-group-transport-protocol-combo").combo("setSelectedOption",{value:l.component.transportProtocol});e("#remote-process-group-configuration").modal("show")}}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common","nf.CanvasUtils"],function(d,e,c){return(nf.RemoteProcessGroupDetails=b(d,e,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.RemoteProcessGroupDetails=b(require("jquery"),require("nf.Common"),require("nf.CanvasUtils")))}else{nf.RemoteProcessGroupDetails=b(a.$,a.nf.Common,a.nf.CanvasUtils)}}}(this,function(b,c,a){return{init:function(){b("#remote-process-group-details").modal({headerText:"Remote Process Group Details",scrollableContentStyle:"scrollable",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){b("#remote-process-group-details").modal("hide")}}}],handler:{close:function(){c.clearField("read-only-remote-process-group-id");c.clearField("read-only-remote-process-group-name");c.clearField("read-only-remote-process-group-urls");c.clearField("read-only-remote-process-group-timeout");c.clearField("read-only-remote-process-group-yield-duration");c.clearField("read-only-remote-process-group-transport-protocol");c.clearField("read-only-remote-process-group-local-network-interface");c.clearField("read-only-remote-process-group-proxy-host");c.clearField("read-only-remote-process-group-proxy-port");c.clearField("read-only-remote-process-group-proxy-user");c.clearField("read-only-remote-process-group-proxy-password")}}})},showDetails:function(d){if(a.isRemoteProcessGroup(d)){var e=d.datum();c.populateField("read-only-remote-process-group-id",e.id);c.populateField("read-only-remote-process-group-name",e.component.name);c.populateField("read-only-remote-process-group-urls",e.component.targetUris);c.populateField("read-only-remote-process-group-timeout",e.component.communicationsTimeout);c.populateField("read-only-remote-process-group-yield-duration",e.component.yieldDuration);c.populateField("read-only-remote-process-group-transport-protocol",e.component.transportProtocol);c.populateField("read-only-remote-process-group-local-network-interface",e.component.localNetworkInterface);c.populateField("read-only-remote-process-group-proxy-host",e.component.proxyHost);c.populateField("read-only-remote-process-group-proxy-port",e.component.proxyPort);c.populateField("read-only-remote-process-group-proxy-user",e.component.proxyUser);c.populateField("read-only-remote-process-group-proxy-password",e.component.proxyPassword);b("#remote-process-group-details").modal("show")}}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.CanvasUtils","nf.ng.Bridge","nf.RemoteProcessGroup"],function(g,k,j,d,f,h,l,e,i,c){return(nf.RemoteProcessGroupPorts=b(g,k,j,d,f,h,l,e,i,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.RemoteProcessGroupPorts=b(require("jquery"),require("d3"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.ng.Bridge"),require("nf.RemoteProcessGroup")))}else{nf.RemoteProcessGroupPorts=b(a.$,a.d3,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.CanvasUtils,a.nf.ng.Bridge,a.nf.RemoteProcessGroup)}}}(this,function(g,n,l,c,e,i,o,d,j,b){var h=function(){g("#remote-port-configuration").modal({headerText:"Configure Remote Port",scrollableContentStyle:"scrollable",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var r=g("#remote-port-concurrent-tasks").val();var q=g("#remote-port-batch-count").val();var w=new Array();if(!g.isNumeric(r)){w.push("Concurrent tasks must be an integer value.")}if(q&&!g.isNumeric(q)){w.push("Batch Settings: count must be an integer value.")}if(w.length==0){var p=g("#remote-process-group-ports-id").text();var v=n.select("#id-"+p).datum();var u=g("#remote-port-id").text();var t={revision:o.getRevision(v),disconnectedNodeAcknowledged:i.isDisconnectionAcknowledged(),remoteProcessGroupPort:{id:u,groupId:p,useCompression:g("#remote-port-use-compression").hasClass("checkbox-checked"),concurrentlySchedulableTaskCount:r,batchSettings:{count:q,size:g("#remote-port-batch-size").val(),duration:g("#remote-port-batch-duration").val()}}};var s="/output-ports/";if(g("#remote-port-type").text()==="input"){s="/input-ports/"}g.ajax({type:"PUT",data:JSON.stringify(t),url:v.uri+s+encodeURIComponent(u),dataType:"json",contentType:"application/json"}).done(function(x){v.revision=x.revision;var y=x.remoteProcessGroupPort;var A="No";if(y.useCompression===true){A="Yes"}g("#"+u+"-concurrent-tasks").text(y.concurrentlySchedulableTaskCount);g("#"+u+"-compression").text(A);var z=a(y);g("#"+u+"-batch-count").text(z.count);g("#"+u+"-batch-size").text(z.size);g("#"+u+"-batch-duration").text(z.duration);g("#remote-port-configuration").modal("hide")}).fail(l.handleConfigurationUpdateAjaxError)}else{e.showOkDialog({headerText:"Configuration Error",dialogContent:w.reduce(function(x,y){return typeof(x)==="string"?x+" "+y:y})})}}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){g("#remote-port-configuration").modal("hide")}}}],handler:{close:function(){g("#remote-port-id").text("");g("#remote-port-name").text("");g("#remote-port-concurrent-tasks").val("");g("#remote-port-use-compression").removeClass("checkbox-checked checkbox-unchecked");g("#remote-port-batch-count").val("");g("#remote-port-batch-size").val("");g("#remote-port-batch-duration").val("")}}})};var k=function(){g("#remote-process-group-ports").modal({scrollableContentStyle:"scrollable",headerText:"Remote Process Group Ports",buttons:[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var p=g("#remote-process-group-ports-id").text();var r=n.select("#id-"+p);var q=r.datum();if(d.canModify(r)){b.reload(q.id)}g("#remote-process-group-ports").modal("hide")}}}],handler:{close:function(){g("#remote-process-group-ports-id").text("");g("#remote-process-group-ports-name").text("");g("#remote-process-group-ports-urls").text("");var p=g("#remote-process-group-ports");c.cleanUpTooltips(p,"div.remote-port-removed");c.cleanUpTooltips(p,"div.concurrent-tasks-info");g("#remote-process-group-input-ports-container").empty();g("#remote-process-group-output-ports-container").empty()}}})};var a=function(q){var p={};var r=q.batchSettings;if(r){p.count=typeof(r.count)==="number"?r.count:"No value set";p.size=r.size?r.size:"No value set";p.duration=r.duration?r.duration:"No value set"}else{p.count="No value set";p.size="No value set";p.duration="No value set"}return p};var f=function(D,B,w){var t=c.escapeHtml(B.id);var x=g('<div class="remote-port-container"></div>').appendTo(D);var I=g('<div class="remote-port-edit-container"></div>').appendTo(x);var u=g('<div class="remote-port-details-container"></div>').appendTo(x);var z=g("#remote-process-group-ports-id").text();var v=n.select("#id-"+z);if(d.canOperate(v)){var J=function(L){var M;if(L.connected===true){if(L.transmitting===true){M=(j.injector.get("$compile")(g('<md-switch style="margin:0px" class="md-primary enabled-active-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope));M.click()}else{if(L.exists===true){M=(j.injector.get("$compile")(g('<md-switch style="margin:0px" class="md-primary enabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope))}else{M=(j.injector.get("$compile")(g('<md-switch ng-disabled="true" style="margin:0px" class="md-primary disabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope))}}}else{if(L.transmitting===true){M=(j.injector.get("$compile")(g('<md-switch style="margin:0px" class="md-primary disabled-active-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope))}else{M=(j.injector.get("$compile")(g('<md-switch ng-disabled="true" style="margin:0px" class="md-primary disabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope))}}return M};var C=J(B);C.appendTo(I);if(d.canModify(v)){if(B.exists===true&&B.connected===true){var H=g('<button class="button edit-remote-port fa fa-pencil"></button>').click(function(){var P=g("#"+t+"-name").text();var O=g("#"+t+"-concurrent-tasks").text();var L=g("#"+t+"-compression").text()==="Yes";var N=g("#"+t+"-batch-count").text();var M=g("#"+t+"-batch-size").text();var Q=g("#"+t+"-batch-duration").text();m(B.id,P,O,L,N,M,Q,w)}).appendTo(I);if(B.transmitting===true){H.hide()}else{H.show()}}else{if(B.exists===false){g('<div class="remote-port-removed"/>').appendTo(I).qtip(g.extend({},c.config.tooltipConfig,{content:"This port has been removed."}))}}}if(c.isDefinedAndNotNull(C)){var K=function(){var L=g("#remote-process-group-ports-id").text();var O=n.select("#id-"+L).datum();var P=false;if(C.hasClass("enabled-inactive-transmission")){P=true}var N={revision:o.getRevision(O),disconnectedNodeAcknowledged:i.isDisconnectionAcknowledged(),state:P?"TRANSMITTING":"STOPPED"};var M="/output-ports/";if(w==="input"){M="/input-ports/"}g.ajax({type:"PUT",data:JSON.stringify(N),url:O.uri+M+encodeURIComponent(B.id)+"/run-status",dataType:"json",contentType:"application/json"}).done(function(Q){O.revision=Q.revision;var R=Q.remoteProcessGroupPort;if(R.exists===false){C.removeClass("enabled-active-transmission enabled-inactive-transmission").addClass("disabled-inactive-transmission").off("click");if(c.isDefinedAndNotNull(H)){H.hide()}}else{if(R.transmitting===true){C.removeClass("enabled-active-transmission enabled-inactive-transmission").addClass("enabled-active-transmission");if(c.isDefinedAndNotNull(H)){H.hide()}}else{C.removeClass("enabled-active-transmission enabled-inactive-transmission").addClass("enabled-inactive-transmission");if(c.isDefinedAndNotNull(H)){H.show()}}}}).fail(function(T,Q,R){var S=J(B);S.click(K);C.replaceWith(S);C=S;l.handleConfigurationUpdateAjaxError(T,Q,R)})};C.click(K)}}else{if(B.transmitting===true){(j.injector.get("$compile")(g('<md-switch style="margin:0px" class="md-primary enabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope)).appendTo(I)}else{(j.injector.get("$compile")(g('<md-switch ng-disabled="true" style="margin:0px" class="md-primary disabled-inactive-transmission" aria-label="Toggle port transmission"></md-switch>'))(j.rootScope)).appendTo(I)}}g('<div id="'+t+'-id" class="remote-port-id hidden"></div>').text(B.id).appendTo(u);g('<div id="'+t+'-name" class="remote-port-name ellipsis"></div>').text(B.name).appendTo(u);g('<div class="clear"></div>').appendTo(u);if(c.isBlank(B.comments)){g('<div class="remote-port-description unset">No description specified.</div>').appendTo(u)}else{g('<div class="remote-port-description"></div>').text(B.comments).appendTo(u)}g('<div class="clear"></div>').appendTo(u);var E=g('<div class="concurrent-task-container"></div>').appendTo(u);var y=g('<div class="setting-field"></div>').append(g('<div id="'+t+'-concurrent-tasks"></div>').text(B.concurrentlySchedulableTaskCount));g('<div><div class="setting-name">Concurrent tasks<div class="processor-setting concurrent-tasks-info fa fa-question-circle"></div></div></div>').append(y).appendTo(E).find("div.concurrent-tasks-info").qtip(g.extend({},c.config.tooltipConfig,{content:"The number of tasks that should be concurrently scheduled for this port."}));var q=g('<div class="compression-container"></div>').appendTo(u);var p="No";if(B.useCompression===true){p="Yes"}g('<div><div class="setting-name">Compressed</div><div class="setting-field"><div id="'+t+'-compression">'+p+"</div></div></div>").appendTo(q);g('<div class="clear"></div>').appendTo(u);var s=g('<div class="batch-settings-container"></div>').append(g('<div class="setting-name">Batch Settings<div class="processor-setting batch-settings-info fa fa-question-circle"></div></div>')).appendTo(u);s.find("div.batch-settings-info").qtip(g.extend({},nf.Common.config.tooltipConfig,{content:(w==="input"?"The batch settings to control how this NiFi sends data to the remote input port in a transaction. This NiFi will transfer as much flow files as they are queued in incoming relationships, until any of these limits is met. If none of these setting is specified, this NiFi uses 500 milliseconds batch duration by default.":"The batch settings to tell the remote NiFi how this NiFi prefers to receive data from the remote output port in a transaction. The remote NiFi will use these settings as a hint to control batch data transferring. However, actual behavior depends on the version of remote NiFi instance. Recent version of NiFi uses 5 seconds for batch duration if none of these setting is specified.")}));var G=a(B);var r=g('<div class="setting-field"></div>').append(g('<div id="'+t+'-batch-count"></div>').text(G.count));var F=g('<div class="setting-field"></div>').append(g('<div id="'+t+'-batch-size"></div>').text(G.size));var A=g('<div class="setting-field"></div>').append(g('<div id="'+t+'-batch-duration"></div>').text(G.duration));g('<div class="batch-setting"><div class="setting-name">Count<div class="processor-setting"></div></div></div>').append(r).appendTo(s);g('<div class="batch-setting"><div class="setting-name">Size<div class="processor-setting"></div></div></div>').append(F).appendTo(s);g('<div class="batch-setting"><div class="setting-name">Duration<div class="processor-setting"></div></div></div>').append(A).appendTo(s);g('<div class="clear"></div>').appendTo(x);x.find(".ellipsis").ellipsis();j.digest()};var m=function(s,t,v,w,q,u,r,p){g("#remote-port-id").text(s);g("#remote-port-type").text(p);var x="checkbox-unchecked";if(w===true){x="checkbox-checked"}g("#remote-port-use-compression").addClass(x);g("#remote-port-concurrent-tasks").val(v);g("#remote-port-batch-count").val(q==="No value set"?null:q);g("#remote-port-batch-size").val(u==="No value set"?null:u);g("#remote-port-batch-duration").val(r==="No value set"?null:r);g("#remote-port-name").text(t).ellipsis();g("#remote-port-configuration").modal("show")};return{init:function(){h();k()},showPorts:function(p){if(d.isRemoteProcessGroup(p)){var q=p.datum();g.ajax({type:"GET",url:q.uri,dataType:"json"}).done(function(t){var w=t.component;b.set(t);g("#remote-process-group-ports-id").text(w.id);g("#remote-process-group-ports-name").text(w.name);g("#remote-process-group-ports-urls").text(w.targetUris);var r=w.contents;if(c.isDefinedAndNotNull(r)){var A=[];var u=[];var s=function(C,B){var E=C.name.toUpperCase();var D=B.name.toUpperCase();return E<D?-1:(E>D?1:0)};var y=g("#remote-process-group-input-ports-container");g.each(r.inputPorts,function(C,B){if(B.connected===true){A.push(B)}else{u.push(B)}});A.sort(s);u.sort(s);g.each(A,function(C,B){f(y,B,"input")});g.each(u,function(C,B){f(y,B,"input")});if(c.isEmpty(A)&&c.isEmpty(u)){g('<div class="unset"></div>').text("No ports to display").appendTo(y)}var v=[];var z=[];var x=g("#remote-process-group-output-ports-container");g.each(r.outputPorts,function(B,C){if(C.connected===true){v.push(C)}else{z.push(C)}});v.sort(s);z.sort(s);g.each(v,function(B,C){f(x,C,"output")});g.each(z,function(B,C){f(x,C,"output")});if(c.isEmpty(v)&&c.isEmpty(z)){g('<div class="unset"></div>').text("No ports to display").appendTo(x)}}g("#remote-process-group-ports").modal("show")}).fail(l.handleAjaxError)}}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.CanvasUtils","nf.Connection"],function(f,j,i,c,e,g,k,d,h){return(nf.ConnectionConfiguration=b(f,j,i,c,e,g,k,d,h))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ConnectionConfiguration=b(require("jquery"),require("d3"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.Connection")))}else{nf.ConnectionConfiguration=b(a.$,a.d3,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.CanvasUtils,a.nf.Connection)}}}(this,function(v,F,c,E,i,r,f,J,N){var d;var q;var n;var h;var m=75;var I=200;var A={urls:{api:"../nifi-api",prioritizers:"../nifi-api/flow/prioritizers"}};var g=function(){F.select("path.connector").remove()};var u=function(){v("div.available-relationship").bind("change",function(){v("#connection-configuration").modal("refreshButtons")})};var b=function(O){if(J.isProcessor(O)){return v.Deferred(function(P){D(O).done(function(R){if(!E.isEmpty(R.relationships)){v.each(R.relationships,function(S,T){w(T.name)});u();var Q=v("#relationship-names").children("div");if(Q.length===1){Q.children("div.available-relationship").removeClass("checkbox-unchecked").addClass("checkbox-checked")}v("#connection-configuration").modal("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){return t().length===0},handler:{click:function(){B(t())}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){v("#connection-configuration").modal("hide")}}}]);P.resolve()}else{i.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+E.escapeHtml(R.name)+"' does not support any relationships."});k();P.reject()}}).fail(function(){P.reject()})}).promise()}else{return v.Deferred(function(Q){var P;if(J.isInputPort(O)){P=C(O)}else{if(J.isRemoteProcessGroup(O)){P=e(O)}else{if(J.isProcessGroup(O)){P=G(O)}else{P=l(O)}}}P.done(function(){v("#connection-configuration").modal("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){B()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){v("#connection-configuration").modal("hide")}}}]);Q.resolve()}).fail(function(){Q.reject()})}).promise()}};var C=function(O){return v.Deferred(function(Q){var P=O.datum();var R=P.permissions.canRead?P.component.name:P.id;v("#input-port-source").show();v("#input-port-source-name").text(R).attr("title",R);v("#connection-source-id").val(P.id);v("#connection-source-component-id").val(P.id);v("#connection-source-group-id").val(J.getGroupId());v("#connection-source-group-name").text(J.getGroupName());Q.resolve()}).promise()};var l=function(O){return v.Deferred(function(Q){var P=O.datum();v("#funnel-source").show();v("#connection-source-id").val(P.id);v("#connection-source-component-id").val(P.id);v("#connection-source-group-id").val(J.getGroupId());v("#connection-source-group-name").text(J.getGroupName());Q.resolve()}).promise()};var D=function(O){return v.Deferred(function(Q){var P=O.datum();var R=P.permissions.canRead?P.component.name:P.id;var S=P.permissions.canRead?E.substringAfterLast(P.component.type,"."):"Processor";v("#processor-source").show();v("#processor-source-name").text(R).attr("title",R);v("#processor-source-type").text(S).attr("title",S);v("#connection-source-id").val(P.id);v("#connection-source-component-id").val(P.id);v("#connection-source-group-id").val(J.getGroupId());v("#connection-source-group-name").text(J.getGroupName());v("#relationship-names-container").show();Q.resolve(P.component)})};var G=function(O){return v.Deferred(function(P){var Q=O.datum();v.ajax({type:"GET",url:A.urls.api+"/flow/process-groups/"+encodeURIComponent(Q.id),dataType:"json"}).done(function(R){var W=R.processGroupFlow;var V=R.permissions.canRead?W.breadcrumb.breadcrumb.name:W.id;var X=W.flow;var S=[];var U=0;v.each(X.outputPorts,function(Z,aa){if(aa.allowRemoteAccess){U++;return}if(aa.permissions.canRead&&aa.permissions.canWrite){var Y=aa.component;S.push({text:Y.name,value:Y.id,description:E.escapeHtml(Y.comments)})}});if(!E.isEmpty(S)){v("#output-port-source").show();S.sort(function(Z,Y){return Z.text.localeCompare(Y.text)});v("#output-port-options").combo({options:S,maxHeight:300,select:function(Y){v("#connection-source-id").val(Y.value)}});v("#connection-source-component-id").val(W.id);v("#connection-source-group-id").val(W.id);v("#connection-source-group-name").text(V);P.resolve()}else{var T="'"+E.escapeHtml(V)+"' does not have any local output ports.";if(E.isEmpty(X.outputPorts)===false&&X.outputPorts.length>U){T="Not authorized for any local output ports in '"+E.escapeHtml(V)+"'."}i.showOkDialog({headerText:"Connection Configuration",dialogContent:T});k();P.reject()}}).fail(function(T,R,S){c.handleAjaxError(T,R,S);P.reject()})}).promise()};var e=function(O){return v.Deferred(function(P){var Q=O.datum();v.ajax({type:"GET",url:Q.uri,dataType:"json"}).done(function(R){var T=R.component;var U=T.contents;if(!E.isEmpty(U.outputPorts)){v("#output-port-source").show();var S=[];v.each(U.outputPorts,function(V,W){S.push({text:W.name,value:W.id,disabled:W.exists===false,description:E.escapeHtml(W.comments)})});S.sort(function(W,V){return W.text.localeCompare(V.text)});v("#output-port-options").combo({options:S,maxHeight:300,select:function(V){v("#connection-source-id").val(V.value)}});v("#connection-source-component-id").val(T.id);v("#connection-source-group div.setting-name").text("Within Remote Group");v("#connection-remote-source-url").text(T.targetUri).show();v("#connection-source-group-id").val(T.id);v("#connection-source-group-name").text(T.name);P.resolve()}else{i.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+E.escapeHtml(T.name)+"' does not have any output ports."});k();P.reject()}}).fail(function(T,R,S){c.handleAjaxError(T,R,S);P.reject()})}).promise()};var a=function(O){if(J.isOutputPort(O)){return o(O)}else{if(J.isProcessor(O)){return z(O)}else{if(J.isRemoteProcessGroup(O)){return K(O)}else{if(J.isFunnel(O)){return s(O)}else{return M(O)}}}}};var o=function(O){return v.Deferred(function(P){var R=O.datum();var Q=R.permissions.canRead?R.component.name:R.id;v("#output-port-destination").show();v("#output-port-destination-name").text(Q).attr("title",Q);v("#connection-destination-id").val(R.id);v("#connection-destination-component-id").val(R.id);v("#connection-destination-group-id").val(J.getGroupId());v("#connection-destination-group-name").text(J.getGroupName());P.resolve()}).promise()};var s=function(O){return v.Deferred(function(Q){var P=O.datum();v("#funnel-destination").show();v("#connection-destination-id").val(P.id);v("#connection-destination-component-id").val(P.id);v("#connection-destination-group-id").val(J.getGroupId());v("#connection-destination-group-name").text(J.getGroupName());Q.resolve()}).promise()};var z=function(O){return v.Deferred(function(Q){var P=O.datum();var R=P.permissions.canRead?P.component.name:P.id;var S=P.permissions.canRead?E.substringAfterLast(P.component.type,"."):"Processor";v("#processor-destination").show();v("#processor-destination-name").text(R).attr("title",R);v("#processor-destination-type").text(S).attr("title",S);v("#connection-destination-id").val(P.id);v("#connection-destination-component-id").val(P.id);v("#connection-destination-group-id").val(J.getGroupId());v("#connection-destination-group-name").text(J.getGroupName());Q.resolve()}).promise()};var M=function(O){return v.Deferred(function(P){var Q=O.datum();v.ajax({type:"GET",url:A.urls.api+"/flow/process-groups/"+encodeURIComponent(Q.id),dataType:"json"}).done(function(R){var U=R.processGroupFlow;var T=R.permissions.canRead?U.breadcrumb.breadcrumb.name:U.id;var V=U.flow;var S=[];v.each(V.inputPorts,function(X,W){if(!W.allowRemoteAccess){S.push({text:W.permissions.canRead?W.component.name:W.id,value:W.id,description:W.permissions.canRead?E.escapeHtml(W.component.comments):null})}});if(!E.isEmpty(S)){v("#input-port-destination").show();S.sort(function(X,W){return X.text.localeCompare(W.text)});v("#input-port-options").combo({options:S,maxHeight:300,select:function(W){v("#connection-destination-id").val(W.value)}});v("#connection-destination-component-id").val(U.id);v("#connection-destination-group-id").val(U.id);v("#connection-destination-group-name").text(T);P.resolve()}else{i.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+E.escapeHtml(T)+"' does not have any local input ports."});k();P.reject()}}).fail(function(T,R,S){c.handleAjaxError(T,R,S);P.reject()})}).promise()};var K=function(O,P){return v.Deferred(function(Q){var R=O.datum();v.ajax({type:"GET",url:R.uri,dataType:"json"}).done(function(S){var U=S.component;var V=U.contents;if(!E.isEmpty(V.inputPorts)){v("#input-port-destination").show();var T=[];v.each(V.inputPorts,function(X,W){T.push({text:W.name,value:W.id,disabled:W.exists===false,description:E.escapeHtml(W.comments)})});T.sort(function(X,W){return X.text.localeCompare(W.text)});v("#input-port-options").combo({options:T,maxHeight:300,select:function(W){v("#connection-destination-id").val(W.value)}});v("#connection-destination-component-id").val(U.id);v("#connection-destination-group div.setting-name").text("Within Remote Group");v("#connection-remote-destination-url").text(U.targetUri).show();v("#connection-destination-group-id").val(U.id);v("#connection-destination-group-name").text(U.name);Q.resolve()}else{i.showOkDialog({headerText:"Connection Configuration",dialogContent:"'"+E.escapeHtml(U.name)+"' does not have any input ports."});k();Q.reject()}}).fail(function(U,S,T){c.handleAjaxError(U,S,T);Q.reject()})}).promise()};var L=function(O){return v.Deferred(function(Q){var R=O.datum();var P=R.permissions.canRead?R.component.name:R.id;v("#read-only-output-port-source").show();v("#connection-source-component-id").val(R.id);v("#connection-source-group-id").val(R.id);v("#connection-source-group-name").text(P);if(J.isRemoteProcessGroup(O)){v("#connection-source-group div.setting-name").text("Within Remote Group");if(R.permissions.canRead){v("#connection-remote-source-url").text(R.component.targetUri).show()}}Q.resolve()}).promise()};var j=function(O){if(J.isProcessor(O)){return D(O)}else{if(J.isInputPort(O)){return C(O)}else{if(J.isFunnel(O)){return l(O)}else{return L(O)}}}};var x=function(O,P){if(J.isProcessor(O)){return z(O)}else{if(J.isOutputPort(O)){return o(O)}else{if(J.isRemoteProcessGroup(O)){return K(O,P)}else{if(J.isFunnel(O)){return s(O)}else{return M(O)}}}}};var w=function(P){var O=v('<div class="relationship-name nf-checkbox-label ellipsis"></div>').text(P);var Q=v('<span class="relationship-name-value hidden"></span>').text(P);return v('<div class="available-relationship-container"><div class="available-relationship nf-checkbox checkbox-unchecked"></div></div>').append(O).append(Q).appendTo("#relationship-names")};var B=function(Q){var an=v("#connection-source-id").val();var ak=v("#connection-destination-id").val();var ar=v("#connection-source-component-id").val();var ah=F.select("#id-"+ar);var al=v("#connection-destination-component-id").val();var Z=F.select("#id-"+al);var aA=ah.datum();var aa=Z.datum();var R=[];if(ar===al){var ag={x:aA.position.x+(aA.dimensions.width),y:aA.position.y+(aA.dimensions.height/2)};var am=N.config.selfLoopXOffset;var ao=N.config.selfLoopYOffset;R.push({x:(ag.x+am),y:(ag.y-ao)});R.push({x:(ag.x+am),y:(ag.y+ao)})}else{var ay=[];var aq=N.getComponentConnections(ar);v.each(aq,function(aD,aG){var aE=J.getConnectionSourceComponentId(aG);var aF=J.getConnectionDestinationComponentId(aG);if((aE===ar&&aF===al)||(aF===ar&&aE===al)){ay.push(aG)}});if(ay.length>0){var S=false;v.each(ay,function(aD,aE){if(E.isEmpty(aE.bends)){S=true;return false}});if(S===true){var ai=[aA.position.x+(aA.dimensions.width/2),aA.position.y+(aA.dimensions.height/2)];var P=[aa.position.x+(aa.dimensions.width/2),aa.position.y+(aa.dimensions.height/2)];var af=((ai[1]-P[1])/(ai[0]-P[0]));var aw=af<=1&&af>=-1;var ap=function(aD,aF){var aE=false;v.each(ay,function(aG,aH){if(!E.isEmpty(aH.bends)){if(aw){if(aH.bends[0].y===aF){aE=true;return false}}else{if(aH.bends[0].x===aD){aE=true;return false}}}});return aE};var W=(ai[0]+P[0])/2;var ac=(ai[1]+P[1])/2;var av=aw?0:I;var ae=aw?m:0;var ax=false;while(ax===false){if(ap(W-av,ac-ae)===false){R.push({x:(W-av),y:(ac-ae)});ax=true}else{if(ap(W+av,ac+ae)===false){R.push({x:(W+av),y:(ac+ae)});ax=true}}if(aw){ae+=m}else{av+=I}}}}}var U=v("#connection-source-group-id").val();var O=v("#connection-destination-group-id").val();var aB=J.getConnectableTypeForSource(ah);var ad=J.getConnectableTypeForDestination(Z);var X=v("#connection-name").val();var T=v("#flow-file-expiration").val();var az=v("#back-pressure-object-threshold").val();var aC=v("#back-pressure-data-size-threshold").val();var aj=v("#prioritizer-selected").sortable("toArray");var ab=v("#load-balance-strategy-combo").combo("getSelectedOption").value;var Y="DO_NOT_LOAD_BALANCE"!==ab;var V=Y&&"PARTITION_BY_ATTRIBUTE"===ab?v("#load-balance-partition-attribute").val():"";var au=Y?v("#load-balance-compression-combo").combo("getSelectedOption").value:"DO_NOT_COMPRESS";if(H()){var at={revision:f.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:r.isDisconnectionAcknowledged(),component:{name:X,source:{id:an,groupId:U,type:aB},destination:{id:ak,groupId:O,type:ad},selectedRelationships:Q,flowFileExpiration:T,backPressureDataSizeThreshold:aC,backPressureObjectThreshold:az,bends:R,prioritizers:aj,loadBalanceStrategy:ab,loadBalancePartitionAttribute:V,loadBalanceCompression:au}};v.ajax({type:"POST",url:A.urls.api+"/process-groups/"+encodeURIComponent(J.getGroupId())+"/connections",data:JSON.stringify(at),dataType:"json",contentType:"application/json"}).done(function(aD){q.add({connections:[aD]},{selectAll:true});v("#connection-configuration").modal("hide");J.reloadConnectionSourceAndDestination(ar,al);q.updateVisibility();d.refresh()}).fail(c.handleConfigurationUpdateAjaxError)}};var y=function(ad){var V=v("#connection-id").text();var P=v("#connection-uri").val();var ab=v("#connection-source-component-id").val();var O=v("#connection-destination-component-id").val();var Z=F.select("#id-"+O);var S=J.getConnectableTypeForDestination(Z);var ae=v("#connection-destination-id").val();var ac=v("#connection-destination-group-id").val();var Y=v("#connection-name").val();var X=v("#flow-file-expiration").val();var Q=v("#back-pressure-object-threshold").val();var af=v("#back-pressure-data-size-threshold").val();var ah=v("#prioritizer-selected").sortable("toArray");var ag=v("#load-balance-strategy-combo").combo("getSelectedOption").value;var T="DO_NOT_LOAD_BALANCE"!==ag;var W=T&&"PARTITION_BY_ATTRIBUTE"===ag?v("#load-balance-partition-attribute").val():"";var U=T?v("#load-balance-compression-combo").combo("getSelectedOption").value:"DO_NOT_COMPRESS";if(H()){var aa=N.get(V);var R={revision:f.getRevision(aa),disconnectedNodeAcknowledged:r.isDisconnectionAcknowledged(),component:{id:V,name:Y,destination:{id:ae,groupId:ac,type:S},selectedRelationships:ad,flowFileExpiration:X,backPressureDataSizeThreshold:af,backPressureObjectThreshold:Q,prioritizers:ah,loadBalanceStrategy:ag,loadBalancePartitionAttribute:W,loadBalanceCompression:U}};return v.ajax({type:"PUT",url:P,data:JSON.stringify(R),dataType:"json",contentType:"application/json"}).done(function(ai){v("#connection-configuration").modal("hide");N.set(ai);J.reloadConnectionSourceAndDestination(ab,O)}).fail(c.handleConfigurationUpdateAjaxError)}else{return v.Deferred(function(ai){ai.reject()}).promise()}};var t=function(){var P=v("#relationship-names");var O=[];v.each(P.children(),function(Q,T){var S=v(T);var R=S.children("div.available-relationship");if(R.hasClass("checkbox-checked")){O.push(S.children("span.relationship-name-value").text())}});return O};var H=function(){var O=[];if(E.isBlank(v("#flow-file-expiration").val())){O.push("File expiration must be specified")}if(!v.isNumeric(v("#back-pressure-object-threshold").val())){O.push("Back pressure object threshold must be an integer value")}if(E.isBlank(v("#back-pressure-data-size-threshold").val())){O.push("Back pressure data size threshold must be specified")}if(v("#load-balance-strategy-combo").combo("getSelectedOption").value==="PARTITION_BY_ATTRIBUTE"&&E.isBlank(v("#load-balance-partition-attribute").val())){O.push('Cannot set Load Balance Strategy to "Partition by attribute" without providing a partitioning "Attribute Name"')}if(O.length>0){i.showOkDialog({headerText:"Configuration Error",dialogContent:E.formatUnorderedList(O)});return false}else{return true}};var k=function(){var Q=v("#prioritizer-selected");var O=v("#prioritizer-available");Q.children().detach().appendTo(O);var P=O.children("li").get();P.sort(function(S,R){var U=v(S).text().toUpperCase();var T=v(R).text().toUpperCase();return(U<T)?-1:(U>T)?1:0});v.each(P,function(){v(this).detach()});v.each(P,function(){v(this).appendTo(O)});v("#connection-name").val("");v("#relationship-names").css("border-width","0").empty();v("#relationship-names-container").hide();E.clearField("connection-id");v("#processor-source").hide();v("#input-port-source").hide();v("#output-port-source").hide();v("#read-only-output-port-source").hide();v("#funnel-source").hide();v("#processor-destination").hide();v("#input-port-destination").hide();v("#output-port-destination").hide();v("#funnel-destination").hide();v("#connection-source-id").val("");v("#connection-source-component-id").val("");v("#connection-source-group-id").val("");v("#connection-destination-id").val("");v("#connection-destination-component-id").val("");v("#connection-destination-group-id").val("");v("#output-port-options").empty();v("#input-port-options").empty();v("#load-balance-strategy-combo").combo("setSelectedOption",E.loadBalanceStrategyOptions[0]);v("#load-balance-partition-attribute").val("");v("#load-balance-compression-combo").combo("setSelectedOption",E.loadBalanceCompressionOptions[0]);g()};var p={init:function(R,O,Q,P){d=R;q=O;n=Q;h=P;v("#relationship-names-container").hide();v("#connection-configuration").modal({scrollableContentStyle:"scrollable",headerText:"Configure Connection",handler:{close:function(){k()},open:function(){E.toggleScrollable(v("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});v("#connection-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Details",tabContentId:"connection-details-tab-content"},{name:"Settings",tabContentId:"connection-settings-tab-content"}]});v("#load-balance-strategy-combo").combo({options:E.loadBalanceStrategyOptions,select:function(S){if(S.value==="PARTITION_BY_ATTRIBUTE"){v("#load-balance-partition-attribute-setting-separator").show();v("#load-balance-partition-attribute-setting").show()}else{v("#load-balance-partition-attribute-setting-separator").hide();v("#load-balance-partition-attribute-setting").hide()}if(S.value==="DO_NOT_LOAD_BALANCE"){v("#load-balance-compression-setting").hide()}else{v("#load-balance-compression-setting").show()}}});v("#load-balance-compression-combo").combo({options:E.loadBalanceCompressionOptions});v.ajax({type:"GET",url:A.urls.prioritizers,dataType:"json"}).done(function(S){v.each(S.prioritizerTypes,function(T,U){p.addAvailablePrioritizer("#prioritizer-available",U)});v("#prioritizer-available, #prioritizer-selected").sortable({containment:v("#connection-settings-tab-content").find(".settings-right"),connectWith:"ul",placeholder:"ui-state-highlight",scroll:true,opacity:0.6});v("#prioritizer-available, #prioritizer-selected").disableSelection()}).fail(c.handleAjaxError)},addAvailablePrioritizer:function(T,R){var Q=R.type;var P=E.substringAfterLast(Q,".");var S=v(T);var O=v("<li></li>").append(v('<span style="float: left;"></span>').text(P)).attr("id",Q).addClass("ui-state-default").appendTo(S);if(E.isDefinedAndNotNull(R.description)){v('<div class="fa fa-question-circle"></div>').appendTo(O).qtip(v.extend({content:E.escapeHtml(R.description)},E.config.tooltipConfig))}},createConnection:function(Q,R){var P=F.select("#id-"+Q);var O=F.select("#id-"+R);if(P.empty()||O.empty()){return}v("#connection-source-group div.setting-name").text("Within Group");v("#connection-destination-group div.setting-name").text("Within Group");v("#connection-remote-source-url").hide();v("#connection-remote-destination-url").hide();v.when(b(P),a(O)).done(function(){v("#flow-file-expiration").val("0 sec");v("#back-pressure-object-threshold").val(n);v("#back-pressure-data-size-threshold").val(h);v("#connection-configuration-tabs").find("li:first").click();v("#connection-configuration").modal("setHeaderText","Create Connection").modal("show");v("#connection-configuration div.relationship-name").ellipsis();E.populateField("connection-id",null);var S=v("#relationship-names");if(S.is(":visible")&&S.get(0).scrollHeight>Math.round(S.innerHeight())){S.css("border-width","1px")}}).fail(function(){g()})},showConfiguration:function(P,O){return v.Deferred(function(R){var S=P.datum();var Q=S.component;var V=J.getConnectionSourceComponentId(S);var T=F.select("#id-"+V);if(E.isUndefinedOrNull(O)){var U=J.getConnectionDestinationComponentId(S);O=F.select("#id-"+U)}v("#connection-source-group div.setting-name").text("Within Group");v("#connection-destination-group div.setting-name").text("Within Group");v("#connection-remote-source-url").hide();v("#connection-remote-destination-url").hide();v.when(j(T),x(O,Q.destination)).done(function(){var Y=Q.availableRelationships;var X=Q.selectedRelationships;if(E.isDefinedAndNotNull(Y)||E.isDefinedAndNotNull(X)){v.each(Y,function(ab,aa){w(aa)});u();v.each(X,function(ac,aa){if(v.inArray(aa,Y)===-1){var ad=w(aa);v(ad).children("div.relationship-name").addClass("undefined")}var ab=v("#relationship-names").children("div");v.each(ab,function(ae,ag){var af=v(ag).children("span.relationship-name-value");if(af.text()===aa){v(ag).children("div.available-relationship").removeClass("checkbox-unchecked").addClass("checkbox-checked")}})})}if(J.isProcessGroup(T)||J.isRemoteProcessGroup(T)){v("#connection-source-id").val(Q.source.id);v("#read-only-output-port-name").text(Q.source.name).attr("title",Q.source.name)}if(J.isProcessGroup(O)||J.isRemoteProcessGroup(O)){var W=O.datum();if(Q.destination.groupId===W.id){v("#input-port-options").combo("setSelectedOption",{value:Q.destination.id})}}v("#connection-name").val(Q.name);v("#flow-file-expiration").val(Q.flowFileExpiration);v("#back-pressure-object-threshold").val(Q.backPressureObjectThreshold);v("#back-pressure-data-size-threshold").val(Q.backPressureDataSizeThreshold);v("#load-balance-strategy-combo").combo("setSelectedOption",{value:Q.loadBalanceStrategy});v("#load-balance-compression-combo").combo("setSelectedOption",{value:Q.loadBalanceCompression});v("#load-balance-partition-attribute").val(Q.loadBalancePartitionAttribute);E.populateField("connection-id",Q.id);v.each(Q.prioritizers,function(aa,ab){v("#prioritizer-available").children('li[id="'+ab+'"]').detach().appendTo("#prioritizer-selected")});v("#connection-uri").val(S.uri);v("#connection-configuration").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){if(J.isProcessor(T)){return t().length===0}return false},handler:{click:function(){if(J.isProcessor(T)){y(t()).done(function(){R.resolve()}).fail(function(){R.reject()})}else{y(undefined).done(function(){R.resolve()}).fail(function(){R.reject()})}}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){v("#connection-configuration").modal("hide");R.reject()}}}]);v("#connection-configuration").modal("setHeaderText","Configure Connection").modal("show");v("#connection-configuration div.relationship-name").ellipsis();var Z=v("#relationship-names");if(Z.is(":visible")&&Z.get(0).scrollHeight>Math.round(Z.innerHeight())){Z.css("border-width","1px")}}).fail(function(){R.reject()})}).promise()}};return p}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common","nf.ErrorHandler"],function(c,d,e){return(nf.ConnectionDetails=b(c,d,e))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ConnectionDetails=b(require("jquery"),require("nf.Common"),require("nf.ErrorHandler")))}else{nf.ConnectionDetails=b(a.$,a.nf.Common,a.nf.ErrorHandler)}}}(this,function(d,b,g){var j=function(o,q,p){if(p.type==="PROCESSOR"){return k(o,q,p)}else{if(p.type==="FUNNEL"){return l(o,q,p)}else{if(p.type==="REMOTE_OUTPUT_PORT"){return f(o,q,p)}else{return n(o,q,p)}}}};var k=function(o,q,p){return d.Deferred(function(r){d.ajax({type:"GET",url:"../nifi-api/processors/"+encodeURIComponent(p.id),dataType:"json"}).done(function(s){var t=s.component;var u=d('<div class="label"></div>').text(t.name).addClass("ellipsis").attr("title",t.name);var v=d("<div></div>").text(b.substringAfterLast(t.type,".")).addClass("ellipsis").attr("title",b.substringAfterLast(t.type,"."));d("#read-only-connection-source-label").text("From processor");d("#read-only-connection-source").append(u).append(v);d("#read-only-connection-source-group-name").text(q);r.resolve()}).fail(function(w,s,t){if(w.status===403){var u=d('<div class="label"></div>').text(p.name).addClass("ellipsis").attr("title",p.name);var v=d("<div></div>").text("Processor").addClass("ellipsis").attr("title","Processor");d("#read-only-connection-source-label").text("From processor");d("#read-only-connection-source").append(u).append(v);d("#read-only-connection-source-group-name").text(q);r.resolve()}else{r.reject(w,s,t)}})}).promise()};var l=function(o,q,p){return d.Deferred(function(r){d("#read-only-connection-source-label").text("From funnel");d("#read-only-connection-source").text("funnel").attr("title","funnel");d("#read-only-connection-source-group-name").text(q);r.resolve()}).promise()};var f=function(o,q,p){return d.Deferred(function(r){d.ajax({type:"GET",url:"../nifi-api/remote-process-groups/"+encodeURIComponent(p.groupId),dataType:"json"}).done(function(s){var t=s.component;d("#read-only-connection-source-label").text("From output");d("#read-only-connection-source").text(p.name).attr("title",p.name);d("#read-only-connection-source-group-name").text(t.name);d("#read-only-connection-source-group div.setting-name").text("Within Remote Group");d("#read-only-connection-remote-source-url").text(t.targetUri).show();r.resolve()}).fail(function(u,s,t){if(u.status===403){d("#read-only-connection-source-label").text("From output");d("#read-only-connection-source").text(p.name).attr("title",p.name);d("#read-only-connection-source-group-name").text(p.groupId);d("#read-only-connection-source-group div.setting-name").text("Within Remote Group");r.resolve()}else{r.reject(u,s,t)}})}).promise()};var n=function(o,q,p){return d.Deferred(function(r){if(o===p.groupId){d("#read-only-connection-source-label").text("From input");d("#read-only-connection-source").text(p.name).attr("title",p.name);d("#read-only-connection-source-group-name").text(q);r.resolve()}else{d.ajax({type:"GET",url:"../nifi-api/process-groups/"+encodeURIComponent(p.groupId),dataType:"json"}).done(function(s){var t=s.component;d("#read-only-connection-source-label").text("From output");d("#read-only-connection-source").text(p.name).attr("title",p.name);d("#read-only-connection-source-group-name").text(t.name);r.resolve()}).fail(function(u,s,t){if(u.status===403){d("#read-only-connection-source-label").text("From output");d("#read-only-connection-source").text(p.name).attr("title",p.name);d("#read-only-connection-source-group-name").text(p.groupId);r.resolve()}else{r.reject(u,s,t)}})}}).promise()};var e=function(p,q,o){if(o.type==="PROCESSOR"){return a(p,q,o)}else{if(o.type==="FUNNEL"){return m(p,q,o)}else{if(o.type==="REMOTE_INPUT_PORT"){return i(p,q,o)}else{return c(p,q,o)}}}};var a=function(p,q,o){return d.Deferred(function(r){d.ajax({type:"GET",url:"../nifi-api/processors/"+encodeURIComponent(o.id),dataType:"json"}).done(function(s){var t=s.component;var u=d('<div class="label"></div>').text(t.name).addClass("ellipsis").attr("title",t.name);var v=d("<div></div>").text(b.substringAfterLast(t.type,".")).addClass("ellipsis").attr("title",b.substringAfterLast(t.type,"."));d("#read-only-connection-target-label").text("To processor");d("#read-only-connection-target").append(u).append(v);d("#read-only-connection-target-group-name").text(q);r.resolve()}).fail(function(w,s,t){if(w.status===403){var u=d('<div class="label"></div>').text(o.name).addClass("ellipsis").attr("title",o.name);var v=d("<div></div>").text("Processor").addClass("ellipsis").attr("title","Processor");d("#read-only-connection-target-label").text("To processor");d("#read-only-connection-target").append(u).append(v);d("#read-only-connection-target-group-name").text(q);r.resolve()}else{r.reject(w,s,t)}})}).promise()};var m=function(p,q,o){return d.Deferred(function(r){d("#read-only-connection-target-label").text("To funnel");d("#read-only-connection-target").text("funnel").attr("title","funnel");d("#read-only-connection-target-group-name").text(q);r.resolve()}).promise()};var i=function(p,q,o){return d.Deferred(function(r){d.ajax({type:"GET",url:"../nifi-api/remote-process-groups/"+encodeURIComponent(o.groupId),dataType:"json"}).done(function(s){var t=s.component;d("#read-only-connection-target-label").text("To input");d("#read-only-connection-target").text(o.name).attr("title",o.name);d("#read-only-connection-target-group-name").text(t.name);d("#read-only-connection-target-group div.setting-name").text("Within Remote Group");d("#read-only-connection-remote-target-url").text(t.targetUri).show();r.resolve()}).fail(function(u,s,t){if(u.status===403){d("#read-only-connection-target-label").text("To input");d("#read-only-connection-target").text(o.name).attr("title",o.name);d("#read-only-connection-target-group-name").text(o.groupId);d("#read-only-connection-target-group div.setting-name").text("Within Remote Group");r.resolve()}else{r.reject(u,s,t)}})}).promise()};var c=function(p,q,o){return d.Deferred(function(r){if(p===o.groupId){d("#read-only-connection-target-label").text("To output");d("#read-only-connection-target").text(o.name).attr("title",o.name);d("#read-only-connection-target-group-name").text(q);r.resolve()}else{d.ajax({type:"GET",url:"../nifi-api/process-groups/"+encodeURIComponent(o.groupId),dataType:"json"}).done(function(s){var t=s.component;d("#read-only-connection-target-label").text("To input");d("#read-only-connection-target").text(o.name).attr("title",o.name);d("#read-only-connection-target-group-name").text(t.name);r.resolve()}).fail(function(u,s,t){if(u.status===403){d("#read-only-connection-target-label").text("To input");d("#read-only-connection-target").text(o.name).attr("title",o.name);d("#read-only-connection-target-group-name").text(o.groupId);r.resolve()}else{r.reject(u,s,t)}})}}).promise()};var h=function(o){d('<div class="available-relationship-container"></div>').append(d('<div class="relationship-name"></div>').text(o)).appendTo("#read-only-relationship-names")};return{init:function(){d("#connection-details-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Details",tabContentId:"read-only-connection-details-tab-content"},{name:"Settings",tabContentId:"read-only-connection-settings-tab-content"}]});d("#connection-details").modal({headerText:"Connection Details",scrollableContentStyle:"scrollable",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){d("#connection-details").modal("hide")}}}],handler:{close:function(){d("#read-only-relationship-names").empty();b.clearField("read-only-connection-name");b.clearField("read-only-connection-id");d("#read-only-connection-source-label").text("");d("#read-only-connection-source").empty();d("#read-only-connection-source-group div.setting-name").text("Within Group");d("#read-only-connection-source-group-name").text("");d("#read-only-connection-remote-source-url").text("").hide();d("#read-only-connection-target-label").text("");d("#read-only-connection-target").empty();d("#read-only-connection-target-group div.setting-name").text("Within Group");d("#read-only-connection-target-group-name").text("");d("#read-only-connection-remote-target-url").text("").hide();d("#read-only-relationship-names").css("border-width","0").empty();b.clearField("read-only-flow-file-expiration");b.clearField("read-only-back-pressure-object-threshold");b.clearField("read-only-back-pressure-data-size-threshold");b.clearField("read-only-load-balance-strategy");b.clearField("read-only-load-balance-partition-attribute");b.clearField("read-only-load-balance-compression");d("#read-only-prioritizers").empty()},open:function(){b.toggleScrollable(d("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}})},showDetails:function(p,r){var q=d.ajax({type:"GET",url:"../nifi-api/flow/process-groups/"+encodeURIComponent(p),dataType:"json"});var o=d.ajax({type:"GET",url:"../nifi-api/connections/"+encodeURIComponent(r),dataType:"json"});d.when(q,o).done(function(w,u){var v=w[0];var x=u[0];if(x.permissions.canRead){var t=x.component;var z=v.permissions.canRead?v.processGroupFlow.breadcrumb.breadcrumb.name:v.processGroupFlow.id;var y=j(v.id,z,t.source);var s=e(v.id,z,t.destination);d.when(y,s).done(function(){var B=t.availableRelationships;var A=t.selectedRelationships;if(b.isDefinedAndNotNull(B)||b.isDefinedAndNotNull(A)){d.each(B,function(G,F){h(F)});d.each(A,function(H,F){if(d.inArray(F,B)===-1){var I=h(F);d(I).children("div.relationship-name").addClass("undefined")}var G=d("#read-only-relationship-names").children("div");d.each(G.children("div.relationship-name"),function(K,J){var L=d(J);if(L.text()===F){L.css("font-weight","bold")}})});d("#selected-relationship-text").show();d("#read-only-relationship-names-container").show()}else{d("#selected-relationship-text").hide();d("#read-only-relationship-names-container").hide()}b.populateField("read-only-connection-name",t.name);b.populateField("read-only-connection-id",t.id);b.populateField("read-only-flow-file-expiration",t.flowFileExpiration);b.populateField("read-only-back-pressure-object-threshold",t.backPressureObjectThreshold);b.populateField("read-only-back-pressure-data-size-threshold",t.backPressureDataSizeThreshold);b.populateField("read-only-load-balance-strategy",b.getComboOptionText(b.loadBalanceStrategyOptions,t.loadBalanceStrategy));b.populateField("read-only-load-balance-partition-attribute",t.loadBalancePartitionAttribute);b.populateField("read-only-load-balance-compression",b.getComboOptionText(b.loadBalanceCompressionOptions,t.loadBalanceCompression));if(t.loadBalanceStrategy==="PARTITION_BY_ATTRIBUTE"){d("#read-only-load-balance-partition-attribute-setting").show()}else{d("#read-only-load-balance-partition-attribute-setting").hide()}if(t.loadBalanceStrategy==="DO_NOT_LOAD_BALANCE"){d("#read-only-load-balance-compression-setting").hide()}else{d("#read-only-load-balance-compression-setting").show()}if(b.isDefinedAndNotNull(t.prioritizers)&&t.prioritizers.length>0){var E=d("<ol></ol>").css("list-style","decimal inside none");d.each(t.prioritizers,function(F,G){E.append(d("<li></li>").text(b.substringAfterLast(G,".")))});d("#read-only-prioritizers").append(E)}else{var C=d('<span class="unset">No value set</span>');d("#read-only-prioritizers").append(C)}d("#connection-details-tabs").find("li:first").click();d("#connection-details").modal("show");var D=d("#read-only-relationship-names");if(D.is(":visible")&&D.get(0).scrollHeight>Math.round(D.innerHeight())){D.css("border-width","1px")}}).fail(g.handleAjaxError)}}).fail(g.handleAjaxError)}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.CanvasUtils","nf.ng.Bridge"],function(f,e,g,d,c){return(nf.ContextMenu=b(f,e,g,d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ContextMenu=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.CanvasUtils"),require("nf.ng.Bridge")))}else{nf.ContextMenu=b(a.$,a.d3,a.nf.Common,a.nf.CanvasUtils,a.nf.ng.Bridge)}}}(this,function(H,U,Q,Z,q){var A;var K=function(ae){return Z.getParentGroupId()!==null&&ae.empty()};var X=function(ae){if(ae.size()==1&&Z.isProcessor(ae)&&Z.canModify(ae)&&(Z.isConfigurable(ae)||b(ae))){return true}else{return Z.isConfigurable(ae)}};var ac=function(ae){return ae.empty()||Z.isProcessGroup(ae)};var n=function(ae){var af;if(ae.empty()){af=Z.getParameterContext()}else{if(Z.isProcessGroup(ae)){var ag=ae.datum();af=ag.parameterContext}}if(Q.isDefinedAndNotNull(af)){return Q.isDefinedAndNotNull(af)&&af.permissions.canRead===true}return false};var I=function(ae){if(ae.size()==1&&Z.isProcessor(ae)&&Z.canModify(ae)){return !X(ae)}else{return Z.hasDetails(ae)}};var v=function(ae){return Z.areDeletable(ae)};var R=function(ae){return Z.canWriteCurrentGroup()&&(ae.empty()||Z.canRead(ae))};var d=function(ae){return Z.canWriteCurrentGroup()&&ae.empty()};var Y=function(ae){return Z.getComponentByType("Connection").isDisconnected(ae)&&Z.canModify(ae)};var J=function(ae){return Z.canEnable(ae)};var D=function(ae){return Z.canDisable(ae)};var F=function(ae){return Z.isManagedAuthorizer()&&Z.canManagePolicies(ae)};var r=function(ae){return Z.areRunnable(ae)};var N=function(ae){return Z.areStoppable(ae)};var b=function(ag){if(ag.size()!==1){return false}if(Z.canOperate(ag)===false){return false}var ae=false;if(Z.isProcessor(ag)){var ah=ag.datum();var af=ah.status.aggregateSnapshot;ae=af.runStatus!=="Running"&&af.activeThreadCount>0}return ae};var m=function(ae){if(ae.size()!==1){return false}return Z.isProcessor(ae)||Z.isProcessGroup(ae)||Z.isRemoteProcessGroup(ae)||Z.isConnection(ae)};var O=function(ae){if(ae.size()!==1){return false}if(Z.canRead(ae)===false){return false}return Z.isProcessor(ae)};var w=function(ae){return ae.size()===1&&!Z.isConnection(ae)};var i=function(ae){return Z.isCopyable(ae)};var e=function(ae){return Z.isPastable()};var V=function(ae){return ae.empty()};var z=function(ae){if(ae.size()!==1){return false}if(Z.canModify(ae)===false){return false}return Z.isConnection(ae)};var s=function(ae){return Z.canAlign(ae)};var y=function(ae){return Z.isColorable(ae)};var ab=function(ae){if(ae.size()!==1){return false}return Z.isConnection(ae)};var p=function(ae){if(ae.size()!==1){return false}return Z.isFunnel(ae)||Z.isProcessor(ae)||Z.isProcessGroup(ae)||Z.isRemoteProcessGroup(ae)||Z.isInputPort(ae)||(Z.isOutputPort(ae)&&Z.getParentGroupId()!==null)};var u=function(ae){if(ae.size()!==1){return false}return Z.isFunnel(ae)||Z.isProcessor(ae)||Z.isProcessGroup(ae)||Z.isRemoteProcessGroup(ae)||Z.isOutputPort(ae)||(Z.isInputPort(ae)&&Z.getParentGroupId()!==null)};var o=function(af){if(af.size()!==1){return false}if(Z.canRead(af)===false||Z.canModify(af)===false){return false}if(Z.isProcessor(af)){var ae=af.datum();return ae.component.persistsState===true}else{return false}};var L=function(af){if(af.size()!==1){return false}if(Z.canRead(af)===false||Z.canModify(af)===false){return false}if(Z.isProcessor(af)){var ae=af.datum();return ae.component.multipleVersionsAvailable===true}else{return false}};var a=function(ae){if(ae.size()!==1){return false}return Z.isProcessGroup(ae)};var M=function(ae){if(Q.canVersionFlows()===false){return false}if(ae.empty()){if(Z.getParentGroupId()===null){return false}return Z.canReadCurrentGroup()&&Z.canWriteCurrentGroup()}if(a(ae)===true){return Z.canRead(ae)&&Z.canModify(ae)}return false};var S=function(af){if(M(af)===false){return false}if(af.empty()){var ae=q.injector.get("breadcrumbsCtrl").getBreadcrumbs();if(ae.length>0){var ag=ae[ae.length-1];if(ag.permissions.canRead){return Q.isUndefinedOrNull(ag.breadcrumb.versionControlInformation)}else{return false}}else{return false}}var ah=af.datum();return Q.isUndefinedOrNull(ah.component.versionControlInformation)};var P=function(af){if(M(af)===false){return false}var ah;if(af.empty()){var ae=q.injector.get("breadcrumbsCtrl").getBreadcrumbs();if(ae.length>0){var ag=ae[ae.length-1];if(ag.permissions.canRead){ah=ag.breadcrumb.versionControlInformation}else{return false}}else{return false}}else{var ai=af.datum();ah=ai.component.versionControlInformation}if(Q.isUndefinedOrNull(ah)){return false}return ah.state==="LOCALLY_MODIFIED"};var aa=function(af){if(M(af)===false){return false}var ah;if(af.empty()){var ae=q.injector.get("breadcrumbsCtrl").getBreadcrumbs();if(ae.length>0){var ag=ae[ae.length-1];if(ag.permissions.canRead){ah=ag.breadcrumb.versionControlInformation}else{return false}}else{return false}}else{var ai=af.datum();ah=ai.component.versionControlInformation}if(Q.isUndefinedOrNull(ah)){return false}return ah.state==="LOCALLY_MODIFIED_AND_STALE"};var f=function(af){if(M(af)===false){return false}var ah;if(af.empty()){var ae=q.injector.get("breadcrumbsCtrl").getBreadcrumbs();if(ae.length>0){var ag=ae[ae.length-1];if(ag.permissions.canRead){ah=ag.breadcrumb.versionControlInformation}else{return false}}else{return false}}else{var ai=af.datum();ah=ai.component.versionControlInformation}if(Q.isUndefinedOrNull(ah)){return false}return ah.state==="LOCALLY_MODIFIED"||ah.state==="LOCALLY_MODIFIED_AND_STALE"};var ad=function(af){if(M(af)===false){return false}var ah;if(af.empty()){var ae=q.injector.get("breadcrumbsCtrl").getBreadcrumbs();if(ae.length>0){var ag=ae[ae.length-1];if(ag.permissions.canRead){ah=ag.breadcrumb.versionControlInformation}else{return false}}else{return false}}else{var ai=af.datum();ah=ai.component.versionControlInformation}if(Q.isUndefinedOrNull(ah)){return false}return ah.state!=="LOCALLY_MODIFIED"&&ah.state!=="LOCALLY_MODIFIED_AND_STALE"&&ah.state!=="SYNC_FAILURE"};var G=function(af){if(M(af)===false){return false}if(af.empty()){var ae=q.injector.get("breadcrumbsCtrl").getBreadcrumbs();if(ae.length>0){var ag=ae[ae.length-1];if(ag.permissions.canRead){return Q.isDefinedAndNotNull(ag.breadcrumb.versionControlInformation)}else{return false}}else{return false}}var ah=af.datum();return Q.isDefinedAndNotNull(ah.component.versionControlInformation)};var t=function(ae){if(ae.size()!==1){return false}return !Z.isLabel(ae)&&!Z.isConnection(ae)&&!Z.isProcessGroup(ae)&&!Z.isRemoteProcessGroup(ae)&&Q.canAccessProvenance()};var c=function(ae){if(ae.size()!==1){return false}if(Z.canRead(ae)===false){return false}return Z.isRemoteProcessGroup(ae)};var C=function(ae){if(Z.canOperate(ae)===false){return false}return Z.canAllStartTransmitting(ae)};var k=function(ae){if(Z.canOperate(ae)===false){return false}return Z.canAllStopTransmitting(ae)};var W=function(ae){return ab(ae)};var l=function(ae){return ab(ae)};var x=function(ae){if(Z.canModify(ae)===false){return false}return !ae.empty()&&Z.getComponentByType("Connection").isDisconnected(ae)&&Z.getParentGroupId()!==null};var E=function(ae){ae.remove().find(".group-menu-item").each(function(){var af=H(this).attr("id");E(H("#"+af+"-sub-menu"))})};var j=function(af,ah){var ag=H('<div class="context-menu-item"></div>').attr("id",ah.id).on("mouseenter",function(){H(this).addClass("hover");af.find(".group-menu-item").not("#"+ah.id).each(function(){var ai=H(this).attr("id");E(H("#"+ai+"-sub-menu"))})}).on("mouseleave",function(){H(this).removeClass("hover")}).appendTo(af);var ae=H('<div class="context-menu-item-img"></div>').addClass(ah.clazz).appendTo(ag);if(Q.isDefinedAndNotNull(ah.imgStyle)){ae.addClass(ah.imgStyle)}H('<div class="context-menu-item-text"></div>').text(ah.text).appendTo(ag);if(ah.isGroup){H('<div class="fa fa-caret-right context-menu-group-item-img"></div>').appendTo(ag)}H('<div class="clear"></div>').appendTo(ag);return ag};var g=function(af,ae){af.css({left:ae.x+"px",top:ae.y+"px"}).show()};var T=function(ag,af,ae){A[ag](af,ae);B.hide()};var h=[{id:"reload-menu-item",condition:V,menuItem:{clazz:"fa fa-refresh",text:"Refresh",action:"reload"}},{id:"leave-group-menu-item",condition:K,menuItem:{clazz:"fa fa-level-up",text:"Leave group",action:"leaveGroup"}},{separator:true},{id:"show-configuration-menu-item",condition:X,menuItem:{clazz:"fa fa-gear",text:"Configure",action:"showConfiguration"}},{id:"show-details-menu-item",condition:I,menuItem:{clazz:"fa fa-gear",text:"View configuration",action:"showDetails"}},{id:"parameters-menu-item",condition:n,menuItem:{clazz:"fa",text:"Parameters",action:"openParameterContext"}},{id:"variable-registry-menu-item",condition:ac,menuItem:{clazz:"fa",text:"Variables",action:"openVariableRegistry"}},{separator:true},{id:"version-menu-item",groupMenuItem:{clazz:"fa",text:"Version"},menuItems:[{id:"start-version-control-menu-item",condition:S,menuItem:{clazz:"fa fa-upload",text:"Start version control",action:"saveFlowVersion"}},{separator:true},{id:"commit-menu-item",condition:P,menuItem:{clazz:"fa fa-upload",text:"Commit local changes",action:"saveFlowVersion"}},{id:"force-commit-menu-item",condition:aa,menuItem:{clazz:"fa fa-upload",text:"Commit local changes",action:"forceSaveFlowVersion"}},{id:"local-changes-menu-item",condition:f,menuItem:{clazz:"fa",text:"Show local changes",action:"showLocalChanges"}},{id:"revert-menu-item",condition:f,menuItem:{clazz:"fa fa-undo",text:"Revert local changes",action:"revertLocalChanges"}},{id:"change-version-menu-item",condition:ad,menuItem:{clazz:"fa",text:"Change version",action:"changeFlowVersion"}},{separator:true},{id:"stop-version-control-menu-item",condition:G,menuItem:{clazz:"fa",text:"Stop version control",action:"stopVersionControl"}}]},{separator:true},{id:"enter-group-menu-item",condition:a,menuItem:{clazz:"fa fa-sign-in",text:"Enter group",action:"enterGroup"}},{separator:true},{id:"start-menu-item",condition:r,menuItem:{clazz:"fa fa-play",text:"Start",action:"start"}},{id:"stop-menu-item",condition:N,menuItem:{clazz:"fa fa-stop",text:"Stop",action:"stop"}},{id:"terminate-menu-item",condition:b,menuItem:{clazz:"fa fa-hourglass-end",text:"Terminate",action:"terminate"}},{id:"enable-menu-item",condition:J,menuItem:{clazz:"fa fa-flash",text:"Enable",action:"enable"}},{id:"disable-menu-item",condition:D,menuItem:{clazz:"icon icon-enable-false",text:"Disable",action:"disable"}},{id:"enable-transmission-menu-item",condition:C,menuItem:{clazz:"fa fa-bullseye",text:"Enable transmission",action:"enableTransmission"}},{id:"disable-transmission-menu-item",condition:k,menuItem:{clazz:"icon icon-transmit-false",text:"Disable transmission",action:"disableTransmission"}},{separator:true},{id:"data-provenance-menu-item",condition:t,menuItem:{clazz:"icon icon-provenance",imgStyle:"context-menu-provenance",text:"View data provenance",action:"openProvenance"}},{id:"show-stats-menu-item",condition:m,menuItem:{clazz:"fa fa-area-chart",text:"View status history",action:"showStats"}},{id:"view-state-menu-item",condition:o,menuItem:{clazz:"fa fa-tasks",text:"View state",action:"viewState"}},{id:"list-queue-menu-item",condition:l,menuItem:{clazz:"fa fa-list",text:"List queue",action:"listQueue"}},{id:"show-usage-menu-item",condition:O,menuItem:{clazz:"fa fa-book",text:"View usage",action:"showUsage"}},{id:"view-menu-item",groupMenuItem:{clazz:"icon icon-connect",text:"View connections"},menuItems:[{id:"show-upstream-menu-item",condition:u,menuItem:{clazz:"icon",text:"Upstream",action:"showUpstream"}},{id:"show-downstream-menu-item",condition:p,menuItem:{clazz:"icon",text:"Downstream",action:"showDownstream"}}]},{separator:true},{id:"refresh-remote-flow-menu-item",condition:c,menuItem:{clazz:"fa fa-refresh",text:"Refresh remote",action:"refreshRemoteFlow"}},{separator:true},{id:"remote-ports-menu-item",condition:c,menuItem:{clazz:"fa fa-cloud",text:"Manage remote ports",action:"remotePorts"}},{id:"manage-policies-menu-item",condition:F,menuItem:{clazz:"fa fa-key",text:"Manage access policies",action:"managePolicies"}},{id:"change-version-menu-item",condition:L,menuItem:{clazz:"fa fa-exchange",text:"Change version",action:"changeVersion"}},{separator:true},{id:"show-source-menu-item",condition:ab,menuItem:{clazz:"fa fa-long-arrow-left",text:"Go to source",action:"showSource"}},{id:"show-destination-menu-item",condition:ab,menuItem:{clazz:"fa fa-long-arrow-right",text:"Go to destination",action:"showDestination"}},{separator:true},{id:"align-menu-item",groupMenuItem:{clazz:"fa",text:"Align"},menuItems:[{id:"align-horizontal-menu-item",condition:s,menuItem:{clazz:"fa fa-align-center fa-rotate-90",text:"Horizontally",action:"alignHorizontal"}},{id:"align-vertical-menu-item",condition:s,menuItem:{clazz:"fa fa-align-center",text:"Vertically",action:"alignVertical"}}]},{id:"to-front-menu-item",condition:z,menuItem:{clazz:"fa fa-clone",text:"Bring to front",action:"toFront"}},{id:"center-menu-item",condition:w,menuItem:{clazz:"fa fa-crosshairs",text:"Center in view",action:"center"}},{id:"fill-color-menu-item",condition:y,menuItem:{clazz:"fa fa-paint-brush",text:"Change color",action:"fillColor"}},{id:"open-uri-menu-item",condition:c,menuItem:{clazz:"fa fa-external-link",text:"Go to",action:"openUri"}},{separator:true},{id:"move-into-parent-menu-item",condition:x,menuItem:{clazz:"fa fa-arrows",text:"Move to parent group",action:"moveIntoParent"}},{id:"group-menu-item",condition:Y,menuItem:{clazz:"icon icon-group",text:"Group",action:"group"}},{separator:true},{id:"upload-template-menu-item",condition:d,menuItem:{clazz:"icon icon-template-import",text:"Upload template",action:"uploadTemplate"}},{id:"template-menu-item",condition:R,menuItem:{clazz:"icon icon-template-save",text:"Create template",action:"template"}},{separator:true},{id:"copy-menu-item",condition:i,menuItem:{clazz:"fa fa-copy",text:"Copy",action:"copy"}},{id:"paste-menu-item",condition:e,menuItem:{clazz:"fa fa-paste",text:"Paste",action:"paste"}},{separator:true},{id:"empty-queue-menu-item",condition:W,menuItem:{clazz:"fa fa-minus-circle",text:"Empty queue",action:"emptyQueue"}},{id:"delete-menu-item",condition:v,menuItem:{clazz:"fa fa-trash",text:"Delete",action:"delete"}}];var B={init:function(ae){A=ae;H("#context-menu").on("contextmenu",function(af){af.preventDefault();af.stopPropagation()})},show:function(){nf.ContextMenu.hide();var ai=H("#context-menu").empty();var al=H("#canvas-body").get(0);var aq=H("#banner-footer").get(0);var aj=H("#breadcrumbs").get(0);var ao=Z.getSelection();var am=U.mouse(al);var af=function(ar,at){return ar+at.width()>al.clientWidth};var ag=function(at,ar){return at+ar.height()>(al.clientHeight-aj.clientHeight-aq.clientHeight)};var ap=function(at,au,ar){j(at,{id:au,clazz:ar.clazz,imgStyle:ar.imgStyle,text:ar.text,isGroup:false}).on("click",function(av){T(ar.action,ao,av)}).on("contextmenu",function(av){T(ar.action,ao,av);av.preventDefault();av.stopPropagation()})};var an=function(au,at,ar,av){j(au,{id:at,clazz:ar.clazz,imgStyle:ar.imgStyle,text:ar.text,isGroup:true}).addClass("group-menu-item").on("mouseenter",function(){if(H("#"+at+"-sub-menu").length==0){var aA=H(this);var ax=au.position();var az=aA.position();var aw=ax.left+az.left+aA.width();var aB=ax.top+az.top;var ay=H('<div class="context-menu unselectable sub-menu"></div>').attr("id",at+"-sub-menu").appendTo("body");ae(ay,av);if(af(aw,ay)){aw-=(ay.width()+aA.width()-4)}if(ag(aB,ay)){aB-=(ay.height()-aA.height())}ay.css({top:aB+"px",left:aw+"px"}).show()}})};var ak=function(at){if(at.separator){return true}else{if(at.menuItem){return at.condition(ao)}else{var ar=[];H.each(at.menuItems,function(au,av){if(ak(av)){ar.push(av)}});return ar.length>0}}};var ae=function(av,ar){var at=false;H.each(ar,function(aw,ax){if(ax.separator&&at){H('<div class="context-menu-item-separator"></div>').appendTo(av);at=false}else{if(ah(av,ax)){at=true}}});var au=av.children().last();if(au.hasClass("context-menu-item-separator")){au.remove()}};var ah=function(au,ar){var at=false;if(ar.menuItem){at=ar.condition(ao);if(at){ap(au,ar.id,ar.menuItem)}}else{if(ar.groupMenuItem){var aw=[];H.each(ar.menuItems,function(ay,ax){if(ak(ax)){aw.push(ax)}});var av=H.grep(aw,function(ax){return Q.isUndefinedOrNull(ax.separator)});at=av.length>0;if(at){an(au,ar.id,ar.groupMenuItem,aw)}}}return at};ae(ai,h);if(af(am[0],ai)){am[0]=al.clientWidth-ai.width()-2}if(ag(am[1],ai)){am[1]=al.clientHeight-aj.clientHeight-aq.clientHeight-ai.height()-9}g(ai,{x:am[0],y:am[1]});q.digest()},hide:function(){H("#context-menu").hide();H("div.context-menu.sub-menu").remove()},activate:function(ae){ae.on("contextmenu.selection",function(){B.show();U.event.preventDefault();U.event.stopPropagation()})}};return B}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["d3","nf.CanvasUtils"],function(d,c){return(nf.QuickSelect=b(d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.QuickSelect=b(require("d3"),require("nf.CanvasUtils")))}else{nf.QuickSelect=b(a.d3,a.nf.CanvasUtils)}}}(this,function(d,c){var b;var a={init:function(e){b=e},quickSelect:function(){var e=c.getSelection();if(c.isConfigurable(e)){b.showConfiguration(e)}else{if(c.hasDetails(e)){b.showDetails(e)}}d.event.preventDefault();d.event.stopPropagation()},activate:function(e){e.on("dblclick",function(){a.quickSelect()})}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["d3","nf.ng.Bridge","nf.ContextMenu","nf.CanvasUtils"],function(f,d,c,e){return(nf.Selectable=b(f,d,c,e))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Selectable=b(require("d3"),require("nf.ng.Bridge"),require("nf.ContextMenu"),require("nf.CanvasUtils")))}else{nf.Selectable=b(a.d3,a.nf.ng.Bridge,a.nf.ContextMenu,a.nf.CanvasUtils)}}}(this,function(d,b,a,c){var e={select:function(f){a.hide();if(!f.classed("selected")){if(!d.event.shiftKey){d.selectAll("g.selected").classed("selected",false)}f.classed("selected",true)}else{if(d.event.shiftKey){f.classed("selected",false)}}b.digest();d.event.stopPropagation()},activate:function(f){f.on("mousedown.selection",function(){e.select(d.select(this));c.setURLParameters()})}};return e}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.CanvasUtils","nf.ContextMenu","nf.Label"],function(f,e,g,d,c,h){return(nf.Birdseye=b(f,e,g,d,c,h))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Birdseye=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.CanvasUtils"),require("nf.ContextMenu"),require("nf.Label")))}else{nf.Birdseye=b(a.$,a.d3,a.nf.Common,a.nf.CanvasUtils,a.nf.ContextMenu,a.nf.Label)}}}(this,function(g,l,d,e,k,f){var h;var c;var j;var i=function(F){var D=e.getCanvasTranslate();var U=e.getCanvasScale();D=[D[0]/U,D[1]/U];var x=l.select("#canvas").node().getBoundingClientRect();var m=(x.left/U)-D[0];var z=((x.top-e.getCanvasOffset())/U)-D[1];var E=(x.right/U)-D[0];var s=(x.bottom/U)-D[1];var H=g("#canvas-container");var I=H.width()/U;var S=H.height()/U;var y=-D[0];var M=-D[1];var T=y+I;var v=M+S;var K=Math.min(m,y);var N=Math.min(z,M);var p=Math.max(E,T);var Q=Math.max(s,v);var R=p-K;var n=Q-N;var C=g("#birdseye");var B=C.width();var u=C.height();var L=B/R;var t=u/n;var J=Math.min(L,t);var r=[0,0];var o=[0,0];if(D[0]<0&&D[1]<0){r=[0,0];o=[-D[0],-D[1]]}else{if(D[0]>=0&&D[1]<0){r=[D[0],0];o=[0,-D[1]]}else{if(D[0]<0&&D[1]>=0){r=[0,D[1]];o=[-D[0],0]}else{r=[D[0],D[1]];o=[0,0]}}}var P=0;var w=-m;if(D[0]<0){if(D[0]<w){P=w}else{P=w-(w-D[0])}}else{if(D[0]<w){P=w-D[0]}}var O=0;var G=-z;if(D[1]<0){if(D[1]<G){O=G}else{O=G-(G-D[1])}}else{if(D[1]<G){O=G-D[1]}}r=[r[0]+P,r[1]+O];o=[o[0]+P,o[1]+O];c.attr("transform","scale("+J+")");j.attr("transform","translate("+r+")");l.select("rect.birdseye-brush").attrs({width:I,height:S,"stroke-width":(2/J),transform:function(V){V.x=o[0];V.y=o[1];return"translate("+o+")"}});var A=l.select("#birdseye-canvas").node();var q=A.getContext("2d");q.save();q.setTransform(1,0,0,1,0,0);q.clearRect(0,0,A.width,A.height);q.restore();q.save();q.translate(r[0]*J,r[1]*J);q.scale(J,J);g.each(F.labels,function(W,X){var V=f.defaultColor();if(X.permissions.canRead){if(d.isDefinedAndNotNull(X.component.style["background-color"])){V=X.component.style["background-color"]}}q.fillStyle=V;q.fillRect(X.position.x,X.position.y,X.dimensions.width,X.dimensions.height)});q.fillStyle="#ad9897";g.each(F.funnels,function(V,W){q.fillRect(W.position.x,W.position.y,W.dimensions.width,W.dimensions.height)});q.fillStyle="#bbdcde";g.each(F.ports,function(V,W){q.fillRect(W.position.x,W.position.y,W.dimensions.width,W.dimensions.height)});q.fillStyle="#728e9b";g.each(F.remoteProcessGroups,function(V,W){q.fillRect(W.position.x,W.position.y,W.dimensions.width,W.dimensions.height)});g.each(F.processGroups,function(V,W){q.fillRect(W.position.x,W.position.y,W.dimensions.width,W.dimensions.height)});g.each(F.processors,function(W,X){var V="#dde4eb";if(X.permissions.canRead){if(d.isDefinedAndNotNull(X.component.style["background-color"])){V=X.component.style["background-color"];if(V==="#ffffff"){V="#dde4eb"}}}q.fillStyle=V;q.fillRect(X.position.x,X.position.y,X.dimensions.width,X.dimensions.height)});q.restore()};var b=true;var a={init:function(m){h=m;var p=g("#birdseye");l.select("#birdseye").append("canvas").attr("id","birdseye-canvas").attr("width",p.width()).attr("height",p.height());var o=l.select("#birdseye").append("svg").attr("width",p.width()).attr("height",p.height());c=o.append("g").attr("class","birdseye");j=c.append("g").attr("pointer-events","none");var n=l.drag().subject(function(q){return{x:q.x,y:q.y,source:"birdseye"}}).on("drag",function(q){q.x+=l.event.dx;q.y+=l.event.dy;l.select(this).attr("transform",function(){return"translate("+q.x+", "+q.y+")"});e.translateCanvas([-l.event.dx,-l.event.dy])}).on("end",function(){h.updateVisibility();e.persistUserView();a.refresh()});c.append("g").attrs({"pointer-events":"all","class":"birdseye-brush-container"}).append("rect").attr("class","birdseye-brush moveable").datum({x:0,y:0}).call(n)},refresh:function(){if(b){i(h.get())}},updateBirdseyeVisibility:function(m){var n=g("#birdseye");if(m){n.show();b=true;i(h.get())}else{n.hide();b=false}}};return a}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Storage","nf.Connection","nf.Birdseye","nf.CanvasUtils","nf.Common","nf.Dialog","nf.Client","nf.ErrorHandler"],function(g,l,h,j,c,e,d,f,k,i){return(nf.Draggable=b(g,l,h,j,c,e,d,f,k,i))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Draggable=b(require("jquery"),require("d3"),require("nf.Storage"),require("nf.Connection"),require("nf.Birdseye"),require("nf.CanvasUtils"),require("nf.Common"),require("nf.Dialog"),require("nf.Client"),require("nf.ErrorHandler")))}else{nf.Draggable=b(a.$,a.d3,a.nf.Storage,a.nf.Connection,a.nf.Birdseye,a.nf.CanvasUtils,a.nf.Common,a.nf.Dialog,a.nf.Client,a.nf.ErrorHandler)}}}(this,function(g,q,i,l,a,d,c,f,p,k){var m;var h;var o=8;var n=true;var j=function(s){var v=q.map();var u=s.datum();var w={x:u.x-u.original.x,y:u.y-u.original.y};if(w.x===0&&w.y===0){return}var r=q.selectAll("g.connection.selected");var t=q.selectAll("g.component.selected");if(d.canModify(r)===false||d.canModify(t)===false){f.showOkDialog({headerText:"Component Position",dialogContent:"Must be authorized to modify every component selected."});return}r.each(function(y){var x=e.updateConnectionPosition(y,w);if(x!==null){v.set(y.id,x)}});t.each(function(y){var x=l.getComponentConnections(y.id);g.each(x,function(B,A){if(!v.has(A.id)&&d.getConnectionSourceComponentId(A)===d.getConnectionDestinationComponentId(A)){var z=e.updateConnectionPosition(l.get(A.id),w);if(z!==null){v.set(A.id,z)}}});v.set(y.id,e.updateComponentPosition(y,w))});e.refreshConnections(v)};var b=function(s){var r=q.selectAll("g.component.selected, g.connection.selected").classed("selected",false);if(d.canModify(r)===false){f.showOkDialog({headerText:"Component Position",dialogContent:"Must be authorized to modify every component selected."});return}if(d.canModify(s)===false){f.showOkDialog({headerText:"Component Position",dialogContent:"Not authorized to modify the destination group."});return}d.moveComponents(r,s)};var e={init:function(r){m=r;h=q.drag().on("start",function(){q.event.sourceEvent.stopPropagation()}).on("drag",function(){var t=q.select("rect.drag-selection");if(t.empty()){var u=q.selectAll("g.component.selected");var s=null,w=null,x=null,v=null;u.each(function(A){if(s===null||A.position.x<s){s=A.position.x}if(x===null||A.position.y<x){x=A.position.y}var z=A.position.x+A.dimensions.width;var y=A.position.y+A.dimensions.height;if(w===null||z>w){w=z}if(v===null||y>v){v=y}});q.select("#canvas").append("rect").attr("rx",6).attr("ry",6).attr("x",s).attr("y",x).attr("class","drag-selection").attr("pointer-events","none").attr("width",w-s).attr("height",v-x).attr("stroke-width",function(){return 1/d.getCanvasScale()}).attr("stroke-dasharray",function(){return 4/d.getCanvasScale()}).datum({original:{x:s,y:x},x:s,y:x})}else{n=!q.event.sourceEvent.shiftKey;t.attr("x",function(y){y.x+=q.event.dx;return n?(Math.round(y.x/o)*o):y.x}).attr("y",function(y){y.y+=q.event.dy;return n?(Math.round(y.y/o)*o):y.y})}}).on("end",function(){q.event.sourceEvent.stopPropagation();var s=q.select("rect.drag-selection");if(s.empty()){return}var t=q.select("g.drop").classed("drop",false);if(t.empty()){j(s)}else{b(t)}s.remove()})},updateComponentPosition:function(t,u){var s={x:n?(Math.round((t.position.x+u.x)/o)*o):t.position.x+u.x,y:n?(Math.round((t.position.y+u.y)/o)*o):t.position.y+u.y};var r={revision:p.getRevision(t),disconnectedNodeAcknowledged:i.isDisconnectionAcknowledged(),component:{id:t.id,position:s}};return g.Deferred(function(v){g.ajax({type:"PUT",url:t.uri,data:JSON.stringify(r),dataType:"json",contentType:"application/json"}).done(function(w){d.getComponentByType(t.type).set(w);v.resolve({type:t.type,id:t.id})}).fail(function(y,w,x){k.handleAjaxError(y,w,x);v.reject()})}).promise()},updateConnectionPosition:function(t,u){if(t.bends.length===0){return null}var s=g.map(t.bends,function(v){return{x:v.x+u.x,y:v.y+u.y}});var r={revision:p.getRevision(t),disconnectedNodeAcknowledged:i.isDisconnectionAcknowledged(),component:{id:t.id,bends:s}};return g.Deferred(function(v){g.ajax({type:"PUT",url:t.uri,data:JSON.stringify(r),dataType:"json",contentType:"application/json"}).done(function(w){l.set(w);v.resolve({type:t.type,id:t.id})}).fail(function(y,w,x){k.handleAjaxError(y,w,x);v.reject()})}).promise()},refreshConnections:function(r){if(r.size()>0){g.when.apply(window,r.values()).done(function(){var s=g.makeArray(arguments);var t=q.set();g.each(s,function(w,v){if(v.type==="Connection"){t.add(v.id)}else{var u=l.getComponentConnections(v.id);g.each(u,function(y,x){t.add(x.id)})}});t.each(function(u){l.refresh(u)})}).always(function(){a.refresh()})}},activate:function(r){r.classed("moveable",true).call(h)},deactivate:function(r){r.classed("moveable",false).on(".drag",null)}};return e}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["d3","nf.Connection","nf.ConnectionConfiguration","nf.CanvasUtils"],function(d,f,e,c){return(nf.Connectable=b(d,f,e,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Connectable=b(require("d3"),require("nf.Connection"),require("nf.ConnectionConfiguration"),require("nf.CanvasUtils")))}else{nf.Connectable=b(a.d3,a.nf.Connection,a.nf.ConnectionConfiguration,a.nf.CanvasUtils)}}}(this,function(f,h,g,e){var c;var d;var b;var a=function(){return !f.event.shiftKey&&f.select("rect.drag-selection").empty()&&f.select("rect.component-selection").empty()};return{init:function(){d=f.select("#canvas");c=f.drag().subject(function(i){b=f.mouse(d.node());return{x:b[0],y:b[1]}}).on("start",function(l){f.event.sourceEvent.stopPropagation();e.getSelection().classed("selected",false);var k=f.select(this.parentNode).classed("selected",true);f.select(this).classed("dragging",true);var j=k.datum();var i=f.mouse(d.node());d.insert("path",":first-child").datum({sourceId:j.id,sourceWidth:j.dimensions.width,x:i[0],y:i[1]}).attrs({"class":"connector",d:function(m){return"M"+m.x+" "+m.y+"L"+m.x+" "+m.y}});f.select(this).attr("transform",function(){return"translate("+i[0]+", "+(i[1]+20)+")"});d.node().appendChild(this)}).on("drag",function(j){f.select(this).attr("transform",function(){return"translate("+f.event.x+", "+(f.event.y+50)+")"});var i=f.select("g.hover").classed("connectable-destination",function(){return(Math.abs(b[0]-f.event.x)>10||Math.abs(b[1]-f.event.y)>10)&&e.isValidConnectionDestination(f.select(this))});f.select("path.connector").classed("connectable",function(){if(i.empty()){return false}return i.classed("connectable-destination")}).attr("d",function(r){if(!i.empty()&&i.classed("connectable-destination")){var m=i.datum();if(r.sourceId===m.id){var k=r.x;var q=r.y;var o=r.sourceWidth/2;var n=h.config.selfLoopXOffset;var p=h.config.selfLoopYOffset;return"M"+k+" "+q+"L"+(k+o+n)+" "+(q-p)+"L"+(k+o+n)+" "+(q+p)+"Z"}else{var l=e.getPerimeterPoint(r,{x:m.position.x,y:m.position.y,width:m.dimensions.width,height:m.dimensions.height});return"M"+r.x+" "+r.y+"L"+l.x+" "+l.y}}else{return"M"+r.x+" "+r.y+"L"+f.event.x+" "+f.event.y}})}).on("end",function(o){f.event.sourceEvent.stopPropagation();var q=f.select(this);var l=f.select("path.connector");var j=l.datum();var p=f.select("g.connectable-destination");if(p.empty()){var i=f.select("#id-"+j.sourceId);var m=i.datum();var n=f.mouse(i.node());if(n[0]<0||n[0]>m.dimensions.width||n[1]<0||n[1]>m.dimensions.height){q.remove()}else{q.classed("dragging",false).attr("transform",function(){return"translate("+o.origX+", "+o.origY+")"});i.node().appendChild(this)}l.remove()}else{q.remove();var k=p.datum();g.createConnection(j.sourceId,k.id)}})},activate:function(i){i.classed("connectable",true).on("mouseenter.connectable",function(m){if(a()){var k=f.select(this);if(e.isValidConnectionSource(k)){var l=f.select("text.add-connect");if(l.empty()){var j=(m.dimensions.width/2)-14;var n=(m.dimensions.height/2)+14;k.append("text").datum({origX:j,origY:n}).call(c).attrs({"class":"add-connect",transform:"translate("+j+", "+n+")"}).text("\ue834")}}}}).on("mouseleave.connectable",function(){var j=f.select(this).select("text.add-connect");if(!j.empty()&&!j.classed("dragging")){j.remove()}}).on("mouseover.connectable",function(){f.select(this).classed("hover",function(){return a()})}).on("mouseout.connection",function(){f.select(this).classed("hover connectable-destination",false)})},deactivate:function(i){i.classed("connectable",false).on("mouseenter.connectable",null).on("mouseleave.connectable",null).on("mouseover.connectable",null).on("mouseout.connectable",null)}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.ng.Bridge","nf.Label","nf.Funnel","nf.Port","nf.RemoteProcessGroup","nf.ProcessGroup","nf.Processor","nf.Connection","nf.ConnectionConfiguration","nf.CanvasUtils","nf.Connectable","nf.Draggable","nf.Selectable","nf.ContextMenu","nf.QuickSelect"],function(d,s,f,t,k,p,c,m,e,l,h,q,r,j,n,i,o,g){return(nf.Graph=b(d,s,f,t,k,p,c,m,e,l,h,q,r,j,n,i,o,g))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Graph=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.ng.Bridge"),require("nf.Label"),require("nf.Funnel"),require("nf.Port"),require("nf.RemoteProcessGroup"),require("nf.ProcessGroup"),require("nf.Processor"),require("nf.Connection"),require("nf.ConnectionConfiguration"),require("nf.CanvasUtils"),require("nf.Connectable"),require("nf.Draggable"),require("nf.Selectable"),require("nf.ContextMenu"),require("nf.QuickSelect")))}else{nf.Graph=b(a.$,a.d3,a.nf.Common,a.nf.ng.Bridge,a.nf.Label,a.nf.Funnel,a.nf.Port,a.nf.RemoteProcessGroup,a.nf.ProcessGroup,a.nf.Processor,a.nf.Connection,a.nf.ConnectionConfiguration,a.nf.CanvasUtils,a.nf.Connectable,a.nf.Draggable,a.nf.Selectable,a.nf.ContextMenu,a.nf.QuickSelect)}}}(this,function(b,u,e,v,j,q,a,l,d,k,g,r,s,i,n,h,o,f){var p=function(w){if(e.isDefinedAndNotNull(w.inputPorts)&&e.isDefinedAndNotNull(w.outputPorts)){return w.inputPorts.concat(w.outputPorts)}else{if(e.isDefinedAndNotNull(w.inputPorts)){return w.inputPorts}else{if(e.isDefinedAndNotNull(w.outputPorts)){return w.outputPorts}else{return[]}}}};var m=function(w){if(e.isDefinedAndNotNull(w.inputPortStatusSnapshots)&&e.isDefinedAndNotNull(w.outputPortStatusSnapshots)){return w.inputPortStatusSnapshots.concat(w.outputPortStatusSnapshots)}else{if(e.isDefinedAndNotNull(w.inputPortStatusSnapshots)){return w.inputPortStatusSnapshots}else{if(e.isDefinedAndNotNull(w.outputPortStatusSnapshots)){return w.outputPortStatusSnapshots}else{return[]}}}};var t=function(){var E=b("#canvas-container");var z=s.getCanvasTranslate();var A=s.getCanvasScale();z=[z[0]/A,z[1]/A];var w=E.width()/A;var x=E.height()/A;var B=-z[0]-w;var y=-z[1]-x;var G=B+(w*3);var I=y+(x*3);var D=function(N){if(!s.shouldRenderPerScale()){return false}var M=N.position.x;var L=N.position.y;var K=M+N.dimensions.width;var J=L+N.dimensions.height;return B<K&&G>M&&y<J&&I>L};var F=function(L){if(!s.shouldRenderPerScale()){return false}var J,M;if(L.bends.length>0){var K=Math.min(Math.max(0,L.labelIndex),L.bends.length-1);J=L.bends[K].x;M=L.bends[K].y}else{J=(L.start.x+L.end.x)/2;M=(L.start.y+L.end.y)/2}return B<J&&G>J&&y<M&&I>M};var C=function(N,J){var L=u.select("#id-"+N.id);var M=J(N);var K=L.classed("visible");L.classed("visible",M).classed("entering",function(){return M&&!K}).classed("leaving",function(){return !M&&K})};var H=c.get();b.each(H.processors,function(J,K){C(K,D)});b.each(H.ports,function(J,K){C(K,D)});b.each(H.processGroups,function(J,K){C(K,D)});b.each(H.remoteProcessGroups,function(J,K){C(K,D)});b.each(H.connections,function(J,K){C(K,F)})};var c={init:function(){j.init(i,n,h,o,f);q.init(i,n,h,o);a.init(i,n,h,o,f);l.init(i,n,h,o,f);d.init(i,n,h,o);k.init(i,n,h,o,f);g.init(h,o,f,r);return s.showDeepLink(true)},add:function(y,w){var x=false;if(e.isDefinedAndNotNull(w)){x=e.isDefinedAndNotNull(w.selectAll)?w.selectAll:x}if(x){s.getSelection().classed("selected",false)}var z=p(y);j.add(y.labels,w);q.add(y.funnels,w);l.add(y.remoteProcessGroups,w);a.add(z,w);d.add(y.processGroups,w);k.add(y.processors,w);g.add(y.connections,w);if(x){v.digest()}},set:function(y,w){var x=false;if(e.isDefinedAndNotNull(w)){x=e.isDefinedAndNotNull(w.selectAll)?w.selectAll:x}if(x){s.getSelection().classed("selected",false)}var z=p(y);j.set(y.labels,w);q.set(y.funnels,w);l.set(y.remoteProcessGroups,w);a.set(z,w);d.set(y.processGroups,w);k.set(y.processors,w);g.set(y.connections,w);if(x){v.digest()}},expireCaches:function(w){j.expireCaches(w);q.expireCaches(w);l.expireCaches(w);a.expireCaches(w);d.expireCaches(w);k.expireCaches(w);g.expireCaches(w)},get:function(){return{labels:j.get(),funnels:q.get(),ports:a.get(),remoteProcessGroups:l.get(),processGroups:d.get(),processors:k.get(),connections:g.get()}},getComponentByType:function(w){switch(w){case"Label":return j;break;case"Funnel":return q;break;case"Port":return a;break;case"RemoteProcessGroup":return l;break;case"ProcessGroup":return d;break;case"Processor":return k;break;case"Connection":return g;break;default:throw new Error("Unknown component type.");break}},removeAll:function(){j.removeAll();q.removeAll();a.removeAll();l.removeAll();d.removeAll();k.removeAll();g.removeAll()},pan:function(){a.pan();l.pan();d.pan();k.pan();g.pan()},updateVisibility:function(){t();c.pan();s.setURLParameters()},getSelection:function(){return u.selectAll("g.component.selected, g.connection.selected")},reload:function(w){var x=w.datum();if(x.permissions.canRead){if(s.isProcessor(w)){k.reload(x.id)}else{if(s.isInputPort(w)){a.reload(x.id)}else{if(s.isRemoteProcessGroup(w)){l.reload(x.id)}}}}}};return c}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.ng.Bridge","nf.ErrorHandler","nf.Dialog","nf.Storage","nf.Common","nf.Client","nf.CanvasUtils","nf.ProcessGroup","nf.ProcessGroupConfiguration","nf.Graph","nf.Birdseye"],function(i,k,m,h,j,f,n,g,d,e,l,c){return(nf.FlowVersion=b(i,k,m,h,j,f,n,g,d,e,l,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.FlowVerison=b(require("jquery"),require("nf.ng.Bridge"),require("nf.ErrorHandler"),require("nf.Dialog"),require("nf.Storage"),require("nf.Common"),require("nf.Client"),require("nf.CanvasUtils"),require("nf.ProcessGroup"),require("nf.ProcessGroupConfiguration"),require("nf.Graph"),require("nf.Birdseye")))}else{nf.FlowVersion=b(a.$,a.nf.ng.Bridge,a.nf.ErrorHandler,a.nf.Dialog,a.nf.Storage,a.nf.Common,a.nf.Client,a.nf.CanvasUtils,a.nf.ProcessGroup,a.nf.ProcessGroupConfiguration,a.nf.Graph,a.nf.Birdseye)}}}(this,function(u,j,b,h,n,D,f,J,q,y,m,d){var o=null;var t={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false,rowHeight:24};var K=function(){u("#save-flow-version-registry-combo").combo("destroy").hide();u("#save-flow-version-bucket-combo").combo("destroy").hide();u("#save-flow-version-label").text("");u("#save-flow-version-registry").text("").hide();u("#save-flow-version-bucket").text("").hide();u("#save-flow-version-name").text("").hide();u("#save-flow-version-description").removeClass("unset blank").text("").hide();u("#save-flow-version-name-field").val("").hide();u("#save-flow-version-description-field").val("").hide();u("#save-flow-version-change-comments").val("");u("#save-flow-version-process-group-id").removeData("versionControlInformation").removeData("revision").text("");u("#save-flow-version-action").text("")};var C=function(){u("#revert-local-changes-process-group-id").text("");z(u("#revert-local-changes-table"),u("#revert-local-changes-filter"),u("#displayed-revert-local-changes-entries"),u("#total-revert-local-changes-entries"))};var a=function(){z(u("#show-local-changes-table"),u("#show-local-changes-filter"),u("#displayed-show-local-changes-entries"),u("#total-show-local-changes-entries"))};var z=function(V,R,T,U){var Q=V.data("gridInstance");if(D.isDefinedAndNotNull(Q)){Q.setSelectedRows([]);Q.resetActiveCell();var S=Q.getData();S.setItems([]);S.setFilterArgs({searchString:""})}R.val("");T.text("0");U.text("0")};var l=function(){var Q=u("#import-flow-version-table").data("gridInstance");if(D.isDefinedAndNotNull(Q)){Q.setSelectedRows([]);Q.resetActiveCell();var R=Q.getData();R.setItems([])}};var P=function(){u("#import-flow-version-dialog").removeData("pt");u("#import-flow-version-registry-combo").combo("destroy").hide();u("#import-flow-version-bucket-combo").combo("destroy").hide();u("#import-flow-version-name-combo").combo("destroy").hide();u("#import-flow-version-registry").text("").hide();u("#import-flow-version-bucket").text("").hide();u("#import-flow-version-name").text("").hide();l();u("#import-flow-version-process-group-id").removeData("versionControlInformation").removeData("revision").text("");u("#import-flow-version-container").hide();u("#import-flow-version-label").text("")};var N=function(S,Q,U,R,T,V){return u.ajax({type:"GET",url:"../nifi-api/flow/registries",dataType:"json"}).done(function(W){var X=[];if(D.isDefinedAndNotNull(W.registries)&&W.registries.length>0){W.registries.sort(function(Z,Y){return Z.registry.name>Y.registry.name});u.each(W.registries,function(Z,aa){var Y=aa.registry;X.push({text:Y.name,value:Y.id,description:D.escapeHtml(Y.description)})})}else{X.push({text:"No available registries",value:null,optionClass:"unset",disabled:true})}Q.combo({options:X,select:function(Y){k(S,Y,U,R,T,V)}})}).fail(b.handleAjaxError)};var O=function(Q,T,R,S,U){return u.ajax({type:"GET",url:"../nifi-api/flow/registries/"+encodeURIComponent(Q)+"/buckets",dataType:"json"}).done(function(V){var W=[];if(D.isDefinedAndNotNull(V.buckets)&&V.buckets.length>0){V.buckets.sort(function(Y,X){if(Y.permissions.canRead===false&&X.permissions.canRead===false){return 0}else{if(Y.permissions.canRead===false){return -1}else{if(X.permissions.canRead===false){return 1}}}return Y.bucket.name>X.bucket.name});u.each(V.buckets,function(Y,X){if(X.permissions.canRead===true){var Z=X.bucket;if(U(X)){W.push({text:Z.name,value:Z.id,description:D.escapeHtml(Z.description)})}}})}if(W.length===0){W.push({text:"No available buckets",value:null,optionClass:"unset",disabled:true});if(D.isDefinedAndNotNull(R)){R.combo("destroy").combo({options:[{text:"No available flows",value:null,optionClass:"unset",disabled:true}]})}}T.combo("destroy").combo({options:W,select:S})}).fail(b.handleAjaxError)};var k=function(R,U,T,Q,S,W){var V=function(){T.combo("destroy").combo({options:[{text:"No available buckets",value:null,optionClass:"unset",disabled:true}]});if(D.isDefinedAndNotNull(Q)){Q.combo("destroy").combo({options:[{text:"No available flows",value:null,optionClass:"unset",disabled:true}]})}R.modal("refreshButtons")};if(U.disabled===true){V()}else{T.combo("destroy").combo({options:[{text:"Loading buckets...",value:null,optionClass:"unset",disabled:true}]});if(D.isDefinedAndNotNull(Q)){Q.combo("destroy").combo({options:[{text:"Loading flows...",value:null,optionClass:"unset",disabled:true}]});l()}O(U.value,T,Q,S,W).fail(function(){V()})}};var c=function(Q){u("#save-flow-version-dialog").modal("refreshButtons")};var w=function(){var Q=u("#save-flow-version-process-group-id").text();var S=u("#save-flow-version-process-group-id").data("revision");var V={processGroupRevision:f.getRevision({revision:{version:S.version}}),disconnectedNodeAcknowledged:n.isDisconnectionAcknowledged()};var T=u("#save-flow-version-process-group-id").data("versionControlInformation");if(D.isDefinedAndNotNull(T)){V.versionedFlow={registryId:T.registryId,bucketId:T.bucketId,flowId:T.flowId,comments:u("#save-flow-version-change-comments").val(),action:u("#save-flow-version-action").text()}}else{var R=u("#save-flow-version-registry-combo").combo("getSelectedOption");var U=u("#save-flow-version-bucket-combo").combo("getSelectedOption");V.versionedFlow={registryId:R.value,bucketId:U.value,flowName:u("#save-flow-version-name-field").val(),description:u("#save-flow-version-description-field").val(),comments:u("#save-flow-version-change-comments").val(),action:u("#save-flow-version-action").text()}}return u.ajax({type:"POST",data:JSON.stringify(V),url:"../nifi-api/versions/process-groups/"+encodeURIComponent(Q),dataType:"json",contentType:"application/json"}).done(function(W){if("SYNC_FAILURE"===W.versionControlInformation.state){h.showOkDialog({headerText:"Error",dialogContent:W.versionControlInformation.stateExplanation})}}).fail(b.handleAjaxError)};var L=function(Q,S){var R=function(U,T){var W=D.isBlank(U[Q.columnId]);var V=D.isBlank(T[Q.columnId]);if(W&&V){return 0}else{if(W){return 1}else{if(V){return -1}}}return U[Q.columnId]===T[Q.columnId]?0:U[Q.columnId]>T[Q.columnId]?1:-1};S.sort(R,Q.sortAsc)};var s=function(){var V=u("#import-flow-version-table");var S=function(aa,X,Z,Y,W){return D.escapeHtml(Z)};var R=function(ad,X,ac,Z,W){var ab=new Date();var Y=ab.getTimezoneOffset()*60*1000;var aa=new Date(W.timestamp+Y+o);return D.formatDateTime(aa)};var Q=[{id:"version",name:"Version",field:"version",formatter:S,sortable:true,resizable:true,width:75,maxWidth:75},{id:"timestamp",name:"Created",field:"timestamp",formatter:R,sortable:true,resizable:true,width:175,maxWidth:175},{id:"changeComments",name:"Comments",field:"comments",sortable:true,resizable:true,formatter:S}];var U=new Slick.Data.DataView({inlineFilters:false});L({columnId:"version",sortAsc:false},U);var T=new Slick.Grid(V,U,Q,t);T.setSelectionModel(new Slick.RowSelectionModel());T.registerPlugin(new Slick.AutoTooltips());T.setSortColumn("version",false);T.onSort.subscribe(function(X,W){L({columnId:W.sortCol.id,sortAsc:W.sortAsc},U)});T.onSelectedRowsChanged.subscribe(function(X,W){u("#import-flow-version-dialog").modal("refreshButtons")});T.onDblClick.subscribe(function(X,W){if(u("#import-flow-version-label").is(":visible")){r()}else{A().always(function(){u("#import-flow-version-dialog").modal("hide")})}});U.onRowCountChanged.subscribe(function(X,W){T.updateRowCount();T.render()});U.onRowsChanged.subscribe(function(X,W){T.invalidateRows(W.rows);T.render()});U.syncGridSelection(T,true);V.data("gridInstance",T)};var I=function(X,U,Z,R){var Y=function(){return U.val()};var T=function(){var ac=X.data("gridInstance");if(D.isDefinedAndNotNull(ac)){var ad=ac.getData();ad.setFilterArgs({searchString:Y()});ad.refresh()}};var S=function(af,ac){if(ac.searchString===""){return true}try{var aj=new RegExp(ac.searchString,"i")}catch(ah){return false}var ad=af.componentId.search(aj)>=0;var ai=af.differenceType.search(aj)>=0;var ae=af.difference.search(aj)>=0;var ag=false;if(D.isDefinedAndNotNull(af.componentName)){ag=af.componentName.search(aj)>=0}return ad||ag||ai||ae};U.on("keyup",function(){T()});var W=function(ag,ad,af,ae,ac){return D.escapeHtml(af)};var ab=function(ah,ad,ag,af,ac){var ae="";if(ac.differenceType!=="Component Removed"&&D.isDefinedAndNotNull(ac.processGroupId)){ae+='<div class="pointer go-to-component fa fa-long-arrow-right" title="Go To"></div>'}return ae};var aa=[{id:"componentName",name:"Component Name",field:"componentName",formatter:W,sortable:true,resizable:true},{id:"differenceType",name:"Change Type",field:"differenceType",formatter:W,sortable:true,resizable:true},{id:"difference",name:"Difference",field:"difference",formatter:W,sortable:true,resizable:true},{id:"actions",name:"&nbsp;",formatter:ab,sortable:false,resizable:false,width:25}];var Q=new Slick.Data.DataView({inlineFilters:false});Q.setFilterArgs({searchString:Y()});Q.setFilter(S);L({columnId:"componentName",sortAsc:true},Q);var V=new Slick.Grid(X,Q,aa,t);V.setSelectionModel(new Slick.RowSelectionModel());V.registerPlugin(new Slick.AutoTooltips());V.setSortColumn("componentName",true);V.onSort.subscribe(function(ad,ac){L({columnId:ac.sortCol.id,sortAsc:ac.sortAsc},Q)});V.onClick.subscribe(function(af,ad){var ae=u(af.target);var ac=Q.getItem(ad.row);if(V.getColumns()[ad.cell].id==="actions"){if(ae.hasClass("go-to-component")){if(ac.componentType==="Controller Service"){y.showConfiguration(ac.processGroupId).done(function(){y.selectControllerService(ac.componentId);X.closest(".large-dialog").modal("hide")})}else{J.showComponent(ac.processGroupId,ac.componentId).done(function(){X.closest(".large-dialog").modal("hide")})}}}});Q.onRowCountChanged.subscribe(function(ad,ac){V.updateRowCount();V.render();Z.text(D.formatInteger(ac.current))});Q.onRowsChanged.subscribe(function(ad,ac){V.invalidateRows(ac.rows);V.render()});Q.syncGridSelection(V,true);X.data("gridInstance",V);Z.text("0");R.text("0")};var G=function(){var T=u("#new-process-group-dialog").data("pt");u("#import-flow-version-dialog").data("pt",T);var Q=u("#import-flow-version-registry-combo").combo("destroy").combo({options:[{text:"Loading registries...",value:null,optionClass:"unset",disabled:true}]}).show();var S=u("#import-flow-version-bucket-combo").combo("destroy").combo({options:[{text:"Loading buckets...",value:null,optionClass:"unset",disabled:true}]}).show();var R=u("#import-flow-version-name-combo").combo("destroy").combo({options:[{text:"Loading flows...",value:null,optionClass:"unset",disabled:true}]}).show();N(u("#import-flow-version-dialog"),Q,S,R,E,function(U){return true}).done(function(){u("#import-flow-version-dialog").modal("setHeaderText","Import Version").modal("setButtonModel",[{buttonText:"Import",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:M,handler:{click:function(){A().always(function(){u("#import-flow-version-dialog").modal("hide")})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){u(this).modal("hide")}}}]).modal("show");u("#new-process-group-dialog").modal("hide")})};var x=function(R,U,Q){var S=u("#import-flow-version-table").data("gridInstance");var T=S.getData();T.beginUpdate();S.setSelectedRows([]);S.resetActiveCell();T.setItems([]);return u.ajax({type:"GET",url:"../nifi-api/flow/registries/"+encodeURIComponent(R)+"/buckets/"+encodeURIComponent(U)+"/flows/"+encodeURIComponent(Q)+"/versions",dataType:"json"}).done(function(V){if(D.isDefinedAndNotNull(V.versionedFlowSnapshotMetadataSet)&&V.versionedFlowSnapshotMetadataSet.length>0){u.each(V.versionedFlowSnapshotMetadataSet,function(X,W){T.addItem(u.extend({id:W.versionedFlowSnapshotMetadata.version},W.versionedFlowSnapshotMetadata))})}else{h.showOkDialog({headerText:"Flow Versions",dialogContent:"This flow does not have any versions available."})}}).fail(b.handleAjaxError).always(function(){T.endUpdate();T.reSort();S.invalidate()})};var F=function(Q,R,S){return u.ajax({type:"GET",url:"../nifi-api/flow/registries/"+encodeURIComponent(Q)+"/buckets/"+encodeURIComponent(R)+"/flows",dataType:"json"}).done(function(T){var U=[];if(D.isDefinedAndNotNull(T.versionedFlows)&&T.versionedFlows.length>0){T.versionedFlows.sort(function(W,V){return W.versionedFlow.flowName>V.versionedFlow.flowName});u.each(T.versionedFlows,function(W,V){var X=V.versionedFlow;U.push({text:X.flowName,value:X.flowId,description:D.escapeHtml(X.description)})})}else{U.push({text:"No available flows",value:null,optionClass:"unset",disabled:true})}u("#import-flow-version-name-combo").combo("destroy").combo({options:U,select:function(V){if(D.isDefinedAndNotNull(V.value)){S(Q,R,V.value)}else{var W=u("#import-flow-version-table").data("gridInstance");var X=W.getData();X.beginUpdate();X.setItems([]);X.endUpdate()}}})}).fail(b.handleAjaxError)};var p=function(R,S,Q){x(R,S,Q).done(function(){u("#import-flow-version-dialog").modal("refreshButtons")})};var E=function(R){l();if(D.isDefinedAndNotNull(R.value)){u("#import-flow-version-name-combo").combo("destroy").combo({options:[{text:"Loading flows...",value:null,optionClass:"unset",disabled:true}]});var Q=u("#import-flow-version-registry-combo").combo("getSelectedOption");F(Q.value,R.value,p)}else{u("#import-flow-version-name-combo").combo("destroy").combo({options:[{text:"No available flows",value:null,optionClass:"unset",disabled:true}]})}};var A=function(){var W=u("#import-flow-version-dialog").data("pt");var T=u("#import-flow-version-registry-combo").combo("getSelectedOption");var X=u("#import-flow-version-bucket-combo").combo("getSelectedOption");var Q=u("#import-flow-version-name-combo").combo("getSelectedOption");var S=u("#import-flow-version-table").data("gridInstance");var R=S.getSelectedRows();var V=S.getDataItem(R[0]);var U={revision:f.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:n.isDisconnectionAcknowledged(),component:{position:{x:W.x,y:W.y},versionControlInformation:{registryId:T.value,bucketId:X.value,flowId:Q.value,version:V.version}}};return u.ajax({type:"POST",data:JSON.stringify(U),url:"../nifi-api/process-groups/"+encodeURIComponent(J.getGroupId())+"/process-groups",dataType:"json",contentType:"application/json"}).done(function(Y){m.add({processGroups:[Y]},{selectAll:true});m.updateVisibility();d.refresh()}).fail(b.handleAjaxError)};var M=function(){var S=u("#import-flow-version-table").data("gridInstance");if(D.isDefinedAndNotNull(S)){var T=S.getSelectedRows();if(u("#import-flow-version-label").is(":visible")){if(T.length===1){var R=S.getDataItem(T[0]);var Q=parseInt(u("#import-flow-version-label").text(),10);return Q===R.version}else{return true}}else{return T.length!==1}}else{return true}};var r=function(){var ab=null;var S=null;var V=false;var R=u("#import-flow-version-process-group-id").text();var ac=u("#import-flow-version-process-group-id").data("revision");var ad=u("#import-flow-version-process-group-id").data("versionControlInformation");var Q=u("#import-flow-version-table").data("gridInstance");var Z=Q.getSelectedRows();var W=Q.getDataItem(Z[0]);u("#change-version-status-dialog").modal("setButtonModel",[{buttonText:"Stop",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){V=true;u("#change-version-status-dialog").modal("setButtonModel",[]);if(ab!==null){clearTimeout(ab);aa()}}}}]);u("#import-flow-version-dialog").modal("hide");var T=function(){var ae={processGroupRevision:f.getRevision({revision:{version:ac.version}}),disconnectedNodeAcknowledged:n.isDisconnectionAcknowledged(),versionControlInformation:{groupId:R,registryId:ad.registryId,bucketId:ad.bucketId,flowId:ad.flowId,version:W.version}};return u.ajax({type:"POST",data:JSON.stringify(ae),url:"../nifi-api/versions/update-requests/process-groups/"+encodeURIComponent(R),dataType:"json",contentType:"application/json"}).done(function(){g(0);u("#change-version-status-dialog").modal("show")}).fail(b.handleAjaxError)};var X=function(){Y().done(U)};var Y=function(){return u.ajax({type:"GET",url:S.uri,dataType:"json"}).fail(aa).fail(b.handleAjaxError)};var aa=function(){if(V===true){u("#change-version-status-message").text("The change version request has been cancelled.");u("#change-version-status-dialog").modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){u(this).modal("hide")}}}])}if(D.isDefinedAndNotNull(S)){u.ajax({type:"DELETE",url:S.uri+"?"+u.param({disconnectedNodeAcknowledged:n.isDisconnectionAcknowledged()}),dataType:"json"}).done(function(ae){S=ae.request;e(R);if(D.isDefinedAndNotNull(S.failureReason)){u("#change-version-status-dialog").modal("hide");h.showOkDialog({headerText:"Change Version",dialogContent:D.escapeHtml(S.failureReason)})}else{g(S.percentCompleted);u("#change-version-status-message").text("This Process Group version has changed.");u("#change-version-status-dialog").modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){u(this).modal("hide")}}}])}})}};var U=function(ae){S=ae.request;if(S.complete===true||V===true){aa()}else{g(S.percentCompleted);u("#change-version-status-message").text(S.state);ab=setTimeout(function(){ab=null;X()},2000)}};T().done(U)};var B=function(Q){return u.Deferred(function(R){if(Q===J.getGroupId()){u.ajax({type:"GET",url:"../nifi-api/versions/process-groups/"+encodeURIComponent(Q),dataType:"json"}).done(function(T){R.resolve(T)}).fail(function(){R.reject()})}else{var S=q.get(Q);if(S.permissions.canRead===true&&S.permissions.canWrite===true){R.resolve({processGroupRevision:S.revision,versionControlInformation:S.component.versionControlInformation})}else{R.reject()}}}).promise()};var H=function(Q,R){if(J.getGroupId()===Q){j.injector.get("breadcrumbsCtrl").updateVersionControlInformation(Q,R);j.digest()}else{q.reload(Q)}};var e=function(Q){if(J.getGroupId()===Q){u.ajax({type:"GET",url:"../nifi-api/flow/process-groups/"+encodeURIComponent(Q),dataType:"json"}).done(function(S){m.set(S.processGroupFlow.flow);m.updateVisibility();var R=j.injector.get("breadcrumbsCtrl");R.resetBreadcrumbs();R.generateBreadcrumbs(S.processGroupFlow.breadcrumb);j.digest()}).fail(b.handleAjaxError)}else{q.reload(Q)}};var g=function(R){var S=u("#change-version-percent-complete");S.find("div.progress-label").remove();S.find("md-progress-linear").remove();var Q=u('<div class="progress-label"></div>').text(R+"%");(j.injector.get("$compile")(u('<md-progress-linear ng-cloak ng-value="'+R+'" class="md-hue-2" md-mode="determinate" aria-label="Searching Queue"></md-progress-linear>'))(j.rootScope)).appendTo(S);S.append(Q)};var v=function(Q,R,X,W){var S=X.data("gridInstance");var T=S.getData();T.beginUpdate();S.setSelectedRows([]);S.resetActiveCell();T.setItems([]);var V=B(Q).done(function(Y){if(D.isDefinedAndNotNull(Y.versionControlInformation)){var Z=Y.versionControlInformation;R.text("The following changes have been made to "+Z.flowName+" (Version "+Z.version+").")}else{h.showOkDialog({headerText:"Change Version",dialogContent:"This Process Group is not currently under version control."})}});var U=u.ajax({type:"GET",url:"../nifi-api/process-groups/"+encodeURIComponent(Q)+"/local-modifications",dataType:"json"}).done(function(Y){if(D.isDefinedAndNotNull(Y.componentDifferences)&&Y.componentDifferences.length>0){var Z=0;u.each(Y.componentDifferences,function(ab,aa){u.each(aa.differences,function(ac,ad){T.addItem({id:Z++,componentId:aa.componentId,componentName:aa.componentName,componentType:aa.componentType,processGroupId:aa.processGroupId,differenceType:ad.differenceType,difference:ad.difference})})});T.endUpdate();T.reSort();S.invalidate();W.text(D.formatInteger(Z))}else{h.showOkDialog({headerText:"Local Changes",dialogContent:"This Process Group does not have any local changes."})}}).fail(b.handleAjaxError);return u.when(V,U)};var i=function(Q){B(Q).done(function(U){if(D.isDefinedAndNotNull(U.versionControlInformation)){var Z=null;var Y=null;var V=false;u("#change-version-status-dialog").modal("setButtonModel",[{buttonText:"Stop",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){V=true;u("#change-version-status-dialog").modal("setButtonModel",[]);if(Z!==null){clearTimeout(Z);X()}}}}]);u("#import-flow-version-dialog").modal("hide");var S=function(){var aa={processGroupRevision:f.getRevision({revision:{version:U.processGroupRevision.version}}),disconnectedNodeAcknowledged:n.isDisconnectionAcknowledged(),versionControlInformation:U.versionControlInformation};return u.ajax({type:"POST",data:JSON.stringify(aa),url:"../nifi-api/versions/revert-requests/process-groups/"+encodeURIComponent(Q),dataType:"json",contentType:"application/json"}).done(function(){g(0);u("#change-version-status-dialog").modal("show")}).fail(b.handleAjaxError)};var T=function(){W().done(R)};var W=function(){return u.ajax({type:"GET",url:Y.uri,dataType:"json"}).fail(X).fail(b.handleAjaxError)};var X=function(){if(V===true){u("#change-version-status-message").text("The revert request has been cancelled.");u("#change-version-status-dialog").modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){u(this).modal("hide")}}}])}if(D.isDefinedAndNotNull(Y)){u.ajax({type:"DELETE",url:Y.uri+"?"+u.param({disconnectedNodeAcknowledged:n.isDisconnectionAcknowledged()}),dataType:"json"}).done(function(aa){Y=aa.request;e(Q);if(D.isDefinedAndNotNull(Y.failureReason)){u("#change-version-status-dialog").modal("hide");h.showOkDialog({headerText:"Revert Local Changes",dialogContent:D.escapeHtml(Y.failureReason)})}else{g(Y.percentCompleted);u("#change-version-status-message").text("This Process Group version has changed.");u("#change-version-status-dialog").modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){u(this).modal("hide")}}}])}})}};var R=function(aa){Y=aa.request;if(Y.complete===true||V===true){X()}else{g(Y.percentCompleted);u("#change-version-status-message").text(Y.state);Z=setTimeout(function(){Z=null;T()},2000)}};S().done(R)}else{h.showOkDialog({headerText:"Revert Changes",dialogContent:"This Process Group is not currently under version control."})}}).fail(b.handleAjaxError)};return{init:function(Q){o=Q;u("#save-flow-version-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Save Flow Version",buttons:[{buttonText:"Save",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){if(u("#save-flow-version-registry-combo").is(":visible")){var R=u("#save-flow-version-registry-combo").combo("getSelectedOption");var S=u("#save-flow-version-bucket-combo").combo("getSelectedOption");if(D.isDefinedAndNotNull(R)&&D.isDefinedAndNotNull(S)){return R.disabled===true||S.disabled===true}else{return true}}else{return false}},handler:{click:function(){var R=u("#save-flow-version-process-group-id").text();w().done(function(S){H(R,S.versionControlInformation)});u(this).modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){u(this).modal("hide")}}}],handler:{close:function(){K()}}});u("#import-flow-version-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){P()}}});u("#change-version-status-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Change Flow Version",handler:{close:function(){u("#change-version-status-dialog").modal("setButtonModel",[])}}});u("#revert-local-changes-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Revert Local Changes",buttons:[{buttonText:"Revert",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var R=u("#revert-local-changes-process-group-id").text();i(R);u(this).modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){u(this).modal("hide")}}}],handler:{close:function(){C()}}});u("#show-local-changes-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Show Local Changes",buttons:[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){u(this).modal("hide")}}}],handler:{close:function(){a()}}});u("#import-process-group-link").on("click",function(){G()});s();I(u("#revert-local-changes-table"),u("#revert-local-changes-filter"),u("#displayed-revert-local-changes-entries"),u("#total-revert-local-changes-entries"));I(u("#show-local-changes-table"),u("#show-local-changes-filter"),u("#displayed-show-local-changes-entries"),u("#total-show-local-changes-entries"))},showFlowVersionDialog:function(Q,S){var R=true;return u.Deferred(function(T){B(Q).done(function(U){if(D.isDefinedAndNotNull(U.versionControlInformation)){var X=U.versionControlInformation;u("#save-flow-version-registry").text(X.registryName).show();u("#save-flow-version-bucket").text(X.bucketName).show();if(S=="COMMIT"){u("#save-flow-version-label").text(X.version+1).show()}else{u("#save-flow-version-label").hide()}u("#save-flow-version-name").text(X.flowName).show();D.populateField("save-flow-version-description",X.flowDescription);u("#save-flow-version-description").show();u("#save-flow-version-process-group-id").data("versionControlInformation",X);u("#save-flow-version-action").text(S);u("#save-flow-version-label").css("margin-top","-15px");R=false;T.resolve()}else{var V=u("#save-flow-version-registry-combo").combo("destroy").combo({options:[{text:"Loading registries...",value:null,optionClass:"unset",disabled:true}]}).show();var W=u("#save-flow-version-bucket-combo").combo("destroy").combo({options:[{text:"Loading buckets...",value:null,optionClass:"unset",disabled:true}]}).show();u("#save-flow-version-label").text(1).show();u("#save-flow-version-name-field").show();u("#save-flow-version-description-field").show();u("#save-flow-version-action").text(S);u("#save-flow-version-label").css("margin-top","0");N(u("#save-flow-version-dialog"),V,W,null,c,function(Y){return Y.permissions.canWrite===true}).done(function(){T.resolve()}).fail(function(){T.reject()})}u("#save-flow-version-process-group-id").data("revision",U.processGroupRevision).text(Q)}).fail(b.handleAjaxError)}).done(function(){u("#save-flow-version-dialog").modal("show");if(R){u("#save-flow-version-name-field").focus()}else{u("#save-flow-version-change-comments").focus()}}).fail(function(){u("#save-flow-version-dialog").modal("refreshButtons")}).promise()},revertLocalChanges:function(Q){v(Q,u("#revert-local-changes-message"),u("#revert-local-changes-table"),u("#total-revert-local-changes-entries")).done(function(){u("#revert-local-changes-process-group-id").text(Q);u("#revert-local-changes-dialog").modal("show")})},showLocalChanges:function(Q){v(Q,u("#show-local-changes-message"),u("#show-local-changes-table"),u("#total-show-local-changes-entries")).done(function(){u("#show-local-changes-dialog").modal("show")})},showChangeFlowVersionDialog:function(Q){return u.Deferred(function(R){B(Q).done(function(S){if(D.isDefinedAndNotNull(S.versionControlInformation)){var T=S.versionControlInformation;u("#import-flow-version-registry").text(T.registryName).show();u("#import-flow-version-bucket").text(T.bucketName).show();u("#import-flow-version-name").text(T.flowName).show();u("#import-flow-version-container").show();u("#import-flow-version-label").text(T.version);u("#import-flow-version-process-group-id").data("versionControlInformation",T).data("revision",S.processGroupRevision).text(Q);x(T.registryId,T.bucketId,T.flowId).done(function(){R.resolve()}).fail(function(){h.showOkDialog({headerText:"Change Version",dialogContent:"Unable to load available versions for this Process Group."});R.reject()})}else{h.showOkDialog({headerText:"Change Version",dialogContent:"This Process Group is not currently under version control."});R.reject()}}).fail(b.handleAjaxError)}).done(function(){u("#import-flow-version-dialog").modal("setHeaderText","Change Version").modal("setButtonModel",[{buttonText:"Change",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:M,handler:{click:function(){r()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){u(this).modal("hide")}}}]).modal("show")}).promise()},stopVersionControl:function(Q){h.showYesNoDialog({headerText:"Stop Version Control",dialogContent:"Are you sure you want to stop version control?",noText:"Cancel",yesText:"Disconnect",yesHandler:function(){u.ajax({type:"GET",url:"../nifi-api/versions/process-groups/"+encodeURIComponent(Q),dataType:"json"}).done(function(R){if(D.isDefinedAndNotNull(R.versionControlInformation)){var S=f.getRevision({revision:{version:R.processGroupRevision.version}});u.ajax({type:"DELETE",url:"../nifi-api/versions/process-groups/"+encodeURIComponent(Q)+"?"+u.param(u.extend({disconnectedNodeAcknowledged:n.isDisconnectionAcknowledged()},S)),dataType:"json",contentType:"application/json"}).done(function(T){H(Q,undefined);h.showOkDialog({headerText:"Disconnect",dialogContent:"This Process Group is no longer under version control."})}).fail(b.handleAjaxError)}else{h.showOkDialog({headerText:"Disconnect",dialogContent:"This Process Group is not currently under version control."})}}).fail(b.handleAjaxError)}})}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery"],function(c){return(nf.FilteredDialogCommon=b(c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.FilteredDialogCommon=b(require("jquery")))}else{nf.FilteredDialogCommon=b(a.$)}}}(this,function(a){var b={addKeydownListener:function(e,d,c){var f=[a.ui.keyCode.UP,a.ui.keyCode.PAGE_UP,a.ui.keyCode.DOWN,a.ui.keyCode.PAGE_DOWN];a(e).off("keydown").on("keydown",function(j){var i=j.keyCode?j.keyCode:j.which;if(a.inArray(i,f)===-1||j.shiftKey||j.altKey||j.ctrlKey){return}var h=d.getSelectedRows();if(h.length>0){if(i===a.ui.keyCode.PAGE_UP){d.navigatePageUp();return}if(i===a.ui.keyCode.PAGE_DOWN){d.navigatePageDown();return}var g=h[0];if(i===a.ui.keyCode.UP){g=Math.max(g-1,0)}else{g=Math.min(g+1,c.getLength()-1)}b.choseRow(d,g);d.scrollRowIntoView(g,false)}})},choseFirstRow:function(c){b.choseRow(c,0)},choseRow:function(d,c){d.setSelectedRows([c]);d.setActiveCell(c,0)}};return b}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.Dialog","nf.ErrorHandler"],function(e,c,f,d,g){return(nf.StatusHistory=b(e,c,f,d,g))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.StatusHistory=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.Dialog"),require("nf.ErrorHandler")))}else{nf.StatusHistory=b(a.$,a.d3,a.nf.Common,a.nf.Dialog,a.nf.ErrorHandler)}}}(this,function(e,x,h,s,g){var w={nifiInstanceId:"nifi-instance-id",nifiInstanceLabel:"NiFi",type:{processor:"Processor",inputPort:"Input Port",outputPort:"Output Port",processGroup:"Process Group",remoteProcessGroup:"Remote Process Group",connection:"Connection",funnel:"Funnel",template:"Template",label:"Label"},urls:{api:"../nifi-api"}};var v={DURATION:function(z){return h.formatDuration(z)},COUNT:function(z){if(z%1===0){return h.formatInteger(z)}else{return h.formatFloat(z)}},DATA_SIZE:function(z){return h.formatDataSize(z)}};var n=null;var c=null;var q=null;var d=null;var k=function(B,F,D,A,E){e("#status-history-last-refreshed").text(D.generated);var z={groupId:B,id:F,type:A,instances:[]};var C=D.fieldDescriptors;z.details=D.componentDetails;z.selectedDescriptor=h.isUndefined(E)?C[0]:E;if(h.isDefinedAndNotNull(D.aggregateSnapshots)&&D.aggregateSnapshots.length>1){z.instances.push({id:w.nifiInstanceId,label:w.nifiInstanceLabel,snapshots:D.aggregateSnapshots})}else{j();return}e.each(D.nodeSnapshots,function(H,G){if(h.isDefinedAndNotNull(G.statusSnapshots)&&G.statusSnapshots.length>1){z.instances.push({id:G.nodeId,label:G.address+":"+G.apiPort,snapshots:G.statusSnapshots})}});if(z.instances.length>0){e("#status-history-dialog").data("status-history",z);r(z,C)}else{j()}};var j=function(){s.showOkDialog({headerText:"Status History",dialogContent:"Insufficient history, please try again later."})};var r=function(z,A){if(d===null){d={}}e.each(z.instances,function(C,B){B.snapshots.forEach(function(F){var E=new Date();var D=E.getTimezoneOffset()*60*1000;F.timestamp=new Date(F.timestamp+D+n)})});m(A,z.selectedDescriptor)};var m=function(B,A){var z=[];e.each(B,function(C,D){z.push({text:D.label,value:D.field,description:h.escapeHtml(D.description)})});e("#status-history-metric-combo").combo({selectedOption:{value:A.field},options:z,select:function(D){var E=null;e.each(B,function(F,G){if(D.value===G.field){E=G;return false}});if(E!==null){if(q===null||q.field!==E.field){c=null}q=E;var C=e("#status-history-dialog").data("status-history");C.selectedDescriptor=E;e("#status-history-dialog").data("status-history",C);l()}}});e("#status-history-dialog").modal("show")};var a=function(){return e("#status-history-chart-container").parent().outerHeight()-e("#status-history-chart-control-container").outerHeight()-parseInt(e("#status-history-chart-control-container").css("margin-top"),10)};var y=function(){return e("body").height()-e("#status-history-chart-control-container").outerHeight()-e("#status-history-refresh-container").outerHeight()-parseInt(e("#status-history-chart-control-container").css("margin-top"),10)-parseInt(e(".dialog-content").css("top"))-parseInt(e(".dialog-content").css("bottom"))};var u=function(){return e("body").width()-e("#status-history-details").innerWidth()-parseInt(e("#status-history-dialog").css("left"),10)-parseInt(e(".dialog-content").css("left"))-parseInt(e(".dialog-content").css("right"))};var l=function(){var ah=e("#status-history-dialog");if(ah.is(":visible")){var aa=ah.data("status-history");var ag=aa.selectedDescriptor;e("#status-history-details").empty();var C=o("Status History");x.map(aa.details).each(function(aw,av){i(C,av,aw)});var E={top:15,right:20,bottom:25,left:75};var X=x.scaleOrdinal(x.schemeCategory10);var B=[];e.each(aa.instances,function(aw,av){B.push(av.label)});X.domain(B);var ar=[];e.each(aa.instances,function(aw,av){if(h.isUndefinedOrNull(d[av.id])){d[av.id]=true}ar.push({id:av.id,label:av.label,values:e.map(av.snapshots,function(ax){return{timestamp:ax.timestamp,value:ax.statusMetrics[ag.field]}}),visible:d[av.id]===true})});var O=function(av){if(av.getMilliseconds()){return x.timeFormat(":%S.%L")(av)}else{if(av.getSeconds()){return x.timeFormat(":%S")(av)}else{if(av.getMinutes()||av.getHours()){return x.timeFormat("%H:%M")(av)}else{if(av.getDay()&&av.getDate()!==1){return x.timeFormat("%a %d")(av)}else{if(av.getDate()!==1){return x.timeFormat("%b %d")(av)}else{if(av.getMonth()){return x.timeFormat("%B")(av)}else{return x.timeFormat("%Y")(av)}}}}}}};var N=e("#status-history-chart-container").empty();if(N.hasClass("ui-resizable")){N.resizable("destroy");N.removeAttr("style")}N.height(a());var z=N.outerWidth()-E.left-E.right;var A=N.outerHeight()-E.top-E.bottom;V=e("#status-history-container").width();if(z>V){z=V}am=y();if(A>am){A=am}var ae=x.scaleTime().range([0,z]);var U=x.axisBottom(ae).ticks(5).tickFormat(O);var ad=x.scaleLinear().range([A,0]);var F=x.axisLeft(ad).tickFormat(v[ag.formatter]);var G=x.line().curve(x.curveMonotoneX).x(function(av){return ae(av.timestamp)}).y(function(av){return ad(av.value)});var M=x.select("#status-history-chart-container").append("svg").attr("style","pointer-events: none;").attr("width",N.parent().width()).attr("height",N.innerHeight());var H=M.append("defs").append("clipPath").attr("id","clip").append("rect").attr("width",z).attr("height",A);var au=M.append("g").attr("transform","translate("+E.left+", "+E.top+")");var D=x.min(ar,function(av){return x.min(av.values,function(aw){return aw.timestamp})});var K=x.max(ar,function(av){return x.max(av.values,function(aw){return aw.timestamp})});i(C,"Start",h.formatDateTime(D));i(C,"End",h.formatDateTime(K));ae.domain([D,K]);ad.domain([p(ar),t(ar)]);au.append("g").attr("class","x axis").attr("transform","translate(0, "+A+")").call(U);au.append("g").attr("class","y axis").call(F).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71em").attr("text-anchor","end").text(ag.label);var ab=au.selectAll(".status").data(ar).enter().append("g").attr("clip-path","url(#clip)").attr("class","status");ab.append("path").attr("class",function(av){return"chart-line chart-line-"+av.id}).attr("d",function(av){return G(av.values)}).attr("stroke",function(av){return X(av.label)}).classed("hidden",function(av){return av.visible===false}).append("title").text(function(av){return av.label});ab.each(function(av){var aw=x.select(this).append("g").attr("class",function(){return"mark-group mark-group-"+av.id}).classed("hidden",function(ax){return ax.visible===false});aw.selectAll("circle.mark").data(av.values).enter().append("circle").attr("style","pointer-events: all;").attr("class","mark").attr("cx",function(ax){return ae(ax.timestamp)}).attr("cy",function(ax){return ad(ax.value)}).attr("fill",function(){return X(av.label)}).attr("r",1.5).append("title").text(function(ax){return av.label+" -- "+v[ag.formatter](ax.value)})});M.attr("width",N.parent().width()).attr("height",N.innerHeight());H.attr("width",z).attr("height",A);au.select(".x.axis").attr("transform","translate(0, "+A+")");var T=e("#status-history-chart-control-container").empty();var R=T.innerHeight()-E.top-E.bottom;var ak=x.scaleTime().range([0,z]);var J=x.axisBottom(ak).ticks(5).tickFormat(O);var ao=x.scaleLinear().range([R,0]);var ai=x.axisLeft(ao).tickValues(ad.domain()).tickFormat(v[ag.formatter]);var Q=x.line().curve(x.curveMonotoneX).x(function(av){return ak(av.timestamp)}).y(function(av){return ao(av.value)});var af=x.select("#status-history-chart-control-container").append("svg").attr("width",N.parent().width()).attr("height",R+E.top+E.bottom);var W=af.append("g").attr("transform","translate("+E.left+", "+E.top+")");ak.domain(ae.domain());ao.domain(ad.domain());W.append("g").attr("class","x axis").attr("transform","translate(0, "+R+")").call(J);W.append("g").attr("class","y axis").call(ai);var at=W.selectAll(".status").data(ar).enter().append("g").attr("class","status");at.append("path").attr("class",function(av){return"chart-line chart-line-"+av.id}).attr("d",function(av){return Q(av.values)}).attr("stroke",function(av){return X(av.label)}).classed("hidden",function(av){return d[av.id]===false}).append("title").text(function(av){return av.label});var L=function(){var aA=e.map(ar,function(aG){var aE=ae.domain();var aF=ad.domain();var aH=e.extend({},aG);return e.extend(aH,{values:e.grep(aG.values,function(aI){return aI.timestamp.getTime()>=aE[0].getTime()&&aI.timestamp.getTime()<=aE[1].getTime()&&aI.value>=aF[0]&&aI.value<=aF[1]})})});var av=e.grep(aA,function(aE){return aE.id!==w.nifiInstanceId&&aE.visible&&aE.values.length>0});var az=av.length===0?"NA":v[ag.formatter](p(av));var ay=av.length===0?"NA":v[ag.formatter](f(av));var aw=av.length===0?"NA":v[ag.formatter](t(av));e("#node-aggregate-statistics").text(az+" / "+aw+" / "+ay);var aC=e.grep(aA,function(aE){return aE.id===w.nifiInstanceId&&aE.visible&&aE.values.length>0});var aD=aC.length===0?"NA":v[ag.formatter](p(aC));var aB=aC.length===0?"NA":v[ag.formatter](f(aC));var ax=aC.length===0?"NA":v[ag.formatter](t(aC));e("#cluster-aggregate-statistics").text(aD+" / "+ax+" / "+aB)};var aq=function(av,aw){ae.domain(av);ad.domain(aw);ab.selectAll(".chart-line").attr("d",function(ax){return G(ax.values)});ab.selectAll("circle.mark").attr("cx",function(ax){return ae(ax.timestamp)}).attr("cy",function(ax){return ad(ax.value)}).attr("r",function(){return x.brushSelection(P.node())===null?1.5:4});au.select(".x.axis").call(U);au.select(".y.axis").call(F)};var I=function(){c=x.brushSelection(P.node());var aw,av;if(c===null){var ax=e.grep(ar,function(ay){return ay.visible});if(ax.length===0){av=ao.domain()}else{av=[x.min(ax,function(ay){return x.min(ay.values,function(az){return az.value})}),x.max(ax,function(ay){return x.max(ay.values,function(az){return az.value})})]}aw=ak.domain()}else{aw=[c[0][0],c[1][0]].map(ak.invert,ak);av=[c[1][1],c[0][1]].map(ao.invert,ao)}aq(aw,av);L()};var al=x.brush().extent([[ak.range()[0],ao.range()[1]],[ak.range()[1],ao.range()[0]]]).on("brush",I);var P=W.append("g").attr("class","brush").on("click",I).call(al);if(h.isDefinedAndNotNull(c)){al=al.move(P,c)}W.select("rect.selection").attr("style","pointer-events: all;").on("dblclick",function(){if(c!==null){var av=ao.range();al.move(P,[[c[0][0],av[1]],[c[1][0],av[0]]])}});var ac=e.grep(ar,function(av){return av.id!==w.nifiInstanceId}).sort(function(aw,av){return aw.label<av.label?-1:aw.label>av.label?1:0});var ap=function(aw,av){var ay=e("<div></div>").addClass("legend-label nf-checkbox-label").css("color",X(av.label)).text(av.label).ellipsis();var ax=e('<div class="nf-checkbox"></div>').on("click",function(){var az=x.selectAll("path.chart-line-"+av.id);var aB=x.select("g.mark-group-"+av.id);var aA=aB.classed("hidden");az.classed("hidden",function(){return !aA});aB.classed("hidden",function(){return !aA});av.visible=aA;d[av.id]=av.visible;I()}).addClass(av.visible?"checkbox-checked":"checkbox-unchecked");e('<div class="legend-entry"></div>').append(ax).append(ay).on("mouseenter",function(){x.selectAll("path.chart-line-"+av.id).classed("over",true)}).on("mouseleave",function(){x.selectAll("path.chart-line-"+av.id).classed("over",false)}).appendTo(aw)};var Z=e.grep(ar,function(av){return av.id===w.nifiInstanceId});var aj=o("NiFi");i(aj,"Min / Max / Mean","","cluster-aggregate-statistics");ap(aj,Z[0]);if(ac.length>0){var Y=o("Nodes");i(Y,"Min / Max / Mean","","node-aggregate-statistics");e.each(ac,function(aw,av){ap(Y,av)})}I();var V,am,S,an;N.append('<div class="ui-resizable-handle ui-resizable-se"></div>').resizable({minWidth:425,minHeight:150,handles:{se:".ui-resizable-se"},resize:function(ax,aw){an=e("#status-history-dialog");var av={};if(h.isDefinedAndNotNull(an.data("nf-dialog"))){av=an.data("nf-dialog")}av["min-width"]=(an.width()/e(window).width())*100+"%";av["min-height"]=(an.height()/e(window).height())*100+"%";av.responsive["fullscreen-width"]=an.outerWidth()+"px";av.responsive["fullscreen-height"]=an.outerHeight()+"px";V=u();if(aw.helper.width()>V){aw.helper.width(V);av.responsive["fullscreen-width"]=e(window).width()+"px";av["min-width"]="100%"}am=y();if(aw.helper.height()>am){aw.helper.height(am);av.responsive["fullscreen-height"]=e(window).height()+"px";av["min-height"]="100%"}S=a();if(aw.helper.height()<S){aw.helper.height(S)}av["min-width"]=(parseInt(av["min-width"],10)>=100)?"100%":av["min-width"];av["min-height"]=(parseInt(av["min-height"],10)>=100)?"100%":av["min-height"];an.data("nfDialog",av);an.css("min-width",(N.outerWidth()+e("#status-history-details").outerWidth()+40));an.css("min-height",(N.outerHeight()+e("#status-history-refresh-container").outerHeight()+e("#status-history-chart-control-container").outerHeight()+e(".dialog-buttons").outerHeight()+e(".dialog-header").outerHeight()+40+5));an.center()},stop:l})}};var p=function(z){return x.min(z,function(A){return x.min(A.values,function(B){return B.value})})};var t=function(z){return x.max(z,function(A){return x.max(A.values,function(B){return B.value})})};var f=function(A){var B=0;var z=x.sum(A,function(C){B+=C.values.length;return x.sum(C.values,function(D){return D.value})});return z/B};var o=function(A){var z=e('<div class="status-history-detail"></div>').appendTo("#status-history-details");e('<div class="detail-container-label"></div>').text(A).appendTo(z);return e("<div></div>").appendTo(z)};var i=function(A,C,D,E){var B=e('<div class="detail-item"></div>').appendTo(A);e('<div class="setting-name"></div>').text(C).appendTo(B);var z=e('<div class="setting-field"></div>').text(D).appendTo(B);if(h.isDefinedAndNotNull(E)){z.attr("id",E)}};var b={init:function(z){n=z;e("#status-history-refresh-button").click(function(){var A=e("#status-history-dialog").data("status-history");if(A!==null){if(A.type===w.type.processor){b.showProcessorChart(A.groupId,A.id,A.selectedDescriptor)}else{if(A.type===w.type.processGroup){b.showProcessGroupChart(A.groupId,A.id,A.selectedDescriptor)}else{if(A.type===w.type.remoteProcessGroup){b.showRemoteProcessGroupChart(A.groupId,A.id,A.selectedDescriptor)}else{b.showConnectionChart(A.groupId,A.id,A.selectedDescriptor)}}}}});e("#status-history-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Status History",buttons:[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){this.modal("hide")}}}],handler:{close:function(){e("#status-history-dialog").removeData("status-history");e("#status-history-chart-container").empty();e("#status-history-chart-control-container").empty();e("#status-history-details").empty();c=null;q=null;d=null},open:l}});e(window).on("resize",function(A){if(A.target===window){l()}h.toggleScrollable(e("#status-history-details").get(0))})},showConnectionChart:function(z,A,B){e.ajax({type:"GET",url:w.urls.api+"/flow/connections/"+encodeURIComponent(A)+"/status/history",dataType:"json"}).done(function(C){k(z,A,C.statusHistory,w.type.connection,B)}).fail(g.handleAjaxError)},showProcessorChart:function(z,B,A){e.ajax({type:"GET",url:w.urls.api+"/flow/processors/"+encodeURIComponent(B)+"/status/history",dataType:"json"}).done(function(C){k(z,B,C.statusHistory,w.type.processor,A)}).fail(g.handleAjaxError)},showProcessGroupChart:function(A,z,B){e.ajax({type:"GET",url:w.urls.api+"/flow/process-groups/"+encodeURIComponent(z)+"/status/history",dataType:"json"}).done(function(C){k(A,z,C.statusHistory,w.type.processGroup,B)}).fail(g.handleAjaxError)},showRemoteProcessGroupChart:function(A,z,B){e.ajax({type:"GET",url:w.urls.api+"/flow/remote-process-groups/"+encodeURIComponent(z)+"/status/history",dataType:"json"}).done(function(C){k(A,z,C.statusHistory,w.type.remoteProcessGroup,B)}).fail(g.handleAjaxError)}};return b}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","nf.Common","nf.Dialog","nf.Shell","nf.ng.Bridge","nf.ClusterSummary","nf.ErrorHandler","nf.Storage","nf.CanvasUtils"],function(h,e,f,g,c,j,l,k,i,d){return(nf.QueueListing=b(h,e,f,g,c,j,l,k,i,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.QueueListing=b(require("jquery"),require("Slick"),require("nf.Common"),require("nf.Dialog"),require("nf.Shell"),require("nf.ng.Bridge"),require("nf.ClusterSummary"),require("nf.ErrorHandler"),require("nf.Storage"),require("nf.CanvasUtils")))}else{nf.QueueListing=b(a.$,a.Slick,a.nf.Common,a.nf.Dialog,a.nf.Shell,a.nf.ng.Bridge,a.nf.ClusterSummary,a.nf.ErrorHandler,a.nf.Storage,a.nf.CanvasUtils)}}}(this,function(c,n,h,i,o,r,g,e,d,m){var p={urls:{uiExtensionToken:"../nifi-api/access/ui-extension-token",downloadToken:"../nifi-api/access/download-token"}};var l=function(){c("#listing-request-status-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Queue Listing",handler:{close:function(){c("#listing-request-status-dialog").modal("setButtonModel",[])}}})};var q=function(){var s=function(C,z,B,A,y){return'<div class="pointer show-flowfile-details fa fa-info-circle" title="View Details" style="float: left;"></div>'};var x=function(C,z,B,A,y){return h.formatDataSize(B)};var u=function(C,z,B,A,y){return h.formatDuration(B)};var t=function(C,z,B,A,y){if(B==0){return"No"}return h.formatDuration(B)};var w=[{id:"moreDetails",field:"moreDetails",name:"&nbsp;",sortable:false,resizable:false,formatter:s,width:50,maxWidth:50},{id:"position",name:"Position",field:"position",sortable:false,resizable:false,width:75,maxWidth:75,formatter:h.genericValueFormatter},{id:"uuid",name:"UUID",field:"uuid",sortable:false,resizable:true,formatter:h.genericValueFormatter},{id:"filename",name:"Filename",field:"filename",sortable:false,resizable:true,formatter:h.genericValueFormatter},{id:"size",name:"File Size",field:"size",sortable:false,resizable:true,defaultSortAsc:false,formatter:x},{id:"queuedDuration",name:"Queued Duration",field:"queuedDuration",sortable:false,resizable:true,formatter:u},{id:"lineageDuration",name:"Lineage Duration",field:"lineageDuration",sortable:false,resizable:true,formatter:u},{id:"penalized",name:"Penalized",field:"penaltyExpiresIn",sortable:false,resizable:false,width:100,maxWidth:100,formatter:t}];if(g.isConnectedToCluster()){w.push({id:"clusterNodeAddress",name:"Node",field:"clusterNodeAddress",sortable:false,resizable:true,formatter:h.genericValueFormatter})}var v=function(E,z,D,A,y){var C="";var B=(y.size>0)?false:true;C+='<div class="icon download-flowfile-content fa fa-download '+((B)?"disabled":"pointer")+'" title="'+((B)?"No content available to download":"Download content")+'" aria-hidden="true"></div>';if(h.isContentViewConfigured()){C+='<div class="icon view-flowfile-content fa fa-eye '+((B)?"disabled":"pointer")+'" title="'+((B)?"No content available to view":"View content")+'" aria-hidden="true"></div>'}if(h.canAccessProvenance()){C+='<div title="Provenance" class="pointer icon icon-provenance view-provenance" aria-hidden="true"></div>'}return C};w.push({id:"actions",name:"&nbsp;",resizable:false,formatter:v,sortable:false,width:75,maxWidth:75});return w};var b=function(t){var s=((h.isDefinedAndNotNull(t.uri))?t.uri:c("#flowfile-uri").text())+"/content";h.getAccessToken(p.urls.downloadToken).done(function(v){var w={};if(!h.isBlank(v)){w.access_token=v}var u=(h.isDefinedAndNotNull(t.clusterNodeId))?t.clusterNodeId:c("#flowfile-cluster-node-id").text();if(!h.isBlank(u)){w.clusterNodeId=u}if(c.isEmptyObject(w)){window.open(s)}else{window.open(s+"?"+c.param(w))}}).fail(function(){i.showOkDialog({headerText:"Queue Listing",dialogContent:"Unable to generate access token for downloading content."})})};var f=function(t){var s=((h.isDefinedAndNotNull(t.uri))?t.uri:c("#flowfile-uri").text())+"/content";var u=c.Deferred(function(v){if(d.hasItem("jwt")){var x=c.ajax({type:"POST",url:p.urls.uiExtensionToken});var w=c.ajax({type:"POST",url:p.urls.downloadToken});c.when(x,w).done(function(B,A){var z=B[0];var y=A[0];v.resolve(z,y)}).fail(function(){i.showOkDialog({headerText:"Queue Listing",dialogContent:"Unable to generate access token for viewing content."});v.reject()})}else{v.resolve("","")}}).promise();u.done(function(x,w){var z={};var v=(h.isDefinedAndNotNull(t.clusterNodeId))?t.clusterNodeId:c("#flowfile-cluster-node-id").text();if(!h.isBlank(v)){z.clusterNodeId=v}if(!h.isBlank(w)){z.access_token=w}if(c.isEmptyObject(z)===false){s=s+"?"+c.param(z)}var y=c("#nifi-content-viewer-url").text();if(y.indexOf("?")===-1){y+="?"}else{y+="&"}var A={ref:s};if(!h.isBlank(x)){A.access_token=x}window.open(y+c.param(A))})};var a=function(t){var u=4;var w=false;var v=null;var s=null;return c.Deferred(function(y){var B=function(D){var E=c("#listing-request-percent-complete");E.find("div.progress-label").remove();E.find("md-progress-linear").remove();var C=c('<div class="progress-label"></div>').text(D+"%");(r.injector.get("$compile")(c('<md-progress-linear ng-cloak ng-value="'+D+'" class="md-hue-2" md-mode="determinate" aria-label="Searching Queue"></md-progress-linear>'))(r.rootScope)).appendTo(E);E.append(C)};c("#listing-request-status-dialog").modal("setButtonModel",[{headerText:"Queue Listing",buttonText:"Stop",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){w=true;if(s!==null){clearTimeout(s);x()}}}}]);var x=function(){c("#listing-request-status-dialog").modal("hide");var E=w;if(h.isDefinedAndNotNull(v)){c.ajax({type:"DELETE",url:v.uri,dataType:"json"});if(h.isEmpty(v.flowFileSummaries)){if(w===false){E=true;i.showOkDialog({headerText:"Queue Listing",dialogContent:"The queue has no FlowFiles."})}}else{c("#total-flowfiles-count").text(h.formatInteger(v.queueSize.objectCount));c("#total-flowfiles-size").text(h.formatDataSize(v.queueSize.byteCount));c("#queue-listing-last-refreshed").text(v.lastUpdated);var D=c("#queue-listing-table");var G=c("#queue-listing-message");if(v.sourceRunning===true||v.destinationRunning===true){if(v.souceRunning===true&&v.destinationRunning===true){G.text("The source and destination of this queue are currently running. This listing may no longer be accurate.").show()}else{if(v.sourceRunning===true){G.text("The source of this queue is currently running. This listing may no longer be accurate.").show()}else{if(v.destinationRunning===true){G.text("The destination of this queue is currently running. This listing may no longer be accurate.").show()}}}}else{G.text("").hide()}var F=c("#queue-listing-table").data("gridInstance");F.setColumns(q());var C=F.getData();C.beginUpdate();C.setItems(v.flowFileSummaries,"uuid");C.endUpdate()}}else{E=true}if(E){y.reject()}else{y.resolve()}};var A=function(C){B(v.percentCompleted);c("#listing-request-status-message").text(v.state);if(v.finished===true||w===true){x()}else{s=setTimeout(function(){s=null;z(Math.min(u,C*2))},C*1000)}};var z=function(C){c.ajax({type:"GET",url:v.uri,dataType:"json"}).done(function(D){v=D.listingRequest;A(C)}).fail(x).fail(e.handleAjaxError)};c.ajax({type:"POST",url:"../nifi-api/flowfile-queues/"+t.id+"/listing-requests",dataType:"json",contentType:"application/json"}).done(function(C){B(0);c("#listing-request-status-dialog").modal("show");v=C.listingRequest;A(1)}).fail(x).fail(e.handleAjaxError)}).promise()};var j=function(s){var t=function(w,x){c('<div class="flowfile-detail"></div>').append(c('<div class="detail-name"></div>').text(w)).append(c('<div class="detail-value">'+h.formatValue(x)+"</div>").ellipsis()).append(c('<div class="clear"></div>')).appendTo("#additional-flowfile-details")};var u=function(w,x){if(h.isDefinedAndNotNull(x)){w.removeClass("unset").text(x)}else{w.addClass("unset").text("No value set")}};var v={};if(h.isDefinedAndNotNull(s.clusterNodeId)){v.clusterNodeId=s.clusterNodeId}c.ajax({type:"GET",url:s.uri,data:v,dataType:"json"}).done(function(x){var z=x.flowFile;var w=h.isDefinedAndNotNull(z.contentClaimFileSize)?z.contentClaimFileSize:h.formatDataSize(0);c("#flowfile-uri").text(z.uri);c("#flowfile-uuid").html(h.formatValue(z.uuid));c("#flowfile-filename").html(h.formatValue(z.filename));c("#flowfile-queue-position").html(h.formatValue(z.position));c("#flowfile-file-size").html(h.formatValue(w));c("#flowfile-queued-duration").text(h.formatDuration(z.queuedDuration));c("#flowfile-lineage-duration").text(h.formatDuration(z.lineageDuration));c("#flowfile-penalized").text(z.penaltyExpiresIn==0?"No":h.formatDuration(z.penaltyExpiresIn));if(h.isDefinedAndNotNull(s.clusterNodeId)){c("#flowfile-cluster-node-id").text(s.clusterNodeId);t("Node Address",s.clusterNodeAddress)}if(h.isDefinedAndNotNull(z.contentClaimContainer)){u(c("#content-container"),z.contentClaimContainer);u(c("#content-section"),z.contentClaimSection);u(c("#content-identifier"),z.contentClaimIdentifier);u(c("#content-offset"),z.contentClaimOffset);u(c("#content-bytes"),z.contentClaimFileSizeBytes);var B=c("#content-size");u(B,z.contentClaimFileSize);if(h.isDefinedAndNotNull(z.contentClaimFileSize)){B.attr("title",h.formatInteger(z.contentClaimFileSizeBytes)+" bytes")}c("#flowfile-content-details").show();c("#flowfile-with-no-content").hide()}else{c("#flowfile-content-details").hide();c("#flowfile-with-no-content").show()}var y=c("#flowfile-attributes-container");var A=Object.keys(z.attributes).sort();A.forEach(function(C){var D=z.attributes[C];var E=c('<div class="attribute-detail"></div>').append(c('<div class="attribute-name">'+h.formatValue(C)+"</div>").ellipsis()).appendTo(y);E.append(c('<div class="attribute-value">'+h.formatValue(D)+"</div>").ellipsis()).append('<div class="clear"></div>')});c("#flowfile-details-dialog").modal("show")}).fail(e.handleAjaxError)};var k={init:function(){l();c("#queue-listing-refresh-button").click(function(){var v=c("#queue-listing-table").data("connection");a(v)});var t={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:false,enableColumnReorder:false,autoEdit:false,rowHeight:24};var s=new n.Data.DataView({inlineFilters:false});s.setItems([]);var u=new n.Grid("#queue-listing-table",s,q(),t);u.setSelectionModel(new n.RowSelectionModel());u.registerPlugin(new n.AutoTooltips());u.onClick.subscribe(function(y,v){var x=c(y.target);var w=s.getItem(v.row);if(u.getColumns()[v.cell].id==="moreDetails"){if(x.hasClass("show-flowfile-details")){j(w)}}else{if(u.getColumns()[v.cell].id==="actions"){if(x.hasClass("view-provenance")){c("#shell-close-button").click();o.showPage("provenance?"+c.param({flowFileUuid:w.uuid}))}else{if(x.hasClass("download-flowfile-content")&&!x.hasClass("disabled")){b(w)}else{if(x.hasClass("view-flowfile-content")&&!x.hasClass("disabled")){f(w)}}}}}});s.onRowCountChanged.subscribe(function(w,v){u.updateRowCount();u.render();c("#displayed-flowfiles").text(v.current)});s.onRowsChanged.subscribe(function(w,v){u.invalidateRows(v.rows);u.render()});c("#queue-listing-table").data("gridInstance",u);c("#displayed-flowfiles").text("0")},initFlowFileDetailsDialog:function(){c("#content-download").on("click",b);if(h.isContentViewConfigured()){c("#content-view").show();c("#content-view").on("click",f)}c("#flowfile-details-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Details",tabContentId:"flowfile-details-tab-content"},{name:"Attributes",tabContentId:"flowfile-attributes-tab-content"}]});c("#flowfile-details-dialog").modal({scrollableContentStyle:"scrollable",headerText:"FlowFile",buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){c("#flowfile-details-dialog").modal("hide")}}}],handler:{close:function(){c("#flowfile-attributes-container").empty();c("#flowfile-cluster-node-id").text("");c("#additional-flowfile-details").empty()},open:function(){h.toggleScrollable(c("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}})},resetTableSize:function(){var s=c("#queue-listing-table").data("gridInstance");if(h.isDefinedAndNotNull(s)){s.resizeCanvas()}},listQueue:function(s){a(s).done(function(){var t="";if(s.permissions.canRead){t=m.formatConnectionName(s.component)}if(t===""){t="Connection"}c("#queue-listing-header-text").text(t);o.showContent("#queue-listing-container").done(function(){c("#queue-listing-table").removeData("connection");var v=c("#queue-listing-table").data("gridInstance");var u=v.getData();u.beginUpdate();u.setItems([],"uuid");u.endUpdate();c("#displayed-flowfiles, #total-flowfiles-count").text("0");c("#total-flowfiles-size").text(h.formatDataSize(0))});k.resetTableSize();c("#queue-listing-table").data("connection",s)})}};return k}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","nf.ErrorHandler","nf.Common","nf.Client","nf.Storage","nf.CanvasUtils","nf.ng.Bridge","nf.Dialog","nf.Shell"],function(h,d,k,e,l,i,f,j,g,c){return(nf.PolicyManagement=b(h,d,k,e,l,i,f,j,g,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.PolicyManagement=b(require("jquery"),require("Slick"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Client"),require("nf.Storage"),require("nf.CanvasUtils"),require("nf.ng.Bridge"),require("nf.Dialog"),require("nf.Shell")))}else{nf.PolicyManagement=b(a.$,a.Slick,a.nf.ErrorHandler,a.nf.Common,a.nf.Client,a.nf.Storage,a.nf.CanvasUtils,a.nf.ng.Bridge,a.nf.Dialog,a.nf.Shell)}}}(this,function(z,a,e,I,g,u,L,p,h,H){var D={urls:{api:"../nifi-api",searchTenants:"../nifi-api/tenants/search-results"}};var i=false;var j=false;var q=false;var v=function(){z("#new-policy-user-button").on("click",function(){z("#search-users-dialog").modal("show");z("#search-users-field").focus()});z("#delete-policy-button").on("click",function(){y()});z("#search-users-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Add Users/Groups",buttons:[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var O=z("#policy-table").data("gridInstance");var N=O.getData();N.beginUpdate();z.each(f(z("#allowed-users")),function(Q,P){N.addItem(P)});z.each(f(z("#allowed-groups")),function(P,Q){N.addItem(Q)});N.endUpdate();J();z("#search-users-dialog").modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){z("#search-users-dialog").modal("hide")}}}],handler:{close:function(){z("#search-users-field").userSearchAutocomplete("reset").val("");z("#allowed-users, #allowed-groups").empty()}}});z(document).on("click","div.remove-allowed-entity",function(){z(this).closest("li").remove()});z.widget("nf.userSearchAutocomplete",z.ui.autocomplete,{reset:function(){this.term=null},_create:function(){this._super();this.widget().menu("option","items","> :not(.search-no-matches)")},_normalize:function(O){var N=[];N.push(O);return N},_renderMenu:function(Q,O){var S=O[0];var P=K();var R=o();var N=this;z.each(S.userGroups,function(T,U){if(z.inArray(U.id,P)===-1){N._renderGroup(Q,z.extend({type:"group"},U))}});z.each(S.users,function(T,U){if(z.inArray(U.id,R)===-1){N._renderUser(Q,z.extend({type:"user"},U))}});if(Q.children().length===0){Q.append('<li class="unset search-no-matches">No users matched the search terms</li>')}},_resizeMenu:function(){var N=this.menu.element;N.width(z("#search-users-field").outerWidth()-2)},_renderUser:function(P,O){var N=z("<a></a>").text(O.component.identity);return z("<li></li>").data("ui-autocomplete-item",O).append(N).appendTo(P)},_renderGroup:function(O,N){var Q=z("<span></span>").text(N.component.identity);var P=z("<a></a>").append('<div class="fa fa-users"></div>').append(Q);return z("<li></li>").data("ui-autocomplete-item",N).append(P).appendTo(O)}});z("#search-users-field").userSearchAutocomplete({minLength:0,appendTo:"#search-users-results",position:{my:"left top",at:"left bottom",offset:"0 1"},source:function(O,N){z.ajax({type:"GET",data:{q:O.term},dataType:"json",url:D.urls.searchTenants}).done(function(P){N(P)})},select:function(N,O){A(O.item);z(this).val("");return false}})};var K=function(){var Q=z("#policy-table").data("gridInstance");var P=Q.getData();var O=[];var N=P.getItems();z.each(N,function(R,S){if(S.type==="group"){O.push(S.id)}});z.each(f(z("#allowed-groups")),function(R,S){O.push(S.id)});return O};var f=function(N){var O=[];N.children("li").each(function(Q,P){var R=z(P).data("tenant");if(I.isDefinedAndNotNull(R)){O.push(R)}});return O};var o=function(){var Q=z("#policy-table").data("gridInstance");var O=Q.getData();var P=[];var N=O.getItems();z.each(N,function(R,S){if(S.type==="user"){P.push(S.id)}});z.each(f(z("#allowed-users")),function(S,R){P.push(R.id)});return P};var A=function(N){var P=N.type==="user"?z("#allowed-users"):z("#allowed-groups");var Q=z("<span></span>").addClass("allowed-entity ellipsis").text(N.component.identity).ellipsis();var O=z("<div></div>").addClass("remove-allowed-entity fa fa-trash");z("<li></li>").data("tenant",N).append(Q).append(O).appendTo(P)};var d=function(N){return N==="controller"||N==="parameter-contexts"||N==="counters"||N==="policies"||N==="tenants"};var m=function(N){return N==="proxy"||N==="restricted-components"};var B=function(){z("#override-policy-dialog").modal({headerText:"Override Policy",buttons:[{buttonText:"Override",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){k(z("#copy-policy-radio-button").is(":checked"));z(this).modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){z(this).modal("hide")}}}],handler:{close:function(){z("#copy-policy-radio-button").prop("checked",true)}}});z("#create-policy-link, #add-local-admin-link").on("click",function(){k(false)});z("#override-policy-link").on("click",function(){z("#override-policy-dialog").modal("show")});z("#policy-type-list").combo({options:[I.getPolicyTypeListing("flow"),I.getPolicyTypeListing("controller"),I.getPolicyTypeListing("parameter-contexts"),I.getPolicyTypeListing("provenance"),I.getPolicyTypeListing("restricted-components"),I.getPolicyTypeListing("policies"),I.getPolicyTypeListing("tenants"),I.getPolicyTypeListing("site-to-site"),I.getPolicyTypeListing("system"),I.getPolicyTypeListing("proxy"),I.getPolicyTypeListing("counters")],select:function(X){if(i){z("#selected-policy-type").text(X.value);if(d(X.value)){z("#restricted-component-required-permissions").hide();z("#restriction-message").hide();z("#controller-policy-target").combo("setSelectedOption",{value:"read"}).show()}else{z("#controller-policy-target").hide();if(m(X.value)){z("#selected-policy-action").text("write")}else{z("#selected-policy-action").text("read")}if(X.value==="restricted-components"){if(!j){var W="regardless of restrictions";var T=L.getComponentRestrictions();var V=T.requiredPermissions;var U=[{text:W,value:"",description:"Allows users to create/modify all restricted components regardless of restrictions."}];V.each(function(Y,Z){if(Z!==X.value){U.push({text:"requiring '"+Y+"'",value:Z,description:"Allows users to create/modify restricted components requiring '"+I.escapeHtml(Y)+"'"})}});U.sort(function(Z,Y){if(Z.text===W){return -1}else{if(Y.text===W){return 1}}return Z.text<Y.text?-1:Z.text>Y.text?1:0});z("#restricted-component-required-permissions").combo({options:U,select:function(Y){if(Y.text===W){z("#restriction-message").hide()}else{z("#restriction-message").show()}b()}})}z("#restricted-component-required-permissions").show()}else{z("#restriction-message").hide();z("#restricted-component-required-permissions").hide()}b()}}}});z("#controller-policy-target").combo({options:[{text:"view",value:"read"},{text:"modify",value:"write"}],select:function(T){if(i){z("#selected-policy-action").text(T.value);b()}}});z("#component-policy-target").combo({options:[{text:"view the component",value:"read-component",description:"Allows users to view component configuration details"},{text:"modify the component",value:"write-component",description:"Allows users to modify component configuration details"},{text:"operate the component",value:"operate-component",description:"Allows users to operate components by changing component run status (start/stop/enable/disable), remote port transmission status, or terminating processor threads"},{text:"view provenance",value:"read-provenance",description:"Allows users to view provenance events generated by this component"},{text:"view the data",value:"read-data",description:"Allows users to view metadata and content for this component in flowfile queues in outbound connections and through provenance events"},{text:"modify the data",value:"write-data",description:"Allows users to empty flowfile queues in outbound connections and submit replays through provenance events"},{text:"receive data via site-to-site",value:"write-receive-data",description:"Allows this port to receive data from these NiFi instances",disabled:true},{text:"send data via site-to-site",value:"write-send-data",description:"Allows this port to send data to these NiFi instances",disabled:true},{text:"view the policies",value:"read-policies",description:"Allows users to view the list of users who can view/modify this component"},{text:"modify the policies",value:"write-policies",description:"Allows users to modify the list of users who can view/modify this component"}],select:function(T){if(i){var U=z("#selected-policy-component-type").text();if(T.value==="read-component"){z("#selected-policy-action").text("read")}else{if(T.value==="write-component"){z("#selected-policy-action").text("write")}else{if(T.value==="operate-component"){z("#selected-policy-action").text("write");U=("operation/"+U)}else{if(T.value==="read-data"){z("#selected-policy-action").text("read");U=("data/"+U)}else{if(T.value==="write-data"){z("#selected-policy-action").text("write");U=("data/"+U)}else{if(T.value==="read-provenance"){z("#selected-policy-action").text("read");U=("provenance-data/"+U)}else{if(T.value==="read-policies"){z("#selected-policy-action").text("read");U=("policies/"+U)}else{if(T.value==="write-policies"){z("#selected-policy-action").text("write");U=("policies/"+U)}else{if(T.value==="write-receive-data"){z("#selected-policy-action").text("write");U="data-transfer/input-ports"}else{if(T.value==="write-send-data"){z("#selected-policy-action").text("write");U="data-transfer/output-ports"}}}}}}}}}}z("#selected-policy-type").text(U);if(!q){b()}}}});var N=function(Y,U,X,W,T){var V="";if(T.type==="group"){V+='<div class="fa fa-users"></div>'}V+=I.escapeHtml(T.component.identity);return V};var R=function(aa,V,Z,X,U){var W="";var T=z("#policy-table").data("policy");var Y=z("#delete-policy-button").is(":disabled")===false;if(T.permissions.canWrite===true&&Y){W+='<div title="Remove" class="pointer delete-user fa fa-trash"></div>'}return W};var Q=[{id:"identity",name:"User",sortable:true,resizable:true,formatter:N}];if(L.isConfigurableAuthorizer()){Q.push({id:"actions",name:"&nbsp;",sortable:false,resizable:false,formatter:R,width:100,maxWidth:100})}var P={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false};var O=new a.Data.DataView({inlineFilters:false});O.setItems([]);M({columnId:"identity",sortAsc:true},O);var S=new a.Grid("#policy-table",O,Q,P);S.setSelectionModel(new a.RowSelectionModel());S.registerPlugin(new a.AutoTooltips());S.setSortColumn("identity",true);S.onSort.subscribe(function(U,T){M({columnId:T.sortCol.id,sortAsc:T.sortAsc},O)});S.onClick.subscribe(function(W,T){var V=z(W.target);var U=O.getItem(T.row);if(S.getColumns()[T.cell].id==="actions"){if(V.hasClass("delete-user")){G(U)}}});O.onRowCountChanged.subscribe(function(U,T){S.updateRowCount();S.render();z("#displayed-policy-users").text(T.current)});O.onRowsChanged.subscribe(function(U,T){S.invalidateRows(T.rows);S.render()});z("#policy-table").data("gridInstance",S);z("#displayed-policy-users").text("0")};var M=function(N,P){var O=function(S,Q){if(S.permissions.canRead&&Q.permissions.canRead){var R=I.isDefinedAndNotNull(S.component[N.columnId])?S.component[N.columnId]:"";var T=I.isDefinedAndNotNull(Q.component[N.columnId])?Q.component[N.columnId]:"";return R===T?0:R>T?1:-1}else{if(!S.permissions.canRead&&!Q.permissions.canRead){return 0}if(S.permissions.canRead){return 1}else{return -1}}};P.sort(O,N.sortAsc)};var G=function(N){h.showYesNoDialog({headerText:"Update Policy",dialogContent:"Remove '"+I.escapeHtml(N.component.identity)+"' from this policy?",yesHandler:function(){r(N)}})};var r=function(O){var P=z("#policy-table").data("gridInstance");var N=P.getData();N.beginUpdate();N.deleteItem(O.id);N.endUpdate();J()};var y=function(){h.showYesNoDialog({headerText:"Delete Policy",dialogContent:"By deleting this policy, the permissions for this component will revert to the inherited policy if applicable.",yesText:"Delete",noText:"Cancel",yesHandler:function(){l()}})};var l=function(){var N=z("#policy-table").data("policy");var O=g.getRevision(N);if(I.isDefinedAndNotNull(N)){z.ajax({type:"DELETE",url:N.uri+"?"+z.param(z.extend({disconnectedNodeAcknowledged:u.isDisconnectionAcknowledged()},O)),dataType:"json"}).done(function(){b()}).fail(function(R,P,Q){e.handleAjaxError(R,P,Q);t();b()})}else{h.showOkDialog({headerText:"Delete Policy",dialogContent:"No policy selected"})}};var n=function(){var N=z("#selected-policy-component-id").text();var P=z("#selected-policy-type").text();if(N!==""){P+=("/"+N)}if(P==="restricted-components"){var O=z("#restricted-component-required-permissions").combo("getSelectedOption").value;if(!I.isBlank(O)){P+=("/"+O)}}return{action:z("#selected-policy-action").text(),resource:"/"+P}};var E=function(R,P){var Q=z("#policy-table").data("gridInstance");var O=Q.getData();O.beginUpdate();var N=[];z.each(R,function(T,S){N.push(z.extend({type:"user"},S))});z.each(P,function(S,T){N.push(z.extend({type:"group"},T))});O.setItems(N);O.endUpdate();O.reSort();Q.invalidate();Q.getSelectionModel().setSelectedRows([])};var s=function(Q){if(Q==="/policies"){return z("<span>Showing effective policy inherited from all policies.</span>")}else{if(Q==="/controller"){return z("<span>Showing effective policy inherited from the controller.</span>")}else{if(Q==="/parameter-contexts"){return z("<span>Showing effective policy inherited from global parameter context policy.</span>")}else{var N=I.substringAfterLast(Q,"/");var P=N;var O=p.injector.get("breadcrumbsCtrl").getBreadcrumbs();z.each(O,function(R,S){if(S.id===N){P=S.label;return false}});return z("<span>Showing effective policy inherited from Process Group </span>").append(z('<span class="link ellipsis" style="max-width: 200px; vertical-align: top;"></span>').text(P).attr("title",P).on("click",function(){z("#shell-close-button").click();L.getComponentByType("ProcessGroup").enterGroup(N).done(function(){L.getSelection().classed("selected",false);p.digest()})})).append("<span>.</span>")}}}};var w=function(O){var P=O.component;var N=n();c();z("#policy-table").data("policy",O);if(N.resource===P.resource){if(L.isConfigurableAuthorizer()){z("#delete-policy-button").prop("disabled",P.configurable===false||O.permissions.canWrite===false);z("#new-policy-user-button").prop("disabled",P.configurable===false||O.permissions.canWrite===false)}}else{z("#policy-message").append(s(P.resource));if(L.isConfigurableAuthorizer()){z("#override-policy-message").show();z("#delete-policy-button").prop("disabled",true);z("#new-policy-user-button").prop("disabled",true)}}E(P.users,P.userGroups)};var b=function(){var N=n();var O;if(N.resource.startsWith("/policies")){if(N.resource.endsWith("/policies")){z("#admin-policy-message").show()}O=z.Deferred(function(P){z.ajax({type:"GET",url:"../nifi-api/policies/"+N.action+N.resource,dataType:"json"}).done(function(Q){z("#policy-last-refreshed").text(Q.generated);if(Q.permissions.canRead===true){var R=Q.component;if(N.resource===R.resource){w(Q)}else{t();z("#policy-message").text("No component specific administrators.");if(L.isConfigurableAuthorizer()){z("#add-local-admin-message").show()}}}else{t();z("#policy-message").text("No component specific administrators.");if(L.isConfigurableAuthorizer()){z("#add-local-admin-message").show()}}P.resolve()}).fail(function(S,Q,R){if(S.status===404){t();z("#policy-message").text("No component specific administrators.");if(L.isConfigurableAuthorizer()){z("#add-local-admin-message").show()}P.resolve()}else{if(S.status===403){t();z("#policy-message").text("Not authorized to access the policy for the specified resource.");P.resolve()}else{t();P.reject();e.handleAjaxError(S,Q,R)}}})}).promise()}else{if(N.resource.startsWith("/restricted-components")){z("#admin-policy-message").hide();O=z.Deferred(function(P){z.ajax({type:"GET",url:"../nifi-api/policies/"+N.action+N.resource,dataType:"json"}).done(function(Q){z("#policy-last-refreshed").text(Q.generated);if(Q.permissions.canRead===true){var R=Q.component;if(N.resource===R.resource){w(Q)}else{t();z("#policy-message").text("No restriction specific users.");if(L.isConfigurableAuthorizer()){z("#new-policy-message").show()}}}else{t();z("#policy-message").text("Not authorized to view the policy.");if(L.isConfigurableAuthorizer()){z("#new-policy-message").show()}}P.resolve()}).fail(function(S,Q,R){if(S.status===404){t();if(N.resource==="/restricted-components"){z("#policy-message").text('No users with permission "regardless of restrictions."')}else{z("#policy-message").text("No users with permission to specific restriction.")}if(L.isConfigurableAuthorizer()){z("#new-policy-message").show()}P.resolve()}else{if(S.status===403){t();z("#policy-message").text("Not authorized to access the policy for the specified resource.");P.resolve()}else{t();P.reject();e.handleAjaxError(S,Q,R)}}})}).promise()}else{z("#admin-policy-message").hide();O=z.Deferred(function(P){z.ajax({type:"GET",url:"../nifi-api/policies/"+N.action+N.resource,dataType:"json"}).done(function(Q){z("#policy-last-refreshed").text(Q.generated);if(Q.permissions.canRead===true){w(Q)}else{t();z("#policy-message").text("Not authorized to view the policy.");if(L.isConfigurableAuthorizer()){z("#override-policy-message").show()}}P.resolve()}).fail(function(S,Q,R){if(S.status===404){t();z("#policy-message").text("No policy for the specified resource.");if(L.isConfigurableAuthorizer()){z("#new-policy-message").show()}P.resolve()}else{if(S.status===403){t();z("#policy-message").text("Not authorized to access the policy for the specified resource.");P.resolve()}else{t();P.reject();e.handleAjaxError(S,Q,R)}}})}).promise()}}return O};var k=function(S){var R=n();var U=[];var Q=[];if(S===true){var T=z("#policy-table").data("gridInstance");var P=T.getData();var O=P.getItems();z.each(O,function(W,X){var V=z.extend({},X);if(V.type==="user"){U.push(V)}else{Q.push(V)}delete V.type})}var N={revision:g.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:u.isDisconnectionAcknowledged(),component:{action:R.action,resource:R.resource,users:U,userGroups:Q}};z.ajax({type:"POST",url:"../nifi-api/policies",data:JSON.stringify(N),dataType:"json",contentType:"application/json"}).done(function(V){if(V.permissions.canRead===true){w(V)}else{t();b()}}).fail(e.handleAjaxError)};var J=function(){var T=z("#policy-table").data("gridInstance");var R=T.getData();var S=[];var Q=[];var P=R.getItems();z.each(P,function(V,W){var U=z.extend({},W);if(U.type==="user"){S.push(U)}else{Q.push(U)}delete U.type});var N=z("#policy-table").data("policy");if(I.isDefinedAndNotNull(N)){var O={revision:g.getRevision(N),disconnectedNodeAcknowledged:u.isDisconnectionAcknowledged(),component:{id:N.id,users:S,userGroups:Q}};z.ajax({type:"PUT",url:N.uri,data:JSON.stringify(O),dataType:"json",contentType:"application/json"}).done(function(U){if(U.permissions.canRead===true){w(U)}else{t();b()}}).fail(function(W,U,V){e.handleAjaxError(W,U,V);t();b()}).always(function(){L.reload()})}else{h.showOkDialog({headerText:"Update Policy",dialogContent:"No policy selected"})}};var C=function(){H.showContent("#policy-management").always(function(){F()});x.resetTableSize()};var c=function(){z("#policy-message").text("").empty();if(L.isConfigurableAuthorizer()){z("#new-policy-message").hide();z("#override-policy-message").hide();z("#add-local-admin-message").hide()}};var t=function(){c();if(L.isConfigurableAuthorizer()){z("#delete-policy-button").prop("disabled",true);z("#new-policy-user-button").prop("disabled",true)}z("#policy-table").removeData("policy");E([],[])};var F=function(){t();z("#selected-policy-type").text("");z("#selected-policy-action").text("");z("#selected-policy-component-id").text("");z("#selected-policy-component-type").text("");z("div.policy-selected-component-container").hide()};var x={init:function(){v();B();if(L.isConfigurableAuthorizer()){z("#delete-policy-button").show();z("#new-policy-user-button").show()}z("#policy-refresh-button").on("click",function(){b()});t();i=true},resetTableSize:function(){var N=z("#policy-table");if(N.is(":visible")){var O=N.data("gridInstance");if(I.isDefinedAndNotNull(O)){O.resizeCanvas()}}},showControllerServicePolicy:function(N){q=true;c();z("#component-policy-controls").show();z("#global-policy-controls").hide();if(N.permissions.canRead===true){z("#policy-selected-controller-service-container div.policy-selected-component-name").text(N.component.name)}else{z("#policy-selected-controller-service-container div.policy-selected-component-name").text(N.id)}z("#policy-selected-controller-service-container").show();z("#selected-policy-component-id").text(N.id);z("#selected-policy-component-type").text("controller-services");z("#component-policy-target").combo("setOptionEnabled",{value:"write-receive-data"},false).combo("setOptionEnabled",{value:"write-send-data"},false).combo("setOptionEnabled",{value:"read-data"},false).combo("setOptionEnabled",{value:"read-provenance"},false).combo("setOptionEnabled",{value:"write-data"},false).combo("setSelectedOption",{value:"read-component"});q=false;return b().always(C)},showReportingTaskPolicy:function(N){q=true;c();z("#component-policy-controls").show();z("#global-policy-controls").hide();if(N.permissions.canRead===true){z("#policy-selected-reporting-task-container div.policy-selected-component-name").text(N.component.name)}else{z("#policy-selected-reporting-task-container div.policy-selected-component-name").text(N.id)}z("#policy-selected-reporting-task-container").show();z("#selected-policy-component-id").text(N.id);z("#selected-policy-component-type").text("reporting-tasks");z("#component-policy-target").combo("setOptionEnabled",{value:"write-receive-data"},false).combo("setOptionEnabled",{value:"write-send-data"},false).combo("setOptionEnabled",{value:"read-data"},false).combo("setOptionEnabled",{value:"read-provenance"},false).combo("setOptionEnabled",{value:"write-data"},false).combo("setSelectedOption",{value:"read-component"});q=false;return b().always(C)},showTemplatePolicy:function(N){q=true;c();z("#component-policy-controls").show();z("#global-policy-controls").hide();if(N.permissions.canRead===true){z("#policy-selected-template-container div.policy-selected-component-name").text(N.template.name)}else{z("#policy-selected-template-container div.policy-selected-component-name").text(N.id)}z("#policy-selected-template-container").show();z("#selected-policy-component-id").text(N.id);z("#selected-policy-component-type").text("templates");z("#component-policy-target").combo("setOptionEnabled",{value:"operate-component"},false).combo("setOptionEnabled",{value:"write-receive-data"},false).combo("setOptionEnabled",{value:"write-send-data"},false).combo("setOptionEnabled",{value:"read-data"},false).combo("setOptionEnabled",{value:"read-provenance"},false).combo("setOptionEnabled",{value:"write-data"},false).combo("setSelectedOption",{value:"read-component"});q=false;return b().always(C)},showParameterContextPolicy:function(N){q=true;c();z("#component-policy-controls").show();z("#global-policy-controls").hide();if(N.permissions.canRead===true){z("#policy-selected-parameter-context-container div.policy-selected-component-name").text(N.component.name)}else{z("#policy-selected-parameter-context-container div.policy-selected-component-name").text(N.id)}z("#policy-selected-parameter-context-container").show();z("#selected-policy-component-id").text(N.id);z("#selected-policy-component-type").text("parameter-contexts");z("#component-policy-target").combo("setOptionEnabled",{value:"operate-component"},false).combo("setOptionEnabled",{value:"write-receive-data"},false).combo("setOptionEnabled",{value:"write-send-data"},false).combo("setOptionEnabled",{value:"read-data"},false).combo("setOptionEnabled",{value:"read-provenance"},false).combo("setOptionEnabled",{value:"write-data"},false).combo("setSelectedOption",{value:"read-component"});q=false;return b().always(C)},showComponentPolicy:function(N){q=true;c();z("#component-policy-controls").show();z("#global-policy-controls").hide();z("#policy-selected-component-container").show();var O;if(N.empty()){z("#selected-policy-component-id").text(L.getGroupId());O="process-groups";z("#component-policy-target").combo("setOptionEnabled",{value:"operate-component"},true).combo("setOptionEnabled",{value:"write-receive-data"},false).combo("setOptionEnabled",{value:"write-send-data"},false).combo("setOptionEnabled",{value:"read-data"},true).combo("setOptionEnabled",{value:"read-provenance"},true).combo("setOptionEnabled",{value:"write-data"},true)}else{var P=N.datum();z("#selected-policy-component-id").text(P.id);if(L.isProcessor(N)){O="processors"}else{if(L.isProcessGroup(N)){O="process-groups"}else{if(L.isInputPort(N)){O="input-ports"}else{if(L.isOutputPort(N)){O="output-ports"}else{if(L.isRemoteProcessGroup(N)){O="remote-process-groups"}else{if(L.isLabel(N)){O="labels"}else{if(L.isFunnel(N)){O="funnels"}}}}}}}z("#component-policy-target").combo("setOptionEnabled",{value:"operate-component"},!L.isLabel(N)).combo("setOptionEnabled",{value:"write-receive-data"},L.isInputPort(N)&&P.allowRemoteAccess===true).combo("setOptionEnabled",{value:"write-send-data"},L.isOutputPort(N)&&P.allowRemoteAccess===true).combo("setOptionEnabled",{value:"read-data"},!L.isLabel(N)).combo("setOptionEnabled",{value:"write-data"},!L.isLabel(N))}z("#selected-policy-component-type").text(O);z("#component-policy-target").combo("setSelectedOption",{value:"read-component"});q=false;return b().always(C)},showGlobalPolicies:function(){c();z("#component-policy-controls").hide();z("#global-policy-controls").show();var N=z("#policy-type-list").combo("getSelectedOption").value;z("#selected-policy-type").text(N);if(d(N)){z("#selected-policy-action").text(z("#controller-policy-target").combo("getSelectedOption").value)}else{if(m(N)){z("#selected-policy-action").text("write")}else{z("#selected-policy-action").text("read")}}return b().always(C)}};return x}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","d3","nf.Client","nf.Dialog","nf.Storage","nf.Common","nf.CanvasUtils","nf.ng.Bridge","nf.ErrorHandler","nf.FilteredDialogCommon","nf.Shell","nf.ComponentState","nf.ComponentVersion","nf.PolicyManagement","nf.Processor","nf.ProcessGroup","nf.ProcessGroupConfiguration","lodash-core"],function(f,o,r,t,m,g,j,n,u,h,e,q,c,d,p,l,i,k,s){return(nf.ParameterContexts=b(f,o,r,t,m,g,j,n,u,h,e,q,c,d,p,l,i,k,s))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ParameterContexts=b(require("jquery"),require("Slick"),require("d3"),require("nf.Client"),require("nf.Dialog"),require("nf.Storage"),require("nf.Common"),require("nf.CanvasUtils"),require("nf.ng.Bridge"),require("nf.ErrorHandler"),require("nf.FilteredDialogCommon"),require("nf.Shell"),require("nf.ComponentState"),require("nf.ComponentVersion"),require("nf.PolicyManagement"),require("nf.Processor"),require("nf.ProcessGroup"),require("nf.ProcessGroupConfiguration"),require("lodash-core")))}else{nf.ParameterContexts=b(a.$,a.Slick,a.d3,a.nf.Client,a.nf.Dialog,a.nf.Storage,a.nf.Common,a.nf.CanvasUtils,a.nf.ng.Bridge,a.nf.ErrorHandler,a.nf.FilteredDialogCommon,a.nf.Shell,a.nf.ComponentState,a.nf.ComponentVersion,a.nf.PolicyManagement,a.nf.Processor,a.nf.ProcessGroup,a.nf.ProcessGroupConfiguration,a._)}}}(this,function(D,a,U,e,g,r,T,ac,m,b,aa,S,d,s,x,p,A,G,ah){var K={urls:{parameterContexts:"../nifi-api/parameter-contexts"}};var z={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false,rowHeight:24};var f={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,editable:false,enableAddRow:false,autoEdit:false,multiSelect:false,rowHeight:24};var v=function(am,aj,al,ak,ai){if(!ai.permissions.canRead){return'<span class="blank">'+T.escapeHtml(ai.id)+"</span>"}return T.escapeHtml(ai.component.name)};var ae=function(ai,ak){var aj=function(an,al){if(an.permissions.canRead&&al.permissions.canRead){var am=ah.get(an,"component["+ai.columnId+"]","");var ao=ah.get(al,"component["+ai.columnId+"]","");return am===ao?0:am>ao?1:-1}else{if(!an.permissions.canRead&&!al.permissions.canRead){return 0}if(an.permissions.canRead){return 1}else{return -1}}};ak.sort(aj,ai.sortAsc)};var L=null;var ag=function(ai,ak){var aj=function(an,al){if(ai.columnId==="name"){var am=ah.get(an,"["+ai.columnId+"]","");var ao=ah.get(al,"["+ai.columnId+"]","");return am===ao?0:am>ao?1:-1}};ak.sort(aj,ai.sortAsc)};var l=function(){D("#parameter-context-name").val("");D("#parameter-context-name-read-only").text("");D("#parameter-context-description-field").val("");D("#parameter-context-description-read-only").text("");D("#parameter-table, #add-parameter").show();D("#parameter-context-tabs").show();D("#parameter-context-tabs").find(".tab")[0].click();D("#parameter-context-update-status").hide();D("#process-group-parameter").text("");D("#parameter-process-group-id").text("").removeData("revision");D("#parameter-referencing-components-context").removeClass("unset").attr("title","").text("");var ai=D("#parameter-table").data("gridInstance");var aj=ai.getData();aj.setItems([]);Y();L=null;F=0;t=null;T.cleanUpTooltips(D("#parameter-table"),"div.fa-question-circle")};var q=function(){D("#parameter-name").val("");D("#parameter-value-field").val("");D("#parameter-description-field").val("");D("#parameter-sensitive-radio-button").prop("checked",false);D("#parameter-not-sensitive-radio-button").prop("checked",false);D("#parameter-name").prop("disabled",false);D("#parameter-sensitive-radio-button").prop("disabled",false);D("#parameter-not-sensitive-radio-button").prop("disabled",false);D("#parameter-set-empty-string-field").removeClass("checkbox-checked").addClass("checkbox-unchecked");D("#parameter-value-field").prop("disabled",false)};var i=function(){var al=[];var ak=D("#parameter-table");var ai=ak.data("gridInstance");var aj=ai.getData();D.each(aj.getItems(),function(){var am={name:this.name};if(this.hidden===true&&this.isNew!==true){al.push({parameter:am})}else{if(this.isNew===true){am.value=this.value;am.sensitive=this.sensitive;am.description=this.description;al.push({parameter:am})}else{if(this.isModified===true){am.sensitive=this.sensitive;if(this.hasValueChanged){am.value=this.value}am.description=this.description;al.push({parameter:am})}}}});return al};var y=function(){if(!D("#parameter-dialog").hasClass("hidden")){h()}return D.Deferred(function(ai){if(D("#parameter-context-update-status").is(":visible")){R();ai.resolve()}else{var aj=i();if(D.isEmptyObject(aj)){R();ai.resolve()}else{g.showYesNoDialog({headerText:"Parameters",dialogContent:"Save changes before leaving parameter context configuration?",noHandler:function(){R();ai.resolve()},yesHandler:function(){C(t).done(function(){ai.resolve()}).fail(function(){ai.reject()})}})}}}).promise()};var V=function(ai){var aj=ai.get(0).scrollHeight>Math.round(ai.innerHeight())||ai.get(0).scrollWidth>Math.round(ai.innerWidth());if(ai.is(":visible")&&aj){ai.css("border-width","1px")}else{ai.css("border-width","0px")}};var R=function(){D("#parameter-context-dialog").modal("hide")};var Q=function(al,aj){var ai=D('<li class="referencing-component-container"></li>').appendTo(aj);var ak=al.component;D('<div class="referencing-component-state"></div>').addClass(function(){if(T.isDefinedAndNotNull(ak.state)){var am=D(this);var ao=ak.state.toLowerCase();if(ao==="stopped"&&!T.isEmpty(ak.validationErrors)){ao="invalid";var an=T.formatUnorderedList(ak.validationErrors);am.qtip(D.extend({},ac.config.systemTooltipConfig,{content:an}))}return ao}else{return""}}).appendTo(ai);D('<span class="parameter-context-referencing-component-name link ellipsis"></span>').prop("title",ak.name).text(ak.name).on("click",function(){y().done(function(){D("#shell-dialog").modal("hide");ac.showComponent(al.processGroup.id,ak.id)})}).appendTo(ai);D('<div class="referencing-component-bulletins"></div>').addClass(ak.id+"-referencing-bulletins").appendTo(ai);D('<span class="referencing-component-active-thread-count"></span>').text(function(){if(T.isDefinedAndNotNull(ak.activeThreadCount)&&ak.activeThreadCount>0){return"("+ak.activeThreadCount+")"}else{return""}}).appendTo(ai)};var w=function(ak,ai){var al=D('<li class="referencing-component-container"></li>').appendTo(ai);var aj=ak.component;D('<div class="referencing-component-state"></div>').addClass(function(){if(T.isDefinedAndNotNull(aj.state)){var am=D(this);var ao=aj.state==="ENABLED"?"enabled":"disabled";if(ao==="disabled"&&!T.isEmpty(aj.validationErrors)){ao="invalid";var an=T.formatUnorderedList(aj.validationErrors);am.qtip(D.extend({},ac.config.systemTooltipConfig,{content:an}))}return ao}else{return""}}).appendTo(al);D('<div class="referencing-component-bulletins"></div>').addClass(aj.id+"-referencing-bulletins").appendTo(al);D('<span class="parameter-context-referencing-component-name link ellipsis"></span>').prop("title",aj.name).text(aj.name).on("click",function(){y().done(function(){D("#shell-dialog").modal("hide");A.enterGroup(aj.processGroupId);G.showConfiguration(aj.processGroupId).done(function(){G.selectControllerService(aj.id)})})}).appendTo(al)};var Z=function(aq){var al=function(aw,av){if(aw.hasClass("expanded")){aw.removeClass("expanded").addClass("collapsed");av.hide()}else{aw.removeClass("collapsed").addClass("expanded");av.show()}};var am=[];var an=[];var ap=[];Y();var ao=D("#parameter-referencing-components-container");if(T.isUndefined(aq)){D('<div class="referencing-component-container"><span class="unset">Pending Apply</span></div>').appendTo(ao)}else{var au=[];D.each(aq,function(av,aw){if(aw.permissions.canRead===true&&aw.permissions.canWrite===true){au.push(aw.id);if(aw.component.referenceType==="PROCESSOR"){am.push(aw)}else{an.push(aw)}}else{if(aw.permissions.canRead===true){au.push(aw.id)}ap.push(aw)}});var aj={};D.each(am,function(av,aw){if(aj[aw.processGroup.id]){aj[aw.processGroup.id].referencingProcessors.push(aw);aj[aw.processGroup.id].id=aw.processGroup.id;aj[aw.processGroup.id].name=aw.processGroup.name}else{aj[aw.processGroup.id]={referencingProcessors:[],referencingControllerServices:[],unauthorizedReferencingComponents:[],name:aw.processGroup.name,id:aw.processGroup.id};aj[aw.processGroup.id].referencingProcessors.push(aw)}});D.each(an,function(av,aw){if(aj[aw.processGroup.id]){aj[aw.processGroup.id].referencingControllerServices.push(aw);aj[aw.processGroup.id].id=aw.processGroup.id;aj[aw.processGroup.id].name=aw.processGroup.name}else{aj[aw.processGroup.id]={referencingProcessors:[],referencingControllerServices:[],unauthorizedReferencingComponents:[],name:aw.processGroup.name,id:aw.processGroup.id};aj[aw.processGroup.id].referencingControllerServices.push(aw)}});D.each(ap,function(aw,av){if(aj[av.processGroup.id]){aj[av.processGroup.id].unauthorizedReferencingComponents.push(av);aj[av.processGroup.id].id=av.processGroup.id;aj[av.processGroup.id].name=av.processGroup.name}else{aj[av.processGroup.id]={referencingProcessors:[],referencingControllerServices:[],unauthorizedReferencingComponents:[],name:av.processGroup.name,id:av.processGroup.id};aj[av.processGroup.id].unauthorizedReferencingComponents.push(av)}});var ao=D("#parameter-referencing-components-container");var ak=D('<ul class="referencing-component-listing clear"></ul>');var ar=[];for(var at in aj){if(aj.hasOwnProperty(at)){ar.push(aj[at])}}var ai=ar.sort(function(aw,av){if(aw.name<av.name){return -1}if(aw.name>av.name){return 1}return 0});ai.forEach(function(av){var aw=D('<div class="referencing-component-references"></div>');ao.append(aw);var ax=function(aA,aC){var aE=D('<div class="expansion-button collapsed"></div>');var aD=D('<span class="referencing-component-title"></span>').text(aA.name);var aB=D('<span class="referencing-component-count"></span>').text("("+(aA.referencingProcessors.length+aA.referencingControllerServices.length+aA.unauthorizedReferencingComponents.length)+")");var ay=D("#referencing-components-template").clone();ay.removeAttr("id");ay.removeClass("hidden");var az=D('<div class="referencing-component-block pointer unselectable"></div>').data("processGroupId",aA.id).on("click",function(){if(aE.hasClass("collapsed")){az.append(ay);var aH=az.find(".parameter-context-referencing-processors");T.cleanUpTooltips(aH,"div.referencing-component-state");T.cleanUpTooltips(aH,"div.referencing-component-bulletins");aH.empty();var aG=az.find(".parameter-context-referencing-controller-services");T.cleanUpTooltips(aG,"div.referencing-component-state");T.cleanUpTooltips(aG,"div.referencing-component-bulletins");aG.empty();var aF=az.find(".parameter-context-referencing-unauthorized-components").empty();if(aj[D(this).data("processGroupId")].referencingProcessors.length===0){D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(aH)}else{aj[D(this).data("processGroupId")].referencingProcessors.sort(ab);D.each(aj[D(this).data("processGroupId")].referencingProcessors,function(aI,aJ){Q(aJ,aH)})}if(aj[D(this).data("processGroupId")].referencingControllerServices.length===0){D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(aG)}else{aj[D(this).data("processGroupId")].referencingControllerServices.sort(ab);D.each(aj[D(this).data("processGroupId")].referencingControllerServices,function(aI,aJ){w(aJ,aG)})}if(aj[D(this).data("processGroupId")].unauthorizedReferencingComponents.length===0){D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(aF)}else{aj[D(this).data("processGroupId")].unauthorizedReferencingComponents.sort(function(aJ,aI){if(aJ.permissions.canRead===true&&aI.permissions.canRead===true){var aK=aJ.component.referenceType===aI.component.referenceType?0:aJ.component.referenceType>aI.component.referenceType?-1:1;if(aK===0){aK=aJ.component.name===aI.component.name?0:aJ.component.name>aI.component.name?1:-1}return aK}else{if(aJ.permissions.canRead===false&&aI.permissions.canRead===false){return aJ.id>aI.id?1:-1}else{if(aJ.permissions.canRead===true){return -1}else{return 1}}}});D.each(aj[D(this).data("processGroupId")].unauthorizedReferencingComponents,function(aJ,aI){if(aI.permissions.canRead===true){if(aI.component.referenceType==="PROCESSOR"){Q(aI,aF)}else{w(aI,aF)}}else{var aK=D('<li class="referencing-component-container"></li>').appendTo(aF);D('<span class="parameter-context-referencing-component-name link ellipsis"></span>').prop("title",aI.id).text(aI.id).on("click",function(){y().done(function(){D("#shell-dialog").modal("hide");if(aI.referenceType==="PROCESSOR"){ac.showComponent(aI.processGroup.id,aI.id)}else{if(aI.referenceType==="CONTROLLER_SERVICE"){G.showConfiguration(aI.processGroup.id).done(function(){A.enterGroup(aI.processGroup.id);G.selectControllerService(aI.id)})}}})}).appendTo(aK)}})}if(au.length>0){ac.queryBulletins(au).done(function(aJ){var aK=aJ.bulletinBoard.bulletins;var aI=U.nest().key(function(aL){return aL.sourceId}).map(aK,U.map);aI.each(function(aL,aM){D("div."+aM+"-referencing-bulletins").each(function(){var aO=D(this);if(aL.length>0){var aN=T.getFormattedBulletins(aL);var aP=T.formatUnorderedList(aN);aO.addClass("has-bulletins").show().qtip(D.extend({},ac.config.systemTooltipConfig,{content:aP}))}})})})}}else{az.find(".referencing-components-template").remove()}al(aE,aC);V(D("#parameter-referencing-components-container"))}).append(aE).append(aD).append(aB).appendTo(aw);aC.appendTo(aw);az.click()};ax(av,ak)})}};var ab=function(aj,ai){return aj.component.name.localeCompare(ai.component.name)};var h=function(){var am=c();var ai=D("#parameter-table").data("gridInstance");var aj=ai.getData();var ak=ad(am,aj.getItems());if(ak){var an=ah.extend({},am,{id:ah.defaultTo(am.id,X),hidden:false,type:"Parameter",previousValue:null,previousDescription:null,isEditable:true,isModified:true,hasValueChanged:false,isNew:true,});if(ah.isNil(am.id)){aj.addItem(an)}else{aj.updateItem(am.id,an)}aj.reSort();var al=aj.getRowById(X);ai.setActiveCell(al,ai.getColumnIndex("value"));X++;D("#parameter-dialog").modal("hide")}D("#parameter-context-dialog").modal("refreshButtons")};var c=function(aq){var ai=D.trim(D("#parameter-name").val());var an=D("#parameter-value-field").val();var ak=D("#parameter-set-empty-string-field").hasClass("checkbox-checked");var ao=D("#parameter-description-field").val();var al=D("#parameter-dialog").find('input[name="sensitive"]:checked').val()==="sensitive"?true:false;var aj=function(){if(!this.isNew){if(ah.isEmpty(this.value)&&!this.isEmptyStringSet){return false}}return true};var am={name:ai,value:null,description:null,sensitive:al,isEmptyStringSet:ak,previousValue:null,isNew:true};var ap=j(D("#parameter-value-field"),ah.isNil(aq)?am:aq,ak);return{name:ai,value:ap.value,description:ao,sensitive:al,isEmptyStringSet:ak,hasValueChanged:ap.hasChanged,hasDescriptionChanged:ao!==ah.get(aq,"description",""),isValueValid:aj}};var ad=function(an,am,al){if(an.name===""){g.showOkDialog({headerText:"Configuration Error",dialogContent:"The name of the parameter must be specified."});return false}var ai=/^[a-zA-Z0-9-_. ]+$/;if(!ai.test(an.name)){g.showOkDialog({headerText:"Configuration Error",dialogContent:"The name of the parameter appears to have an invalid character or characters. Only alpha-numeric characters (a-z, A-Z, 0-9), hyphens (-), underscores (_), periods (.), and spaces ( ) are accepted."});return false}var ak=ah.find(am,{name:an.name});if(ah.isNil(ak)||(al===true&&!ah.isNil(ak))){return true}else{var aj=ah.get(ak,"hidden",false);if(aj&&ak.sensitive!==an.sensitive){g.showOkDialog({headerText:"Parameter Exists",dialogContent:"A parameter with this name has been marked for deletion. Please apply this change to delete this parameter from the parameter context before recreating it with a different sensitivity."})}else{if(aj&&ak.sensitive===an.sensitive){an.id=ak.id;return true}else{g.showOkDialog({headerText:"Parameter Exists",dialogContent:"A parameter with this name already exists."})}}return false}};var j=function(aj,an,am){var ai;var al=aj.val();if(!am&&ah.isEmpty(al)){al=null}var ak=an.value!==al;if(!T.isBlank(al)){if(!ah.isEmpty(an)&&an.sensitive===true&&aj.hasClass("sensitive")&&an.isNew===false){ai=an.previousValue;ak=false}else{ai=al;if(!ak&&!ah.isEmpty(an)&&an.sensitive===true&&an.isNew===false){ak=true}}}else{if(am){ai=""}else{ai=null}}return{value:ai,hasChanged:ak}};var k=function(aj){var ai=c(aj);var ak=D("#parameter-table").data("gridInstance");var al=ak.getData();var am=ad(ai,al.getItems(),true);if(am){var ao=ah.extend({},aj,{id:aj.id,hidden:false,type:"Parameter",sensitive:aj.sensitive,name:aj.name,description:ai.description,referencingComponents:aj.referencingComponents,previousValue:aj.value,previousDescription:aj.description,isEditable:aj.isEditable,isEmptyStringSet:ai.isEmptyStringSet,isNew:aj.isNew,hasValueChanged:ai.hasValueChanged,hasDescriptionChanged:ai.hasDescriptionChanged,value:ai.value,isModified:ai.hasValueChanged||ai.hasDescriptionChanged});al.updateItem(aj.id,ao);al.reSort();var an=al.getRowById(aj.id);ak.setActiveCell(an,ak.getColumnIndex("value"));D("#parameter-dialog").modal("hide")}D("#parameter-context-dialog").modal("refreshButtons")};var O=function(al){var aj=i();var ak=D("#parameter-context-name").val();var ai=D("#parameter-context-description-field").val();if(ah.isEmpty(aj)&&ak===ah.get(al,"component.name")&&ai===ah.get(al,"component.description")){return false}else{return true}};var C=function(aj){var ai=i();if(ai.length===0){aj.component.parameters=[];if(D("#parameter-context-name").val()===aj.component.name&&D("#parameter-context-description-field").val()===aj.component.description){R();return}}else{aj.component.parameters=ai}aj.component.name=D("#parameter-context-name").val();aj.component.description=D("#parameter-context-description-field").val();return D.Deferred(function(ak){var an=function(){D("#parameter-context-dialog").modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){ak.resolve();R()}}}])};var ap=function(){D("#parameter-context-dialog").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){if(D("#parameter-context-name").val()!==""&&O(aj)){return false}return true},handler:{click:function(){if(D("#parameter-referencing-components-container").is(":visible")){V(D("#parameter-referencing-components-container"))}C(aj)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){ak.resolve();if(D("#parameter-referencing-components-container").is(":visible")){V(D("#parameter-referencing-components-container"))}R()}}}])};var al=false;D("#parameter-context-dialog").modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){al=true;if(D("#parameter-referencing-components-container").is(":visible")){V(D("#parameter-referencing-components-container"))}an()}}}]);var ao;var am=function(at,aq,ar){if(T.isDefinedAndNotNull(ao)){P(aj.id,ao)}D("#parameter-context-update-steps").find("div.parameter-context-step.ajax-loading").removeClass("ajax-loading").addClass("ajax-error");if(D("#parameter-referencing-components-container").is(":visible")){V(D("#parameter-referencing-components-container"))}ap()};u(aj).done(function(aq){var ar=function(az){var ay=az.request;var av=T.isDefinedAndNotNull(ay.failureReason);ao=ay.requestId;Z(ay.referencingComponents);var au=[];D.each(ai,function(aA,aB){au.push(aB.parameter.name)});D("#parameter-referencing-components-context").removeClass("unset").attr("title",au.join(", ")).text(au.join(", "));B(ay.updateSteps,al,av);if(al){P(aj.id,ao)}else{if(ay.complete===true){if(av){g.showOkDialog({headerText:"Parameter Context Update Error",dialogContent:"Unable to complete parameter context update request: "+T.escapeHtml(ay.failureReason)})}D.each(ay.referencingComponents,function(aA,aC){if(aC.permissions.canRead===true){var aB=aC.component;if(aB.referenceType==="PROCESSOR"&&ac.getGroupId()===aB.processGroupId){p.reload(aB.id)}}});var at=D("#parameter-contexts-table").data("gridInstance");if(T.isDefinedAndNotNull(at)){var ax=at.getData();D.extend(aj,{revision:az.parameterContextRevision,component:az.request.parameterContext});var aw=ax.getItemById(aj.id);if(T.isDefinedAndNotNull(aw)){ax.updateItem(aj.id,aj)}}P(aj.id,ao);an();V(D("#parameter-referencing-components-container"))}else{setTimeout(function(){o(aj.id,ao).done(function(aA){ar(aA)}).fail(am)},2000)}}};D("#parameter-table, #add-parameter").hide();D("#parameter-context-tabs").find(".tab")[1].click();D("#parameter-context-tabs").hide();D("#parameter-context-update-status").show();ar(aq)}).fail(am)}).promise()};var o=function(ai,aj){return D.ajax({type:"GET",url:K.urls.parameterContexts+"/"+encodeURIComponent(ai)+"/update-requests/"+encodeURIComponent(aj),dataType:"json"}).fail(b.handleAjaxError)};var P=function(ai,aj){return D.ajax({type:"DELETE",url:K.urls.parameterContexts+"/"+encodeURIComponent(ai)+"/update-requests/"+encodeURIComponent(aj)+"?"+D.param({disconnectedNodeAcknowledged:r.isDisconnectionAcknowledged()}),dataType:"json"}).fail(b.handleAjaxError)};var u=function(ai){return D.ajax({type:"POST",data:JSON.stringify(ai),url:K.urls.parameterContexts+"/"+encodeURIComponent(ai.id)+"/update-requests",dataType:"json",contentType:"application/json"}).fail(b.handleAjaxError)};var B=function(al,ak,aj){var ai=D("#parameter-context-update-steps").empty();D.each(al,function(ao,an){var am=D("<li></li>").text(an.description).appendTo(ai);D('<div class="parameter-context-step"></div>').addClass(function(){if(T.isDefinedAndNotNull(an.failureReason)){return"ajax-error"}else{if(an.complete===true){return"ajax-complete"}else{return ak===true||aj===true?"ajax-error":"ajax-loading"}}}).appendTo(am);D('<div class="clear"></div>').appendTo(am)})};var X=0;var F=0;var M=function(am,aj,an){if(T.isDefinedAndNotNull(am)){var ai=D("#parameter-table").data("gridInstance");var al=ai.getData();al.beginUpdate();var ak=[];D.each(am.component.parameters,function(ao,ap){var aq={id:X++,hidden:false,type:"Parameter",isNew:false,isModified:false,hasValueChanged:false,name:ap.parameter.name,value:ap.parameter.value,sensitive:ap.parameter.sensitive,description:ap.parameter.description,previousValue:ap.parameter.value,previousDescription:ap.parameter.description,isEditable:ah.defaultTo(an,false)?false:ap.canWrite,referencingComponents:ap.parameter.referencingComponents};ak.push({parameter:aq});al.addItem(aq)});al.endUpdate();al.reSort();if(T.isDefinedAndNotNull(aj)){D.each(ak,function(ao,ap){if(ap.parameter.name===aj){F=al.getRowById(ap.parameter.id);return false}})}else{F=0}if(ak.length===0){Y()}else{ai.setSelectedRows([F])}}};var Y=function(){var ak=D(".parameter-context-referencing-processors");T.cleanUpTooltips(ak,"div.referencing-component-state");T.cleanUpTooltips(ak,"div.referencing-component-bulletins");ak.empty();var aj=D(".parameter-context-referencing-controller-services");T.cleanUpTooltips(aj,"div.referencing-component-state");T.cleanUpTooltips(aj,"div.referencing-component-bulletins");aj.empty();var ai=D(".parameter-context-referencing-unauthorized-components").empty();D("#parameter-referencing-components-container").empty();L=null;D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(ak);D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(aj);D('<li class="referencing-component-container"><span class="unset">None</span></li>').appendTo(ai);D("#parameter-referencing-components-context").addClass("unset").attr("title","None").text("None");V(D("#parameter-referencing-components-container"))};var E=function(aj,ai){return aj.hidden===false};var H=function(){var ak=D("#parameter-table");var an=function(ax,aq,av,ar,ap){var aw=30;var at=D("<div></div>");var au=D("<span/>").addClass("table-cell").text(av).appendTo(at);if(ap.type==="required"){au.addClass("required")}if(!T.isBlank(ap.description)){D('<div class="fa fa-question-circle" alt="Info" style="float: right;"></div>').appendTo(at);D('<span class="hidden parameter-row"></span>').text(ax).appendTo(at);aw=46}au.width(ar.width-aw).ellipsis();return at.html()};var aj=function(au,aq,at,ar,ap){if(ap.sensitive===true&&!ah.isNil(at)){return'<span class="table-cell sensitive">Sensitive value set</span>'}else{if(at===""){return'<span class="table-cell blank">Empty string set</span>'}else{if(ah.isNil(at)){return'<span class="unset">No value set</span>'}else{return T.escapeHtml(at)}}}};var al=function(av,aq,au,at,ap){var ar="";if(ap.isEditable===true){ar+='<div title="Edit" class="edit-parameter pointer fa fa-pencil"></div>';ar+='<div title="Delete" class="delete-parameter pointer fa fa-trash"></div>'}return ar};var ao=[{id:"name",name:"Name",field:"name",formatter:an,sortable:true,resizable:true,rerenderOnResize:true},{id:"value",name:"Value",field:"value",formatter:aj,sortable:false,resizable:true},{id:"actions",name:"&nbsp;",resizable:false,rerenderOnResize:true,formatter:al,sortable:false,width:90,maxWidth:90}];var am=new a.Data.DataView({inlineFilters:false});am.setFilterArgs({searchString:"",property:"hidden"});am.setFilter(E);ag({columnId:"name",sortAsc:true},am);var ai=new a.Grid(ak,am,ao,f);ai.setSelectionModel(new a.RowSelectionModel());ai.registerPlugin(new a.AutoTooltips());ai.setSortColumn("name",true);ai.onSort.subscribe(function(aq,ap){ag({columnId:ap.sortCol.id,sortAsc:ap.sortAsc},am)});ai.onClick.subscribe(function(au,aw){var ax=am.getItem(aw.row);if(ai.getColumns()[aw.cell].id==="actions"){var av=D(au.target);if(av.hasClass("delete-parameter")){if(!ax.isNew){am.updateItem(ax.id,D.extend(ax,{hidden:true}))}else{am.deleteItem(ax.id)}var aq=ai.getSelectedRows();if(aq.length===0){ai.setSelectedRows([0])}var ay=am.getItems();if(ay.length===0){Y()}else{var at=true;D.each(ay,function(az,aA){if(!aA.hidden){at=false}});if(at){Y()}}D("#parameter-context-dialog").modal("refreshButtons");au.stopImmediatePropagation()}else{if(av.hasClass("edit-parameter")){var ap=function(){q()};var ar=function(){D("#parameter-sensitive-radio-button").prop("checked",false);D("#parameter-not-sensitive-radio-button").prop("checked",true);D("#parameter-name").focus();D("#parameter-name").val(ax.name);D("#parameter-name").prop("disabled",true);D("#parameter-sensitive-radio-button").prop("disabled",true);D("#parameter-not-sensitive-radio-button").prop("disabled",true);if(ax.value===""){D("#parameter-set-empty-string-field").removeClass("checkbox-unchecked").addClass("checkbox-checked")}else{D("#parameter-set-empty-string-field").removeClass("checkbox-checked").addClass("checkbox-unchecked")}if(ax.sensitive){D("#parameter-sensitive-radio-button").prop("checked",true);D("#parameter-not-sensitive-radio-button").prop("checked",false);if(!ah.isNil(ax.value)){D("#parameter-value-field").addClass("sensitive").val(T.config.sensitiveText).select()}}else{D("#parameter-sensitive-radio-button").prop("checked",false);D("#parameter-not-sensitive-radio-button").prop("checked",true);D("#parameter-value-field").val(ax.value)}D("#parameter-description-field").val(ax.description);D("#parameter-dialog").modal("refreshButtons")};D("#parameter-set-empty-string-field").off().on("change",function(aA,az){if(az.isChecked){D("#parameter-value-field").prop("disabled",true).val("");D("#parameter-dialog").modal("refreshButtons")}else{var aB=ax.sensitive?"":ax.previousValue;D("#parameter-value-field").prop("disabled",false).val(aB);D("#parameter-dialog").modal("refreshButtons")}});D("#parameter-dialog").modal("setHeaderText","Edit Parameter").modal("setOpenHandler",ar).modal("setCloseHandler",ap).modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){var az=c(ax);if(az.hasValueChanged){return !az.isValueValid()}else{return !az.hasDescriptionChanged}},handler:{click:function(){k(ax)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){D(this).modal("hide")}}}]).modal("show");au.stopImmediatePropagation()}}}});ai.onSelectedRowsChanged.subscribe(function(ar,aq){if(D.isArray(aq.rows)&&aq.rows.length===1){if(ai.getDataLength()>0){var ap=aq.rows[0];var at=ai.getDataItem(ap);if(L===null||L!==at.id){Z(at.referencingComponents);D("#parameter-referencing-components-context").removeClass("unset").attr("title",at.name).text(at.name);V(D("#parameter-referencing-components-container"));L=at.id}}}});ai.onBeforeCellEditorDestroy.subscribe(function(aq,ap){setTimeout(function(){ai.resizeCanvas()},50)});am.onRowCountChanged.subscribe(function(aq,ap){ai.updateRowCount();ai.render()});am.onRowsChanged.subscribe(function(aq,ap){ai.invalidateRows(ap.rows);ai.render()});am.syncGridSelection(ai,true);ak.data("gridInstance",ai).on("mouseenter","div.slick-cell",function(aq){var ap=D(this).find("div.fa-question-circle");if(ap.length){if(ap.data("qtip")){ap.qtip("destroy",true)}var ar=D(this).find("span.parameter-row").text();var at=am.getItem(ar);if(T.isDefinedAndNotNull(at.description)){ap.qtip(D.extend({},T.config.tooltipConfig,{content:at.description}))}}})};var n=function(){D("#parameter-context-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"parameter-context-standard-settings-tab-content"},{name:"Parameters",tabContentId:"parameter-context-parameters-tab-content"}],select:function(){if(D(this).text()==="Parameters"){var ai=D("#parameter-table").data("gridInstance");if(T.isDefinedAndNotNull(ai)){ai.resizeCanvas()}}}});D("#parameter-context-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){l()}}});D("#parameter-dialog").modal();D("#parameter-value-field").on("keydown",function(){var ai=D(this);if(ai.hasClass("sensitive")){ai.removeClass("sensitive");if(ai.val()===T.config.sensitiveText){ai.val("")}}});D("#parameter-set-empty-string-field").on("click",function(){var ai=D("#parameter-value-field");if(ai.hasClass("sensitive")){ai.removeClass("sensitive");if(ai.val()===T.config.sensitiveText){ai.val("")}}});D("#parameter-name").on("keydown",function(aj){var ai=aj.keyCode?aj.keyCode:aj.which;if(ai===D.ui.keyCode.ENTER){h();aj.stopImmediatePropagation();aj.preventDefault()}});D("#add-parameter").on("click",function(){var aj=function(){q()};var ai=function(){D("#parameter-sensitive-radio-button").prop("checked",false);D("#parameter-not-sensitive-radio-button").prop("checked",true);D("#parameter-name").focus()};D("#parameter-dialog").modal("setHeaderText","Add Parameter").modal("setOpenHandler",ai).modal("setCloseHandler",aj).modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){var ak=c();if(ak.name!==""){return false}return true},handler:{click:function(){h()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){D(this).modal("hide")}}}]).modal("show")});D("#parameter-set-empty-string-field").off().on("change",function(aj,ai){if(ai.isChecked){D("#parameter-value-field").prop("disabled",true).val("");D("#parameter-dialog").modal("refreshButtons")}else{D("#parameter-value-field").prop("disabled",false);D("#parameter-dialog").modal("refreshButtons")}});D("#parameter-context-name").on("keyup",function(ai){D("#parameter-context-dialog").modal("refreshButtons")});D("#parameter-context-description-field").on("keyup",function(ai){D("#parameter-context-dialog").modal("refreshButtons")});D("#parameter-name").on("keyup",function(ai){D("#parameter-dialog").modal("refreshButtons")});D("#parameter-value-field").on("keyup",function(ai){D("#parameter-dialog").modal("refreshButtons")});D("#parameter-description-field").on("keyup",function(ai){D("#parameter-dialog").modal("refreshButtons")});D("#parameter-set-empty-string-field").on("change",function(ai){D("#parameter-dialog").modal("refreshButtons")});H()};var W=function(ai){D("#parameter-dialog").modal("setHeaderText","Add Parameter").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){var ak=c();var aj=D("#parameter-context-updating-status").hasClass("show-status");if(aj||ah.isEmpty(ak.name)){return true}return false},handler:{click:ai.onApply}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:ai.onCancel}}]).modal("show");D("#parameter-set-empty-string-field").off().on("change",function(ak,aj){if(aj.isChecked){D("#parameter-value-field").prop("disabled",true).val("");D("#parameter-dialog").modal("refreshButtons")}else{D("#parameter-value-field").prop("disabled",false);D("#parameter-dialog").modal("refreshButtons")}})};var I=function(ai){var aj=D.Deferred(function(ak){D.ajax({type:"GET",url:"../nifi-api/flow/parameter-contexts",dataType:"json"}).done(function(al){ak.resolve(al)}).fail(function(an,al,am){ak.reject(an,al,am)})}).promise();return D.when(aj).done(function(ak){D("#parameter-contexts-last-refreshed").text(ak.currentTime);var ao=[];D.each(ak.parameterContexts,function(ap,aq){ao.push(D.extend({type:"ParameterContext"},aq))});var am=D("#parameter-contexts-table").data("gridInstance");var an=am.getData();an.setItems(ao);an.reSort();am.invalidate();if(T.isDefinedAndNotNull(ai)){var al=null;D.each(ao,function(aq,ap){if(ap.id===ai){al=an.getRowById(ai);return false}});if(al!==null){am.setSelectedRows([al])}}}).fail(b.handleAjaxError)};var J=function(ai){S.showContent("#parameter-contexts");af.resetTableSize()};var N=function(){var an=function(aw,ap,av,at,ao){var ar="";var au=ao.permissions.canWrite;var aq=ao.permissions.canRead;if(aq&&au){ar+='<div title="Edit" class="pointer edit-parameter-context fa fa-pencil"></div>'}if(aq&&au&&T.canModifyParameterContexts()){ar+='<div title="Remove" class="pointer delete-parameter-context fa fa-trash"></div>'}if(ac.isManagedAuthorizer()&&T.canAccessTenants()){ar+='<div title="Access Policies" class="pointer edit-access-policies fa fa-key"></div>'}return ar};var al=function(at,ap,ar,aq,ao){if(!ao.permissions.canRead){return""}return T.escapeHtml(ao.component.description)};var ak=function(av,ap,au,at,ao){var ar="";var aq=ao.permissions.canRead;if(aq){ar+='<div title="View Details" class="pointer view-parameter-context fa fa-info-circle"></div>'}return ar};var ai=[{id:"info",name:"&nbsp;",resizable:false,formatter:ak,sortable:false,width:30,maxWidth:30},{id:"name",name:"Name",sortable:true,resizable:true,formatter:v},{id:"description",name:"Description",sortable:true,resizable:true,formatter:al}];ai.push({id:"actions",name:"&nbsp;",resizable:false,formatter:an,sortable:false,width:90,maxWidth:90});var am=new a.Data.DataView({inlineFilters:false});am.setItems([]);ae({columnId:"name",sortAsc:true},am);var aj=new a.Grid("#parameter-contexts-table",am,ai,z);aj.setSelectionModel(new a.RowSelectionModel());aj.registerPlugin(new a.AutoTooltips());aj.setSortColumn("name",true);aj.onSort.subscribe(function(ap,ao){ae({columnId:ao.sortCol.id,sortAsc:ao.sortAsc},am)});aj.onClick.subscribe(function(ar,ao){var aq=D(ar.target);var ap=am.getItem(ao.row);if(aj.getColumns()[ao.cell].id==="actions"){if(aq.hasClass("edit-parameter-context")){af.showParameterContext(ap.id)}else{if(aq.hasClass("delete-parameter-context")){af.promptToDeleteParameterContext(ap)}else{if(aq.hasClass("edit-access-policies")){x.showParameterContextPolicy(ap);D("#shell-close-button").click()}}}}else{if(aj.getColumns()[ao.cell].id==="info"){if(aq.hasClass("view-parameter-context")){af.showParameterContext(ap.id,true)}}}});am.onRowCountChanged.subscribe(function(ap,ao){aj.updateRowCount();aj.render()});am.onRowsChanged.subscribe(function(ap,ao){aj.invalidateRows(ao.rows);aj.render()});am.syncGridSelection(aj,true);D("#parameter-contexts-table").data("gridInstance",aj).on("mouseenter","div.slick-cell",function(at){var ar=D(this).find("div.has-errors");if(ar.length&&!ar.data("qtip")){var ao=D(this).find("span.row-id").text();var aq=am.getItemById(ao);var ap=T.formatUnorderedList(aq.component.validationErrors);if(T.isDefinedAndNotNull(ap)){ar.qtip(D.extend({},T.config.tooltipConfig,{content:ap,position:{target:"mouse",viewport:D("#shell-container"),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}})};var t=null;var af={init:function(){D("#parameter-contexts-refresh-button").on("click",function(){I()});D("#new-parameter-context").on("click",function(){Y();if(!D("#parameter-context-id-setting").hasClass("hidden")){D("#parameter-context-id-setting").addClass("hidden")}D("#parameter-context-dialog").removeClass("read-only");D("#parameter-context-dialog").addClass("edit-mode");D("#parameter-context-dialog").modal("setHeaderText","Add Parameter Context").modal("setButtonModel",[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){if(D("#parameter-context-name").val()!==""){return false}return true},handler:{click:function(){af.addParameterContext()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){D(this).modal("hide")}}}]).modal("show");D("#parameter-context-name").focus()});n();N();D(window).on("resize",function(ai){if(D("#parameter-referencing-components-container").is(":visible")){V(D("#parameter-referencing-components-container"))}})},addParameterContext:function(ak){var ai={component:{name:D("#parameter-context-name").val(),description:D("#parameter-context-description-field").val(),parameters:i()},revision:e.getRevision({revision:{version:0}})};var aj=D.ajax({type:"POST",url:K.urls.parameterContexts,data:JSON.stringify(ai),dataType:"json",contentType:"application/json"}).done(function(an){var al=D("#parameter-contexts-table").data("gridInstance");if(T.isDefinedAndNotNull(al)){var am=al.getData();am.addItem(an);am.reSort();al.invalidate();var ao=am.getRowById(an.id);aa.choseRow(al,ao);al.scrollRowIntoView(ao)}if(typeof ak==="function"){ak(an)}}).fail(b.handleAjaxError);D("#parameter-context-dialog").modal("hide");return aj},resetTableSize:function(){var ai=D("#parameter-contexts-table").data("gridInstance");if(T.isDefinedAndNotNull(ai)){ai.resizeCanvas()}},showParameterContexts:function(ai){D("#new-parameter-context").prop("disabled",!T.canModifyParameterContexts());return I(ai).done(J)},showParameterContext:function(al,ak,aj){X=0;var ai=D.ajax({type:"GET",url:K.urls.parameterContexts+"/"+encodeURIComponent(al),dataType:"json"});ai.done(function(ap){var ao=ah.get(ap,"permissions.canWrite",false);if(ah.defaultTo(ak,false)){ao=false}t=ap;if(ao){D("#parameter-context-dialog").removeClass("read-only");D("#parameter-context-dialog").addClass("edit-mode");D("#parameter-context-name").val(ap.component.name);D("#parameter-context-description-field").val(ap.component.description)}else{D("#parameter-context-dialog").removeClass("edit-mode");D("#parameter-context-dialog").addClass("read-only");D("#parameter-context-name-read-only").prop("title",ap.component.name).text(ap.component.name);D("#parameter-context-description-read-only").text(ap.component.description)}if(D("#parameter-context-id-setting").hasClass("hidden")){D("#parameter-context-id-setting").removeClass("hidden")}D("#parameter-context-id-field").prop("title",ap.id).text(ap.id);M(ap,aj,ak||!ao);var an=[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){if(D("#parameter-context-name").val()!==""&&O(t)){return false}return true},handler:{click:function(){C(t)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){D(this).modal("hide")}}}];var am=[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){return false},handler:{click:function(){D(this).modal("hide")}}}];D("#parameter-context-dialog").modal("setHeaderText",ao?"Update Parameter Context":"View Parameter Context").modal("setButtonModel",ao?an:am).modal("show");D("#parameter-context-tabs").find("li:last").click();V(D("#parameter-referencing-components-container"))}).fail(b.handleAjaxError)},promptToDeleteParameterContext:function(ai){g.showYesNoDialog({headerText:"Delete Parameter Context",dialogContent:"Delete parameter context '"+T.escapeHtml(ai.component.name)+"'?",yesHandler:function(){af.remove(ai)}})},remove:function(ai){D.ajax({type:"DELETE",url:K.urls.parameterContexts+"/"+encodeURIComponent(ai.id)+"?"+D.param({disconnectedNodeAcknowledged:r.isDisconnectionAcknowledged(),clientId:ai.revision.clientId,version:ai.revision.version}),dataType:"json"}).done(function(aj){var ak=D("#parameter-contexts-table").data("gridInstance");var al=ak.getData();al.deleteItem(ai.id)}).fail(b.handleAjaxError)},convertPropertyToParameter:function(ak,ai,aj){return D.Deferred(function(al){if(ah.isNil(aj)){g.showOkDialog({headerText:"Unable to Convert Property",dialogContent:"There is no parameter context set for the current process group."});al.reject()}var am=D.ajax({type:"GET",url:K.urls.parameterContexts+"/"+encodeURIComponent(aj),dataType:"json"});am.done(function(ao){var an=function(ar){if(ar){D("#parameter-context-updating-status").addClass("show-status");D("#parameter-dialog").modal("refreshButtons")}else{D("#parameter-context-updating-status").removeClass("show-status");D("#parameter-dialog").modal("refreshButtons")}};var aq;var ap;W({onApply:function(){an(true);var au=ao.component.parameters.map(function(av){return av.parameter});var at=c();var ar=ad(at,au);if(!ar){an(false);return}ao.component.parameters=[{parameter:{name:at.name,value:at.value,sensitive:at.sensitive,description:at.description}}];aq=null;u(ao).done(function(av){var aw=function(az){var ay=az.request;var ax=!ah.isEmpty(ay.failureReason);aq=ay.requestId;if(ay.complete===true){an(false);if(ax){g.showOkDialog({headerText:"Parameter Context Update Error",dialogContent:"Unable to complete parameter context update request: "+T.escapeHtml(ay.failureReason)});al.reject()}else{al.resolve(at)}P(ao.id,aq);D("#parameter-dialog").modal("hide")}else{ap=setTimeout(function(){o(ao.id,aq).done(function(aA){aw(aA)}).fail(function(aA){if(!ah.isNil(ao.id)&&!ah.isNil(aq)){P(ao.id,aq)}al.reject(aA)})},1000)}};aw(av)}).fail(function(av){al.reject(av)})},onCancel:function(){an(false);if(!ah.isNil(ao.id)&&!ah.isNil(aq)){P(ao.id,aq);aq=null;if(!ah.isNil(ap)){clearTimeout(ap)}}q();D(this).modal("hide")}});D("#parameter-name").val(ak.displayName);D("#parameter-name").prop("disabled",false);D("#parameter-sensitive-radio-button").prop("disabled",true);D("#parameter-not-sensitive-radio-button").prop("disabled",true);if(ak.value===""){D("#parameter-dialog").find(".nf-checkbox").removeClass("checkbox-unchecked").addClass("checkbox-checked")}else{D("#parameter-dialog").find(".nf-checkbox").removeClass("checkbox-checked").addClass("checkbox-unchecked")}if(T.isSensitiveProperty(ai)){D("#parameter-sensitive-radio-button").prop("checked",true);D("#parameter-not-sensitive-radio-button").prop("checked",false);D("#parameter-value-field").val(null)}else{D("#parameter-sensitive-radio-button").prop("checked",false);D("#parameter-not-sensitive-radio-button").prop("checked",true);D("#parameter-value-field").val(ak.value)}D("#parameter-description-field").val(ak.description);D("#parameter-dialog").modal("refreshButtons")}).fail(function(an){al.reject(an)})}).promise()}};return af}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.CanvasUtils","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.ErrorHandler","nf.Clipboard","nf.ParameterContexts","nf.Snippet","nf.GoTo","nf.ng.Bridge","nf.Shell","nf.VariableRegistry","nf.ComponentState","nf.FlowVersion","nf.Draggable","nf.Birdseye","nf.Connection","nf.Graph","nf.ProcessGroupConfiguration","nf.ProcessorConfiguration","nf.ProcessorDetails","nf.LabelConfiguration","nf.RemoteProcessGroupConfiguration","nf.RemoteProcessGroupDetails","nf.PortConfiguration","nf.PortDetails","nf.ConnectionConfiguration","nf.ConnectionDetails","nf.PolicyManagement","nf.RemoteProcessGroup","nf.Label","nf.Processor","nf.RemoteProcessGroupPorts","nf.ComponentVersion","nf.QueueListing","nf.StatusHistory"],function(C,H,L,G,l,t,j,f,y,N,M,h,m,F,k,g,u,w,i,O,p,E,K,e,z,B,J,D,q,n,o,x,d,v,r,c,s,A,I){return(nf.Actions=b(C,H,L,G,l,t,j,f,y,N,M,h,m,F,k,g,u,w,i,O,p,E,K,e,z,B,J,D,q,n,o,x,d,v,r,c,s,A,I))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Actions=b(require("jquery"),require("d3"),require("nf.CanvasUtils"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.ErrorHandler"),require("nf.Clipboard"),require("nf.ParameterContexts"),require("nf.Snippet"),require("nf.GoTo"),require("nf.ng.Bridge"),require("nf.Shell"),require("nf.VariableRegistry"),require("nf.ComponentState"),require("nf.FlowVersion"),require("nf.Draggable"),require("nf.Birdseye"),require("nf.Connection"),require("nf.Graph"),require("nf.ProcessGroupConfiguration"),require("nf.ProcessorConfiguration"),require("nf.ProcessorDetails"),require("nf.LabelConfiguration"),require("nf.RemoteProcessGroupConfiguration"),require("nf.RemoteProcessGroupDetails"),require("nf.PortConfiguration"),require("nf.PortDetails"),require("nf.ConnectionConfiguration"),require("nf.ConnectionDetails"),require("nf.PolicyManagement"),require("nf.RemoteProcessGroup"),require("nf.Label"),require("nf.Processor"),require("nf.RemoteProcessGroupPorts"),require("nf.ComponentVersion"),require("nf.QueueListing"),require("nf.StatusHistory")))}else{nf.Actions=b(a.$,a.d3,a.nf.CanvasUtils,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.ErrorHandler,a.nf.Clipboard,a.nf.ParameterContexts,a.nf.Snippet,a.nf.GoTo,a.nf.ng.Bridge,a.nf.Shell,a.nf.VariableRegistry,a.nf.ComponentState,a.nf.FlowVersion,a.nf.Draggable,a.nf.Birdseye,a.nf.Connection,a.nf.Graph,a.nf.ProcessGroupConfiguration,a.nf.ProcessorConfiguration,a.nf.ProcessorDetails,a.nf.LabelConfiguration,a.nf.RemoteProcessGroupConfiguration,a.nf.RemoteProcessGroupDetails,a.nf.PortConfiguration,a.nf.PortDetails,a.nf.ConnectionConfiguration,a.nf.ConnectionDetails,a.nf.PolicyManagement,a.nf.RemoteProcessGroup,a.nf.Label,a.nf.Processor,a.nf.RemoteProcessGroupPorts,a.nf.ComponentVersion,a.nf.QueueListing,a.nf.StatusHistory)}}}(this,function(F,L,P,K,m,v,k,f,B,R,Q,h,o,J,l,g,w,y,i,S,r,H,O,c,C,E,N,G,s,p,q,A,b,x,t,a,u,D,M){var I={urls:{api:"../nifi-api",controller:"../nifi-api/controller",parameterContexts:"../nifi-api/parameter-contexts"}};var e=function(){F("#drop-request-status-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){F("#drop-request-status-dialog").modal("setButtonModel",[])}}})};var n=function(U,T){T.disconnectedNodeAcknowledged=v.isDisconnectionAcknowledged();return F.ajax({type:"PUT",url:U,data:JSON.stringify(T),dataType:"json",contentType:"application/json"}).fail(function(X,V,W){m.showOkDialog({headerText:"Update Resource",dialogContent:K.escapeHtml(X.responseText)})})};var j=function(T){F.ajax({type:"GET",url:I.urls.api+"/flow/process-groups/"+encodeURIComponent(T.id),dataType:"json"}).done(function(U){r.set(U.processGroupFlow.flow)})};var d=function(T,U){return U.filter(function(V){return P.getConnectionSourceComponentId(T)===V.id}).size()>0};var z={init:function(){e()},enterGroup:function(T){if(T.size()===1&&P.isProcessGroup(T)){var U=T.datum();P.getComponentByType("ProcessGroup").enterGroup(U.id)}},leaveGroup:function(){P.getComponentByType("ProcessGroup").enterGroup(P.getParentGroupId())},refreshRemoteFlow:function(U){if(U.size()===1&&P.isRemoteProcessGroup(U)){var X=U.datum();var Y=X.component.flowRefreshed;var T=function(Z){X.component.flowRefreshed=Z;if(U.classed("visible")){U.select("text.remote-process-group-last-refresh").text(function(){return Z})}};var W=function(Z){F.ajax({type:"GET",url:X.uri,dataType:"json"}).done(function(aa){var ac=aa.component;if(Y===ac.flowRefreshed){V(Z)}else{b.set(aa);var ab=S.getComponentConnections(ac.id);F.each(ab,function(ae,ad){if(ad.permissions.canRead){S.reload(ad.id)}})}})};var V=function(Z){if(Z<=32){setTimeout(function(){W(Z*2)},Z*1000)}else{T(Y)}};T("Refreshing...");W(1)}},openUri:function(T){if(T.size()===1&&P.isRemoteProcessGroup(T)){var V=T.datum();var U=V.component.targetUri;if(!K.isBlank(U)){window.open(encodeURI(U))}else{m.showOkDialog({headerText:"Remote Process Group",dialogContent:"No target URI defined."})}}},showSource:function(T){if(T.size()===1&&P.isConnection(T)){var V=T.datum();if(V.sourceGroupId===P.getGroupId()){var U=L.select("#id-"+V.sourceId);z.show(U)}else{if(V.sourceType==="REMOTE_OUTPUT_PORT"){var W=L.select("#id-"+V.sourceGroupId);z.show(W)}else{P.showComponent(V.sourceGroupId,V.sourceId)}}}},showDestination:function(V){if(V.size()===1&&P.isConnection(V)){var W=V.datum();if(W.destinationGroupId===P.getGroupId()){var T=L.select("#id-"+W.destinationId);z.show(T)}else{if(W.destinationType==="REMOTE_INPUT_PORT"){var U=L.select("#id-"+W.destinationGroupId);z.show(U)}else{P.showComponent(W.destinationGroupId,W.destinationId)}}}},showDownstream:function(T){if(T.size()===1&&!P.isConnection(T)){if(P.isProcessor(T)){h.showDownstreamFromProcessor(T)}else{if(P.isFunnel(T)){h.showDownstreamFromFunnel(T)}else{if(P.isInputPort(T)){h.showDownstreamFromInputPort(T)}else{if(P.isOutputPort(T)){h.showDownstreamFromOutputPort(T)}else{if(P.isProcessGroup(T)||P.isRemoteProcessGroup(T)){h.showDownstreamFromGroup(T)}}}}}}},showUpstream:function(T){if(T.size()===1&&!P.isConnection(T)){if(P.isProcessor(T)){h.showUpstreamFromProcessor(T)}else{if(P.isFunnel(T)){h.showUpstreamFromFunnel(T)}else{if(P.isInputPort(T)){h.showUpstreamFromInputPort(T)}else{if(P.isOutputPort(T)){h.showUpstreamFromOutputPort(T)}else{if(P.isProcessGroup(T)||P.isRemoteProcessGroup(T)){h.showUpstreamFromGroup(T)}}}}}}},show:function(T){var U=P.getSelection();U.classed("selected",false);T.classed("selected",true);if(T.size()===1){z.center(T)}else{o.injector.get("navigateCtrl").zoomFit()}P.setURLParameters(P.getGroupId(),T);o.digest()},select:function(T){T.classed("selected",true)},selectAll:function(){z.select(L.selectAll("g.component, g.connection"))},center:function(V){if(V.size()===1){var W;if(P.isConnection(V)){var T,aa;var Z=V.datum();if(Z.bends.length>0){var U=Math.min(Math.max(0,Z.labelIndex),Z.bends.length-1);T=Z.bends[U].x;aa=Z.bends[U].y}else{T=(Z.start.x+Z.end.x)/2;aa=(Z.start.y+Z.end.y)/2}W={x:T,y:aa,width:1,height:1}}else{var X=V.datum();var Y=X.position;W={x:Y.x,y:Y.y,width:X.dimensions.width,height:X.dimensions.height}}P.centerBoundingBox(W)}},enable:function(U){if(U.empty()){var T={id:P.getGroupId(),state:"ENABLED"};n(I.urls.api+"/flow/process-groups/"+encodeURIComponent(P.getGroupId()),T).done(j)}else{var W=P.filterEnable(U);if(!W.empty()){var V=[];W.each(function(aa){var Y=L.select(this);var Z,X;if(P.isProcessGroup(Y)){Z=I.urls.api+"/flow/process-groups/"+encodeURIComponent(aa.id);X={id:aa.id,state:"ENABLED"}}else{Z=aa.uri+"/run-status";X={revision:k.getRevision(aa),state:"STOPPED"}}V.push(n(Z,X).done(function(ab){if(P.isProcessGroup(Y)){P.getComponentByType("ProcessGroup").reload(aa.id)}else{P.getComponentByType(aa.type).set(ab)}}))});if(V.length>0){F.when.apply(window,V).always(function(){o.digest()})}}}},disable:function(V){if(V.empty()){var U={id:P.getGroupId(),state:"DISABLED"};n(I.urls.api+"/flow/process-groups/"+encodeURIComponent(P.getGroupId()),U).done(j)}else{var T=P.filterDisable(V);if(!T.empty()){var W=[];T.each(function(aa){var Y=L.select(this);var Z,X;if(P.isProcessGroup(Y)){Z=I.urls.api+"/flow/process-groups/"+encodeURIComponent(aa.id);X={id:aa.id,state:"DISABLED"}}else{Z=aa.uri+"/run-status";X={revision:k.getRevision(aa),state:"DISABLED"}}W.push(n(Z,X).done(function(ab){if(P.isProcessGroup(Y)){P.getComponentByType("ProcessGroup").reload(aa.id)}else{P.getComponentByType(aa.type).set(ab)}}))});if(W.length>0){F.when.apply(window,W).always(function(){o.digest()})}}}},openProvenance:function(T){if(T.size()===1){var U=T.datum();J.showPage("provenance?"+F.param({componentId:U.id}))}},start:function(V){if(V.empty()){var T={id:P.getGroupId(),state:"RUNNING"};n(I.urls.api+"/flow/process-groups/"+encodeURIComponent(P.getGroupId()),T).done(j)}else{var W=V.filter(function(X){return P.isRunnable(L.select(this))});if(!W.empty()){var U=[];W.each(function(aa){var Y=L.select(this);var Z,X;if(P.isProcessGroup(Y)){Z=I.urls.api+"/flow/process-groups/"+encodeURIComponent(aa.id);X={id:aa.id,state:"RUNNING"}}else{Z=aa.uri+"/run-status";X={revision:k.getRevision(aa),state:"RUNNING"}}U.push(n(Z,X).done(function(ab){if(P.isProcessGroup(Y)){P.getComponentByType("ProcessGroup").reload(aa.id)}else{P.getComponentByType(aa.type).set(ab)}}))});if(U.length>0){F.when.apply(window,U).always(function(){o.digest()})}}}},stop:function(V,T){if(V.empty()){var U={id:P.getGroupId(),state:"STOPPED"};n(I.urls.api+"/flow/process-groups/"+encodeURIComponent(P.getGroupId()),U).done(j)}else{var X=V.filter(function(Y){return P.isStoppable(L.select(this))});if(!X.empty()){var W=[];X.each(function(ab){var Z=L.select(this);var aa,Y;if(P.isProcessGroup(Z)){aa=I.urls.api+"/flow/process-groups/"+encodeURIComponent(ab.id);Y={id:ab.id,state:"STOPPED"}}else{aa=ab.uri+"/run-status";Y={revision:k.getRevision(ab),state:"STOPPED"}}W.push(n(aa,Y).done(function(ac){if(P.isProcessGroup(Z)){P.getComponentByType("ProcessGroup").reload(ab.id)}else{P.getComponentByType(ab.type).set(ac)}}))});if(W.length>0){F.when.apply(window,W).always(function(){o.digest();if(typeof T=="function"){T()}})}else{if(typeof T=="function"){T()}}}}},stopAndConfigure:function(U,T){if(U.size()===1&&P.isProcessor(U)&&P.canModify(U)){z.stop(U,function(){O.showConfiguration(U,T)})}},terminate:function(U,T){if(U.size()===1&&P.isProcessor(U)){var V=U.datum();F.ajax({type:"DELETE",url:V.uri+"/threads",dataType:"json"}).done(function(W){t.set(W);if(typeof T=="function"){T()}}).fail(f.handleAjaxError)}},enableTransmission:function(T){var U=T.filter(function(V){return P.canStartTransmitting(L.select(this))});U.each(function(W){var V={revision:k.getRevision(W),state:"TRANSMITTING"};n(W.uri+"/run-status",V).done(function(X){b.set(X)})})},disableTransmission:function(U){var T=U.filter(function(V){return P.canStopTransmitting(L.select(this))});T.each(function(W){var V={revision:k.getRevision(W),state:"STOPPED"};n(W.uri+"/run-status",V).done(function(X){b.set(X)})})},showConfiguration:function(U,T){if(U.empty()){H.showConfiguration(P.getGroupId())}else{if(U.size()===1){var V=U.datum();if(P.isProcessor(U)){O.showConfiguration(U,T)}else{if(P.isLabel(U)){C.showConfiguration(U)}else{if(P.isProcessGroup(U)){H.showConfiguration(V.id)}else{if(P.isRemoteProcessGroup(U)){E.showConfiguration(U)}else{if(P.isInputPort(U)||P.isOutputPort(U)){G.showConfiguration(U)}else{if(P.isConnection(U)){p.showConfiguration(U)}}}}}}}}},managePolicies:function(T){if(T.size()<=1){A.showComponentPolicy(T)}},showDetails:function(T){if(T.empty()){H.showConfiguration(P.getGroupId())}else{if(T.size()===1){var U=T.datum();if(P.isProcessor(T)){if(!P.isStoppable(T)&&P.canModify(T)){O.showConfiguration(T)}else{c.showDetails(P.getGroupId(),U.id)}}else{if(P.isProcessGroup(T)){H.showConfiguration(U.id)}else{if(P.isRemoteProcessGroup(T)){N.showDetails(T)}else{if(P.isInputPort(T)||P.isOutputPort(T)){s.showDetails(T)}else{if(P.isConnection(T)){q.showDetails(P.getGroupId(),U.id)}}}}}}}},showUsage:function(T){if(T.size()===1&&P.isProcessor(T)){var U=T.datum();J.showPage("../nifi-docs/documentation?"+F.param({select:U.component.type,group:U.component.bundle.group,artifact:U.component.bundle.artifact,version:U.component.bundle.version}))}},showStats:function(T){if(T.size()===1){var U=T.datum();if(P.isProcessor(T)){M.showProcessorChart(P.getGroupId(),U.id)}else{if(P.isProcessGroup(T)){M.showProcessGroupChart(P.getGroupId(),U.id)}else{if(P.isRemoteProcessGroup(T)){M.showRemoteProcessGroupChart(P.getGroupId(),U.id)}else{if(P.isConnection(T)){M.showConnectionChart(P.getGroupId(),U.id)}}}}}},remotePorts:function(T){if(T.size()===1&&P.isRemoteProcessGroup(T)){a.showPorts(T)}},reload:function(){P.reload()},"delete":function(V){if(K.isUndefined(V)||V.empty()){m.showOkDialog({headerText:"Delete Components",dialogContent:"No eligible components are selected. Please select the components to be deleted."})}else{if(V.size()===1){var X=V.datum();var U=k.getRevision(X);F.ajax({type:"DELETE",url:X.uri+"?"+F.param({version:U.version,clientId:U.clientId,disconnectedNodeAcknowledged:v.isDisconnectionAcknowledged()}),dataType:"json"}).done(function(Y){P.getComponentByType(X.type).remove(X.id);if(P.isConnection(V)===false){var Z=S.getComponentConnections(X.id);if(Z.length>0){var aa=[];F.each(Z,function(ac,ab){aa.push(ab.id)});S.remove(aa)}}P.setURLParameters();i.refresh();o.digest()}).fail(f.handleAjaxError)}else{var T=P.getGroupId();var W=Q.marshal(V,T);Q.create(W).done(function(Y){Q.remove(Y.snippet.id).done(function(){var aa=L.map();var Z=function(ab,ac){if(!aa.has(ab)){aa.set(ab,[])}aa.get(ab).push(ac)};V.each(function(ac){Z(ac.type,ac.id);if(ac.type!=="Connection"){var ab=S.getComponentConnections(ac.id);if(ab.length>0){F.each(ab,function(ae,ad){Z("Connection",ad.id)})}}});aa.each(function(ac,ab){if(ab!=="Connection"){P.getComponentByType(ab).remove(ac)}});if(aa.has("Connection")){S.remove(aa.get("Connection"))}P.setURLParameters();i.refresh();o.digest()}).fail(f.handleAjaxError)}).fail(f.handleAjaxError)}}},emptyQueue:function(T){if(T.size()!==1||!P.isConnection(T)){return}m.showYesNoDialog({headerText:"Empty Queue",dialogContent:"Are you sure you want to empty this queue? All FlowFiles waiting at the time of the request will be removed.",noText:"Cancel",yesText:"Empty",yesHandler:function(){var X=T.datum();var ab=4;var Z=false;var aa=null;var W=null;var V=function(ae){var af=F("#drop-request-percent-complete");af.find("div.progress-label").remove();af.find("md-progress-linear").remove();var ad=F('<div class="progress-label"></div>').text(ae+"%");(o.injector.get("$compile")(F('<md-progress-linear ng-cloak ng-value="'+ae+'" class="md-hue-2" md-mode="determinate" aria-label="Drop request percent complete"></md-progress-linear>'))(o.rootScope)).appendTo(af);af.append(ad)};F("#drop-request-status-dialog").modal("setButtonModel",[{buttonText:"Stop",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){Z=true;if(W!==null){clearTimeout(W);U()}}}}]);var U=function(){S.reloadStatus(X.id);if(K.isDefinedAndNotNull(aa)){F.ajax({type:"DELETE",url:aa.uri,dataType:"json"}).done(function(ad){aa=ad.dropRequest;var ag=aa.dropped.split(/ \/ /);var af=F("<div></div>");F('<span class="label"></span>').text(ag[0]).appendTo(af);F("<span></span>").text(" FlowFiles ("+ag[1]+")").appendTo(af);if(aa.percentCompleted<100){var ae=aa.original.split(/ \/ /);F('<span class="label"></span>').text(" out of "+ae[0]).appendTo(af);F("<span></span>").text(" ("+ae[1]+")").appendTo(af)}F("<span></span>").text(" were removed from the queue.").appendTo(af);if(K.isDefinedAndNotNull(aa.failureReason)){F("<br/><br/><span></span>").text(aa.failureReason).appendTo(af)}m.showOkDialog({headerText:"Empty Queue",dialogContent:af})}).always(function(){F("#drop-request-status-dialog").modal("hide")})}else{m.showOkDialog({headerText:"Empty Queue",dialogContent:"No FlowFiles were removed."});F("#drop-request-status-dialog").modal("hide")}};var ac=function(ad){V(aa.percentCompleted);F("#drop-request-status-message").text(aa.state);if(aa.finished===true||Z===true){U()}else{W=setTimeout(function(){W=null;Y(Math.min(ab,ad*2))},ad*1000)}};var Y=function(ad){F.ajax({type:"GET",url:aa.uri,dataType:"json"}).done(function(ae){aa=ae.dropRequest;ac(ad)}).fail(function(ag,ae,af){if(ag.status===403){f.handleAjaxError(ag,ae,af)}else{U()}})};F.ajax({type:"POST",url:"../nifi-api/flowfile-queues/"+encodeURIComponent(X.id)+"/drop-requests",dataType:"json",contentType:"application/json"}).done(function(ad){V(0);F("#drop-request-status-dialog").modal("show");aa=ad.dropRequest;ac(1)}).fail(function(af,ad,ae){if(af.status===403){f.handleAjaxError(af,ad,ae)}else{U()}})}})},listQueue:function(U){if(U.size()!==1||!P.isConnection(U)){return}var T=U.datum();D.listQueue(T)},viewState:function(U){if(U.size()!==1||!P.isProcessor(U)){return}var T=U.datum();g.showState(T,P.isConfigurable(U))},saveFlowVersion:function(T){if(T.empty()){w.showFlowVersionDialog(P.getGroupId(),"COMMIT")}else{if(T.size()===1){var U=T.datum();if(P.isProcessGroup(T)){w.showFlowVersionDialog(U.id,"COMMIT")}}}},forceSaveFlowVersion:function(T){m.showYesNoDialog({headerText:"Commit",dialogContent:"Committing will ignore available upgrades and commit local changes as the next version. Are you sure you want to proceed?",noText:"Cancel",yesText:"Yes",yesHandler:function(){if(T.empty()){w.showFlowVersionDialog(P.getGroupId(),"FORCE_COMMIT")}else{if(T.size()===1){var U=T.datum();if(P.isProcessGroup(T)){w.showFlowVersionDialog(U.id,"FORCE_COMMIT")}}}}})},revertLocalChanges:function(T){if(T.empty()){w.revertLocalChanges(P.getGroupId())}else{if(T.size()===1){var U=T.datum();w.revertLocalChanges(U.id)}}},showLocalChanges:function(T){if(T.empty()){w.showLocalChanges(P.getGroupId())}else{if(T.size()===1){var U=T.datum();w.showLocalChanges(U.id)}}},changeFlowVersion:function(T){if(T.empty()){w.showChangeFlowVersionDialog(P.getGroupId())}else{if(T.size()===1){var U=T.datum();if(P.isProcessGroup(T)){w.showChangeFlowVersionDialog(U.id)}}}},stopVersionControl:function(T){if(T.empty()){w.stopVersionControl(P.getGroupId())}else{if(T.size()===1){var U=T.datum();w.stopVersionControl(U.id)}}},openVariableRegistry:function(T){if(T.empty()){l.showVariables(P.getGroupId())}else{if(T.size()===1){var U=T.datum();if(P.isProcessGroup(T)){l.showVariables(U.id)}}}},openParameterContext:function(T){var U;if(T.empty()){U=P.getParameterContext()}else{if(T.size()===1){if(P.isProcessGroup(T)){var V=T.datum();U=V.parameterContext}}}if(K.isDefinedAndNotNull(U)){R.showParameterContext(U.id)}},changeVersion:function(U){if(U.size()!==1||!P.isProcessor(U)){return}var T=U.datum();u.promptForVersionChange(T)},alignVertical:function(V){var X=L.map();if(P.canModify(V)===false){m.showOkDialog({headerText:"Component Position",dialogContent:"Must be authorized to modify every component selected."});return}var U=null,W=null;V.each(function(Z){if(Z.type!=="Connection"){if(U===null||Z.position.x<U){U=Z.position.x}var Y=Z.position.x+Z.dimensions.width;if(W===null||Y>W){W=Y}}});var T=(U+W)/2;V.each(function(Z){if(Z.type!=="Connection"){var aa={x:T-(Z.position.x+Z.dimensions.width/2),y:0};if(aa.x!==0){var Y=S.getComponentConnections(Z.id);F.each(Y,function(ad,ac){var ae=L.select("#id-"+ac.id);if(!X.has(ac.id)&&P.getConnectionSourceComponentId(ac)===P.getConnectionDestinationComponentId(ac)){var ab=y.updateConnectionPosition(S.get(ac.id),aa);if(ab!==null){X.set(ac.id,ab)}}else{if(!X.has(ac.id)&&ae.classed("selected")&&P.canModify(ae)){if(P.getConnectionSourceComponentId(ac)===Z.id||!d(ac,V)){var ab=y.updateConnectionPosition(S.get(ac.id),aa);if(ab!==null){X.set(ac.id,ab)}}}}});X.set(Z.id,y.updateComponentPosition(Z,aa))}}});y.refreshConnections(X)},alignHorizontal:function(U){var W=L.map();if(P.canModify(U)===false){m.showOkDialog({headerText:"Component Position",dialogContent:"Must be authorized to modify every component selected."});return}var X=null,V=null;U.each(function(Z){if(Z.type!=="Connection"){if(X===null||Z.position.y<X){X=Z.position.y}var Y=Z.position.y+Z.dimensions.height;if(V===null||Y>V){V=Y}}});var T=(X+V)/2;U.each(function(Z){if(Z.type!=="Connection"){var aa={x:0,y:T-(Z.position.y+Z.dimensions.height/2)};if(aa.y!==0){var Y=S.getComponentConnections(Z.id);F.each(Y,function(ad,ac){var ae=L.select("#id-"+ac.id);if(!W.has(ac.id)&&P.getConnectionSourceComponentId(ac)===P.getConnectionDestinationComponentId(ac)){var ab=y.updateConnectionPosition(S.get(ac.id),aa);if(ab!==null){W.set(ac.id,ab)}}else{if(!W.has(ac.id)&&ae.classed("selected")&&P.canModify(ae)){if(P.getConnectionSourceComponentId(ac)===Z.id||!d(ac,U)){var ab=y.updateConnectionPosition(S.get(ac.id),aa);if(ab!==null){W.set(ac.id,ab)}}}}});W.set(Z.id,y.updateComponentPosition(Z,aa))}}});y.refreshConnections(W)},fillColor:function(V){if(P.isColorable(V)){var T=P.isProcessor(V);var U;if(T){U=t.defaultFillColor()}else{U=x.defaultColor()}if(V.size()===1){var W=V.datum();if(K.isDefinedAndNotNull(W.component.style["background-color"])){U=W.component.style["background-color"]}}F("#fill-color").minicolors("value",U);if(T){F("#fill-color-processor-preview").show();F("#fill-color-label-preview").hide()}else{F("#fill-color-processor-preview").hide();F("#fill-color-label-preview").show()}F("#fill-color-dialog").modal("show")}},group:function(){var U=P.getSelection();if(U.empty()){return}var T=P.getOrigin(U);var V={x:T.x,y:T.y};F.when(o.injector.get("groupComponent").promptForGroupName(V,false)).done(function(W){var X=L.select("#id-"+W.id);P.moveComponents(U,X)})},moveIntoParent:function(){var T=P.getSelection();if(T.empty()){return}P.moveComponentsToParent(T)},uploadTemplate:function(){F("#upload-template-dialog").modal("show")},template:function(){var T=P.getSelection();if(T.empty()){T=L.selectAll("g.component, g.connection")}if(T.empty()){m.showOkDialog({headerText:"Create Template",dialogContent:"The current selection is not valid to create a template."});return}T=P.trimDanglingEdges(T);if(T.empty()){m.showOkDialog({headerText:"Create Template",dialogContent:"The current selection is not valid to create a template."});return}F("#new-template-dialog").modal("setButtonModel",[{buttonText:"Create",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var V=F("#new-template-name").val();if(K.isBlank(V)){m.showOkDialog({headerText:"Configuration Error",dialogContent:"The name of the template must be specified."});return}F("#new-template-dialog").modal("hide");var X=F("#new-template-description").val();var U=P.getGroupId();var W=Q.marshal(T,U);Q.create(W).done(function(Y){var Z={name:V,description:X,snippetId:Y.snippet.id,disconnectedNodeAcknowledged:v.isDisconnectionAcknowledged()};F.ajax({type:"POST",url:I.urls.api+"/process-groups/"+encodeURIComponent(P.getGroupId())+"/templates",data:JSON.stringify(Z),dataType:"json",contentType:"application/json"}).done(function(){m.showOkDialog({headerText:"Create Template",dialogContent:"Template '"+K.escapeHtml(V)+"' was successfully created."})}).always(function(){F("#new-template-name").val("");F("#new-template-description").val("")}).fail(f.handleAjaxError)}).fail(f.handleAjaxError)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){F("#new-template-name").val("");F("#new-template-description").val("");F("#new-template-dialog").modal("hide")}}}]).modal("show");F("#new-template-name").focus()},copy:function(W){if(W.empty()){return}var U=P.getOrigin(W);var V=P.getSelectionBoundingClientRect(W);var T=P.getGroupId();B.copy({snippet:Q.marshal(W,T),origin:U,dimensions:V})},paste:function(aa,ab){if(K.isDefinedAndNotNull(ab)){var V=P.getCanvasScale();var T=P.getCanvasTranslate();var W=ab.pageX;var U=ab.pageY-P.getCanvasOffset();var Z=(W/V)-(T[0]/V);var Y=(U/V)-(T[1]/V);var X={x:Z,y:Y}}B.paste().done(function(ad){var ac=F.Deferred(function(ae){var af=function(aj,ah,ai){ae.reject(aj.responseText)};var ag=P.getGroupId();Q.create(ad.snippet).done(function(ak){var aj=X;var ai=ad.origin;var al=ad.dimensions;if(!K.isDefinedAndNotNull(aj)){if(P.getGroupId()!==ad.snippet.parentGroupId||!P.isBoundingBoxInViewport(al,false)){var an=P.getCanvasScale();var ah=P.getCenterForBoundingBox(al);var am=P.getCanvasTranslate();aj={x:ah[0]-(am[0]/an),y:ah[1]-(am[1]/an)}}else{ai.x+=25;ai.y+=25;aj=ai}}Q.copy(ak.snippet.id,aj,ag).done(function(ap){var ao=ap.flow;r.add(ao,{selectAll:true});r.updateVisibility();i.refresh()}).fail(function(){P.reload().done(function(){r.updateVisibility();i.refresh()})}).fail(af)}).fail(af)}).promise();ac.fail(function(af){var ae="An error occurred while attempting to copy and paste.";if(F.trim(af)!==""){ae=af}m.showOkDialog({headerText:"Paste Error",dialogContent:K.escapeHtml(ae)})})})},toFront:function(W){if(W.size()!==1||!P.isConnection(W)){return}var T=W.datum();var V=-1;F.each(S.get(),function(Y,Z){if(T.id!==Z.id&&Z.zIndex>V){V=Z.zIndex}});if(V>=0){var X=V+1;var U={revision:k.getRevision(T),disconnectedNodeAcknowledged:v.isDisconnectionAcknowledged(),component:{id:T.id,zIndex:X}};F.ajax({type:"PUT",url:T.uri,data:JSON.stringify(U),dataType:"json",contentType:"application/json"}).done(function(Y){S.set(Y)}).fail(f.handleAjaxError)}}};return z}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Common","nf.Dialog","nf.Graph","nf.Shell","nf.ng.Bridge","nf.ClusterSummary","nf.ErrorHandler","nf.Storage","nf.CanvasUtils","nf.Birdseye","nf.ContextMenu","nf.Actions","nf.ProcessGroup","nf.ParameterContexts"],function(j,r,h,i,m,e,l,o,n,k,g,d,p,f,c,q){return(nf.Canvas=b(j,r,h,i,m,e,l,o,n,k,g,d,p,f,c,q))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Canvas=b(require("jquery"),require("d3"),require("nf.Common"),require("nf.Dialog"),require("nf.Graph"),require("nf.Shell"),require("nf.ng.Bridge"),require("nf.ClusterSummary"),require("nf.ErrorHandler"),require("nf.Storage"),require("nf.CanvasUtils"),require("nf.Birdseye"),require("nf.ContextMenu"),require("nf.Actions"),require("nf.ProcessGroup"),require("nf.ParameterContexts")))}else{nf.Canvas=b(a.$,a.d3,a.nf.Common,a.nf.Dialog,a.nf.Graph,a.nf.Shell,a.nf.ng.Bridge,a.nf.ClusterSummary,a.nf.ErrorHandler,a.nf.Storage,a.nf.CanvasUtils,a.nf.Birdseye,a.nf.ContextMenu,a.nf.Actions,a.nf.ProcessGroup,a.nf.ParameterContexts)}}}(this,function(w,G,E,h,l,D,k,C,d,o,K,e,s,q,t,N){var A=1;var n=[0,0];var b=1.2;var I=8;var p=0.2;var v=0.6;var P="";var g=false;var z=false;var L="root";var H;var O=null;var i=null;var j=null;var a=false;var F=false;var m=false;var c=null;var f=null;var M=false;var y={urls:{api:"../nifi-api",currentUser:"../nifi-api/flow/current-user",controllerBulletins:"../nifi-api/flow/controller/bulletins",kerberos:"../nifi-api/access/kerberos",oidc:"../nifi-api/access/oidc/exchange",revision:"../nifi-api/flow/revision",banners:"../nifi-api/flow/banners"}};var B=function(Q){if(g){r.reload({transition:true}).done(function(){setTimeout(function(){B(Q)},Q*1000)})}};var J=function(S){var R=new Date().getTime();var Q=r.getGroupId();return w.ajax({type:"GET",url:y.urls.api+"/flow/process-groups/"+encodeURIComponent(Q),dataType:"json"}).done(function(T){var V=T.processGroupFlow;r.setGroupId(V.id);r.setParameterContext(V.parameterContext);var W=V.breadcrumb;if(W.permissions.canRead){r.setGroupName(W.breadcrumb.name)}else{r.setGroupName(W.id)}i=T.permissions;k.injector.get("breadcrumbsCtrl").resetBreadcrumbs();k.digest();k.injector.get("breadcrumbsCtrl").generateBreadcrumbs(W);k.injector.get("breadcrumbsCtrl").resetScrollPosition();var U=W;while(U.parentBreadcrumb!=null){U=U.parentBreadcrumb}if(P==""){P=document.title}if(U.permissions.canRead){document.title=U.breadcrumb.name}else{document.title=P}w("#stats-last-refreshed").text(V.lastRefreshed);if(E.isDefinedAndNotNull(V.parentGroupId)){r.setParentGroupId(V.parentGroupId)}else{r.setParentGroupId(null)}l.expireCaches(R);l.set(V.flow,w.extend({selectAll:false,overrideRevisionCheck:C.didConnectedStateChange()},S));l.updateVisibility();e.refresh()}).fail(d.handleAjaxError)};var u=function(Q,S){var T=r.getGroupId();var U=r.getParameterContext();r.setGroupId(Q);var R=J(S);R.fail(function(X,V,W){r.setGroupId(T);r.setParameterContext(U)});return R};var x=function(){return w.ajax({type:"GET",url:y.urls.currentUser,dataType:"json"}).done(function(Q){E.setCurrentUser(Q)})};var r={CANVAS_OFFSET:0,SUPPORTS_SVG:!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,hideSplash:function(){w("#splash").fadeOut()},stopPolling:function(){g=false},disableRefreshHotKey:function(){z=true},reload:function(Q,R){return w.Deferred(function(U){var T;if(E.isDefinedAndNotNull(R)){T=u(R,Q)}else{T=J(Q)}var W=k.injector.get("flowStatusCtrl").reloadFlowStatus();var V=x();var S=w.ajax({type:"GET",url:y.urls.controllerBulletins,dataType:"json"}).done(function(Y){k.injector.get("flowStatusCtrl").updateBulletins(Y)});var X=C.loadClusterSummary().done(function(Y){var Z=Y.clusterSummary;if(C.didConnectedStateChange()){if(Z.connectedToCluster){h.showConnectedToClusterMessage(function(){o.resetDisconnectionAcknowledgement()})}else{h.showDisconnectedFromClusterMessage(function(){o.acknowledgeDisconnection()})}}k.injector.get("flowStatusCtrl").updateClusterSummary(Z)});w.when(T,W,V,S,X).done(function(Y){var Z=Y[0];k.digest();U.resolve(Z)}).fail(function(aa,Y,Z){U.reject(aa,Y,Z)})}).promise()},initCanvas:function(){var X=w("#canvas-container");c=G.select("#canvas-container").append("svg").on("contextmenu",function(){M=false;K.getSelection().classed("selected",false);K.setURLParameters();s.show();G.event.preventDefault()});var Q=c.append("defs");Q.selectAll("marker").data(["normal","ghost","unauthorized","full"]).enter().append("marker").attrs({id:function(Y){return Y},viewBox:"0 0 6 6",refX:5,refY:3,markerWidth:6,markerHeight:6,orient:"auto",fill:function(Y){if(Y==="ghost"){return"#aaaaaa"}else{if(Y==="unauthorized"){return"#ba554a"}else{if(Y==="full"){return"#ba554a"}else{return"#000000"}}}}}).append("path").attr("d","M2,3 L0,6 L6,3 L0,0 z");var T=Q.append("filter").attrs({id:"component-drop-shadow",height:"140%",y:"-20%"});T.append("feGaussianBlur").attrs({"in":"SourceAlpha",stdDeviation:3,result:"blur"});T.append("feOffset").attrs({"in":"blur",dx:0,dy:1,result:"offsetBlur"});T.append("feFlood").attrs({"flood-color":"#000000","flood-opacity":0.4,result:"offsetColor"});T.append("feComposite").attrs({"in":"offsetColor",in2:"offsetBlur",operator:"in",result:"offsetColorBlur"});var V=T.append("feMerge");V.append("feMergeNode").attr("in","offsetColorBlur");V.append("feMergeNode").attr("in","SourceGraphic");var S=Q.append("filter").attrs({id:"connection-full-drop-shadow",height:"140%",y:"-20%"});S.append("feGaussianBlur").attrs({"in":"SourceAlpha",stdDeviation:3,result:"blur"});S.append("feOffset").attrs({"in":"blur",dx:0,dy:1,result:"offsetBlur"});S.append("feFlood").attrs({"flood-color":"#ba554a","flood-opacity":1,result:"offsetColor"});S.append("feComposite").attrs({"in":"offsetColor",in2:"offsetBlur",operator:"in",result:"offsetColorBlur"});var W=S.append("feMerge");W.append("feMergeNode").attr("in","offsetColorBlur");W.append("feMergeNode").attr("in","SourceGraphic");f=c.append("g").attrs({transform:"translate("+n+") scale("+A+")","pointer-events":"all",id:"canvas"});c.on("mousedown.selection",function(){M=true;if(G.event.button!==0){G.event.stopImmediatePropagation();return}if(G.event.shiftKey){var Y=G.mouse(f.node());f.append("rect").attr("rx",6).attr("ry",6).attr("x",Y[0]).attr("y",Y[1]).attr("class","component-selection").attr("width",0).attr("height",0).attr("stroke-width",function(){return 1/r.View.getScale()}).attr("stroke-dasharray",function(){return 4/r.View.getScale()}).datum(Y);G.event.stopImmediatePropagation();G.event.preventDefault()}}).on("mousemove.selection",function(){if(G.event.shiftKey){var Z=G.select("rect.component-selection");if(!Z.empty()){var aa=Z.datum();var Y=G.mouse(f.node());var ab={};if(aa[0]<Y[0]){ab.x=aa[0];ab.width=Y[0]-aa[0]}else{ab.x=Y[0];ab.width=aa[0]-Y[0]}if(aa[1]<Y[1]){ab.y=aa[1];ab.height=Y[1]-aa[1]}else{ab.y=Y[1];ab.height=aa[1]-Y[1]}Z.attrs(ab);G.event.stopPropagation()}}}).on("mouseup.selection",function(){if(M===false){return}M=false;var Y=G.select("rect.component-selection");if(!Y.empty()){var Z={x:parseInt(Y.attr("x"),10),y:parseInt(Y.attr("y"),10),width:parseInt(Y.attr("width"),10),height:parseInt(Y.attr("height"),10)};G.selectAll("g.component").classed("selected",function(aa){return G.select(this).classed("selected")||aa.position.x>=Z.x&&(aa.position.x+aa.dimensions.width)<=(Z.x+Z.width)&&aa.position.y>=Z.y&&(aa.position.y+aa.dimensions.height)<=(Z.y+Z.height)});G.selectAll("g.connection").classed("selected",function(ac){var ab=[ac.start].concat(ac.bends,[ac.end]);var aa=G.extent(ab,function(ae){return ae.x});var ad=G.extent(ab,function(ae){return ae.y});return G.select(this).classed("selected")||aa[0]>=Z.x&&aa[1]<=(Z.x+Z.width)&&ad[0]>=Z.y&&ad[1]<=(Z.y+Z.height)});Y.remove();K.setURLParameters()}k.digest()});var U=function(){var ac=w("#banner-footer");var Y=0;if(ac.is(":visible")){Y=ac.height()}var aa=parseInt(X.css("top"),10);var ab=w(window).height();var Z=(ab-(Y+aa));X.css({height:Z+"px",bottom:Y+"px"});c.attrs({height:X.height(),width:w(window).width()});k.injector.get("breadcrumbsCtrl").updateBreadcrumbsCss({bottom:Y+"px"});w("#canvas-body").css({height:ab+"px",width:w(window).width()+"px"})};w("body").on("GoTo:Component",function(Z,Y){K.showComponent(Y.parentGroupId,Y.id)});w("body").on("GoTo:ProcessGroup",function(Z,Y){t.enterGroup(Y.id).done(function(){K.getSelection().classed("selected",false);k.digest()})});w("body").on("GoTo:ParameterContext",function(Z,Y){N.showParameterContexts(Y.id)});var R=E.throttle(q.reload,1000);w(window).on("resize",function(ag){if(ag.target===window){if(w(".md-menu-backdrop").is(":visible")===true){w(".md-menu-backdrop").click()}U();var ae=w("#shell-dialog");if(ae.is(":visible")){setTimeout(function(ai){D.resizeContent(ai);if(ai.find("#shell-iframe").is(":visible")){D.resizeIframe(ai)}},50,ae)}var Y=w(".dialog");for(var ad=0,af=Y.length;ad<af;ad++){if(w(Y[ad]).is(":visible")){setTimeout(function(ai){ai.modal("resize")},50,w(Y[ad]))}}var ah=w('*[class*="slickgrid_"]');for(var ac=0,af=ah.length;ac<af;ac++){if(w(ah[ac]).is(":visible")){setTimeout(function(aj){var ai=aj.data("gridInstance");var ak=ai.getEditorLock();if(!ak.isActive()){ai.resizeCanvas()}},50,w(ah[ac]))}}var aa=w(".tab-container");var Z=[];for(var ab=0,af=aa.length;ab<af;ab++){if(w(aa[ab]).is(":visible")){Z.push(w("#"+w(aa[ab]).attr("id")+"-content"))}}w.each(Z,function(ai,aj){E.toggleScrollable(aj.get(0))})}}).on("keydown",function(Y){if(w(".dialog").is(":visible")||w("#search-field").is(":focus")){return}var Z=K.getSelection();var aa=Y.ctrlKey||Y.metaKey;if(aa){if(Y.keyCode===82){if(z===true){location.reload();return}R()}else{if(Y.keyCode===65){q.selectAll();K.setURLParameters();k.digest();Y.preventDefault()}else{if(Y.keyCode===67){if(r.canWrite()&&K.isCopyable(Z)){q.copy(Z)}}else{if(Y.keyCode===86){if(r.canWrite()&&K.isPastable()){q.paste(Z);Y.preventDefault()}}}}}}else{if(Y.keyCode===8||Y.keyCode===46){if(r.canWrite()&&K.areDeletable(Z)){q["delete"](Z)}}}});w.ajax({type:"GET",url:y.urls.banners,dataType:"json"}).done(function(aa){if(E.isDefinedAndNotNull(aa.banners)){if(E.isDefinedAndNotNull(aa.banners.headerText)&&aa.banners.headerText!==""){w("#banner-header").addClass("banner-header-background").text(aa.banners.headerText).show();w("#canvas-container").css("top","98px")}if(E.isDefinedAndNotNull(aa.banners.footerText)&&aa.banners.footerText!==""){var Y=w("#banner-footer").text(aa.banners.footerText).show();var Z=function(ab){var ac=w("#"+ab);ac.css("bottom",parseInt(Y.css("height"),10)+"px")};Z("graph")}}U()}).fail(d.handleAjaxError)},init:function(){var Q=w.Deferred(function(R){var S=function(V){var U=E.getJwtPayload(V);var T=parseInt(U.exp,10)*E.MILLIS_PER_SECOND;o.setItem("jwt",V,T);R.resolve()};if(o.hasItem("jwt")){R.resolve()}else{w.ajax({type:"POST",url:y.urls.kerberos,dataType:"text"}).done(function(T){S(T)}).fail(function(){w.ajax({type:"POST",url:y.urls.oidc,dataType:"text"}).done(function(T){S(T)}).fail(function(){R.reject()})})}}).promise();return w.Deferred(function(R){Q.always(function(){x().done(function(S){if(S.anonymous===false){w("#current-user").text(S.identity).show();if(o.getItem("jwt")!==null){w("#logout-link-container").show()}}else{E.setAnonymousUserLabel()}R.resolve()}).fail(function(U,S,T){if(U.status===401){window.location="../nifi/login"}else{R.reject(U,S,T)}})})}).promise()},setParameterContext:function(Q){H=Q},getParameterContext:function(){return H},setGroupId:function(Q){L=Q},getGroupId:function(){return L},setGroupName:function(Q){O=Q},getGroupName:function(){return O},setParentGroupId:function(Q){j=Q},getParentGroupId:function(){return j},setManagedAuthorizer:function(Q){a=Q},isManagedAuthorizer:function(){return a},setConfigurableAuthorizer:function(Q){F=Q},isConfigurableAuthorizer:function(){return F},setConfigurableUsersAndGroups:function(Q){m=Q},isConfigurableUsersAndGroups:function(){return m},canRead:function(){if(i===null){return false}else{return i.canRead===true}},canWrite:function(){if(i===null){return false}else{return i.canWrite===true}},startPolling:function(Q){g=true;B(Q)},View:(function(){var S;var Q=0,T=0,R=A;return{init:function(){var W;var V=false;var X=function(Y){if(E.isDefinedAndNotNull(Y)){if(E.isDefinedAndNotNull(Y.subject)){return Y.subject.source==="birdseye"}else{return false}}else{return false}};var U=function(Y){if(E.isDefinedAndNotNull(Y)){if(X(Y)){return false}return Y.type==="wheel"||Y.type==="mousewheel"}else{return true}};S=G.zoom().scaleExtent([p,I]).on("start",function(){s.hide()}).on("zoom",function(){if(!isNaN(G.event.transform.x)){Q=G.event.transform.x}if(!isNaN(G.event.transform.y)){T=G.event.transform.y}if(!isNaN(G.event.transform.k)){R=G.event.transform.k}V=true;W=r.View.refresh({persist:false,transition:U(G.event.sourceEvent),refreshComponents:false,refreshBirdseye:false})}).on("end",function(){if(!X(G.event.sourceEvent)){if(E.isDefinedAndNotNull(W)){l.updateVisibility();W.done(function(){e.refresh()});K.persistUserView();W=null}if(V===false){K.getSelection().classed("selected",false);K.setURLParameters();k.digest()}}V=false});c.call(S).on("dblclick.zoom",null)},shouldRenderPerScale:function(){return r.View.getScale()>=v},translate:function(U){S.translateBy(c,U[0],U[1])},scale:function(U){S.scaleBy(c,U)},transform:function(V,U){S.transform(c,G.zoomIdentity.translate(V[0],V[1]).scale(U))},getTranslate:function(){return[Q,T]},getScale:function(){return R},zoomIn:function(){r.View.scale(b)},zoomOut:function(){r.View.scale(1/b)},fit:function(){var W=r.View.getTranslate();var Y=r.View.getScale();var ab;var aa=w("#canvas-container");var X=aa.width();var Z=aa.height();var ad=G.select("#canvas").node().getBoundingClientRect();var ae=ad.width/Y;var V=ad.height/Y;var ac=ad.left/Y;var U=(ad.top-r.CANVAS_OFFSET)/Y;if(ae>X||V>Z){ab=Math.min(X/ae,Z/V);ab=Math.min(Math.max(ab,p),I)}else{ab=1;ac-=100;U-=50}K.centerBoundingBox({x:ac-(W[0]/Y),y:U-(W[1]/Y),width:X/ab,height:Z/ab,scale:ab})},actualSize:function(){var Z=r.View.getTranslate();var Y=r.View.getScale();var V=K.getSelection();var W;if(!V.empty()){var U=V.node().getBoundingClientRect();W={x:(U.left/Y)-(Z[0]/Y),y:((U.top-r.CANVAS_OFFSET)/Y)-(Z[1]/Y),width:U.width/Y,height:U.height/Y,scale:1}}else{var ab=w("#canvas-container");var X=ab.width()/Y;var aa=ab.height()/Y;W={x:(X/2)-(Z[0]/Y),y:(aa/2)-(Z[1]/Y),width:1,height:1,scale:1}}K.centerBoundingBox(W)},refresh:function(U){return w.Deferred(function(V){var Y=true;var aa=false;var Z=true;var ab=true;if(E.isDefinedAndNotNull(U)){Y=E.isDefinedAndNotNull(U.persist)?U.persist:Y;aa=E.isDefinedAndNotNull(U.transition)?U.transition:aa;Z=E.isDefinedAndNotNull(U.refreshComponents)?U.refreshComponents:Z;ab=E.isDefinedAndNotNull(U.refreshBirdseye)?U.refreshBirdseye:ab}if(Z){l.updateVisibility()}if(Y===true){K.persistUserView()}var W=r.View.getTranslate();var X=r.View.getScale();if(aa===true){f.transition().duration(500).attr("transform",function(){return"translate("+W+") scale("+X+")"}).on("end",function(){if(ab===true){e.refresh()}V.resolve()})}else{f.attr("transform",function(){return"translate("+W+") scale("+X+")"});if(ab===true){e.refresh()}V.resolve()}}).promise()}}}())};return r}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["nf.ErrorHandler","nf.Common","nf.Canvas","nf.ContextMenu"],function(f,e,d,c){return(nf.ErrorHandler=b(f,e,d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ErrorHandler=b(require("nf.ErrorHandler"),require("nf.Common"),require("nf.Canvas"),require("nf.ContextMenu")))}else{nf.ErrorHandler=b(a.nf.ErrorHandler,a.nf.Common,a.nf.Canvas,a.nf.ContextMenu)}}}(this,function(e,d,b,a){var c=function(){if($("#message-pane").is(":visible")){d.showLogoutLink();if($("#splash").is(":visible")){b.hideSplash()}a.hide();b.stopPolling();b.disableRefreshHotKey()}};return{handleAjaxError:function(h,f,g){e.handleAjaxError(h,f,g);c()},handleConfigurationUpdateAjaxError:function(h,f,g){e.handleConfigurationUpdateAjaxError(h,f,g);c()}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.Settings","nf.UniversalCapture","nf.CustomUi","nf.CanvasUtils","nf.Processor"],function(g,m,l,d,f,h,n,e,i,k,c,j){return(nf.ControllerService=b(g,m,l,d,f,h,n,e,i,k,c,j))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ControllerService=b(require("jquery"),require("d3"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.Settings"),require("nf.UniversalCapture"),require("nf.CustomUi"),require("nf.CanvasUtils"),require("nf.Processor")))}else{nf.ControllerService=b(a.$,a.d3,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.Settings,a.nf.UniversalCapture,a.nf.CustomUi,a.nf.CanvasUtils,a.nf.Processor)}}}(this,function(E,V,d,T,k,u,g,J,c,B,Y,t){var P,F;var O={edit:"edit",readOnly:"read-only",serviceOnly:"SERVICE_ONLY",serviceAndReferencingComponents:"SERVICE_AND_REFERENCING_COMPONENTS",urls:{api:"../nifi-api"}};var I=function(){var ab=E("#controller-service-configuration").data("controllerServiceDetails");if(E("#controller-service-name").val()!==ab.component.name){return true}if(E("#controller-service-comments").val()!==ab.component.comments){return true}return E("#controller-service-properties").propertytable("isSaveRequired")};var o=function(){var ac=E("#controller-service-properties").propertytable("marshalProperties");var ad={};ad.id=E("#controller-service-id").text();ad.name=E("#controller-service-name").val();ad.comments=E("#controller-service-comments").val();if(E.isEmptyObject(ac)===false){ad.properties=ac}var ab={};ab.disconnectedNodeAcknowledged=u.isDisconnectionAcknowledged();ab.component=ad;return ab};var b=function(ab){return true};var Z=function(ae,af){var ac=ae.data("gridInstance");var ad=ac.getData();var ab=ad.getItemById(af);if(T.isUndefined(ab)||ab.permissions.canRead===false){return E.Deferred(function(ag){ag.reject()}).promise()}return E.ajax({type:"GET",url:ab.uri,dataType:"json"}).done(function(ag){Q(ae,ag)}).fail(d.handleAjaxError)};var Q=function(af,ab){var ac=af.data("gridInstance");var ae=ac.getData();var ad=ae.getItemById(ab.id);ae.updateItem(ab.id,E.extend({type:"ControllerService",bulletins:ad.bulletins},ab))};var h=function(ac,ab){Z(ac,ab.id).done(function(ad){f(ac,ad.component)})};var f=function(ac,ab){E.each(ab.referencingComponents,function(ae,ag){if(ag.permissions.canRead===false){return}var ad=ag.component;if(ad.referenceType==="Processor"){if(Y.getGroupId()===ad.groupId){t.reload(ad.id)}E("div."+ad.id+"-active-threads").text(ad.activeThreadCount);var af=E("div."+ad.id+"-state");if(af.length){m(af,ad)}}else{if(ad.referenceType==="ReportingTask"){F.reload(ad.id);E("div."+ad.id+"-active-threads").text(ad.activeThreadCount);var af=E("div."+ad.id+"-state");if(af.length){m(af,ad)}}else{Z(ac,ad.id);var af=E("div."+ad.id+"-state");if(af.length){K(af,ad)}if(ad.referenceCycle===false){f(ac,ad)}}}});U.reloadReferencedServices(ac,ab)};var W=function(ab){var ac=ab.get(0).scrollHeight>Math.round(ab.innerHeight())||ab.get(0).scrollWidth>Math.round(ab.innerWidth());if(ab.is(":visible")&&ac){ab.css("border-width","1px")}else{ab.css("border-width","0px")}};var l=function(ae,ac){var af=ac.data("bulletins");if(T.doBulletinsDiffer(af,ae)){ac.data("bulletins",ae);var ab=T.getFormattedBulletins(ae);if(ae.length>0){var ad=T.formatUnorderedList(ab);if(ac.data("qtip")){ac.qtip("option","content.text",ad)}else{ac.addClass("has-bulletins").show().qtip(E.extend({},Y.config.systemTooltipConfig,{content:ad}))}}else{if(ac.data("qtip")){ac.removeClass("has-bulletins").removeData("bulletins").hide().qtip("api").destroy(true)}}}};var m=function(ab,ac){ab.removeClass("disabled stopped running invalid").addClass(function(){var ad=E(this);var af=ac.state.toLowerCase();if(af==="stopped"&&!T.isEmpty(ac.validationErrors)){af="invalid";var ae=T.formatUnorderedList(ac.validationErrors);if(ad.data("qtip")){ad.qtip("option","content.text",ae)}else{ad.qtip(E.extend({},Y.config.systemTooltipConfig,{content:ae}))}}else{if(ad.data("qtip")){ad.qtip("api").destroy(true)}}return af})};var K=function(ac,ab){ac.removeClass("disabled enabled invalid").addClass(function(){var ad=E(this);var af=ab.state==="ENABLED"?"enabled":"disabled";if(af==="disabled"&&!T.isEmpty(ab.validationErrors)){af="invalid";var ae=T.formatUnorderedList(ab.validationErrors);if(ad.data("qtip")){ad.qtip("option","content.text",ae)}else{ad.qtip(E.extend({},Y.config.systemTooltipConfig,{content:ae}))}}else{if(ad.data("qtip")){ad.qtip("api").destroy(true)}}return af})};var n=function(ac){var ab=V.nest().key(function(ad){return ad.sourceId}).map(ac,V.map);ab.each(function(ad,ae){E("div."+ae+"-bulletins").each(function(){l(ad,E(this))})})};var N=function(ak,al,ac){if(ac.permissions.canRead===false){al.append('<div class="unset">Unauthorized</div>');return}var af=ac.component.referencingComponents;if(T.isEmpty(af)){al.append('<div class="unset">No referencing components.</div>');return}var ad=function(an,am){if(an.hasClass("expanded")){an.removeClass("expanded").addClass("collapsed");am.hide()}else{an.removeClass("collapsed").addClass("expanded");am.show()}};var ae=[];var ag=E('<ul class="referencing-component-listing clear"></ul>');var aj=E('<ul class="referencing-component-listing clear"></ul>');var ab=E('<ul class="referencing-component-listing clear"></ul>');var ah=E('<ul class="referencing-component-listing clear"></ul>');E.each(af,function(aJ,at){if(at.permissions.canRead===false){var ap=E('<div class="unset"></div>').text(at.id);ah.append(ap)}else{var aC=at.component;ae.push(aC.id);if(aC.referenceType==="Processor"){var aI=E('<span class="referencing-component-name link"></span>').text(aC.name).on("click",function(){Y.showComponent(aC.groupId,aC.id);al.closest(".dialog").modal("hide");E("#shell-close-button").click()});var ay=E('<div class="referencing-component-state"></div>').addClass(aC.id+"-state");m(ay,aC);var aA=E('<div class="referencing-component-bulletins"></div>').addClass(aC.id+"-bulletins");var aD=E('<span class="referencing-component-type"></span>').text(aC.type);var ao=E('<span class="referencing-component-active-thread-count"></span>').addClass(aC.id+"-active-threads");if(T.isDefinedAndNotNull(aC.activeThreadCount)&&aC.activeThreadCount>0){ao.text("("+aC.activeThreadCount+")")}var av=E("<li></li>").append(ay).append(aA).append(aI).append(aD).append(ao);ag.append(av)}else{if(aC.referenceType==="ControllerService"){var aF=E('<span class="referencing-component-name link"></span>').text(aC.name).on("click",function(){var aK=ak.data("gridInstance");var aL=aK.getData();var aM=aL.getRowById(aC.id);aK.setSelectedRows([aM]);aK.scrollRowIntoView(aM);al.closest(".dialog").modal("hide")});var aG=E('<div class="referencing-component-references hidden"></div>');var ar=E('<div class="service expansion-button collapsed pointer"></div>').on("click",function(){if(ar.hasClass("collapsed")){if(aC.referenceCycle===true){aG.append('<div class="unset">Reference cycle detected.</div>')}else{var aK=ak.data("gridInstance");var aL=aK.getData();p(aC.id,aL).done(function(aM){N(ak,aG,aM)})}}else{aG.empty()}ad(ar,aG);W(al)});var aw=E('<div class="referencing-component-state"></div>').addClass(aC.id+"-state");K(aw,aC);var aH=E('<div class="referencing-component-bulletins"></div>').addClass(aC.id+"-bulletins");var aB=E('<span class="referencing-component-type"></span>').text(aC.type);var au=E("<li></li>").append(ar).append(aw).append(aH).append(aF).append(aB).append(aG);aj.append(au)}else{if(aC.referenceType==="ReportingTask"){var aq=E('<span class="referencing-component-name link"></span>').text(aC.name).on("click",function(){var aM=E("#reporting-tasks-table").data("gridInstance");var aK=aM.getData();var aL=aK.getRowById(aC.id);aM.setSelectedRows([aL]);aM.scrollRowIntoView(aL);E("#settings-tabs").find("li:last").click();al.closest(".dialog").modal("hide")});var az=E('<div class="referencing-component-state"></div>').addClass(aC.id+"-state");m(az,aC);var am=E('<div class="referencing-component-bulletins"></div>').addClass(aC.id+"-bulletins");var an=E('<span class="referencing-component-type"></span>').text(T.substringAfterLast(aC.type,"."));var ax=E('<span class="referencing-component-active-thread-count"></span>').addClass(aC.id+"-active-threads");if(T.isDefinedAndNotNull(aC.activeThreadCount)&&aC.activeThreadCount>0){ax.text("("+aC.activeThreadCount+")")}var aE=E("<li></li>").append(az).append(am).append(aq).append(an).append(ax);ab.append(aE)}}}}});Y.queryBulletins(ae).done(function(am){var an=am.bulletinBoard.bulletins;n(an)});var ai=function(am,ao){if(ao.is(":empty")){ao.remove();return}var aq=E('<div class="expansion-button expanded"></div>');var ap=E('<span class="referencing-component-title"></span>').text(am);var an=E('<span class="referencing-component-count"></span>').text("("+ao.children().length+")");E('<div class="referencing-component-block pointer unselectable"></div>').on("click",function(){ad(aq,ao);W(al)}).append(aq).append(ap).append(an).appendTo(al);ao.appendTo(al)};ai("Processors",ag);ai("Reporting Tasks",ab);ai("Controller Services",aj);ai("Unauthorized",ah)};var e=function(ag,ac,ae,af){var ab={revision:g.getRevision(ac),disconnectedNodeAcknowledged:u.isDisconnectionAcknowledged(),state:ae?"ENABLED":"DISABLED"};var ad=E.ajax({type:"PUT",url:ac.uri+"/run-status",data:JSON.stringify(ab),dataType:"json",contentType:"application/json"}).done(function(ah){Q(ag,ah)}).fail(d.handleAjaxError);return E.Deferred(function(ah){ad.done(function(){if(ac.permissions.canRead===false){ah.resolve();return}var ai=v(ac,function(al,ak){if(E.isArray(ak)){if(ae){l(ak,E("#enable-controller-service-bulletins"))}else{l(ak,E("#disable-controller-service-bulletins"))}}var aj=al.status.runStatus;if(ae){return aj==="ENABLING"||aj==="ENABLED"}else{return aj==="DISABLED"}},function(aj){return Y.queryBulletins([ac.id])},af);ai.done(function(){ah.resolve()}).fail(function(){ah.reject()})}).fail(function(){ah.reject()})}).promise()};var r=function(ab){var ac=V.set();ac.add(ab.id);var ad=function(ae){E.each(ae,function(af,ah){var ag=ah.component;if(ag.referenceType==="ControllerService"){ac.add(ag.id);if(ag.referenceCycle===false){ad(ag.referencingComponents)}}})};ad(ab.referencingComponents);return ac};var a=function(ac,ab,ad){E.each(ac,function(ae,ag){var af=ag.component;if(ad){if(af.referenceType==="ControllerService"){ab[ag.id]=g.getRevision(ag)}}else{if(af.referenceType!=="ControllerService"){ab[ag.id]=g.getRevision(ag)}}a(af.referencingComponents,ab,ad)})};var G=function(ag,ab,ad,af){var ah={};a(ab.component.referencingComponents,ah,false);var ae={id:ab.id,state:ad?"RUNNING":"STOPPED",referencingComponentRevisions:ah,disconnectedNodeAcknowledged:u.isDisconnectionAcknowledged()};var ac=E.ajax({type:"PUT",url:ab.uri+"/references",data:JSON.stringify(ae),dataType:"json",contentType:"application/json"}).fail(d.handleAjaxError);return E.Deferred(function(ai){ac.done(function(aj){ab.component.referencingComponents=aj.controllerServiceReferencingComponents;if(ad){ai.resolve()}else{var ak=r(ab.component);var al=ag.data("gridInstance");var an=al.getData();var am=[];ak.each(function(ao){p(ao,an).done(function(ap){am.push(x(ap,af))})});E.when.apply(window,am).done(function(){ai.resolve()}).fail(function(){ai.reject()})}}).fail(function(){ai.reject()})}).promise()};var p=function(ac,ad){var ab=ad.getItemById(ac);if(T.isDefinedAndNotNull(ab)){return E.Deferred(function(ae){ae.resolve(ab)})}else{return E.ajax({type:"GET",url:"../nifi-api/controller-services/"+encodeURIComponent(ac),dataType:"json"}).fail(d.handleAjaxError)}};var v=function(ab,ae,ad,af){var ac=ab.component;return E.Deferred(function(ag){var aj=2;var ai=function(){var al=aj;aj=Math.min(aj*2,4);return al*1000};var ak=function(){var am=ad(ac);var al=E.ajax({type:"GET",url:ab.uri,dataType:"json"});E.when(am,al).done(function(an,ao){var ap=ao[0];ah(ap,an.bulletinBoard.bulletins)}).fail(function(ap,an,ao){ag.reject();d.handleAjaxError(ap,an,ao)})};var ah=function(am,al){if(ae(am,al)){ag.resolve()}else{if(typeof af==="function"&&af()){setTimeout(ak,ai())}else{ag.reject()}}};ad(ac).done(function(al){ah(ab,al.bulletinBoard.bulletins)}).fail(function(an,al,am){ag.reject();d.handleAjaxError(an,al,am)})}).promise()};var x=function(ab,ac){return v(ab,function(ag,af){var ad=ag.component.referencingComponents;var ae=false;E.each(ad,function(ah,ak){var aj=ak.component;if(aj.referenceType==="Processor"||aj.referenceType==="ReportingTask"){if(aj.state==="RUNNING"||aj.activeThreadCount>0){ae=true}E("div."+aj.id+"-active-threads").text(aj.activeThreadCount);var ai=E("div."+aj.id+"-state");m(ai,aj)}});n(af);return ae===false},function(ad){var af=[];var ae=ad.referencingComponents;E.each(ae,function(ag,ai){var ah=ai.component;if(ah.referenceType==="Processor"||ah.referenceType==="ReportingTask"){af.push(ah.id)}});return Y.queryBulletins(af)},ac)};var aa=function(ab,ac){return v(ab,function(ag,af){var ad=ag.component.referencingComponents;var ae=false;E.each(ad,function(ah,ak){var ai=ak.component;if(ai.referenceType==="ControllerService"){if(ai.state!=="ENABLING"&&ai.state!=="ENABLED"){ae=true}var aj=E("div."+ai.id+"-state");K(aj,ai)}});n(af);return ae===false},function(ad){var af=[];var ae=ad.referencingComponents;E.each(ae,function(ag,ai){var ah=ai.component;if(ah.referenceType==="ControllerService"){af.push(ah.id)}});return Y.queryBulletins(af)},ac)};var M=function(ab,ac){return v(ab,function(af,ae){var ad=af.component.referencingComponents;var ag=false;E.each(ad,function(ah,ak){var ai=ak.component;if(ai.referenceType==="ControllerService"){if(ai.state!=="DISABLED"){ag=true}var aj=E("div."+ai.id+"-state");K(aj,ai)}});n(ae);return ag===false},function(ad){var af=[];var ae=ad.referencingComponents;E.each(ae,function(ag,ai){var ah=ai.component;if(ah.referenceType==="ControllerService"){af.push(ah.id)}});return Y.queryBulletins(af)},ac)};var s=function(ag,ab,ad,af){var ah={};a(ab.component.referencingComponents,ah,true);var ae={id:ab.id,state:ad?"ENABLED":"DISABLED",referencingComponentRevisions:ah,disconnectedNodeAcknowledged:u.isDisconnectionAcknowledged()};var ac=E.ajax({type:"PUT",url:ab.uri+"/references",data:JSON.stringify(ae),dataType:"json",contentType:"application/json"}).fail(d.handleAjaxError);return E.Deferred(function(ai){ac.done(function(aj){ab.component.referencingComponents=aj.controllerServiceReferencingComponents;var ak=r(ab.component);var al=ag.data("gridInstance");var an=al.getData();var am=[];ak.each(function(ao){p(ao,an).done(function(ap){if(ad){am.push(aa(ap,af))}else{am.push(M(ap,af))}})});E.when.apply(window,am).done(function(){ai.resolve()}).fail(function(){ai.reject()})}).fail(function(){ai.reject()})}).promise()};var A=function(ae,ac){E("#disable-controller-service-id").text(ac.id);E("#disable-controller-service-name").text(T.getComponentName(ac));var ab=E("#disable-controller-service-referencing-components");N(ae,ab,ac);var ad=[{buttonText:"Disable",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){H(ae)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:S}}];E("#disable-controller-service-dialog").modal("setButtonModel",ad).modal("show");Y.queryBulletins([ac.id]).done(function(af){l(af.bulletinBoard.bulletins,E("#disable-controller-service-bulletins"))});W(ab)};var D=function(ae,ac){E("#enable-controller-service-id").text(ac.id);E("#enable-controller-service-name").text(T.getComponentName(ac));var ab=E("#enable-controller-service-referencing-components");N(ae,ab,ac);var ad=[{buttonText:"Enable",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){i(ae)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:S}}];E("#enable-controller-service-dialog").modal("setButtonModel",ad).modal("show");Y.queryBulletins([ac.id]).done(function(af){l(af.bulletinBoard.bulletins,E("#enable-controller-service-bulletins"))});W(ab)};var S=function(){E(this).modal("hide")};var H=function(ak){var ae=E("#disable-controller-service-dialog");var ad=false;ae.modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){ad=true;ae.modal("setButtonModel",[]);E("#disable-controller-service-dialog div.controller-service-canceling").show()}}}]);E("#disable-controller-service-scope-container").hide();E("#disable-controller-service-progress-container").show();var aj=E("#disable-controller-service-id").text();var ab=ak.data("gridInstance");var af=ab.getData();var ac=af.getItemById(aj);var ag=ac.component;var al=function(){return ad===false};var ai=function(){E("#disable-controller-service-dialog div.controller-service-canceling").hide();ae.modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:S}}])};if(C(ac)){ai();k.showOkDialog({headerText:"Controller Service",dialogContent:ac.permissions.canRead===false?"Unable to disable due to a lack of read permission to see referencing components.":"Unable to disable due to unauthorized referencing components."});return}E("#disable-progress-label").text("Steps to disable "+T.getComponentName(ac));var ah=E("#disable-referencing-schedulable").addClass("ajax-loading");E.Deferred(function(am){var an=G(ak,ac,false,al);an.done(function(){ah.removeClass("ajax-loading").addClass("ajax-complete");var ao=E("#disable-referencing-services").addClass("ajax-loading");var ap=s(ak,ac,false,al);ap.done(function(){ao.removeClass("ajax-loading").addClass("ajax-complete");var aq=E("#disable-controller-service").addClass("ajax-loading");e(ak,ac,false,al).done(function(){am.resolve();aq.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){am.reject();aq.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){am.reject();ao.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){am.reject();ah.removeClass("ajax-loading").addClass("ajax-error")})}).always(function(){if(ac.permissions.canRead===true){h(ak,ag)}ai();if(ad===true&&E("#nf-ok-dialog").not(":visible")){k.showOkDialog({headerText:"Controller Service",dialogContent:"The request to disable has been canceled. Parts of this request may have already completed. Please verify the state of this service and all referencing components."})}})};var C=function(ab){if(ab.permissions.canRead===false||(ab.permissions.canWrite===false&&ab.operatePermissions.canWrite===false)){return true}var ad=false;var ac=ab.component.referencingComponents;E.each(ac,function(ae,af){if(C(af)){ad=true;return false}});return ad};var i=function(ak){var ab=E("#enable-controller-service-dialog");var ae=false;var aj=E("#enable-controller-service-id").text();var ac=ak.data("gridInstance");var af=ac.getData();var ad=af.getItemById(aj);var ag=ad.component;var am=E("#enable-controller-service-scope").combo("getSelectedOption").value;if(am===O.serviceOnly){E("#enable-controller-service-progress li.referencing-component").hide()}ab.modal("setButtonModel",[{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){ae=true;ab.modal("setButtonModel",[]);E("#enable-controller-service-dialog div.controller-service-canceling").show()}}}]);E("#enable-controller-service-scope-container").hide();E("#enable-controller-service-progress-container").show();var al=function(){return ae===false};var ai=function(){E("#enable-controller-service-dialog div.controller-service-canceling").hide();ab.modal("setButtonModel",[{buttonText:"Close",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:S}}])};if(am===O.serviceAndReferencingComponents&&C(ad)){ai();k.showOkDialog({headerText:"Controller Service",dialogContent:ad.permissions.canRead===false?"Unable to enable due to a lack of read permission to see referencing components.":"Unable to enable due to unauthorized referencing components."});return}E("#enable-progress-label").text("Steps to enable "+T.getComponentName(ad));var ah=E("#enable-controller-service").addClass("ajax-loading");E.Deferred(function(an){var ao=e(ak,ad,true,al);if(am===O.serviceAndReferencingComponents){ao.done(function(){ah.removeClass("ajax-loading").addClass("ajax-complete");var ap=E("#enable-referencing-services").addClass("ajax-loading");var aq=s(ak,ad,true,al);aq.done(function(){ap.removeClass("ajax-loading").addClass("ajax-complete");var ar=E("#enable-referencing-schedulable").addClass("ajax-loading");G(ak,ad,true,al).done(function(){an.resolve();ar.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){an.reject();ar.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){an.reject();ap.removeClass("ajax-loading").addClass("ajax-error")})}).fail(function(){an.reject();ah.removeClass("ajax-loading").addClass("ajax-error")})}else{ao.done(function(){an.resolve();ah.removeClass("ajax-loading").addClass("ajax-complete")}).fail(function(){an.reject();ah.removeClass("ajax-loading").addClass("ajax-error")})}}).always(function(){if(ad.permissions.canRead===true){h(ak,ag)}ai();if(ae===true&&E("#nf-ok-dialog").not(":visible")){k.showOkDialog({headerText:"Controller Service",dialogContent:"The request to enable has been canceled. Parts of this request may have already completed. Please verify the state of this service and all referencing components."})}})};var L=function(ac){var ab=E("#controller-service-configuration").data("controllerServiceDetails");return E.ajax({type:"GET",url:ab.uri+"/descriptors",data:{propertyName:ac},dataType:"json"}).fail(d.handleAjaxError)};var z=function(ab,ac){return E.Deferred(function(ae){if(T.isDefinedAndNotNull(ac)){var af;if(ac===Y.getGroupId()){af=Y.getParameterContext()}else{var ad=Y.getComponentByType("ProcessGroup").get(ac);af=ad.parameterContext}if(T.isDefinedAndNotNull(af)){E.ajax({type:"GET",url:"../nifi-api/parameter-contexts/"+encodeURIComponent(af.id),dataType:"json"}).done(function(ah){var ag=T.isSensitiveProperty(ab);ae.resolve(ah.component.parameters.map(function(ai){return ai.parameter}).filter(function(ai){return ai.sensitive===ag}))}).fail(function(){ae.resolve([])})}else{ae.resolve([])}}else{ae.resolve([])}}).promise()};var R=function(ab){return E.Deferred(function(ac){E("#controller-service-properties").propertytable("saveRow");if(I()){k.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before going to this Controller Service?",noHandler:function(){ac.resolve()},yesHandler:function(){var ad=E("#controller-service-configuration").data("controllerServiceDetails");y(ab,ad).done(function(){ac.resolve()}).fail(function(){ac.reject()})}})}else{ac.resolve()}}).promise()};var j=function(ad,ab){if(_.isNil(ab.parentGroupId)){return null}var ae;if(_.isNil(ad)||ad===Y.getGroupId()){ae=Y.getParameterContext()}else{var ac=Y.getComponentByType("ProcessGroup").get(ad);ae=ac.parameterContext}return ae};var y=function(ad,ab){var ae=o();if(b(ae)){ae.revision=g.getRevision(ab);var ac=[];E.each(q(ab.component),function(ag,ai){var af=!T.isUndefined(ae.component.properties)&&!T.isUndefined(ae.component.properties[ai.name]);var ah=T.isDefinedAndNotNull(ab.component.properties[ai.name]);if(af&&ah){ac.push(ab.component.properties[ai.name])}});return E.ajax({type:"PUT",data:JSON.stringify(ae),url:ab.uri,dataType:"json",contentType:"application/json"}).done(function(af){Q(ad,af);E.each(ac,function(ag,ah){Z(ad,ah)})}).fail(d.handleConfigurationUpdateAjaxError)}else{return E.Deferred(function(af){af.reject()}).promise()}};var q=function(ac){var ab=[];E.each(ac.descriptors,function(ad,ae){if(T.isDefinedAndNotNull(ae.identifiesControllerService)){ab.push(ae)}});return ab};var w=function(ac){var ab=[];E.each(q(ac),function(ad,ae){var af=ac.properties[ae.name];if(T.isDefinedAndNotNull(af)&&E.trim(af).length>0){ab.push(af)}});return ab};var X;var U={init:function(ac,ab){P=ac;F=ab;E("#controller-service-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"controller-service-standard-settings-tab-content"},{name:"Properties",tabContentId:"controller-service-properties-tab-content"},{name:"Comments",tabContentId:"controller-service-comments-tab-content"}],select:function(){c.removeAllPropertyDetailDialogs();if(E(this).text()==="Properties"){E("#controller-service-properties").propertytable("resetTableSize")}E("#controller-service-properties").propertytable("saveRow");var ad=E("#controller-service-referencing-components");W(ad)}});E("#controller-service-configuration").modal({headerText:"Configure Controller Service",scrollableContentStyle:"scrollable",handler:{close:function(){var ad=E("#controller-service-referencing-components");T.cleanUpTooltips(ad,"div.referencing-component-state");T.cleanUpTooltips(ad,"div.referencing-component-bulletins");ad.css("border-width","0").empty();E("#controller-service-properties").propertytable("cancelEdit");E("#controller-service-properties").propertytable("clear");T.clearField("read-only-controller-service-comments");E("#controller-service-compatible-apis").empty();E("#controller-service-configuration").removeData("controllerServiceDetails")},open:function(){T.toggleScrollable(E("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});E("#disable-controller-service-dialog").modal({headerText:"Disable Controller Service",scrollableContentStyle:"scrollable",handler:{close:function(){var ae=E(this);E("#disable-controller-service-scope-container").show();E("#disable-controller-service-progress-container").hide();E("#disable-controller-service-id").text("");E("#disable-controller-service-name").text("");E("#disable-controller-service-bulletins").removeClass("has-bulletins").removeData("bulletins").hide();T.cleanUpTooltips(E("#disable-controller-service-service-container"),"#disable-controller-service-bulletins");E("div.disable-referencing-components").removeClass("ajax-loading ajax-complete ajax-error");var ad=E("#disable-controller-service-referencing-components");T.cleanUpTooltips(ad,"div.referencing-component-state");T.cleanUpTooltips(ad,"div.referencing-component-bulletins");ad.css("border-width","0").empty()}}});E("#enable-controller-service-scope").combo({options:[{text:"Service only",value:O.serviceOnly,description:"Enable only this controller service"},{text:"Service and referencing components",value:O.serviceAndReferencingComponents,description:"Enable this controller service and enable/start all referencing components"}]});E("#enable-controller-service-dialog").modal({headerText:"Enable Controller Service",scrollableContentStyle:"scrollable",handler:{close:function(){var ae=E(this);E("#enable-controller-service-scope-container").show();E("#enable-controller-service-progress-container").hide();E("#enable-controller-service-progress li.referencing-component").show();E("#enable-controller-service-id").text("");E("#enable-controller-service-name").text("");E("#enable-controller-service-bulletins").removeClass("has-bulletins").removeData("bulletins").hide();T.cleanUpTooltips(E("#enable-controller-service-service-container"),"#enable-controller-service-bulletins");E("div.enable-referencing-components").removeClass("ajax-loading ajax-complete ajax-error");var ad=E("#enable-controller-service-referencing-components");T.cleanUpTooltips(ad,"div.referencing-component-state");T.cleanUpTooltips(ad,"div.referencing-component-bulletins");ad.css("border-width","0").empty()}}})},showConfiguration:function(af,ac){if(T.isUndefined(X)){X=af}var ad=E("#controller-service-configuration");ad.find(".dialog-header .dialog-header-text").text("Configure Controller Service");if(ad.data("mode")!==O.edit||X!==af){E("#controller-service-configuration .controller-service-read-only").hide();E("#controller-service-configuration .controller-service-editable").show();var ae=null;if(T.isDefinedAndNotNull(ac.parentGroupId)){ae=z}E("#controller-service-properties").propertytable("destroy").propertytable({readOnly:false,supportsGoTo:true,dialogContainer:"#new-controller-service-property-container",descriptorDeferred:L,parameterDeferred:ae,controllerServiceCreatedDeferred:function(ai){var ah;var aj=ai.component;if(T.isDefinedAndNotNull(aj.parentGroupId)){ah=O.urls.api+"/flow/process-groups/"+encodeURIComponent(aj.parentGroupId)+"/controller-services"}else{ah=O.urls.api+"/flow/controller/controller-services"}return P.loadControllerServices(ah,af)},goToServiceDeferred:function(){return R(af)},getParameterContext:function(ah){return j(ah,ac)}});ad.data("mode",O.edit)}X=af;var ag=E.ajax({type:"GET",url:ac.uri,dataType:"json"});var ab=E.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(ac.id),dataType:"json"});E.when(ag,ab).done(function(am,al){ac=am[0];var ai=ac.component;var an=al[0].componentHistory;ad.data("controllerServiceDetails",ac);T.populateField("controller-service-id",ai.id);T.populateField("controller-service-type",T.formatType(ai));T.populateField("controller-service-bundle",T.formatBundle(ai.bundle));E("#controller-service-name").val(ai.name);E("#controller-service-comments").val(ai.comments);if(!T.isEmpty(ai.controllerServiceApis)){var ah=T.getFormattedServiceApis(ai.controllerServiceApis);var ak=T.formatUnorderedList(ah);E("#controller-service-compatible-apis").append(ak)}else{E("#controller-service-compatible-apis").append('<span class="unset">None</span>')}var aj=E("#controller-service-referencing-components");N(af,aj,ac);var ao=[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){E("#controller-service-properties").propertytable("saveRow");y(af,ac).done(function(ap){f(af,ap.component);ad.modal("hide")})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){ad.modal("hide")}}}];if(T.isDefinedAndNotNull(ai.customUiUrl)&&ai.customUiUrl!==""){ao.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){var ap=function(){ad.modal("hide");E("#shell-close-button").click();B.showCustomUi(ac,ai.customUiUrl,true).done(function(){h(af,ai);J.showSettings()})};E("#controller-service-properties").propertytable("saveRow");if(I()){k.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before opening the advanced configuration?",noHandler:ap,yesHandler:function(){y(af,ac).done(function(){ap()})}})}else{ap()}}}})}ad.modal("setButtonModel",ao);E("#controller-service-properties").propertytable("setGroupId",ai.parentGroupId).propertytable("loadProperties",ai.properties,ai.descriptors,an.propertyHistory);ad.modal("show");W(aj);E("#controller-service-properties").propertytable("resetTableSize")}).fail(d.handleAjaxError)},showDetails:function(ae,ac){var ad=E("#controller-service-configuration");ad.find(".dialog-header .dialog-header-text").text("Controller Service Details");if(ad.data("mode")!==O.readOnly){E("#controller-service-configuration .controller-service-read-only").show();E("#controller-service-configuration .controller-service-editable").hide();E("#controller-service-properties").propertytable("destroy").propertytable({supportsGoTo:true,readOnly:true,getParameterContext:function(ag){return j(ag,ac)}});ad.data("mode",O.readOnly)}var af=E.ajax({type:"GET",url:ac.uri,dataType:"json"});var ab=E.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(ac.id),dataType:"json"});E.when(af,ab).done(function(al,ak){ac=al[0];var ah=ac.component;var am=ak[0].componentHistory;ad.data("controllerServiceDetails",ac);T.populateField("controller-service-id",ah.id);T.populateField("controller-service-type",T.formatType(ah));T.populateField("controller-service-bundle",T.formatBundle(ah.bundle));T.populateField("read-only-controller-service-name",ah.name);T.populateField("read-only-controller-service-comments",ah.comments);if(!T.isEmpty(ah.controllerServiceApis)){var ag=T.getFormattedServiceApis(ah.controllerServiceApis);var aj=T.formatUnorderedList(ag);E("#controller-service-compatible-apis").append(aj)}else{E("#controller-service-compatible-apis").append('<span class="unset">None</span>')}var ai=E("#controller-service-referencing-components");N(ae,ai,ac);var an=[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){ad.modal("hide")}}}];if(T.isDefinedAndNotNull(B)&&T.isDefinedAndNotNull(ah.customUiUrl)&&ah.customUiUrl!==""){an.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){ad.modal("hide");E("#shell-close-button").click();B.showCustomUi(ac,ah.customUiUrl,false).done(function(){J.showSettings()})}}})}ad.modal("setButtonModel",an);E("#controller-service-properties").propertytable("loadProperties",ah.properties,ah.descriptors,am.propertyHistory);ad.modal("show");W(ai);E("#controller-service-properties").propertytable("resetTableSize")})},enable:function(ac,ab){D(ac,ab)},disable:function(ac,ab){A(ac,ab)},reloadReferencedServices:function(ac,ab){E.each(w(ab),function(ad,ae){Z(ac,ae)})},promptToDeleteController:function(ac,ab){k.showYesNoDialog({headerText:"Delete Controller Service",dialogContent:"Delete controller service '"+T.escapeHtml(ab.component.name)+"'?",yesHandler:function(){U.remove(ac,ab)}})},remove:function(ad,ab){var ac=g.getRevision(ab);E.ajax({type:"DELETE",url:ab.uri+"?"+E.param({version:ac.version,clientId:ac.clientId,disconnectedNodeAcknowledged:u.isDisconnectionAcknowledged()}),dataType:"json"}).done(function(ae){var af=ad.data("gridInstance");var ag=af.getData();ag.deleteItem(ab.id);if(ab.permissions.canRead){f(ad,ab.component)}}).fail(d.handleAjaxError)}};return U}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","Slick","nf.Client","nf.Shell","nf.ProcessGroupConfiguration","nf.CanvasUtils","nf.ErrorHandler","nf.FilteredDialogCommon","nf.Dialog","nf.Storage","nf.Common","nf.ControllerService","nf.ProcessGroup","nf.PolicyManagement","nf.ComponentState","nf.ComponentVersion","nf.ng.Bridge"],function(g,r,o,t,q,l,n,i,f,m,h,k,d,j,p,c,e,s){return(nf.ControllerServices=b(g,r,o,t,q,l,n,i,f,m,h,k,d,j,p,c,e,s))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ControllerServices=b(require("jquery"),require("d3"),require("Slick"),require("nf.Client"),require("nf.Shell"),require("nf.ProcessGroupConfiguration"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.FilteredDialogCommon"),require("nf.Dialog"),require("nf.Storage"),require("nf.Common"),require("nf.ControllerService"),require("nf.ProcessGroup"),require("nf.PolicyManagement"),require("nf.ComponentState"),require("nf.ComponentVersion"),require("nf.ng.Bridge")))}else{nf.ControllerServices=b(a.$,a.d3,a.Slick,a.nf.Client,a.nf.Shell,a.nf.ProcessGroupConfiguration,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.FilteredDialogCommon,a.nf.Dialog,a.nf.Storage,a.nf.Common,a.nf.ControllerService,a.nf.ProcessGroup,a.nf.PolicyManagement,a.nf.ComponentState,a.nf.ComponentVersion,a.nf.ng.Bridge)}}}(this,function(x,H,a,f,F,A,K,b,J,i,p,G,I,u,s,c,q,m){var h=null;var j=false;var B={urls:{api:"../nifi-api",controllerServiceTypes:"../nifi-api/flow/controller-service-types"}};var w={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false,rowHeight:24};var k=function(N){return N.restricted===false||G.canAccessComponentRestrictions(N.explicitRestrictions)};var e=function(){return x("#controller-service-type-filter").val()};var y=function(){var N=x("#controller-service-types-table").data("gridInstance");if(G.isDefinedAndNotNull(N)){var O=N.getData();O.setFilterArgs({searchString:e()});O.refresh();x("#new-controller-service-dialog").modal("refreshButtons");if(O.getLength()>0){J.choseFirstRow(N);N.scrollRowToTop(0)}}};var z=function(){x("#controller-service-type-description").attr("title","").text("");x("#controller-service-type-name").attr("title","").text("");x("#controller-service-type-bundle").attr("title","").text("");x("#selected-controller-service-name").text("");x("#selected-controller-service-type").text("").removeData("bundle");x("#controller-service-description-container").hide()};var t=function(){z();var N=x("#controller-service-types-table").data("gridInstance");N.resetActiveCell()};var E=function(V,Q){var T=M(V,Q);var P=true;if(T){var U=x("#controller-service-tag-cloud").tagcloud("getSelectedTags");var S=U.length>0;if(S){P=n(U,V.tags)}}var R=true;if(T&&P){var N=x("#controller-service-bundle-group-combo").combo("getSelectedOption");if(G.isDefinedAndNotNull(N)&&N.value!==""){R=(V.bundle.group===N.value)}}var O=T&&P&&R;if(O===false&&x("#selected-controller-service-type").text()===V.type){t()}return O};var M=function(P,O){if(O.searchString===""){return true}try{var S=new RegExp(O.searchString,"i")}catch(R){return false}var Q=P.label.search(S)>=0;var N=P.tags.search(S)>=0;return Q||N};var n=function(P,N){var O=[];x.each(P,function(S,T){O.push(T)});var Q=N.toLowerCase();var R=true;x.each(O,function(S,T){if(Q.indexOf(T)===-1){R=false;return false}});return R};var D=function(N,Q){var P=x("#selected-controller-service-type").text();var O=x("#selected-controller-service-type").data("bundle");if(P===""){i.showOkDialog({headerText:"Controller Service",dialogContent:"The type of controller service to create must be selected."})}else{o(N,Q,P,O)}};var o=function(O,R,Q,S){var N={revision:f.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:p.isDisconnectionAcknowledged(),component:{type:Q,bundle:S}};var P=x.ajax({type:"POST",url:O,data:JSON.stringify(N),dataType:"json",contentType:"application/json"}).done(function(T){var U=R.data("gridInstance");var W=U.getData();W.addItem(x.extend({type:"ControllerService",bulletins:[]},T));W.reSort();U.invalidate();var V=W.getRowById(T.id);J.choseRow(U,V);U.scrollRowIntoView(V)}).fail(b.handleAjaxError);x("#new-controller-service-dialog").modal("hide");return P};var l=function(){var P=[{id:"type",name:"Type",field:"label",formatter:G.typeFormatter,sortable:true,resizable:true},{id:"version",name:"Version",field:"version",formatter:G.typeVersionFormatter,sortable:true,resizable:true},{id:"tags",name:"Tags",field:"tags",sortable:true,resizable:true,formatter:G.genericValueFormatter}];var O=new a.Data.DataView({inlineFilters:false});O.setItems([]);O.setFilterArgs({searchString:e()});O.setFilter(E);G.sortType({columnId:"type",sortAsc:true},O);var N=new a.Grid("#controller-service-types-table",O,P,w);N.setSelectionModel(new a.RowSelectionModel());N.registerPlugin(new a.AutoTooltips());N.setSortColumn("type",true);N.onSort.subscribe(function(S,R){G.sortType({columnId:R.sortCol.field,sortAsc:R.sortAsc},O)});N.onSelectedRowsChanged.subscribe(function(W,T){if(x.isArray(T.rows)&&T.rows.length===1){var R=T.rows[0];var V=N.getDataItem(R);if(G.isDefinedAndNotNull(V)){x("#controller-service-description-container").show();if(G.isBlank(V.description)){x("#controller-service-type-description").attr("title","").html('<span class="unset">No description specified</span>')}else{x("#controller-service-type-description").width(x("#controller-service-description-container").innerWidth()-1).html(V.description).ellipsis()}var S=G.formatBundle(V.bundle);var U=G.formatType(V);x("#controller-service-type-name").text(U).attr("title",U);x("#controller-service-type-bundle").text(S).attr("title",S);x("#selected-controller-service-name").text(V.label);x("#selected-controller-service-type").text(V.type).data("bundle",V.bundle);x("#new-controller-service-dialog").modal("refreshButtons")}}});N.onViewportChanged.subscribe(function(S,R){G.cleanUpTooltips(x("#controller-service-types-table"),"div.view-usage-restriction");G.cleanUpTooltips(x("#controller-service-types-table"),"div.controller-service-apis")});O.onRowCountChanged.subscribe(function(S,R){N.updateRowCount();N.render();x("#displayed-controller-service-types").text(R.current)});O.onRowsChanged.subscribe(function(S,R){N.invalidateRows(R.rows);N.render()});O.syncGridSelection(N,true);x("#controller-service-types-table").data("gridInstance",N).on("mouseenter","div.slick-cell",function(Y){var Z=x(this).find("div.view-usage-restriction");if(Z.length&&!Z.data("qtip")){var V=x(this).find("span.row-id").text();var aa=O.getItemById(V);if(aa.restricted===true){var X=x("<div></div>");if(G.isBlank(aa.usageRestriction)){X.append(x('<p style="margin-bottom: 3px;"></p>').text("Requires the following permissions:"))}else{X.append(x('<p style="margin-bottom: 3px;"></p>').text(aa.usageRestriction+" Requires the following permissions:"))}var T=[];if(G.isDefinedAndNotNull(aa.explicitRestrictions)){x.each(aa.explicitRestrictions,function(ab,ad){var ac=ad.requiredPermission;T.push("'"+ac.label+"' - "+G.escapeHtml(ad.explanation))})}else{T.push("Access to restricted components regardless of restrictions.")}X.append(G.formatUnorderedList(T));Z.qtip(x.extend({},G.config.tooltipConfig,{content:X,position:{container:x("#summary"),at:"bottom right",my:"top left",adjust:{x:4,y:4}}}))}}var R=x(this).find("div.controller-service-apis");if(R.length&&!R.data("qtip")){var V=x(this).find("span.row-id").text();var aa=O.getItemById(V);if(!G.isEmpty(aa.controllerServiceApis)){var U=G.getFormattedServiceApis(aa.controllerServiceApis);var S=G.formatUnorderedList(U);var W=x('<div style="padding: 4px;"><p>Supports Controller Services</p><br/></div>').append(S);R.qtip(x.extend({},G.config.tooltipConfig,{content:W,position:{container:x("#summary"),at:"bottom right",my:"top left",adjust:{x:4,y:4}}}))}}});var Q=G.getPolicyTypeListing("restricted-components");x.ajax({type:"GET",url:B.urls.controllerServiceTypes,dataType:"json"}).done(function(S){var X=0;var U=[];var R=H.set();var W=H.map();var V=H.map();O.beginUpdate();x.each(S.controllerServiceTypes,function(Y,Z){if(Z.restricted===true){if(G.isDefinedAndNotNull(Z.explicitRestrictions)){x.each(Z.explicitRestrictions,function(aa,ac){var ab=ac.requiredPermission;if(!V.has(ab.id)){V.set(ab.id,ab.label)}if(!W.has(ab.id)){W.set(ab.id,[])}W.get(ab.id).push({type:G.formatType(Z),bundle:G.formatBundle(Z.bundle),explanation:ac.explanation})})}else{if(!V.has(Q.value)){V.set(Q.value,Q.text)}if(!W.has(Q.value)){W.set(Q.value,[])}W.get(Q.value).push({type:G.formatType(Z),bundle:G.formatBundle(Z.bundle),explanation:Z.usageRestriction})}}R.add(Z.bundle.group);O.addItem({id:X++,label:G.substringAfterLast(Z.type,"."),type:Z.type,bundle:Z.bundle,controllerServiceApis:Z.controllerServiceApis,description:G.escapeHtml(Z.description),restricted:Z.restricted,usageRestriction:G.escapeHtml(Z.usageRestriction),explicitRestrictions:Z.explicitRestrictions,tags:Z.tags.join(", ")});x.each(Z.tags,function(ab,aa){U.push(aa.toLowerCase())})});O.endUpdate();O.reSort();N.invalidate();K.addComponentRestrictions(W,V);x("#total-controller-service-types, #displayed-controller-service-types").text(S.controllerServiceTypes.length);x("#controller-service-tag-cloud").tagcloud({tags:U,select:y,remove:y});var T=[{text:"all groups",value:""}];R.each(function(Y){T.push({text:Y,value:Y})});x("#controller-service-bundle-group-combo").combo({options:T,select:y})}).fail(b.handleAjaxError);x("#new-controller-service-dialog").modal({headerText:"Add Controller Service",scrollableContentStyle:"scrollable",handler:{close:function(){z();x("#controller-service-type-filter").val("");x("#controller-service-tag-cloud").tagcloud("clearSelectedTags");x("#controller-service-bundle-group-combo").combo("setSelectedOption",{value:""});y();var R=x("#controller-service-types-table").data("gridInstance");R.setSelectedRows([]);R.resetActiveCell()},resize:function(){x("#controller-service-type-description").width(x("#controller-service-description-container").innerWidth()-1).text(x("#controller-service-type-description").attr("title")).ellipsis()}}})};var r=function(R,O,Q,P,N){if(!N.permissions.canRead){return'<span class="blank">'+G.escapeHtml(N.id)+"</span>"}return G.escapeHtml(N.component.name)};var g=function(V,U,S,P,O){if(G.isDefinedAndNotNull(O.parentGroupId)){var T=K.getSelection();if(T.empty()===false){var R=T.datum();if(R.id===O.parentGroupId){if(R.permissions.canRead){return G.escapeHtml(R.component.name)}else{return G.escapeHtml(R.id)}}}var N=m.injector.get("breadcrumbsCtrl").getBreadcrumbs();var Q=O.parentGroupId;x.each(N,function(W,X){if(X.id===O.parentGroupId){Q=X.label;return false}});return G.escapeHtml(Q)}else{return"Controller"}};var v=function(N){var O=function(P){var S=K.getSelection();if(S.empty()===false){var R=S.datum();if(R.id===P){return R.permissions.canWrite}}var Q=m.injector.get("breadcrumbsCtrl").getBreadcrumbs();var T=false;x.each(Q,function(U,V){if(V.id===P){T=V.permissions.canWrite;return false}});return T};if(G.isDefinedAndNotNull(N.parentGroupId)){return O(N.parentGroupId)}else{return G.canModifyController()}};var L=function(N,P){var O=function(X,W){if(X.permissions.canRead&&W.permissions.canRead){if(N.columnId==="moreDetails"){var T=0;if(!G.isEmpty(X.bulletins)){T=X.bulletins.length}var Q=0;if(!G.isEmpty(W.bulletins)){Q=W.bulletins.length}return T-Q}else{if(N.columnId==="type"){var U=G.isDefinedAndNotNull(X.component[N.columnId])?G.substringAfterLast(X.component[N.columnId],"."):"";var S=G.isDefinedAndNotNull(W.component[N.columnId])?G.substringAfterLast(W.component[N.columnId],"."):"";return U===S?0:U>S?1:-1}else{if(N.columnId==="state"){var V;if(X.status.validationStatus==="VALIDATING"){V="Validating"}else{if(X.status.validationStatus==="INVALID"){V="Invalid"}else{V=G.isDefinedAndNotNull(X.component[N.columnId])?X.component[N.columnId]:""}}var Z;if(W.status.validationStatus==="VALIDATING"){Z="Validating"}else{if(W.status.validationStatus==="INVALID"){Z="Invalid"}else{Z=G.isDefinedAndNotNull(W.component[N.columnId])?W.component[N.columnId]:""}}return V===Z?0:V>Z?1:-1}else{var R=G.isDefinedAndNotNull(X.component[N.columnId])?X.component[N.columnId]:"";var Y=G.isDefinedAndNotNull(W.component[N.columnId])?W.component[N.columnId]:"";return R===Y?0:R>Y?1:-1}}}}else{if(!X.permissions.canRead&&!W.permissions.canRead){return 0}if(X.permissions.canRead){return 1}else{return -1}}};P.sort(O,N.sortAsc)};var C=function(T,N){var S=function(ac,W,ab,Y,V){if(!V.permissions.canRead){return""}var X='<div title="Usage" class="pointer controller-service-usage fa fa-book"></div>';var Z=!G.isEmpty(V.component.validationErrors);var aa=!G.isEmpty(V.bulletins);if(Z){X+='<div class="pointer has-errors fa fa-warning"></div>'}if(aa){X+='<div class="has-bulletins fa fa-sticky-note-o"></div>'}if(Z||aa){X+='<span class="hidden row-id">'+G.escapeHtml(V.id)+"</span>"}return X};var O=function(ac,W,ab,X,V){var aa="",Y="";if(V.status.validationStatus==="VALIDATING"){aa="validating fa fa-spin fa-circle-notch";Y="Validating"}else{if(V.status.validationStatus==="INVALID"){aa="invalid fa fa-warning";Y="Invalid"}else{if(V.status.runStatus==="DISABLED"){aa='disabled icon icon-enable-false"';Y="Disabled"}else{if(V.status.runStatus==="DISABLING"){aa='disabled icon icon-enable-false"';Y="Disabling"}else{if(V.status.runStatus==="ENABLED"){aa="enabled fa fa-flash";Y="Enabled"}else{if(V.status.runStatus==="ENABLING"){aa="enabled fa fa-flash";Y="Enabling"}}}}}}var Z='<div layout="row"><div class="'+aa+'"></div>';return Z+'<div class="status-text">'+Y+"</div></div>"};var R=function(af,ac,Z,Y,V){var ad="";var X=V.permissions.canRead;var W=V.permissions.canWrite;var ab=W||(V.operatePermissions&&V.operatePermissions.canWrite);var ae=false;if(G.isDefinedAndNotNull(V.parentGroupId)){if(V.parentGroupId===x("#process-group-id").text()){ae=true}}else{ae=true}if(ae===true){var aa=V.status.runStatus==="DISABLED";if(X){if(W&&aa){ad+='<div class="pointer edit-controller-service fa fa-gear" title="Configure"></div>'}else{ad+='<div class="pointer view-controller-service fa fa-gear" title="View Configuration"></div>'}}if(ab){if(V.status.runStatus==="ENABLED"||V.status.runStatus==="ENABLING"){ad+='<div class="pointer disable-controller-service icon icon-enable-false" title="Disable"></div>'}else{if(aa&&V.status.validationStatus==="VALID"){ad+='<div class="pointer enable-controller-service fa fa-flash" title="Enable"></div>'}}}if(aa&&X&&W&&V.component.multipleVersionsAvailable===true){ad+='<div title="Change Version" class="pointer change-version-controller-service fa fa-exchange"></div>'}if(aa&&X&&W&&v(V)){ad+='<div class="pointer delete-controller-service fa fa-trash" title="Remove"></div>'}if(X&&W&&V.component.persistsState===true){ad+='<div title="View State" class="pointer view-state-controller-service fa fa-tasks"></div>'}}else{ad+='<div class="pointer go-to-controller-service fa fa-long-arrow-right" title="Go To"></div>'}if(K.isManagedAuthorizer()&&G.canAccessTenants()){ad+='<div title="Access Policies" class="pointer edit-access-policies fa fa-key"></div>'}return ad};var Q=[{id:"moreDetails",name:"&nbsp;",resizable:false,formatter:S,sortable:true,width:90,maxWidth:90,toolTip:"Sorts based on presence of bulletins"},{id:"name",name:"Name",formatter:r,sortable:true,resizable:true},{id:"type",name:"Type",formatter:G.instanceTypeFormatter,sortable:true,resizable:true},{id:"bundle",name:"Bundle",formatter:G.instanceBundleFormatter,sortable:true,resizable:true},{id:"state",name:"State",formatter:O,sortable:true,resizeable:true},{id:"parentGroupId",name:"Scope",formatter:g,sortable:true,resizeable:true}];Q.push({id:"actions",name:"&nbsp;",resizable:false,formatter:R,sortable:false,width:90,maxWidth:90});var U=new a.Data.DataView({inlineFilters:false});U.setItems([]);L({columnId:"name",sortAsc:true},U);var P=new a.Grid(T,U,Q,w);P.setSelectionModel(new a.RowSelectionModel());P.registerPlugin(new a.AutoTooltips());P.setSortColumn("name",true);P.onSort.subscribe(function(W,V){L({columnId:V.sortCol.id,sortAsc:V.sortAsc},U)});P.onClick.subscribe(function(Y,W){var X=x(Y.target);var V=U.getItem(W.row);if(P.getColumns()[W.cell].id==="actions"){if(X.hasClass("edit-controller-service")){I.showConfiguration(T,V)}else{if(X.hasClass("view-controller-service")){I.showDetails(T,V)}else{if(X.hasClass("enable-controller-service")){I.enable(T,V)}else{if(X.hasClass("disable-controller-service")){I.disable(T,V)}else{if(X.hasClass("delete-controller-service")){I.promptToDeleteController(T,V)}else{if(X.hasClass("view-state-controller-service")){c.showState(V,V.state==="DISABLED")}else{if(X.hasClass("change-version-controller-service")){q.promptForVersionChange(V)}else{if(X.hasClass("edit-access-policies")){s.showControllerServicePolicy(V);x("#shell-close-button").click()}else{if(X.hasClass("go-to-controller-service")){u.enterGroup(V.parentGroupId).done(function(){x.Deferred(function(Z){if(x("#process-group-configuration").is(":visible")){A.loadConfiguration(V.parentGroupId).done(function(){Z.resolve()})}else{A.showConfiguration(V.parentGroupId).done(function(){Z.resolve()})}}).done(function(){A.selectControllerService(V.id)})})}}}}}}}}}}else{if(P.getColumns()[W.cell].id==="moreDetails"){if(X.hasClass("controller-service-usage")){x("#shell-close-button").click();F.showPage("../nifi-docs/documentation?"+x.param({select:V.component.type,group:V.component.bundle.group,artifact:V.component.bundle.artifact,version:V.component.bundle.version})).done(function(){if(G.isDefinedAndNotNull(V.parentGroupId)){var Z;var aa=u.get(V.parentGroupId);if(G.isDefinedAndNotNull(aa)){Z=aa.id}else{Z=K.getGroupId()}A.showConfiguration(Z)}else{N()}})}}}});U.onRowCountChanged.subscribe(function(W,V){P.updateRowCount();P.render()});U.onRowsChanged.subscribe(function(W,V){P.invalidateRows(V.rows);P.render()});U.syncGridSelection(P,true);T.data("gridInstance",P).on("mouseenter","div.slick-cell",function(ac){var Z=x(this).find("div.has-errors");if(Z.length&&!Z.data("qtip")){var ab=x(this).find("span.row-id").text();var V=U.getItemById(ab);var Y=G.formatUnorderedList(V.component.validationErrors);if(G.isDefinedAndNotNull(Y)){Z.qtip(x.extend({},G.config.tooltipConfig,{content:Y,position:{target:"mouse",viewport:x("#shell-container"),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}var X=x(this).find("div.has-bulletins");if(X.length&&!X.data("qtip")){var W=x(this).find("span.row-id").text();var V=U.getItemById(W);var aa=G.getFormattedBulletins(V.bulletins);var Y=G.formatUnorderedList(aa);if(G.isDefinedAndNotNull(Y)){X.qtip(x.extend({},G.config.tooltipConfig,{content:Y,position:{target:"mouse",viewport:x("#shell-container"),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}})};var d=function(N,O){return x.ajax({type:"GET",url:N,dataType:"json"}).done(function(P){var Q=[];x.each(P.controllerServices,function(U,T){Q.push(x.extend({type:"ControllerService",bulletins:[]},T))});G.cleanUpTooltips(O,"div.has-errors");G.cleanUpTooltips(O,"div.has-bulletins");var R=O.data("gridInstance");var S=R.getData();S.setItems(Q);S.reSort();R.invalidate();R.render()})};return{init:function(O,N){if(!j){l();j=true}C(O,N)},promptNewControllerService:function(O,R){var P=x("#controller-service-types-table").data("gridInstance");var N=P.getData();var Q=[x.ui.keyCode.UP,x.ui.keyCode.PAGE_UP,x.ui.keyCode.DOWN,x.ui.keyCode.PAGE_DOWN];x("#controller-service-type-filter").off("keyup").on("keyup",function(V){var U=V.keyCode?V.keyCode:V.which;if(x.inArray(U,Q)!==-1){return}if(U===x.ui.keyCode.ENTER){var S=P.getSelectedRows();if(S.length>0){var T=P.getDataItem(S[0]);if(k(T)){D(O,R)}}}else{y()}});J.addKeydownListener("#controller-service-type-filter",P,N);x("#new-controller-service-dialog").modal("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){var S=P.getSelectedRows();if(S.length>0){var T=P.getDataItem(S[0]);return k(T)===false}else{return N.getLength()===0}},handler:{click:function(){D(O,R)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){x(this).modal("hide")}}}]).modal("show");if(h!==null){P.onDblClick.unsubscribe(h)}h=function(U,S){var T=P.getDataItem(S.row);if(k(T)){o(O,R,T.type,T.bundle)}};P.onDblClick.subscribe(h);P.resizeCanvas();if(N.getLength()>0){J.choseFirstRow(P)}x("#controller-service-type-filter").focus()},resetTableSize:function(O){var N=O.data("gridInstance");if(G.isDefinedAndNotNull(N)){N.resizeCanvas()}},loadControllerServices:function(N,O){return d(N,O)},setBulletins:function(R,O){var Q=R.data("gridInstance");var S=Q.getData();S.beginUpdate();if(!G.isEmpty(O)){var P=H.nest().key(function(T){return T.sourceId}).map(O,H.map);P.each(function(T,V){var U=S.getItemById(V);if(G.isDefinedAndNotNull(U)){S.updateItem(V,x.extend(U,{bulletins:T}))}})}else{var N=S.getItems();x.each(N,function(U,T){S.updateItem(T.id,x.extend(T,{bulletins:[]}))})}S.endUpdate()}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.ErrorHandler","nf.Common","nf.Dialog","nf.Storage","nf.Client","nf.ControllerService","nf.ControllerServices","nf.UniversalCapture","nf.CustomUi"],function(f,j,d,e,g,l,k,c,h,i){return(nf.ReportingTask=b(f,j,d,e,g,l,k,c,h,i))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ReportingTask=b(require("jquery"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog"),require("nf.Storage"),require("nf.Client"),require("nf.ControllerService"),require("nf.ControllerServices"),require("nf.UniversalCapture"),require("nf.CustomUi")))}else{nf.ReportingTask=b(a.$,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog,a.nf.Storage,a.nf.Client,a.nf.ControllerService,a.nf.ControllerServices,a.nf.UniversalCapture,a.nf.CustomUi)}}}(this,function(f,h,j,m,g,v,a,c,o,d){var s;var t={edit:"edit",readOnly:"read-only",urls:{api:"../nifi-api"}};var i=t.urls.api+"/flow/controller/controller-services";var b=function(){return f("#controller-services-table")};var w=function(){var y=f("#reporting-task-configuration").data("reportingTaskDetails");if(f("#reporting-task-name").val()!==y.component.name){return true}if(f("#reporting-task-comments").val()!==y.component.comments){return true}if(f("#reporting-task-enabled").hasClass("checkbox-checked")&&y.component.state==="DISABLED"){return true}else{if(f("#reporting-task-enabled").hasClass("checkbox-unchecked")&&(y.component.state==="RUNNING"||y.component.state==="STOPPED")){return true}}var z=f("#reporting-task-scheduling-strategy-combo").combo("getSelectedOption").value;if(z!==(y.component.schedulingStrategy+"")){return true}var x;if(z==="CRON_DRIVEN"){x=f("#reporting-task-cron-driven-scheduling-period")}else{x=f("#reporting-task-timer-driven-scheduling-period")}if(j.isDefinedAndNotNull(x)&&x.val()!==(y.component.schedulingPeriod+"")){return true}return f("#reporting-task-properties").propertytable("isSaveRequired")};var k=function(){var y=f("#reporting-task-properties").propertytable("marshalProperties");var B=f("#reporting-task-scheduling-strategy-combo").combo("getSelectedOption").value;var x;if(B==="CRON_DRIVEN"){x=f("#reporting-task-cron-driven-scheduling-period")}else{x=f("#reporting-task-timer-driven-scheduling-period")}var A={};A.id=f("#reporting-task-id").text();A.name=f("#reporting-task-name").val();A.schedulingStrategy=B;A.schedulingPeriod=x.val();A.comments=f("#reporting-task-comments").val();if(f("#reporting-task-enabled").hasClass("checkbox-unchecked")){A.state="DISABLED"}else{if(f("#reporting-task-enabled").hasClass("checkbox-checked")){A.state="STOPPED"}}if(f.isEmptyObject(y)===false){A.properties=y}var z={};z.component=A;return z};var r=function(x){var z=[];var y=x.component;if(j.isBlank(y.schedulingPeriod)){z.push("Run schedule must be specified")}if(z.length>0){m.showOkDialog({dialogContent:j.formatUnorderedList(z),headerText:"Reporting Task"});return false}else{return true}};var q=function(y){var A=f("#reporting-tasks-table").data("gridInstance");var x=A.getData();var z=x.getItemById(y.id);x.updateItem(y.id,f.extend({type:"ReportingTask",bulletins:z.bulletins},y))};var e=function(z,y){var x={revision:v.getRevision(z),disconnectedNodeAcknowledged:g.isDisconnectionAcknowledged(),state:y===true?"RUNNING":"STOPPED"};return f.ajax({type:"PUT",url:z.uri+"/run-status",data:JSON.stringify(x),dataType:"json",contentType:"application/json"}).done(function(A){q(A);if(j.isDefinedAndNotNull(A.component)){a.reloadReferencedServices(b(),A.component)}}).fail(h.handleAjaxError)};var n=function(){return f.Deferred(function(x){f("#reporting-task-properties").propertytable("saveRow");if(w()){m.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before going to this Controller Service?",noHandler:function(){x.resolve()},yesHandler:function(){var y=f("#reporting-task-configuration").data("reportingTaskDetails");l(y).done(function(){x.resolve()}).fail(function(){x.reject()})}})}else{x.resolve()}}).promise()};var l=function(y){var x=k();if(r(x)){x.revision=v.getRevision(y);x.disconnectedNodeAcknowledged=g.isDisconnectionAcknowledged();return f.ajax({type:"PUT",data:JSON.stringify(x),url:y.uri,dataType:"json",contentType:"application/json"}).done(function(z){q(z)}).fail(h.handleConfigurationUpdateAjaxError)}else{return f.Deferred(function(z){z.reject()}).promise()}};var p=function(x){var y=f("#reporting-task-configuration").data("reportingTaskDetails");return f.ajax({type:"GET",url:y.uri+"/descriptors",data:{propertyName:x},dataType:"json"}).fail(h.handleAjaxError)};var u={init:function(x){s=x;f("#reporting-task-configuration-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"Settings",tabContentId:"reporting-task-standard-settings-tab-content"},{name:"Properties",tabContentId:"reporting-task-properties-tab-content"},{name:"Comments",tabContentId:"reporting-task-comments-tab-content"}],select:function(){o.removeAllPropertyDetailDialogs();if(f(this).text()==="Properties"){f("#reporting-task-properties").propertytable("resetTableSize")}f("#reporting-task-properties").propertytable("saveRow")}});f("#reporting-task-configuration").data("mode",t.edit).modal({scrollableContentStyle:"scrollable",headerText:"Configure Reporting Task",handler:{close:function(){f("#reporting-task-properties").propertytable("cancelEdit");f("#reporting-task-properties").propertytable("clear");j.clearField("read-only-reporting-task-comments");f("#reporting-task-configuration").removeData("reportingTaskDetails")},open:function(){j.toggleScrollable(f("#"+this.find(".tab-container").attr("id")+"-content").get(0))}}});f("#reporting-task-properties").propertytable({readOnly:false,supportsGoTo:true,dialogContainer:"#new-reporting-task-property-container",descriptorDeferred:p,controllerServiceCreatedDeferred:function(y){return c.loadControllerServices(i,f("#controller-services-table"))},goToServiceDeferred:n})},showConfiguration:function(y){var z=f("#reporting-task-configuration");z.find(".dialog-header .dialog-header-text").text("Configure Reporting Task");if(z.data("mode")===t.readOnly){f("#reporting-task-configuration .reporting-task-read-only").hide();f("#reporting-task-configuration .reporting-task-editable").show();f("#reporting-task-properties").propertytable("destroy").propertytable({readOnly:false,supportsGoTo:true,dialogContainer:"#new-reporting-task-property-container",descriptorDeferred:p,controllerServiceCreatedDeferred:function(B){return c.loadControllerServices(i,f("#controller-services-table"))},goToServiceDeferred:n});z.data("mode",t.edit)}var A=f.ajax({type:"GET",url:y.uri,dataType:"json"});var x=f.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(y.id),dataType:"json"});f.when(A,x).done(function(D,I){y=D[0];var J=y.component;var C=I[0].componentHistory;f("#reporting-task-configuration").data("reportingTaskDetails",y);var G="checkbox-checked";if(J.state==="DISABLED"){G="checkbox-unchecked"}j.populateField("reporting-task-id",J.id);j.populateField("reporting-task-type",j.formatType(J));j.populateField("reporting-task-bundle",j.formatBundle(J.bundle));f("#reporting-task-name").val(J.name);f("#reporting-task-enabled").removeClass("checkbox-unchecked checkbox-checked").addClass(G);f("#reporting-task-comments").val(J.comments);var E=J.defaultSchedulingPeriod;var B=f("#reporting-task-cron-driven-scheduling-period").val(E.CRON_DRIVEN);var F=f("#reporting-task-timer-driven-scheduling-period").val(E.TIMER_DRIVEN);if(J.schedulingStrategy==="CRON_DRIVEN"){B.val(J.schedulingPeriod)}else{F.val(J.schedulingPeriod)}f("#reporting-task-scheduling-strategy-combo").combo({options:[{text:"Timer driven",value:"TIMER_DRIVEN",description:"Reporting task will be scheduled to run on an interval defined by the run schedule."},{text:"CRON driven",value:"CRON_DRIVEN",description:"Reporting task will be scheduled to run on at specific times based on the specified CRON string."}],selectedOption:{value:J.schedulingStrategy},select:function(K){if(K.value==="CRON_DRIVEN"){F.hide();B.show()}else{F.show();B.hide()}}});var H=[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){f("#reporting-task-properties").propertytable("saveRow");l(y).done(function(K){a.reloadReferencedServices(b(),K.component);f("#reporting-task-configuration").modal("hide")})}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){f("#reporting-task-configuration").modal("hide")}}}];if(j.isDefinedAndNotNull(J.customUiUrl)&&J.customUiUrl!==""){H.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){var K=function(){f("#reporting-task-configuration").modal("hide");f("#shell-close-button").click();d.showCustomUi(y,J.customUiUrl,true).done(function(){u.reload(y.id).done(function(L){a.reloadReferencedServices(b(),L.reportingTask)});s.showSettings()})};f("#reporting-task-properties").propertytable("saveRow");if(w()){m.showYesNoDialog({headerText:"Save",dialogContent:"Save changes before opening the advanced configuration?",noHandler:K,yesHandler:function(){l(y).done(function(){K()})}})}else{K()}}}})}f("#reporting-task-configuration").modal("setButtonModel",H);f("#reporting-task-properties").propertytable("setGroupId",J.parentGroupId).propertytable("loadProperties",J.properties,J.descriptors,C.propertyHistory);f("#reporting-task-configuration").modal("show");f("#reporting-task-properties").propertytable("resetTableSize")}).fail(h.handleAjaxError)},showDetails:function(y){var z=f("#reporting-task-configuration");z.find(".dialog-header .dialog-header-text").text("Reporting Task Details");if(z.data("mode")===t.edit){f("#reporting-task-configuration .reporting-task-read-only").show();f("#reporting-task-configuration .reporting-task-editable").hide();f("#reporting-task-properties").propertytable("destroy").propertytable({supportsGoTo:true,readOnly:true});z.data("mode",t.readOnly)}var A=f.ajax({type:"GET",url:y.uri,dataType:"json"});var x=f.ajax({type:"GET",url:"../nifi-api/flow/history/components/"+encodeURIComponent(y.id),dataType:"json"});f.when(A,x).done(function(B,C){y=B[0];var G=y.component;var D=C[0].componentHistory;j.populateField("reporting-task-id",G.id);j.populateField("reporting-task-type",j.substringAfterLast(G.type,"."));j.populateField("reporting-task-bundle",j.formatBundle(G.bundle));j.populateField("read-only-reporting-task-name",G.name);j.populateField("read-only-reporting-task-comments",G.comments);var F=G.schedulingStrategy;if(F==="CRON_DRIVEN"){F="CRON driven"}else{F="Timer driven"}j.populateField("read-only-reporting-task-scheduling-strategy",F);j.populateField("read-only-reporting-task-scheduling-period",G.schedulingPeriod);var E=[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){z.modal("hide")}}}];if(j.isDefinedAndNotNull(d)&&j.isDefinedAndNotNull(G.customUiUrl)&&G.customUiUrl!==""){E.push({buttonText:"Advanced",clazz:"fa fa-cog button-icon",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){z.modal("hide");f("#shell-close-button").click();d.showCustomUi(y,G.customUiUrl,false).done(function(){s.showSettings()})}}})}z.modal("setButtonModel",E).modal("show");f("#reporting-task-properties").propertytable("loadProperties",G.properties,G.descriptors,D.propertyHistory);z.modal("show");f("#reporting-task-properties").propertytable("resetTableSize")})},start:function(x){e(x,true)},stop:function(x){e(x,false)},reload:function(A){var z=f("#reporting-tasks-table").data("gridInstance");var x=z.getData();var y=x.getItemById(A);return f.ajax({type:"GET",url:y.uri,dataType:"json"}).done(function(B){q(B)}).fail(h.handleAjaxError)},promptToDeleteReportingTask:function(x){m.showYesNoDialog({headerText:"Delete Reporting Task",dialogContent:"Delete reporting task '"+j.escapeHtml(x.component.name)+"'?",yesHandler:function(){u.remove(x)}})},remove:function(y){var x=v.getRevision(y);f.ajax({type:"DELETE",url:y.uri+"?"+f.param({version:x.version,clientId:x.clientId,disconnectedNodeAcknowledged:g.isDisconnectionAcknowledged()}),dataType:"json"}).done(function(A){var B=f("#reporting-tasks-table").data("gridInstance");var z=B.getData();z.deleteItem(y.id)}).fail(h.handleAjaxError)}};return u}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","d3","nf.Client","nf.Dialog","nf.Storage","nf.Common","nf.CanvasUtils","nf.ControllerServices","nf.ErrorHandler","nf.FilteredDialogCommon","nf.ReportingTask","nf.Shell","nf.ComponentState","nf.ComponentVersion","nf.PolicyManagement"],function(j,f,q,r,i,k,g,h,d,m,l,n,e,p,c,o){return(nf.Settings=b(j,f,q,r,i,k,g,h,d,m,l,n,e,p,c,o))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.Settings=b(require("jquery"),require("Slick"),require("d3"),require("nf.Client"),require("nf.Dialog"),require("nf.Storage"),require("nf.Common"),require("nf.CanvasUtils"),require("nf.ControllerServices"),require("nf.ErrorHandler"),require("nf.FilteredDialogCommon"),require("nf.ReportingTask"),require("nf.Shell"),require("nf.ComponentState"),require("nf.ComponentVersion"),require("nf.PolicyManagement")))}else{nf.Settings=b(a.$,a.Slick,a.d3,a.nf.Client,a.nf.Dialog,a.nf.Storage,a.nf.Common,a.nf.CanvasUtils,a.nf.ControllerServices,a.nf.ErrorHandler,a.nf.FilteredDialogCommon,a.nf.ReportingTask,a.nf.Shell,a.nf.ComponentState,a.nf.ComponentVersion,a.nf.PolicyManagement)}}}(this,function(A,a,O,i,k,s,M,T,H,d,R,B,K,e,t,w){var F={urls:{api:"../nifi-api",controllerConfig:"../nifi-api/controller/config",reportingTaskTypes:"../nifi-api/flow/reporting-task-types",createReportingTask:"../nifi-api/controller/reporting-tasks",reportingTasks:"../nifi-api/flow/reporting-tasks",registries:"../nifi-api/controller/registry-clients"}};var z={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false,rowHeight:24};var r=function(){return A("#controller-services-table")};var Q=function(Y){var X=[];if(M.isDefinedAndNotNull(Y.maxTimerDrivenThreadCount)&&!A.isNumeric(Y.maxTimerDrivenThreadCount)){X.push("Maximum Timer Driven Thread Count must be an integer value")}if(M.isDefinedAndNotNull(Y.maxEventDrivenThreadCount)&&!A.isNumeric(Y.maxEventDrivenThreadCount)){X.push("Maximum Event Driven Thread Count must be an integer value")}if(X.length>0){k.showOkDialog({dialogContent:M.formatUnorderedList(X),headerText:"Configuration Error"});return false}else{return true}};var m=function(X){var Z=S();if(Q(Z)){var Y={revision:i.getRevision({revision:{version:X}}),disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged(),component:Z};A.ajax({type:"PUT",url:F.urls.controllerConfig,data:JSON.stringify(Y),dataType:"json",contentType:"application/json"}).done(function(aa){k.showOkDialog({headerText:"Settings",dialogContent:"Settings successfully applied."});A("#settings-save").off("click").on("click",function(){m(aa.revision.version)})}).fail(d.handleConfigurationUpdateAjaxError)}};var j=function(){};var S=function(){var X={};X.maxTimerDrivenThreadCount=A("#maximum-timer-driven-thread-count-field").val();X.maxEventDrivenThreadCount=A("#maximum-event-driven-thread-count-field").val();return X};var W=function(Z,Y){if(Y.searchString===""){return true}try{var ac=new RegExp(Y.searchString,"i")}catch(ab){return false}var aa=Z.label.search(ac)>=0;var X=Z.tags.search(ac)>=0;return aa||X};var o=function(Z,X){var Y=[];A.each(Z,function(ac,ad){Y.push(ad)});var aa=X.toLowerCase();var ab=true;A.each(Y,function(ac,ad){if(aa.indexOf(ad)===-1){ab=false;return false}});return ab};var n=function(X){return X.restricted===false||M.canAccessComponentRestrictions(X.explicitRestrictions)};var v=function(ab,Y,aa,Z,X){if(!X.permissions.canRead){return'<span class="blank">'+M.escapeHtml(X.id)+"</span>"}return M.escapeHtml(X.component.name)};var U=function(X,Z){var Y=function(ah,ag){if(ah.permissions.canRead&&ag.permissions.canRead){if(X.columnId==="moreDetails"){var ad=0;if(!M.isEmpty(ah.bulletins)){ad=ah.bulletins.length}var aa=0;if(!M.isEmpty(ag.bulletins)){aa=ag.bulletins.length}return ad-aa}else{if(X.columnId==="type"){var ae=M.isDefinedAndNotNull(ah.component[X.columnId])?M.substringAfterLast(ah.component[X.columnId],"."):"";var ac=M.isDefinedAndNotNull(ag.component[X.columnId])?M.substringAfterLast(ag.component[X.columnId],"."):"";return ae===ac?0:ae>ac?1:-1}else{if(X.columnId==="state"){var af;if(ah.component.validationStatus==="VALIDATING"){af="Validating"}else{if(ah.component.validationStatus==="INVALID"){af="Invalid"}else{af=M.isDefinedAndNotNull(ah.component[X.columnId])?ah.component[X.columnId]:""}}var aj;if(ag.component.validationStatus==="VALIDATING"){aj="Validating"}else{if(ag.component.validationStatus==="INVALID"){aj="Invalid"}else{aj=M.isDefinedAndNotNull(ag.component[X.columnId])?ag.component[X.columnId]:""}}return af===aj?0:af>aj?1:-1}else{var ab=M.isDefinedAndNotNull(ah.component[X.columnId])?ah.component[X.columnId]:"";var ai=M.isDefinedAndNotNull(ag.component[X.columnId])?ag.component[X.columnId]:"";return ab===ai?0:ab>ai?1:-1}}}}else{if(!ah.permissions.canRead&&!ag.permissions.canRead){return 0}if(ah.permissions.canRead){return 1}else{return -1}}};Z.sort(Y,X.sortAsc)};var C=function(){return A("#reporting-task-type-filter").val()};var p=function(){var Y=A("#reporting-task-types-table").data("gridInstance");if(M.isDefinedAndNotNull(Y)){var X=Y.getData();X.setFilterArgs({searchString:C()});X.refresh();A("#new-reporting-task-dialog").modal("refreshButtons");if(X.getLength()>0){R.choseFirstRow(Y)}}};var P=function(){A("#reporting-task-type-description").attr("title","").text("");A("#reporting-task-type-name").attr("title","").text("");A("#reporting-task-type-bundle").attr("title","").text("");A("#selected-reporting-task-name").text("");A("#selected-reporting-task-type").text("").removeData("bundle");A("#reporting-task-description-container").hide()};var h=function(){P();var X=A("#reporting-task-types-table").data("gridInstance");X.resetActiveCell()};var I=function(af,aa){var ad=W(af,aa);var Z=true;if(ad){var ae=A("#reporting-task-tag-cloud").tagcloud("getSelectedTags");var ac=ae.length>0;if(ac){Z=o(ae,af.tags)}}var ab=true;if(ad&&Z){var X=A("#reporting-task-bundle-group-combo").combo("getSelectedOption");if(M.isDefinedAndNotNull(X)&&X.value!==""){ab=(af.bundle.group===X.value)}}var Y=ad&&Z&&ab;if(Y===false&&A("#selected-reporting-task-type").text()===af.type){h()}return Y};var L=function(){var Y=A("#selected-reporting-task-type").text();var X=A("#selected-reporting-task-type").data("bundle");if(Y===""){k.showOkDialog({headerText:"Settings",dialogContent:"The type of reporting task to create must be selected."})}else{l(Y,X)}};var l=function(X,Z){var aa={revision:i.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged(),component:{type:X,bundle:Z}};var Y=A.ajax({type:"POST",url:F.urls.createReportingTask,data:JSON.stringify(aa),dataType:"json",contentType:"application/json"}).done(function(ac){var ae=A("#reporting-tasks-table").data("gridInstance");var ab=ae.getData();ab.addItem(A.extend({type:"ReportingTask",bulletins:[]},ac));ab.reSort();ae.invalidate();var ad=ab.getRowById(ac.id);R.choseRow(ae,ad);ae.scrollRowIntoView(ad)}).fail(d.handleAjaxError);A("#new-reporting-task-dialog").modal("hide");return Y};var f=function(){var X={revision:i.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged(),component:{name:A("#registry-name").val(),uri:A("#registry-location").val(),description:A("#registry-description").val()}};var Y=A.ajax({type:"POST",url:F.urls.registries,data:JSON.stringify(X),dataType:"json",contentType:"application/json"}).done(function(ac){var Z=A("#registries-table").data("gridInstance");var aa=Z.getData();aa.addItem(A.extend({type:"Registry"},ac));aa.reSort();Z.invalidate();var ab=aa.getRowById(ac.id);R.choseRow(Z,ab);Z.scrollRowIntoView(ab);A("#registry-configuration-dialog").modal("hide")}).fail(d.handleConfigurationUpdateAjaxError);return Y};var y=function(ab){var Y=A("#registries-table").data("gridInstance");var Z=Y.getData();var ac=Z.getItemById(ab);var aa={revision:i.getRevision(ac),disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged(),component:{id:ab,name:A("#registry-name").val(),uri:A("#registry-location").val(),description:A("#registry-description").val()}};var X=A.ajax({type:"PUT",url:ac.uri,data:JSON.stringify(aa),dataType:"json",contentType:"application/json"}).done(function(ad){Z.updateItem(ab,A.extend({type:"Registry"},ad));A("#registry-configuration-dialog").modal("hide")}).fail(d.handleConfigurationUpdateAjaxError);return X};var g=function(){var Y=[{id:"type",name:"Type",field:"label",formatter:M.typeFormatter,sortable:true,resizable:true},{id:"version",name:"Version",field:"version",formatter:M.typeVersionFormatter,sortable:true,resizable:true},{id:"tags",name:"Tags",field:"tags",sortable:true,resizable:true,formatter:M.genericValueFormatter}];var X=new a.Data.DataView({inlineFilters:false});X.setItems([]);X.setFilterArgs({searchString:C()});X.setFilter(I);M.sortType({columnId:"type",sortAsc:true},X);var ab=new a.Grid("#reporting-task-types-table",X,Y,z);ab.setSelectionModel(new a.RowSelectionModel());ab.registerPlugin(new a.AutoTooltips());ab.setSortColumn("type",true);ab.onSort.subscribe(function(ad,ac){M.sortType({columnId:ac.sortCol.field,sortAsc:ac.sortAsc},X)});ab.onSelectedRowsChanged.subscribe(function(ah,ae){if(A.isArray(ae.rows)&&ae.rows.length===1){var ag=ae.rows[0];var ac=ab.getDataItem(ag);if(M.isDefinedAndNotNull(ac)){A("#reporting-task-description-container").show();if(M.isBlank(ac.description)){A("#reporting-task-type-description").attr("title","").html('<span class="unset">No description specified</span>')}else{A("#reporting-task-type-description").width(A("#reporting-task-description-container").innerWidth()-1).html(ac.description).ellipsis()}var ad=M.formatBundle(ac.bundle);var af=M.formatType(ac);A("#reporting-task-type-name").text(af).attr("title",af);A("#reporting-task-type-bundle").text(ad).attr("title",ad);A("#selected-reporting-task-name").text(ac.label);A("#selected-reporting-task-type").text(ac.type).data("bundle",ac.bundle);A("#new-reporting-task-dialog").modal("refreshButtons")}}});ab.onDblClick.subscribe(function(ae,ad){var ac=ab.getDataItem(ad.row);if(n(ac)){l(ac.type,ac.bundle)}});ab.onViewportChanged.subscribe(function(ad,ac){M.cleanUpTooltips(A("#reporting-task-types-table"),"div.view-usage-restriction")});X.onRowCountChanged.subscribe(function(ad,ac){ab.updateRowCount();ab.render();A("#displayed-reporting-task-types").text(ac.current)});X.onRowsChanged.subscribe(function(ad,ac){ab.invalidateRows(ac.rows);ab.render()});X.syncGridSelection(ab,true);A("#reporting-task-types-table").data("gridInstance",ab).on("mouseenter","div.slick-cell",function(af){var ag=A(this).find("div.view-usage-restriction");if(ag.length&&!ag.data("qtip")){var ae=A(this).find("span.row-id").text();var ad=X.getItemById(ae);if(ad.restricted===true){var ah=A("<div></div>");if(M.isBlank(ad.usageRestriction)){ah.append(A('<p style="margin-bottom: 3px;"></p>').text("Requires the following permissions:"))}else{ah.append(A('<p style="margin-bottom: 3px;"></p>').text(ad.usageRestriction+" Requires the following permissions:"))}var ac=[];if(M.isDefinedAndNotNull(ad.explicitRestrictions)){A.each(ad.explicitRestrictions,function(ai,ak){var aj=ak.requiredPermission;ac.push("'"+aj.label+"' - "+M.escapeHtml(ak.explanation))})}else{ac.push("Access to restricted components regardless of restrictions.")}ah.append(M.formatUnorderedList(ac));ag.qtip(A.extend({},M.config.tooltipConfig,{content:ah,position:{container:A("#summary"),at:"bottom right",my:"top left",adjust:{x:4,y:4}}}))}}});var aa=M.getPolicyTypeListing("restricted-components");A.ajax({type:"GET",url:F.urls.reportingTaskTypes,dataType:"json"}).done(function(ad){var ai=0;var af=[];var ac=O.set();var ah=O.map();var ag=O.map();X.beginUpdate();A.each(ad.reportingTaskTypes,function(aj,ak){if(ak.restricted===true){if(M.isDefinedAndNotNull(ak.explicitRestrictions)){A.each(ak.explicitRestrictions,function(al,an){var am=an.requiredPermission;if(!ag.has(am.id)){ag.set(am.id,am.label)}if(!ah.has(am.id)){ah.set(am.id,[])}ah.get(am.id).push({type:M.formatType(ak),bundle:M.formatBundle(ak.bundle),explanation:M.escapeHtml(an.explanation)})})}else{if(!ag.has(aa.value)){ag.set(aa.value,aa.text)}if(!ah.has(aa.value)){ah.set(aa.value,[])}ah.get(aa.value).push({type:M.formatType(ak),bundle:M.formatBundle(ak.bundle),explanation:M.escapeHtml(ak.usageRestriction)})}}ac.add(ak.bundle.group);X.addItem({id:ai++,label:M.substringAfterLast(ak.type,"."),type:ak.type,bundle:ak.bundle,description:M.escapeHtml(ak.description),restricted:ak.restricted,usageRestriction:M.escapeHtml(ak.usageRestriction),explicitRestrictions:ak.explicitRestrictions,tags:ak.tags.join(", ")});A.each(ak.tags,function(am,al){af.push(al.toLowerCase())})});X.endUpdate();X.reSort();ab.invalidate();T.addComponentRestrictions(ah,ag);A("#total-reporting-task-types, #displayed-reporting-task-types").text(ad.reportingTaskTypes.length);A("#reporting-task-tag-cloud").tagcloud({tags:af,select:p,remove:p});var ae=[{text:"all groups",value:""}];ac.each(function(aj){ae.push({text:aj,value:aj})});A("#reporting-task-bundle-group-combo").combo({options:ae,select:p})}).fail(d.handleAjaxError);var Z=[A.ui.keyCode.UP,A.ui.keyCode.PAGE_UP,A.ui.keyCode.DOWN,A.ui.keyCode.PAGE_DOWN];A("#reporting-task-type-filter").off("keyup").on("keyup",function(af){var ae=af.keyCode?af.keyCode:af.which;if(A.inArray(ae,Z)!==-1){return}if(ae===A.ui.keyCode.ENTER){var ac=ab.getSelectedRows();if(ac.length>0){var ad=ab.getDataItem(ac[0]);if(n(ad)){L()}}}else{p()}});R.addKeydownListener("#reporting-task-type-filter",ab,ab.getData());A("#new-reporting-task-dialog").modal({scrollableContentStyle:"scrollable",headerText:"Add Reporting Task",buttons:[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){var ac=ab.getSelectedRows();if(ac.length>0){var ad=ab.getDataItem(ac[0]);return n(ad)===false}else{return ab.getData().getLength()===0}},handler:{click:function(){L()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){A(this).modal("hide")}}}],handler:{close:function(){P();A("#reporting-task-type-filter").val("");A("#reporting-task-tag-cloud").tagcloud("clearSelectedTags");A("#reporting-task-bundle-group-combo").combo("setSelectedOption",{value:""});p();var ac=A("#reporting-task-types-table").data("gridInstance");ac.setSelectedRows([]);ac.resetActiveCell()},resize:function(){A("#reporting-task-type-description").width(A("#reporting-task-description-container").innerWidth()-1).text(A("#reporting-task-type-description").attr("title")).ellipsis()}}});A("#registry-configuration-dialog").modal({scrollableContentStyle:"scrollable",handler:{close:function(){A("#registry-id").text("");A("#registry-name").val("");A("#registry-location").val("");A("#registry-description").val("")}}})};var c=function(){g();var ab=function(ak,ae,aj,ag,ad){if(!ad.permissions.canRead){return""}var af='<div title="View Details" class="pointer view-reporting-task fa fa-info-circle"></div>';af+='<div title="Usage" class="pointer reporting-task-usage fa fa-book"></div>';var ah=!M.isEmpty(ad.component.validationErrors);var ai=!M.isEmpty(ad.bulletins);if(ah){af+='<div class="pointer has-errors fa fa-warning" ></div>'}if(ai){af+='<div class="has-bulletins fa fa-sticky-note-o"></div>'}if(ah||ai){af+='<span class="hidden row-id">'+M.escapeHtml(ad.component.id)+"</span>"}return af};var ac=function(al,ak,aj,af,ad){var ah="",ai="";if(ad.status.validationStatus==="VALIDATING"){ah="validating fa fa-spin fa-circle-notch";ai="Validating"}else{if(ad.status.validationStatus==="INVALID"){ah="invalid fa fa-warning";ai="Invalid"}else{if(ad.status.runStatus==="STOPPED"){ai="Stopped";ah="fa fa-stop stopped"}else{if(ad.status.runStatus==="RUNNING"){ai="Running";ah="fa fa-play running"}else{ai="Disabled";ah="icon icon-enable-false disabled"}}}}var ag="";if(M.isDefinedAndNotNull(ad.status.activeThreadCount)&&ad.status.activeThreadCount>0){ag="("+ad.status.activeThreadCount+")"}var ae='<div layout="row"><div class="'+ah+'"></div>';return ae+'<div class="status-text">'+M.escapeHtml(ai)+'</div><div style="float: left; margin-left: 4px;">'+M.escapeHtml(ag)+"</div></div>"};var aa=function(am,ak,ai,ah,ad){var al="";var ae=ad.permissions.canWrite;var ag=ad.permissions.canRead;var aj=ad.operatePermissions.canWrite||ae;var af=ad.status.runStatus==="STOPPED";if(ad.status.runStatus==="RUNNING"){if(aj){al+='<div title="Stop" class="pointer stop-reporting-task fa fa-stop"></div>'}}else{if(af||ad.status.runStatus==="DISABLED"){if(ag&&ae){al+='<div title="Edit" class="pointer edit-reporting-task fa fa-pencil"></div>'}if(aj&&ad.status.runStatus==="STOPPED"&&ad.status.validationStatus==="VALID"){al+='<div title="Start" class="pointer start-reporting-task fa fa-play"></div>'}if(ag&&ae&&ad.component.multipleVersionsAvailable===true){al+='<div title="Change Version" class="pointer change-version-reporting-task fa fa-exchange"></div>'}if(ag&&ae&&M.canModifyController()){al+='<div title="Remove" class="pointer delete-reporting-task fa fa-trash"></div>'}}}if(ag&&ae&&ad.component.persistsState===true){al+='<div title="View State" class="pointer view-state-reporting-task fa fa-tasks"></div>'}if(T.isManagedAuthorizer()&&M.canAccessTenants()){al+='<div title="Access Policies" class="pointer edit-access-policies fa fa-key"></div>'}return al};var X=[{id:"moreDetails",name:"&nbsp;",resizable:false,formatter:ab,sortable:true,width:90,maxWidth:90,toolTip:"Sorts based on presence of bulletins"},{id:"name",name:"Name",sortable:true,resizable:true,formatter:v},{id:"type",name:"Type",formatter:M.instanceTypeFormatter,sortable:true,resizable:true},{id:"bundle",name:"Bundle",formatter:M.instanceBundleFormatter,sortable:true,resizable:true},{id:"state",name:"Run Status",sortable:true,resizeable:true,formatter:ac}];X.push({id:"actions",name:"&nbsp;",resizable:false,formatter:aa,sortable:false,width:90,maxWidth:90});var Z=new a.Data.DataView({inlineFilters:false});Z.setItems([]);U({columnId:"name",sortAsc:true},Z);var Y=new a.Grid("#reporting-tasks-table",Z,X,z);Y.setSelectionModel(new a.RowSelectionModel());Y.registerPlugin(new a.AutoTooltips());Y.setSortColumn("name",true);Y.onSort.subscribe(function(ae,ad){U({columnId:ad.sortCol.id,sortAsc:ad.sortAsc},Z)});Y.onClick.subscribe(function(ah,ae){var ag=A(ah.target);var af=Z.getItem(ae.row);if(Y.getColumns()[ae.cell].id==="actions"){if(ag.hasClass("edit-reporting-task")){B.showConfiguration(af)}else{if(ag.hasClass("start-reporting-task")){B.start(af)}else{if(ag.hasClass("stop-reporting-task")){B.stop(af)}else{if(ag.hasClass("delete-reporting-task")){B.promptToDeleteReportingTask(af)}else{if(ag.hasClass("view-state-reporting-task")){var ad=af.status.runStatus==="STOPPED"&&af.status.activeThreadCount===0;e.showState(af,ad)}else{if(ag.hasClass("change-version-reporting-task")){t.promptForVersionChange(af)}else{if(ag.hasClass("edit-access-policies")){w.showReportingTaskPolicy(af);A("#shell-close-button").click()}}}}}}}}else{if(Y.getColumns()[ae.cell].id==="moreDetails"){if(ag.hasClass("view-reporting-task")){B.showDetails(af)}else{if(ag.hasClass("reporting-task-usage")){A("#shell-close-button").click();K.showPage("../nifi-docs/documentation?"+A.param({select:af.component.type,group:af.component.bundle.group,artifact:af.component.bundle.artifact,version:af.component.bundle.version})).done(function(){E.showSettings()})}}}}});Z.onRowCountChanged.subscribe(function(ae,ad){Y.updateRowCount();Y.render()});Z.onRowsChanged.subscribe(function(ae,ad){Y.invalidateRows(ad.rows);Y.render()});Z.syncGridSelection(Y,true);A("#reporting-tasks-table").data("gridInstance",Y).on("mouseenter","div.slick-cell",function(aj){var ah=A(this).find("div.has-errors");if(ah.length&&!ah.data("qtip")){var ad=A(this).find("span.row-id").text();var af=Z.getItemById(ad);var ag=M.formatUnorderedList(af.component.validationErrors);if(M.isDefinedAndNotNull(ag)){ah.qtip(A.extend({},M.config.tooltipConfig,{content:ag,position:{target:"mouse",viewport:A("#shell-container"),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}var ae=A(this).find("div.has-bulletins");if(ae.length&&!ae.data("qtip")){var ad=A(this).find("span.row-id").text();var af=Z.getItemById(ad);var ai=M.getFormattedBulletins(af.bulletins);var ag=M.formatUnorderedList(ai);if(M.isDefinedAndNotNull(ag)){ae.qtip(A.extend({},M.config.tooltipConfig,{content:ag,position:{target:"mouse",viewport:A("#shell-container"),adjust:{x:8,y:8,method:"flipinvert flipinvert"}}}))}}})};var u=function(){var ac=function(ah,ae,ag,af,ad){if(!ad.permissions.canRead){return'<span class="blank">'+M.escapeHtml(ad.id)+"</span>"}return M.escapeHtml(ad.component.uri)};var aa=function(ah,ae,ag,af,ad){if(!ad.permissions.canRead){return'<span class="blank">'+M.escapeHtml(ad.id)+"</span>"}return M.escapeHtml(ad.component.description)};var Y=function(ai,ae,ah,ag,ad){var af="";if(M.canModifyController()){af+='<div title="Edit" class="pointer edit-registry fa fa-pencil"></div>';af+='<div title="Remove" class="pointer remove-registry fa fa-trash"></div>'}return af};var ab=[{id:"name",name:"Name",field:"name",formatter:v,sortable:true,resizable:true},{id:"uri",name:"Location",field:"uri",formatter:ac,sortable:true,resizable:true},{id:"description",name:"Description",field:"description",formatter:aa,sortable:true,resizable:true}];ab.push({id:"actions",name:"&nbsp;",resizable:false,formatter:Y,sortable:false,width:90,maxWidth:90});var Z=new a.Data.DataView({inlineFilters:false});Z.setItems([]);U({columnId:"name",sortAsc:true},Z);var X=new a.Grid("#registries-table",Z,ab,z);X.setSelectionModel(new a.RowSelectionModel());X.registerPlugin(new a.AutoTooltips());X.setSortColumn("name",true);X.onSort.subscribe(function(ae,ad){U({columnId:ad.sortCol.id,sortAsc:ad.sortAsc},Z)});X.onClick.subscribe(function(af,ad){var ae=A(af.target);var ag=Z.getItem(ad.row);if(X.getColumns()[ad.cell].id==="actions"){if(ae.hasClass("edit-registry")){D(ag)}else{if(ae.hasClass("remove-registry")){q(ag)}}}else{if(X.getColumns()[ad.cell].id==="moreDetails"){}}});Z.onRowCountChanged.subscribe(function(ae,ad){X.updateRowCount();X.render()});Z.onRowsChanged.subscribe(function(ae,ad){X.invalidateRows(ad.rows);X.render()});Z.syncGridSelection(X,true);A("#registries-table").data("gridInstance",X)};var D=function(X){A("#registry-id").text(X.id);A("#registry-name").val(X.component.name);A("#registry-location").val(X.component.uri);A("#registry-description").val(X.component.description);A("#registry-configuration-dialog").modal("setHeaderText","Edit Registry Client").modal("setButtonModel",[{buttonText:"Update",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){y(X.id)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){A(this).modal("hide")}}}]).modal("show")};var q=function(X){k.showYesNoDialog({headerText:"Delete Registry",dialogContent:"Delete registry '"+M.escapeHtml(X.component.name)+"'?",yesHandler:function(){b(X)}})};var b=function(Y){var X=i.getRevision(Y);A.ajax({type:"DELETE",url:Y.uri+"?"+A.param({version:X.version,clientId:X.clientId,disconnectedNodeAcknowledged:s.isDisconnectionAcknowledged()}),dataType:"json"}).done(function(aa){var Z=A("#registries-table").data("gridInstance");var ab=Z.getData();ab.deleteItem(Y.id)}).fail(d.handleAjaxError)};var N=function(){var ad=function(){A("#read-only-maximum-timer-driven-thread-count-field").addClass("unset").text("Unauthorized");A("#read-only-maximum-event-driven-thread-count-field").addClass("unset").text("Unauthorized")};var ab=function(ae){if(ae){A("#general-settings div.editable").show();A("#general-settings div.read-only").hide();A("#settings-save").show()}else{A("#general-settings div.editable").hide();A("#general-settings div.read-only").show();A("#settings-save").hide()}};var aa=A.Deferred(function(ae){A.ajax({type:"GET",url:F.urls.controllerConfig,dataType:"json"}).done(function(af){if(af.permissions.canWrite){A("#maximum-timer-driven-thread-count-field").removeClass("unset").val(af.component.maxTimerDrivenThreadCount);A("#maximum-event-driven-thread-count-field").removeClass("unset").val(af.component.maxEventDrivenThreadCount);ab(true);A("#settings-save").off("click").on("click",function(){m(af.revision.version)})}else{if(af.permissions.canRead){A("#read-only-maximum-timer-driven-thread-count-field").removeClass("unset").text(af.component.maxTimerDrivenThreadCount);A("#read-only-maximum-event-driven-thread-count-field").removeClass("unset").text(af.component.maxEventDrivenThreadCount)}else{ad()}ab(false)}ae.resolve()}).fail(function(ah,af,ag){if(ah.status===403){ad();ab(false);ae.resolve()}else{ae.reject(ah,af,ag)}})}).promise();var X=F.urls.api+"/flow/controller/controller-services";var Z=H.loadControllerServices(X,r());var ac=G();var Y=V();return A.when(aa,Z,ac).done(function(ag,af){var ae=af[0];A("#settings-last-refreshed").text(ae.currentTime)}).fail(d.handleAjaxError)};var G=function(){return A.ajax({type:"GET",url:F.urls.reportingTasks,dataType:"json"}).done(function(X){var ab=[];A.each(X.reportingTasks,function(ad,ac){ab.push(A.extend({type:"ReportingTask",bulletins:[]},ac))});var Z=A("#reporting-tasks-table");M.cleanUpTooltips(Z,"div.has-errors");M.cleanUpTooltips(Z,"div.has-bulletins");var Y=Z.data("gridInstance");var aa=Y.getData();aa.setItems(ab);aa.reSort();Y.invalidate()})};var V=function(){return A.ajax({type:"GET",url:F.urls.registries,dataType:"json"}).done(function(X){var Y=[];A.each(X.registries,function(ab,ac){Y.push(A.extend({type:"Registry"},ac))});var Z=A("#registries-table").data("gridInstance");var aa=Z.getData();aa.setItems(Y);aa.reSort();Z.invalidate()})};var x=function(){K.showContent("#settings").done(function(){J()});A("#settings-tabs").find(".selected-tab").click();E.resetTableSize()};var J=function(){A("#settings-save").mouseout()};var E={init:function(){A("#settings-tabs").tabbs({tabStyle:"tab",selectedTabStyle:"selected-tab",scrollableTabContentStyle:"scrollable",tabs:[{name:"General",tabContentId:"general-settings-tab-content"},{name:"Reporting Task Controller Services",tabContentId:"controller-services-tab-content"},{name:"Reporting Tasks",tabContentId:"reporting-tasks-tab-content"},{name:"Registry Clients",tabContentId:"registries-tab-content"}],select:function(){var X=A(this).text();if(X==="General"){A("#controller-cs-availability").hide();A("#new-service-or-task").hide();A("#settings-save").show()}else{var Y=false;if(M.isDefinedAndNotNull(M.currentUser)){Y=M.currentUser.controllerPermissions.canWrite===true}if(Y){A("#new-service-or-task").show();A("div.controller-settings-table").css("top","32px");A("#new-service-or-task").attr("title",function(){if(X==="Reporting Task Controller Services"){A("#settings-save").hide();return"Create a new reporting task controller service"}else{if(X==="Reporting Tasks"){A("#settings-save").hide();return"Create a new reporting task"}else{if(X==="Registry Clients"){A("#settings-save").hide();return"Register a new registry client"}}}})}else{A("#new-service-or-task").hide();A("div.controller-settings-table").css("top","0")}if(X==="Reporting Task Controller Services"){A("#controller-cs-availability").show()}else{if(X==="Reporting Tasks"||X==="Registry Clients"){A("#controller-cs-availability").hide()}}E.resetTableSize()}}});A("#settings-refresh-button").click(function(){N()});A("#new-service-or-task").on("click",function(){var Z=A("#settings-tabs li.selected-tab").text();if(Z==="Reporting Task Controller Services"){var Y=F.urls.api+"/controller/controller-services";H.promptNewControllerService(Y,r())}else{if(Z==="Reporting Tasks"){A("#new-reporting-task-dialog").modal("show");var aa=A("#reporting-task-types-table").data("gridInstance");if(M.isDefinedAndNotNull(aa)){var X=aa.getData();aa.resizeCanvas();if(X.getLength()>0){R.choseFirstRow(aa)}}A("#reporting-task-type-filter").focus()}else{if(Z==="Registry Clients"){A("#registry-configuration-dialog").modal("setHeaderText","Add Registry Client").modal("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){f()}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){A(this).modal("hide")}}}]).modal("show");A("#registry-name").focus()}}}});j();H.init(r(),E.showSettings);c();u()},resetTableSize:function(){H.resetTableSize(r());var X=A("#reporting-tasks-table").data("gridInstance");if(M.isDefinedAndNotNull(X)){X.resizeCanvas()}},showSettings:function(){return N().done(x)},loadSettings:function(){return N()},selectControllerService:function(X){var Y=r().data("gridInstance");var Z=Y.getData();var aa=Z.getRowById(X);R.choseRow(Y,aa);Y.scrollRowIntoView(aa);A("#settings-tabs").find("li:eq(1)").click()},selectReportingTask:function(X){var aa=A("#reporting-tasks-table").data("gridInstance");var Y=aa.getData();var Z=Y.getRowById(X);R.choseRow(aa,Z);aa.scrollRowIntoView(Z);A("#settings-tabs").find("li:eq(2)").click()},setBulletins:function(Z,X){if(A("#controller-services-table").data("gridInstance")){H.setBulletins(r(),Z)}var Y=A("#reporting-tasks-table").data("gridInstance");var ab=Y.getData();ab.beginUpdate();if(!M.isEmpty(X)){var ac=O.nest().key(function(ad){return ad.sourceId}).map(X,O.map);ac.each(function(ad,ae){var af=ab.getItemById(ae);if(M.isDefinedAndNotNull(af)){ab.updateItem(ae,A.extend(af,{bulletins:ad}))}})}else{var aa=ab.getItems();A.each(aa,function(ad,ae){ab.updateItem(ae.id,A.extend(ae,{bulletins:[]}))})}ab.endUpdate()}};return E}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common"],function(c,d){return(nf.ng.BreadcrumbsCtrl=b(c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.BreadcrumbsCtrl=b(require("jquery"),require("nf.Common")))}else{nf.ng.BreadcrumbsCtrl=b(a.$,a.nf.Common)}}}(this,function(a,b){return function(e){function d(){this.breadcrumbs=[]}d.prototype={constructor:d,register:function(){if(e.breadcrumbsCtrl===undefined){e.register("breadcrumbsCtrl",c)}},generateBreadcrumbs:function(g){var f=g.id;if(g.permissions.canRead){f=g.breadcrumb.name}this.breadcrumbs.unshift(a.extend({label:f},g));if(b.isDefinedAndNotNull(g.parentBreadcrumb)){this.generateBreadcrumbs(g.parentBreadcrumb)}},updateVersionControlInformation:function(f,g){a.each(this.breadcrumbs,function(h,i){if(i.id===f){i.breadcrumb.versionControlInformation=g;return false}})},resetBreadcrumbs:function(){this.breadcrumbs=[]},isTracking:function(f){return b.isDefinedAndNotNull(f.versionedFlowState)},getVersionControlClass:function(g){if(b.isDefinedAndNotNull(g.versionedFlowState)){var f=g.versionedFlowState;if(f==="SYNC_FAILURE"){return"breadcrumb-version-control-gray fa fa-question"}else{if(f==="LOCALLY_MODIFIED_AND_STALE"){return"breadcrumb-version-control-red fa fa-exclamation-circle"}else{if(f==="STALE"){return"breadcrumb-version-control-red fa fa-arrow-circle-up"}else{if(f==="LOCALLY_MODIFIED"){return"breadcrumb-version-control-gray fa fa-asterisk"}else{return"breadcrumb-version-control-green fa fa-check"}}}}}else{return""}},getVersionControlTooltip:function(f){if(b.isDefinedAndNotNull(f.versionedFlowState)&&f.permissions.canRead){return b.getVersionControlTooltip(f.breadcrumb.versionControlInformation)}else{return"This Process Group is not under version control."}},getBreadcrumbs:function(){return this.breadcrumbs},updateBreadcrumbsCss:function(f){a("#breadcrumbs").css(f)},resetScrollPosition:function(){var l=a("#data-flow-title-container");var i=l.position();var m=l.outerWidth();var k=i.left+m;var j=a("#breadcrumbs-right-border").width();var g=a("#data-flow-title-viewport");var h=g.width();var f=h-j;if(k>f){l.css("left",(i.left-(k-f))+"px")}else{l.css("left","10px")}},registerMouseWheelEvent:function(f){f.on("DOMMouseScroll mousewheel",function(s,l){if(b.isUndefinedOrNull(s.originalEvent)){return}var m=a("#data-flow-title-container");var g=m.position();var q=m.outerWidth();var j=g.left+q;var n=a("#breadcrumbs-right-border").width();var k=a("#data-flow-title-viewport");var i=k.width();var h=i-n;if(q>i){var p=false;var r=0;if(b.isDefinedAndNotNull(s.originalEvent.wheelDelta)){r=s.originalEvent.wheelDelta}else{if(b.isDefinedAndNotNull(s.originalEvent.detail)){r=-s.originalEvent.detail}}if(r>0&&j>h){var o=-25;p=true}else{if(r<0&&(g.left-n)<0){o=25;if(g.left+o>n){o=n-g.left}p=true}}if(p){m.css("left",(g.left+o)+"px")}}})}};var c=new d();c.register();return c}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common","nf.Storage","nf.Shell","nf.ErrorHandler"],function(e,f,d,c,g){return(nf.ng.Canvas.HeaderCtrl=b(e,f,d,c,g))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Canvas.HeaderCtrl=b(require("jquery"),require("nf.Common"),require("nf.Storage"),require("nf.Shell"),require("nf.ErrorHandler")))}else{nf.ng.Canvas.HeaderCtrl=b(a.$,a.nf.Common,a.nf.Storage,a.nf.Shell,a.nf.ErrorHandler)}}}(this,function(c,d,b,a,e){return function(k,m,f,i){var j=640;var h={urls:{accessConfig:"../nifi-api/access/config"}};function l(p,n,o){this.toolboxCtrl=p;this.globalMenuCtrl=n;this.flowStatusCtrl=o;this.loginCtrl={init:function(){var q=this;if(c("#current-user").text()!==d.ANONYMOUS_USER_TEXT||location.protocol==="http:"){c("#login-link-container").css("display","none")}if(location.protocol==="http:"){c("#current-user-container").css("display","none")}var r=c.ajax({type:"GET",url:h.urls.accessConfig,dataType:"json"});c.when(r).done(function(s){q.supportsLogin=s.config.supportsLogin}).fail(e.handleAjaxError)},supportsLogin:undefined,shell:{launch:function(){a.showPage("login",false)}}};this.logoutCtrl={logout:function(){c.ajax({type:"DELETE",url:"../nifi-api/access/logout",}).done(function(){b.removeItem("jwt");window.location="../nifi/logout"}).fail(e.handleAjaxError)}}}l.prototype={constructor:l,register:function(){if(k.headerCtrl===undefined){k.register("headerCtrl",g)}},init:function(){this.toolboxCtrl.init();this.globalMenuCtrl.init();this.flowStatusCtrl.init();this.loginCtrl.init()}};var g=new l(m,f,i);g.register();return g}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["nf.CanvasUtils","nf.ContextMenu"],function(d,c){return(nf.ng.Canvas.ToolboxCtrl=b(d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Canvas.ToolboxCtrl=b(require("nf.CanvasUtils"),require("nf.ContextMenu")))}else{nf.ng.Canvas.ToolboxCtrl=b(a.nf.CanvasUtils,a.nf.ContextMenu)}}}(this,function(b,a){return function(l,e,h,c,j,k,g,i){function f(m,p,r,q,n,t,s,o){this.processorComponent=m;this.inputPortComponent=p;this.outputPortComponent=r;this.groupComponent=q;this.remoteGroupComponent=n;this.funnelComponent=t;this.templateComponent=s;this.labelComponent=o;this.config={type:{processor:"Processor",inputPort:"Input Port",outputPort:"Output Port",processGroup:"Process Group",remoteProcessGroup:"Remote Process Group",connection:"Connection",funnel:"Funnel",template:"Template",label:"Label"},urls:{api:"../nifi-api",controller:"../nifi-api/controller",processorTypes:"../nifi-api/flow/processor-types"}}}f.prototype={constructor:f,init:function(){l.modal.init();e.modal.init();h.modal.init();c.modal.init();j.modal.init();g.modal.init()},draggableComponentConfig:function(m){m.getElement().hover(function(){m.getElement().removeClass(m.icon).addClass(m.hoverIcon)},function(){m.getElement().removeClass(m.hoverIcon).addClass(m.icon)});return{zIndex:1011,revert:true,revertDuration:0,cancel:false,containment:"body",cursor:"-webkit-grabbing",start:function(o,n){a.hide()},stop:function(r,q){var t=b.getCanvasTranslate();var s=b.getCanvasScale();var p=r.originalEvent.pageX;var o=r.originalEvent.pageY-b.getCanvasOffset();if(p>=0&&o>=0){var n=(p/s)-(t[0]/s);var u=(o/s)-(t[1]/s);m.dropHandler.apply(m,[{x:n,y:u}])}},helper:m.dragIcon}}};var d=new f(l,e,h,c,j,k,g,i);return d}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common","nf.Dialog","nf.CanvasUtils","nf.ContextMenu","nf.ClusterSummary","nf.ErrorHandler","nf.Settings","nf.ParameterContexts"],function(g,c,f,d,j,i,h,e,k){return(nf.ng.Canvas.FlowStatusCtrl=b(g,c,f,d,j,i,h,e,k))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Canvas.FlowStatusCtrl=b(require("jquery"),require("nf.Common"),require("nf.Dialog"),require("nf.CanvasUtils"),require("nf.ContextMenu"),require("nf.ClusterSummary"),require("nf.ErrorHandler"),require("nf.Settings"),require("nf.ParameterContexts")))}else{nf.ng.Canvas.FlowStatusCtrl=b(a.$,a.nf.Common,a.nf.Dialog,a.nf.CanvasUtils,a.nf.ContextMenu,a.nf.ClusterSummary,a.nf.ErrorHandler,a.nf.Settings,a.nf.ParameterContexts)}}}(this,function(e,a,d,b,h,g,f,c,i){return function(m){var j={search:"Search",urls:{search:"../nifi-api/flow/search-results",status:"../nifi-api/flow/status"}};function l(){this.connectedNodesCount="-";this.clusterConnectionWarning=false;this.activeThreadCount="-";this.terminatedThreadCount="-";this.threadCounts="-";this.totalQueued="-";this.controllerTransmittingCount="-";this.controllerNotTransmittingCount="-";this.controllerRunningCount="-";this.controllerStoppedCount="-";this.controllerInvalidCount="-";this.controllerDisabledCount="-";this.controllerUpToDateCount="-";this.controllerLocallyModifiedCount="-";this.controllerStaleCount="-";this.controllerLocallyModifiedAndStaleCount="-";this.controllerSyncFailureCount="-";this.statsLastRefreshed="-";this.search={getInputElement:function(){return e("#search-field")},getButtonElement:function(){return e("#search-button")},getSearchContainerElement:function(){return e("#search-container")},init:function(){var n=this;e.widget("nf.searchAutocomplete",e.ui.autocomplete,{reset:function(){this.term=null},_create:function(){this._super();this.widget().menu("option","items","> :not(.search-header, .search-no-matches)")},_resizeMenu:function(){var o=this.menu.element;o.width(400)},_normalize:function(p){var o=[];o.push(p);return o},_renderMenu:function(q,p){var o=this;var r=p[0];if(!a.isEmpty(r.processorResults)){q.append('<li class="search-header"><div class="search-result-icon icon icon-processor"></div>Processors</li>');e.each(r.processorResults,function(t,s){o._renderItem(q,e.extend({},s,{type:"processor"}))})}if(!a.isEmpty(r.processGroupResults)){q.append('<li class="search-header"><div class="search-result-icon icon icon-group"></div>Process Groups</li>');e.each(r.processGroupResults,function(t,s){o._renderItem(q,e.extend({},s,{type:"process group"}))})}if(!a.isEmpty(r.remoteProcessGroupResults)){q.append('<li class="search-header"><div class="search-result-icon icon icon-group-remote"></div>Remote Process Groups</li>');e.each(r.remoteProcessGroupResults,function(s,t){o._renderItem(q,e.extend({},t,{type:"remote process group"}))})}if(!a.isEmpty(r.connectionResults)){q.append('<li class="search-header"><div class="search-result-icon icon icon-connect"></div>Connections</li>');e.each(r.connectionResults,function(t,s){o._renderItem(q,e.extend({},s,{type:"connection"}))})}if(!a.isEmpty(r.inputPortResults)){q.append('<li class="search-header"><div class="search-result-icon icon icon-port-in"></div>Input Ports</li>');e.each(r.inputPortResults,function(s,t){o._renderItem(q,e.extend({},t,{type:"input port"}))})}if(!a.isEmpty(r.outputPortResults)){q.append('<li class="search-header"><div class="search-result-icon icon icon-port-out"></div>Output Ports</li>');e.each(r.outputPortResults,function(s,t){o._renderItem(q,e.extend({},t,{type:"output port"}))})}if(!a.isEmpty(r.funnelResults)){q.append('<li class="search-header"><div class="search-result-icon icon icon-funnel"></div>Funnels</li>');e.each(r.funnelResults,function(t,s){o._renderItem(q,e.extend({},s,{type:"funnel"}))})}if(!a.isEmpty(r.parameterContextResults)){q.append('<li class="search-header"><div class="search-result-icon icon"></div>Parameter Contexts</li>');e.each(r.parameterContextResults,function(s,t){o._renderItem(q,e.extend({},t,{type:"parameter context"}))})}if(!a.isEmpty(r.parameterResults)){q.append('<li class="search-header"><div class="search-result-icon icon"></div>Parameters</li>');e.each(r.parameterResults,function(t,s){o._renderItem(q,e.extend({},s,{type:"parameter"}))})}if(q.children().length===0){q.append('<li class="unset search-no-matches">No results matched the search terms</li>')}},_renderItem:function(s,q){var x=e('<div class="search-match-header"></div>').text(q.name);var r=e("<a></a>").append(x);if(q.type!=="parameter context"&&q.type!=="parameter"){var v=e('<div class="search-match-header"></div>').append(document.createTextNode("Parent: "));var t="-";if(a.isDefinedAndNotNull(q.parentGroup)){t=q.parentGroup.name?q.parentGroup.name:q.parentGroup.id}v=v.append(e("<span></span>").text(t));var u=e('<div class="search-match-header"></div>').append(document.createTextNode("Versioned: "));var p="-";if(a.isDefinedAndNotNull(q.versionedGroup)){p=q.versionedGroup.name?q.versionedGroup.name:q.versionedGroup.id}u=u.append(e("<span></span>").text(p));r.append(v).append(u)}else{if(q.type==="parameter"){var o=e('<div class="search-match-header"></div>').append(document.createTextNode("Parameter Context: "));var w="-";if(a.isDefinedAndNotNull(q.parentGroup)){w=q.parentGroup.name?q.parentGroup.name:q.parentGroup.id}o=o.append(e("<span></span>").text(w));r.append(o)}}e.each(q.matches,function(z,y){r.append(e('<div class="search-match"></div>').text(y))});return e("<li></li>").data("ui-autocomplete-item",q).append(r).appendTo(s)}});this.getInputElement().searchAutocomplete({delay:1000,appendTo:"#search-flow-results",position:{my:"right top",at:"right bottom",offset:"1 1"},source:function(p,o){e.ajax({type:"GET",data:{q:p.term},dataType:"json",url:j.urls.search}).done(function(q){o(q.searchResultsDTO)})},select:function(q,r){var p=r.item;switch(p.type){case"parameter context":i.showParameterContexts(p.id);break;case"parameter":var o=p.parentGroup;i.showParameterContext(o.id,null,p.name);break;default:var s=p.parentGroup;b.showComponent(s.id,p.id);break}n.getInputElement().val("").blur();return false},open:function(o,p){var q=e(this);e('<div class="search-glass-pane"></div>').one("click",function(){}).appendTo("body")},close:function(o,p){e(this).searchAutocomplete("reset");n.getInputElement().val("");e("div.search-glass-pane").remove()}});n.toggleSearchField()},toggleSearchField:function(){var q=this;h.hide();var n=q.getInputElement().is(":visible");var r="none";var p="search-container-opened";var o="search-container-closed";if(!n){q.getButtonElement().css("background-color","#FFFFFF");r="inline-block";p="search-container-closed";o="search-container-opened"}else{q.getInputElement().css("display",r)}this.getSearchContainerElement().switchClass(p,o,500,function(){q.getInputElement().css("display",r);if(!n){q.getButtonElement().css("background-color","#FFFFFF");q.getInputElement().focus()}else{q.getButtonElement().css("background-color","#E3E8EB")}})}};this.bulletins={update:function(n){var p=e("#bulletin-button");var r=p.data("bulletins");if(a.doBulletinsDiffer(r,n.bulletins)){p.data("bulletins",n.bulletins);var q=a.getFormattedBulletins(n.bulletins);if(q.length===0){if(p.data("qtip")){p.removeClass("has-bulletins").qtip("api").destroy(true)}}else{var o=a.formatUnorderedList(q);if(p.data("qtip")){p.qtip("option","content.text",o)}else{p.addClass("has-bulletins").qtip(e.extend({},b.config.systemTooltipConfig,{content:o,position:{at:"bottom left",my:"top right",adjust:{x:4}}}))}}}c.setBulletins(n.controllerServiceBulletins,n.reportingTaskBulletins)}}}l.prototype={constructor:l,init:function(){this.search.init()},reloadFlowStatus:function(){var n=this;return e.ajax({type:"GET",url:j.urls.status,dataType:"json"}).done(function(o){if(a.isDefinedAndNotNull(o.controllerStatus)){n.update(o.controllerStatus)}}).fail(f.handleAjaxError)},updateClusterSummary:function(o){if(o.connectedToCluster){var n=o.connectedNodes.split(" / ");if(n.length===2&&n[0]!==n[1]){this.clusterConnectionWarning=true}else{this.clusterConnectionWarning=false}this.connectedNodesCount=o.connectedNodes}else{this.connectedNodesCount="Disconnected"}},hasTerminatedThreads:function(){if(Number.isInteger(this.terminatedThreadCount)){return this.terminatedThreadCount>0}else{return false}},getExtraThreadStyles:function(){if(Number.isInteger(this.terminatedThreadCount)&&this.terminatedThreadCount>0){return"warning"}else{if(this.activeThreadCount===0){return"zero"}}return""},getExtraClusterStyles:function(){if(this.connectedNodesCount==="Disconnected"||this.clusterConnectionWarning===true){return"warning"}return""},update:function(n){this.activeThreadCount=n.activeThreadCount;this.terminatedThreadCount=n.terminatedThreadCount;if(this.hasTerminatedThreads()){this.threadCounts=this.activeThreadCount+" ("+this.terminatedThreadCount+")"}else{this.threadCounts=this.activeThreadCount}this.totalQueued=n.queued;if(this.totalQueued.indexOf("0 / 0")>=0){e("#flow-status-container").find(".fa-list").addClass("zero")}else{e("#flow-status-container").find(".fa-list").removeClass("zero")}this.controllerTransmittingCount=a.isDefinedAndNotNull(n.activeRemotePortCount)?n.activeRemotePortCount:"-";if(this.controllerTransmittingCount>0){e("#flow-status-container").find(".fa-bullseye").removeClass("zero").addClass("transmitting")}else{e("#flow-status-container").find(".fa-bullseye").removeClass("transmitting").addClass("zero")}this.controllerNotTransmittingCount=a.isDefinedAndNotNull(n.inactiveRemotePortCount)?n.inactiveRemotePortCount:"-";if(this.controllerNotTransmittingCount>0){e("#flow-status-container").find(".icon-transmit-false").removeClass("zero").addClass("not-transmitting")}else{e("#flow-status-container").find(".icon-transmit-false").removeClass("not-transmitting").addClass("zero")}this.controllerRunningCount=a.isDefinedAndNotNull(n.runningCount)?n.runningCount:"-";if(this.controllerRunningCount>0){e("#flow-status-container").find(".fa-play").removeClass("zero").addClass("running")}else{e("#flow-status-container").find(".fa-play").removeClass("running").addClass("zero")}this.controllerStoppedCount=a.isDefinedAndNotNull(n.stoppedCount)?n.stoppedCount:"-";if(this.controllerStoppedCount>0){e("#flow-status-container").find(".fa-stop").removeClass("zero").addClass("stopped")}else{e("#flow-status-container").find(".fa-stop").removeClass("stopped").addClass("zero")}this.controllerInvalidCount=a.isDefinedAndNotNull(n.invalidCount)?n.invalidCount:"-";if(this.controllerInvalidCount>0){e("#flow-status-container").find(".fa-warning").removeClass("zero").addClass("invalid")}else{e("#flow-status-container").find(".fa-warning").removeClass("invalid").addClass("zero")}this.controllerDisabledCount=a.isDefinedAndNotNull(n.disabledCount)?n.disabledCount:"-";if(this.controllerDisabledCount>0){e("#flow-status-container").find(".icon-enable-false").removeClass("zero").addClass("disabled")}else{e("#flow-status-container").find(".icon-enable-false").removeClass("disabled").addClass("zero")}this.controllerUpToDateCount=a.isDefinedAndNotNull(n.upToDateCount)?n.upToDateCount:"-";if(this.controllerUpToDateCount>0){e("#flow-status-container").find(".fa-check").removeClass("zero").addClass("up-to-date")}else{e("#flow-status-container").find(".fa-check").removeClass("up-to-date").addClass("zero")}this.controllerLocallyModifiedCount=a.isDefinedAndNotNull(n.locallyModifiedCount)?n.locallyModifiedCount:"-";if(this.controllerLocallyModifiedCount>0){e("#flow-status-container").find(".fa-asterisk").removeClass("zero").addClass("locally-modified")}else{e("#flow-status-container").find(".fa-asterisk").removeClass("locally-modified").addClass("zero")}this.controllerStaleCount=a.isDefinedAndNotNull(n.staleCount)?n.staleCount:"-";if(this.controllerStaleCount>0){e("#flow-status-container").find(".fa-arrow-circle-up").removeClass("zero").addClass("stale")}else{e("#flow-status-container").find(".fa-arrow-circle-up").removeClass("stale").addClass("zero")}this.controllerLocallyModifiedAndStaleCount=a.isDefinedAndNotNull(n.locallyModifiedAndStaleCount)?n.locallyModifiedAndStaleCount:"-";if(this.controllerLocallyModifiedAndStaleCount>0){e("#flow-status-container").find(".fa-exclamation-circle").removeClass("zero").addClass("locally-modified-and-stale")}else{e("#flow-status-container").find(".fa-exclamation-circle").removeClass("locally-modified-and-stale").addClass("zero")}this.controllerSyncFailureCount=a.isDefinedAndNotNull(n.syncFailureCount)?n.syncFailureCount:"-";if(this.controllerSyncFailureCount>0){e("#flow-status-container").find(".fa-question").removeClass("zero").addClass("sync-failure")}else{e("#flow-status-container").find(".fa-question").removeClass("sync-failure").addClass("zero")}},updateBulletins:function(n){this.bulletins.update(n)}};var k=new l();return k}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Common","nf.QueueListing","nf.Shell","nf.ParameterContexts","nf.PolicyManagement","nf.ClusterSummary","nf.ErrorHandler","nf.Settings","nf.CanvasUtils"],function(g,f,l,c,k,j,i,h,e,d){return(nf.ng.Canvas.GlobalMenuCtrl=b(g,f,l,c,j,i,h,e,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Canvas.GlobalMenuCtrl=b(require("jquery"),require("nf.Common"),require("nf.QueueListing"),require("nf.Shell"),require("nf.ParameterContexts"),require("nf.PolicyManagement"),require("nf.ClusterSummary"),require("nf.ErrorHandler"),require("nf.Settings"),require("nf.CanvasUtils")))}else{nf.ng.Canvas.GlobalMenuCtrl=b(a.$,a.nf.Common,a.nf.QueueListing,a.nf.Shell,a.nf.ParameterContexts,a.nf.PolicyManagement,a.nf.ClusterSummary,a.nf.ErrorHandler,a.nf.Settings,a.nf.CanvasUtils)}}}(this,function(e,d,j,a,i,h,g,f,c,b){return function(n){var l={urls:{helpDocument:"../nifi-docs/documentation",controllerAbout:"../nifi-api/flow/about"}};function m(o){this.summary={shell:{launch:function(){a.showPage("summary")}}};this.counters={shell:{launch:function(){if(d.canAccessCounters()){a.showPage("counters")}}}};this.bulletinBoard={shell:{launch:function(){a.showPage("bulletin-board")}}};this.dataProvenance={shell:{launch:function(){if(d.canAccessProvenance()){a.showPage("provenance")}}}};this.controllerSettings={shell:{launch:function(){c.showSettings()}}};this.parameterContexts={shell:{launch:function(){i.showParameterContexts()}}};this.cluster={visible:function(){return g.isConnectedToCluster()},shell:{launch:function(){if(d.canAccessController()){a.showPage("cluster")}}}};this.flowConfigHistory={shell:{launch:function(){a.showPage("history")}}};this.users={shell:{launch:function(){if(d.canAccessTenants()){a.showPage("users")}}}};this.policies={shell:{launch:function(){if(d.canModifyPolicies()&&d.canAccessTenants()){h.showGlobalPolicies()}}}};this.templates={shell:{launch:function(){a.showPage("templates?"+e.param({groupId:b.getGroupId()}))}}};this.help={shell:{launch:function(){a.showPage(l.urls.helpDocument)}}};this.about={init:function(){e.ajax({type:"GET",url:l.urls.controllerAbout,dataType:"json"}).done(function(r){var p=r.about;document.title=p.title;e("#nf-version").text(p.version);var q=false;if(p.buildTag&&p.buildTag!=="HEAD"){e("#nf-about-build-tag").text(p.buildTag);e("#nf-version-detail-tag").show();q=true}if(p.buildRevision){e("#nf-about-build-revision").text(p.buildRevision);e("#nf-about-build-branch").text(p.buildBranch);e("#nf-version-detail-commit").show();q=true}if(p.buildTimestamp){e("#nf-about-build-timestamp").text(p.buildTimestamp);e("#nf-version-detail-timestamp").show();q=true}if(q){e("#nf-version-detail").show()}if(!d.isBlank(p.contentViewerUrl)){e("#nifi-content-viewer-url").text(p.contentViewerUrl);j.initFlowFileDetailsDialog()}}).fail(f.handleAjaxError);this.modal.init()},modal:{getElement:function(){return e("#nf-about")},init:function(){var p=this;var q=function(){var r=e(this);var s=e("#nf-about-pic-container").height()+e(".dialog-header").height()+10;r.find(".dialog-content").css("top",s)};this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"About Apache NiFi",handler:{resize:q},buttons:[{buttonText:"Ok",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){p.hide()}}}]})},update:function(q,p){this.getElement().modal(q,p)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}}m.prototype={constructor:m,init:function(){this.about.init()}};var k=new m();return k}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Actions","nf.Birdseye","nf.Storage","nf.CanvasUtils","nf.ProcessGroupConfiguration"],function(h,d,g,e,f,c){return(nf.ng.Canvas.GraphControlsCtrl=b(h,d,g,e,f,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Canvas.GraphControlsCtrl=b(require("jquery"),require("nf.Actions"),require("nf.Birdseye"),require("nf.Storage"),require("nf.CanvasUtils"),require("nf.ProcessGroupConfiguration")))}else{nf.ng.Canvas.GraphControlsCtrl=b(a.$,a.nf.Actions,a.nf.Birdseye,a.nf.Storage,a.nf.CanvasUtils,a.nf.ProcessGroupConfiguration)}}}(this,function(f,b,e,c,d,a){return function(m,i,l){var k=function(n){if(f("div.graph-control-content").is(":visible")===false){f("#graph-controls div.graph-control-docked").hide();f("#graph-controls div.graph-control-header-container").show();f(".graph-control").removeClass("docked")}n.children("div.graph-control-content").show();n.find("div.graph-control-expansion").removeClass("fa-plus-square-o").addClass("fa-minus-square-o");if(n.attr("id")==="navigation-control"){e.updateBirdseyeVisibility(true)}var o=c.getItem("graph-control-visibility");if(o===null){o={}}var p=n.attr("id");o[p]=true;c.setItem("graph-control-visibility",o)};var j=function(n){n.children("div.graph-control-content").hide();n.find("div.graph-control-expansion").removeClass("fa-minus-square-o").addClass("fa-plus-square-o");if(f("div.graph-control-content").is(":visible")===false){f("#graph-controls div.graph-control-header-container").hide();f("#graph-controls div.graph-control-docked").show();f(".graph-control").addClass("docked")}if(n.attr("id")==="navigation-control"){e.updateBirdseyeVisibility(false)}var o=c.getItem("graph-control-visibility");if(o===null){o={}}var p=n.attr("id");o[p]=false;c.setItem("graph-control-visibility",o)};function h(n,o){this.navigateCtrl=n;this.operateCtrl=o}h.prototype={constructor:h,register:function(){if(m.graphControlsCtrl===undefined){m.register("graphControlsCtrl",g)}},init:function(){this.operateCtrl.init();var n=c.getItem("graph-control-visibility");if(n!==null){f.each(n,function(q,o){var p=f("#"+q);if(p){if(o){k(p)}else{j(p)}}})}else{k(f("#navigation-control"));k(f("#operation-control"))}},undock:function(n){k(f(n.target).parent())},expand:function(n){var o=f(n.target);if(o.find(".fa-plus-square-o").length>0||o.hasClass("fa-plus-square-o")||o.parent().children().find(".fa-plus-square-o").length>0){k(o.closest("div.graph-control"))}else{j(o.closest("div.graph-control"))}},getContextIcon:function(){var n=d.getSelection();if(n.empty()){if(d.getParentGroupId()===null){return"icon-drop"}else{return"icon-group"}}else{if(n.size()===1){if(d.isProcessor(n)){return"icon-processor"}else{if(d.isProcessGroup(n)){return"icon-group"}else{if(d.isInputPort(n)){return"icon-port-in"}else{if(d.isOutputPort(n)){return"icon-port-out"}else{if(d.isRemoteProcessGroup(n)){return"icon-group-remote"}else{if(d.isFunnel(n)){return"icon-funnel"}else{if(d.isLabel(n)){return"icon-label"}else{if(d.isConnection(n)){return"icon-connect"}}}}}}}}}else{return"icon-drop"}}},hide:function(){var n=d.getSelection();if(n.size()>1){return"invisible"}else{return""}},getContextName:function(){var o=d.getSelection();var n=d.canReadCurrentGroup();if(o.empty()){if(n){return d.getGroupName()}else{return d.getGroupId()}}else{if(o.size()===1){var p=o.datum();if(p.permissions.canRead){if(d.isLabel(o)){if(f.trim(p.component.label)!==""){return p.component.label}else{return""}}else{if(d.isConnection(o)){return d.formatConnectionName(p.component)}else{return p.component.name}}}else{return p.id}}else{return"Multiple components selected"}}},getContextType:function(){var n=d.getSelection();if(n.empty()){return"Process Group"}else{if(n.size()===1){if(d.isProcessor(n)){return"Processor"}else{if(d.isProcessGroup(n)){return"Process Group"}else{if(d.isInputPort(n)){return"Input Port"}else{if(d.isOutputPort(n)){return"Output Port"}else{if(d.isRemoteProcessGroup(n)){return"Remote Process Group"}else{if(d.isFunnel(n)){return"Funnel"}else{if(d.isLabel(n)){return"Label"}else{if(d.isConnection(n)){return"Connection"}}}}}}}}}else{return"Multiple selected"}}},getContextId:function(){var n=d.getSelection();if(n.empty()){return d.getGroupId()}else{if(n.size()===1){var o=n.datum();return o.id}else{return"Multiple selected"}}},canConfigureOrOpenDetails:function(){var n=d.getSelection();if(n.empty()){return true}return d.isConfigurable(n)||d.hasDetails(n)},openConfigureOrDetailsView:function(){var n=d.getSelection();if(d.isConfigurable(n)){b.showConfiguration(n)}else{if(d.hasDetails(n)){b.showDetails(n)}}}};var g=new h(i,l);g.register();return g}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["nf.CanvasUtils","nf.ContextMenu"],function(d,c){return(nf.ng.Canvas.NavigateCtrl=b(d,c))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Canvas.NavigateCtrl=b(require("nf.CanvasUtils"),require("nf.ContextMenu")))}else{nf.ng.Canvas.NavigateCtrl=b(a.nf.CanvasUtils,a.nf.ContextMenu)}}}(this,function(b,a){return function(e){function d(){this.zoomIn=function(){e(function(){b.zoomInCanvas()},0)};this.zoomOut=function(){e(function(){b.zoomOutCanvas()},0)};this.zoomFit=function(){e(function(){b.fitCanvas()},0)};this.zoomActualSize=function(){e(function(){b.actualSizeCanvas()},0)}}d.prototype={constructor:d};var c=new d();return c}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","d3","nf.Dialog","nf.Storage","nf.Birdseye","nf.CanvasUtils","nf.Common","nf.Client","nf.Processor"],function(g,j,f,h,c,e,d,k,i){return(nf.ng.Canvas.OperateCtrl=b(g,j,f,h,c,e,d,k,i))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.Canvas.OperateCtrl=b(require("jquery"),require("d3"),require("nf.Dialog"),require("nf.Storage"),require("nf.Birdseye"),require("nf.CanvasUtils"),require("nf.Common"),require("nf.Client"),require("nf.Processor")))}else{nf.ng.Canvas.OperateCtrl=b(a.$,a.d3,a.nf.Dialog,a.nf.Storage,a.nf.Birdseye,a.nf.CanvasUtils,a.nf.Common,a.nf.Client,a.nf.Processor)}}}(this,function(e,h,d,f,a,c,b,i,g){return function(){var k=function(){var m=e("#fill-color-value").val();if(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(m)){e("#fill-color").minicolors("value",m)}};function j(){this.template={modal:{getElement:function(){return e("#new-template-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Create Template"})},update:function(n,m){this.getElement().modal(n,m)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}};this.templateUpload={modal:{getElement:function(){return e("#upload-template-dialog")},init:function(){var m=e("#template-upload-form").ajaxForm({url:"../nifi-api/process-groups/",dataType:"xml",beforeSubmit:function(p,n,o){p.push({name:"disconnectedNodeAcknowledged",value:f.isDisconnectionAcknowledged()});o.url+=(encodeURIComponent(c.getGroupId())+"/templates/upload")},success:function(n,q,r,p){if(n.documentElement.tagName==="templateEntity"){d.showOkDialog({headerText:"Success",dialogContent:"Template successfully imported."})}else{var q="Unable to import template. Please check the log for errors.";if(n.documentElement.tagName==="errorResponse"){var o=n.documentElement.getAttribute("statusText");if(!b.isBlank(o)){q=o}}d.showOkDialog({headerText:"Unable to Upload",dialogContent:b.escapeHtml(q)})}},error:function(p,o,n){d.showOkDialog({headerText:"Unable to Upload",dialogContent:b.escapeHtml(p.responseText)})}});this.getElement().modal({headerText:"Upload Template",buttons:[{buttonText:"Upload",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var n=e("#selected-template-name").text();if(b.isBlank(n)){e("#upload-template-status").text("No template selected. Please browse to select a template.")}else{m.submit();e("#upload-template-dialog").modal("hide")}}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){e("#upload-template-dialog").modal("hide")}}}],handler:{close:function(){e("#selected-template-name").text("");e("#upload-template-status").text("");m.resetForm()}}});e("#template-file-field-button").on("click",function(n){e("#template-file-field").click()});e("#template-file-field").on("change",function(o){var n=e(this).val();if(!b.isBlank(n)){n=n.replace(/^.*[\\\/]/,"")}e("#selected-template-name").text(n);e("#upload-template-status").text("")})},update:function(n,m){this.getElement().modal(n,m)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}};this.fillcolor={modal:{getElement:function(){return e("#fill-color-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Change Color",buttons:[{buttonText:"Apply",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var m=c.getSelection();m.each(function(r){var p=h.select(this);var q=p.datum();var o=e("#fill-color").minicolors("value");if(o!==q.component.style["background-color"]){var n={revision:i.getRevision(q),disconnectedNodeAcknowledged:f.isDisconnectionAcknowledged(),component:{id:q.id,style:{"background-color":o}}};e.ajax({type:"PUT",url:q.uri,data:JSON.stringify(n),dataType:"json",contentType:"application/json"}).done(function(s){c.getComponentByType(q.type).set(s)}).fail(function(u,s,t){if(u.status===400||u.status===404||u.status===409){d.showOkDialog({headerText:"Error",dialogContent:b.escapeHtml(u.responseText)})}}).always(function(){a.refresh()})}});e("#fill-color-dialog").modal("hide")}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){e("#fill-color-dialog").modal("hide")}}}],handler:{close:function(){e("#fill-color-value").val("");e("#fill-color").minicolors("value","")}}})},update:function(n,m){this.getElement().modal(n,m)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")},minicolors:{getElement:function(){return e("#fill-color")},init:function(){this.getElement().minicolors({inline:true,change:function(n,m){e("#fill-color-value").val(n);if(n.toLowerCase()==="#ffffff"){e("#fill-color-processor-preview-icon").css({color:g.defaultIconColor(),"background-color":n})}else{e("#fill-color-processor-preview-icon").css({color:b.determineContrastColor(b.substringAfterLast(n,"#")),"background-color":n})}var o=n;if(o.toLowerCase()==="#ffffff"){o="rgba(0,0,0,0.25)"}e("#fill-color-processor-preview").css({"border-color":o});e("#fill-color-label-preview").css({background:n});e("#fill-color-label-preview-value").css("color",b.determineContrastColor(b.substringAfterLast(n,"#")))}});e("#fill-color-value").on("blur",k).on("keyup",function(n){var m=n.keyCode?n.keyCode:n.which;if(m===e.ui.keyCode.ENTER){k()}})}}}}}j.prototype={constructor:j,init:function(){this.template.modal.init();this.templateUpload.modal.init();this.fillcolor.modal.init();this.fillcolor.modal.minicolors.init()}};var l=new j();return l}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","Slick","nf.Client","nf.Birdseye","nf.Storage","nf.Graph","nf.CanvasUtils","nf.ErrorHandler","nf.FilteredDialogCommon","nf.Dialog","nf.Common"],function(h,e,m,c,i,j,f,l,k,g,d){return(nf.ng.ProcessorComponent=b(h,e,m,c,i,j,f,l,k,g,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.ProcessorComponent=b(require("jquery"),require("Slick"),require("nf.Client"),require("nf.Birdseye"),require("nf.Storage"),require("nf.Graph"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.FilteredDialogCommon"),require("nf.Dialog"),require("nf.Common")))}else{nf.ng.ProcessorComponent=b(a.$,a.Slick,a.nf.Client,a.nf.Birdseye,a.nf.Storage,a.nf.Graph,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.FilteredDialogCommon,a.nf.Dialog,a.nf.Common)}}}(this,function(f,c,k,a,g,h,d,j,i,e,b){return function(n){var q=function(){var w=f("#processor-types-table").data("gridInstance");if(b.isDefinedAndNotNull(w)){var x=w.getData();x.setFilterArgs({searchString:u()});x.refresh();f("#new-processor-dialog").modal("refreshButtons");if(x.getLength()>0){i.choseFirstRow(w);w.scrollRowToTop(0)}}};var s=function(y,x){if(x.searchString===""){return true}try{var B=new RegExp(x.searchString,"i")}catch(A){return false}var z=y.label.search(B)>=0;var w=y.tags.search(B)>=0;return z||w};var l=function(F,A){var D=s(F,A);var z=true;if(D){var E=f("#processor-tag-cloud").tagcloud("getSelectedTags");var C=E.length>0;if(C){z=m(E,F.tags)}}var B=true;if(D&&z){var w=f("#processor-bundle-group-combo").combo("getSelectedOption");if(b.isDefinedAndNotNull(w)&&w.value!==""){B=(F.bundle.group===w.value)}}var x=D&&z&&B;if(x===false&&f("#selected-processor-type").text()===F.type){f("#processor-type-description").attr("title","").text("");f("#processor-type-name").attr("title","").text("");f("#processor-type-bundle").attr("title","").text("");f("#selected-processor-name").text("");f("#selected-processor-type").text("").removeData("bundle");var y=f("#processor-types-table").data("gridInstance");y.resetActiveCell()}return x};var m=function(y,w){var x=[];f.each(y,function(B,C){x.push(C)});var z=w.toLowerCase();var A=true;f.each(x,function(B,C){if(z.indexOf(C)===-1){A=false;return false}});return A};var u=function(){return f("#processor-type-filter").val()};var o=function(){f("#processor-tag-cloud").tagcloud("clearSelectedTags");f("#processor-bundle-group-combo").combo("setSelectedOption",{value:""});f("#processor-type-filter").val("");q();f("#processor-type-description").attr("title","").text("");f("#processor-type-name").attr("title","").text("");f("#processor-type-bundle").attr("title","").text("");f("#selected-processor-name").text("");f("#selected-processor-type").text("").removeData("bundle");var w=f("#processor-types-table").data("gridInstance");w.setSelectedRows([]);w.resetActiveCell()};var r=function(x,A,w,y){var z={revision:k.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:g.isDisconnectionAcknowledged(),component:{type:A,bundle:w,name:x,position:{x:y.x,y:y.y}}};f.ajax({type:"POST",url:n.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(d.getGroupId())+"/processors",data:JSON.stringify(z),dataType:"json",contentType:"application/json"}).done(function(B){h.add({processors:[B]},{selectAll:true});h.updateVisibility();a.refresh()}).fail(j.handleAjaxError)};var p=function(w){return w.restricted===false||b.canAccessComponentRestrictions(w.explicitRestrictions)};function v(){this.icon="icon icon-processor";this.hoverIcon="icon icon-processor-add";this.modal={filter:{init:function(){var x=[{id:"type",name:"Type",field:"label",formatter:b.typeFormatter,sortable:true,resizable:true},{id:"version",name:"Version",field:"version",formatter:b.typeVersionFormatter,sortable:true,resizable:true},{id:"tags",name:"Tags",field:"tags",sortable:true,resizable:true,formatter:b.genericValueFormatter}];var A={forceFitColumns:true,enableTextSelectionOnCells:true,enableCellNavigation:true,enableColumnReorder:false,autoEdit:false,multiSelect:false,rowHeight:24};var y=new c.Data.DataView({inlineFilters:false});y.setItems([]);y.setFilterArgs({searchString:u()});y.setFilter(l);b.sortType({columnId:"type",sortAsc:true},y);var w=new c.Grid("#processor-types-table",y,x,A);w.setSelectionModel(new c.RowSelectionModel());w.registerPlugin(new c.AutoTooltips());w.setSortColumn("type",true);w.onSort.subscribe(function(C,B){b.sortType({columnId:B.sortCol.field,sortAsc:B.sortAsc},y)});w.onSelectedRowsChanged.subscribe(function(F,D){if(f.isArray(D.rows)&&D.rows.length===1){var B=D.rows[0];var G=w.getDataItem(B);if(b.isDefinedAndNotNull(G)){if(b.isBlank(G.description)){f("#processor-type-description").attr("title","").html('<span class="unset">No description specified</span>')}else{f("#processor-type-description").width(f("#processor-description-container").innerWidth()-1).html(G.description).ellipsis()}var C=b.formatBundle(G.bundle);var E=b.formatType(G);f("#processor-type-name").text(E).attr("title",E);f("#processor-type-bundle").text(C).attr("title",C);f("#selected-processor-name").text(G.label);f("#selected-processor-type").text(G.type).data("bundle",G.bundle);f("#new-processor-dialog").modal("refreshButtons")}}});w.onViewportChanged.subscribe(function(C,B){b.cleanUpTooltips(f("#processor-types-table"),"div.view-usage-restriction")});y.onRowCountChanged.subscribe(function(C,B){w.updateRowCount();w.render();f("#displayed-processor-types").text(B.current)});y.onRowsChanged.subscribe(function(C,B){w.invalidateRows(B.rows);w.render()});y.syncGridSelection(w,false);f("#processor-types-table").data("gridInstance",w).on("mouseenter","div.slick-cell",function(E){var F=f(this).find("div.view-usage-restriction");if(F.length&&!F.data("qtip")){var D=f(this).find("span.row-id").text();var C=y.getItemById(D);if(C.restricted===true){var G=f("<div></div>");if(b.isBlank(C.usageRestriction)){G.append(f('<p style="margin-bottom: 3px;"></p>').text("Requires the following permissions:"))}else{G.append(f('<p style="margin-bottom: 3px;"></p>').text(C.usageRestriction+" Requires the following permissions:"))}var B=[];if(b.isDefinedAndNotNull(C.explicitRestrictions)){f.each(C.explicitRestrictions,function(H,J){var I=J.requiredPermission;B.push("'"+I.label+"' - "+b.escapeHtml(J.explanation))})}else{B.push("Access to restricted components regardless of restrictions.")}G.append(b.formatUnorderedList(B));F.qtip(f.extend({},b.config.tooltipConfig,{content:G,position:{container:f("#summary"),at:"bottom right",my:"top left",adjust:{x:4,y:4}}}))}}});var z=b.getPolicyTypeListing("restricted-components");f.ajax({type:"GET",url:n.headerCtrl.toolboxCtrl.config.urls.processorTypes,dataType:"json"}).done(function(C){var E=[];var B=d3.set();var G=d3.map();var F=d3.map();y.beginUpdate();f.each(C.processorTypes,function(H,J){var I=J.type;if(J.restricted===true){if(b.isDefinedAndNotNull(J.explicitRestrictions)){f.each(J.explicitRestrictions,function(K,M){var L=M.requiredPermission;if(!F.has(L.id)){F.set(L.id,L.label)}if(!G.has(L.id)){G.set(L.id,[])}G.get(L.id).push({type:b.formatType(J),bundle:b.formatBundle(J.bundle),explanation:b.escapeHtml(M.explanation)})})}else{if(!F.has(z.value)){F.set(z.value,z.text)}if(!G.has(z.value)){G.set(z.value,[])}G.get(z.value).push({type:b.formatType(J),bundle:b.formatBundle(J.bundle),explanation:b.escapeHtml(J.usageRestriction)})}}B.add(J.bundle.group);y.addItem({id:H,label:b.substringAfterLast(I,"."),type:I,bundle:J.bundle,description:b.escapeHtml(J.description),restricted:J.restricted,usageRestriction:b.escapeHtml(J.usageRestriction),explicitRestrictions:J.explicitRestrictions,tags:J.tags.join(", ")});f.each(J.tags,function(L,K){E.push(K.toLowerCase())})});y.endUpdate();y.reSort();w.invalidate();d.addComponentRestrictions(G,F);f("#total-processor-types, #displayed-processor-types").text(C.processorTypes.length);f("#processor-tag-cloud").tagcloud({tags:E,select:q,remove:q});var D=[{text:"all groups",value:""}];B.each(function(H){D.push({text:H,value:H})});f("#processor-bundle-group-combo").combo({options:D,select:q})}).fail(j.handleAjaxError)}},getElement:function(){return f("#new-processor-dialog")},init:function(){this.filter.init();this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Add Processor",handler:{resize:function(){f("#processor-type-description").width(f("#processor-description-container").innerWidth()-1).text(f("#processor-type-description").attr("title")).ellipsis()}}})},update:function(x,w){this.getElement().modal(x,w)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}v.prototype={constructor:v,getElement:function(){return f("#processor-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(w){this.promptForProcessorType(w)},dragIcon:function(w){return f('<div class="icon icon-processor-add"></div>')},promptForProcessorType:function(C){var w=this;var A=function(){var E=f("#selected-processor-name").text();var F=f("#selected-processor-type").text();var D=f("#selected-processor-type").data("bundle");if(E===""||F===""){e.showOkDialog({headerText:"Add Processor",dialogContent:"The type of processor to create must be selected."})}else{r(E,F,D,C)}w.modal.hide()};var z=f("#processor-types-table").data("gridInstance");var x=z.getData();var y=function(E,D){var F=z.getDataItem(D.row);if(p(F)){f("#selected-processor-name").text(F.label);f("#selected-processor-type").text(F.type).data("bundle",F.bundle);A()}};z.onDblClick.subscribe(y);this.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},disabled:function(){var D=z.getSelectedRows();if(D.length>0){var E=z.getDataItem(D[0]);return p(E)===false}else{return x.getLength()===0}},handler:{click:A}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){f("#new-processor-dialog").modal("hide")}}}]);this.modal.update("setCloseHandler",function(){z.onDblClick.unsubscribe(y);o()});this.modal.show();var B=[f.ui.keyCode.UP,f.ui.keyCode.PAGE_UP,f.ui.keyCode.DOWN,f.ui.keyCode.PAGE_DOWN];f("#processor-type-filter").off("keyup").on("keyup",function(G){var F=G.keyCode?G.keyCode:G.which;if(f.inArray(F,B)!==-1){return}if(F===f.ui.keyCode.ENTER){var D=z.getSelectedRows();if(D.length>0){var E=z.getDataItem(D[0]);if(p(E)){A()}}}else{q()}});i.addKeydownListener("#processor-type-filter",z,x);z.resizeCanvas();if(x.getLength()>0){i.choseFirstRow(z)}f("#processor-type-filter").focus()}};var t=new v();return t}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Client","nf.Birdseye","nf.Storage","nf.Graph","nf.CanvasUtils","nf.ErrorHandler","nf.Common"],function(i,e,g,d,c,f,j,h){return(nf.ng.InputPortComponent=b(i,e,g,d,c,f,j))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.InputPortComponent=b(require("jquery"),require("nf.Client"),require("nf.Birdseye"),require("nf.Storage"),require("nf.Graph"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.Dialog")))}else{nf.ng.InputPortComponent=b(a.$,a.nf.Client,a.nf.Birdseye,a.nf.Storage,a.nf.Graph,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.Dialog)}}}(this,function(g,c,e,b,a,d,h,f){return function(l){var k=function(p,m,o){var n={revision:c.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:b.isDisconnectionAcknowledged(),component:{name:p,allowRemoteAccess:m,position:{x:o.x,y:o.y}}};g.ajax({type:"POST",url:l.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(d.getGroupId())+"/input-ports",data:JSON.stringify(n),dataType:"json",contentType:"application/json"}).done(function(q){a.add({inputPorts:[q]},{selectAll:true});j.modal.hide();a.updateVisibility();e.refresh()}).fail(h.handleConfigurationUpdateAjaxError)};function i(){this.icon="icon icon-port-in";this.hoverIcon="icon icon-port-in-add";this.modal={getElement:function(){return g("#new-port-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Add Input Port",handler:{close:function(){g("#new-port-name").val("")}}})},update:function(n,m){this.getElement().modal(n,m)},show:function(){g("#new-port-dialog > .dialog-header > .dialog-header-text").text("Add Input Port");var n={text:"Local connections",value:"false",description:"Receive FlowFiles from components in parent process groups"};var m={text:"Remote connections (site-to-site)",value:"true",description:"Receive FlowFiles from remote process group (site-to-site)"};g("#port-allow-remote-access-label").text("Receive from");g("#port-allow-remote-access-info").attr("title","Specify where FlowFiles are received from.");if(d.getParentGroupId()===null){g("#port-allow-remote-access-setting").hide()}else{g("#port-allow-remote-access-setting").show()}g("#port-allow-remote-access").combo({options:[n,m]});this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}i.prototype={constructor:i,getElement:function(){return g("#port-in-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(m){this.promptForInputPortName(m)},dragIcon:function(m){return g('<div class="icon icon-port-in-add"></div>')},promptForInputPortName:function(o){var n=this;var m=function(){var q=g("#new-port-name").val();var p=g("#port-allow-remote-access").combo("getSelectedOption").value;k(q,p,o)};this.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:m}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){n.modal.hide()}}}]);g("#new-port-type").text("Input");this.modal.show();g("#new-port-name").focus().off("keyup").on("keyup",function(q){var p=q.keyCode?q.keyCode:q.which;if(p===g.ui.keyCode.ENTER){m()}})}};var j=new i();return j}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Client","nf.Birdseye","nf.Storage","nf.Graph","nf.CanvasUtils","nf.ErrorHandler","nf.Common"],function(i,e,g,d,c,f,j,h){return(nf.ng.OutputPortComponent=b(i,e,g,d,c,f,j))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.OutputPortComponent=b(require("jquery"),require("nf.Client"),require("nf.Birdseye"),require("nf.Storage"),require("nf.Graph"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.Dialog")))}else{nf.ng.OutputPortComponent=b(a.$,a.nf.Client,a.nf.Birdseye,a.nf.Storage,a.nf.Graph,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.Dialog)}}}(this,function(g,c,e,b,a,d,h,f){return function(l){var j=function(p,m,o){var n={revision:c.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:b.isDisconnectionAcknowledged(),component:{name:p,allowRemoteAccess:m,position:{x:o.x,y:o.y}}};g.ajax({type:"POST",url:l.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(d.getGroupId())+"/output-ports",data:JSON.stringify(n),dataType:"json",contentType:"application/json"}).done(function(q){a.add({outputPorts:[q]},{selectAll:true});k.modal.hide();a.updateVisibility();e.refresh()}).fail(h.handleConfigurationUpdateAjaxError)};function i(){this.icon="icon icon-port-out";this.hoverIcon="icon icon-port-out-add";this.modal={getElement:function(){return g("#new-port-dialog")},init:function(){},update:function(n,m){this.getElement().modal(n,m)},show:function(){g("#new-port-dialog > .dialog-header > .dialog-header-text").text("Add Output Port");var n={text:"Local connections",value:"false",description:"Send FlowFiles to components in parent process groups."};var m={text:"Remote connections (site-to-site)",value:"true",description:"Send FlowFiles to remote process group (site-to-site)."};g("#port-allow-remote-access-label").text("Send to");g("#port-allow-remote-access-info").attr("title","Specify where FlowFiles are sent.");if(d.getParentGroupId()===null){g("#port-allow-remote-access-setting").hide()}else{g("#port-allow-remote-access-setting").show()}g("#port-allow-remote-access").combo({options:[n,m]});this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}i.prototype={constructor:i,getElement:function(){return g("#port-out-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(m){this.promptForOutputPortName(m)},dragIcon:function(m){return g('<div class="icon icon-port-out-add"></div>')},promptForOutputPortName:function(n){var o=this;var m=function(){var q=g("#new-port-name").val();var p=g("#port-allow-remote-access").combo("getSelectedOption").value;j(q,p,n)};this.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:m}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){o.modal.hide()}}}]);g("#new-port-type").text("Output");this.modal.show();g("#new-port-name").focus().off("keyup").on("keyup",function(q){var p=q.keyCode?q.keyCode:q.which;if(p===g.ui.keyCode.ENTER){m()}})}};var k=new i();return k}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Client","nf.Birdseye","nf.Storage","nf.Graph","nf.CanvasUtils","nf.ErrorHandler","nf.Common","nf.Dialog"],function(g,k,c,h,i,e,j,d,f){return(nf.ng.GroupComponent=b(g,k,c,h,i,e,j,d,f))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.GroupComponent=b(require("jquery"),require("nf.Client"),require("nf.Birdseye"),require("nf.Storage"),require("nf.Graph"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.Common"),require("nf.Dialog")))}else{nf.ng.GroupComponent=b(a.$,a.nf.Client,a.nf.Birdseye,a.nf.Storage,a.nf.Graph,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.Common,a.nf.Dialog)}}}(this,function(e,i,a,f,g,c,h,b,d){return function(m){var l=function(p,o){var n={revision:i.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:f.isDisconnectionAcknowledged(),component:{name:p,position:{x:o.x,y:o.y}}};return e.ajax({type:"POST",url:m.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(c.getGroupId())+"/process-groups",data:JSON.stringify(n),dataType:"json",contentType:"application/json"}).done(function(q){g.add({processGroups:[q]},{selectAll:true});g.updateVisibility();a.refresh()}).fail(h.handleConfigurationUpdateAjaxError)};function j(){this.icon="icon icon-group";this.hoverIcon="icon icon-group-add";this.modal={getElement:function(){return e("#new-process-group-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Add Process Group",handler:{close:function(){e("#new-process-group-name").val("");e("#new-process-group-dialog").removeData("pt")}}})},update:function(o,n){this.getElement().modal(o,n)},show:function(){this.getElement().modal("show")},storePt:function(n){e("#new-process-group-dialog").data("pt",n)},hide:function(){this.getElement().modal("hide")}}}j.prototype={constructor:j,getElement:function(){return e("#group-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(n){this.promptForGroupName(n,true)},dragIcon:function(n){return e('<div class="icon icon-group-add"></div>')},promptForGroupName:function(o,p){var n=this;return e.Deferred(function(q){var r=function(){var s=e("#new-process-group-name").val();if(b.isBlank(s)){d.showOkDialog({headerText:"Configuration Error",dialogContent:"The name of the process group must be specified."});q.reject()}else{n.modal.hide();l(s,o).done(function(t){q.resolve(t.component)}).fail(function(){q.reject()})}};n.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:r}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){q.reject();n.modal.hide()}}}]);if(p===true&&b.canVersionFlows()){e("#import-process-group-link").show()}else{e("#import-process-group-link").hide()}n.modal.storePt(o);n.modal.show();e("#new-process-group-name").focus().off("keyup").on("keyup",function(t){var s=t.keyCode?t.keyCode:t.which;if(s===e.ui.keyCode.ENTER){r()}})}).promise()}};var k=new j();return k}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Client","nf.Birdseye","nf.Storage","nf.Graph","nf.CanvasUtils","nf.ErrorHandler","nf.Dialog","nf.Common"],function(g,k,c,h,i,e,j,f,d){return(nf.ng.RemoteProcessGroupComponent=b(g,k,c,h,i,e,j,f,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.RemoteProcessGroupComponent=b(require("jquery"),require("nf.Client"),require("nf.Birdseye"),require("nf.Storage"),require("nf.Graph"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.Dialog"),require("nf.Common")))}else{nf.ng.RemoteProcessGroupComponent=b(a.$,a.nf.Client,a.nf.Birdseye,a.nf.Storage,a.nf.Graph,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.Dialog,a.nf.Common)}}}(this,function(e,i,a,f,g,c,h,d,b){return function(m){var l=function(o){var n={revision:i.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:f.isDisconnectionAcknowledged(),component:{targetUris:e("#new-remote-process-group-uris").val(),position:{x:o.x,y:o.y},communicationsTimeout:e("#new-remote-process-group-timeout").val(),yieldDuration:e("#new-remote-process-group-yield-duration").val(),transportProtocol:e("#new-remote-process-group-transport-protocol-combo").combo("getSelectedOption").value,localNetworkInterface:e("#new-remote-process-group-local-network-interface").val(),proxyHost:e("#new-remote-process-group-proxy-host").val(),proxyPort:e("#new-remote-process-group-proxy-port").val(),proxyUser:e("#new-remote-process-group-proxy-user").val(),proxyPassword:e("#new-remote-process-group-proxy-password").val()}};e.ajax({type:"POST",url:m.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(c.getGroupId())+"/remote-process-groups",data:JSON.stringify(n),dataType:"json",contentType:"application/json"}).done(function(p){g.add({remoteProcessGroups:[p]},{selectAll:true});e("#new-remote-process-group-dialog").modal("hide");g.updateVisibility();a.refresh()}).fail(h.handleConfigurationUpdateAjaxError)};function k(){this.icon="icon icon-group-remote";this.hoverIcon="icon icon-group-remote-add";this.modal={getElement:function(){return e("#new-remote-process-group-dialog")},init:function(){var n="30 sec";var o="10 sec";this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Add Remote Process Group",handler:{close:function(){e("#new-remote-process-group-uris").val("");e("#new-remote-process-group-timeout").val(n);e("#new-remote-process-group-yield-duration").val(o);e("#new-remote-process-group-transport-protocol-combo").combo("setSelectedOption",{value:"RAW"});e("#new-remote-process-group-local-network-interface").val("");e("#new-remote-process-group-proxy-host").val("");e("#new-remote-process-group-proxy-port").val("");e("#new-remote-process-group-proxy-user").val("");e("#new-remote-process-group-proxy-password").val("")}}});e("#new-remote-process-group-timeout").val(n);e("#new-remote-process-group-yield-duration").val(o);e("#new-remote-process-group-transport-protocol-combo").combo({options:[{text:"RAW",value:"RAW"},{text:"HTTP",value:"HTTP"}]})},update:function(o,n){this.getElement().modal(o,n)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}k.prototype={constructor:k,getElement:function(){return e("#group-remote-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(n){this.promptForRemoteProcessGroupUri(n)},dragIcon:function(n){return e('<div class="icon icon-group-remote-add"></div>')},promptForRemoteProcessGroupUri:function(p){var n=this;var o=function(){l(p)};this.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:o}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){n.modal.hide()}}}]);this.modal.show();e("#new-remote-process-group-uris").focus().off("keyup").on("keyup",function(r){var q=r.keyCode?r.keyCode:r.which;if(q===e.ui.keyCode.ENTER){o()}})}};var j=new k();return j}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Client","nf.Birdseye","nf.Storage","nf.Graph","nf.CanvasUtils","nf.ErrorHandler"],function(h,e,g,d,c,f,i){return(nf.ng.FunnelComponent=b(h,e,g,d,c,f,i))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.FunnelComponent=b(require("jquery"),require("nf.Client"),require("nf.Birdseye"),require("nf.Storage"),require("nf.Graph"),require("nf.CanvasUtils"),require("nf.ErrorHandler")))}else{nf.ng.FunnelComponent=b(a.$,a.nf.Client,a.nf.Birdseye,a.nf.Storage,a.nf.Graph,a.nf.CanvasUtils,a.nf.ErrorHandler)}}}(this,function(f,c,e,b,a,d,g){return function(i){function h(){this.icon="icon icon-funnel";this.hoverIcon="icon icon-funnel-add"}h.prototype={constructor:h,getElement:function(){return f("#funnel-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(k){this.createFunnel(k)},dragIcon:function(k){return f('<div class="icon icon-funnel-add"></div>')},createFunnel:function(l){var k={revision:c.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:b.isDisconnectionAcknowledged(),component:{position:{x:l.x,y:l.y}}};f.ajax({type:"POST",url:i.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(d.getGroupId())+"/funnels",data:JSON.stringify(k),dataType:"json",contentType:"application/json"}).done(function(m){a.add({funnels:[m]},{selectAll:true});a.updateVisibility();e.refresh()}).fail(g.handleAjaxError)}};var j=new h();return j}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Client","nf.Birdseye","nf.Storage","nf.Graph","nf.CanvasUtils","nf.ErrorHandler","nf.Dialog","nf.Common"],function(g,k,c,h,i,e,j,f,d){return(nf.ng.TemplateComponent=b(g,k,c,h,i,e,j,f,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.TemplateComponent=b(require("jquery"),require("nf.Client"),require("nf.Birdseye"),require("nf.Storage"),require("nf.Graph"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.Dialog"),require("nf.Common")))}else{nf.ng.TemplateComponent=b(a.$,a.nf.Client,a.nf.Birdseye,a.nf.Storage,a.nf.Graph,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.Dialog,a.nf.Common)}}}(this,function(e,i,a,f,g,c,h,d,b){return function(l){var k=function(o,p){var n={templateId:o,originX:p.x,originY:p.y,disconnectedNodeAcknowledged:f.isDisconnectionAcknowledged()};e.ajax({type:"POST",url:l.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(c.getGroupId())+"/template-instance",data:JSON.stringify(n),dataType:"json",contentType:"application/json"}).done(function(q){g.add(q.flow,{selectAll:true});g.updateVisibility();a.refresh()}).fail(h.handleAjaxError)};function j(){this.icon="icon icon-template";this.hoverIcon="icon icon-template-add";this.modal={getElement:function(){return e("#instantiate-template-dialog")},init:function(){this.getElement().modal({scrollableContentStyle:"scrollable",headerText:"Add Template"})},update:function(o,n){this.getElement().modal(o,n)},show:function(){this.getElement().modal("show")},hide:function(){this.getElement().modal("hide")}}}j.prototype={constructor:j,getElement:function(){return e("#template-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(n){this.promptForTemplate(n)},dragIcon:function(n){return e('<div class="icon icon-template-add"></div>')},promptForTemplate:function(n){var o=this;e.ajax({type:"GET",url:l.headerCtrl.toolboxCtrl.config.urls.api+"/flow/templates",dataType:"json"}).done(function(p){var r=p.templates;if(b.isDefinedAndNotNull(r)&&r.length>0){r=r.sort(function(t,s){var v=b.parseDateTime(t.template.timestamp);var u=b.parseDateTime(s.template.timestamp);return u.getTime()-v.getTime()});var q=[];e.each(r,function(s,t){if(t.permissions.canRead===true){q.push({text:t.template.name,value:t.id,description:b.escapeHtml(t.template.description)})}});e("#available-templates").combo({maxHeight:300,options:q});o.modal.update("setButtonModel",[{buttonText:"Add",color:{base:"#728E9B",hover:"#004849",text:"#ffffff"},handler:{click:function(){var t=e("#available-templates").combo("getSelectedOption");var s=t.value;o.modal.hide();k(s,n)}}},{buttonText:"Cancel",color:{base:"#E3E8EB",hover:"#C7D2D7",text:"#004849"},handler:{click:function(){o.modal.hide()}}}]);o.modal.show()}else{d.showOkDialog({headerText:"Instantiate Template",dialogContent:"No templates have been loaded into this NiFi."})}}).fail(h.handleAjaxError)}};var m=new j();return m}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","nf.Client","nf.Birdseye","nf.Storage","nf.Graph","nf.CanvasUtils","nf.ErrorHandler","nf.Label"],function(h,e,g,d,c,f,i,j){return(nf.ng.LabelComponent=b(h,e,g,d,c,f,i,j))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.LabelComponent=b(require("jquery"),require("nf.Client"),require("nf.Birdseye"),require("nf.Storage"),require("nf.Graph"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.Label")))}else{nf.ng.LabelComponent=b(a.$,a.nf.Client,a.nf.Birdseye,a.nf.Storage,a.nf.Graph,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.Label)}}}(this,function(f,c,e,b,a,d,g,h){return function(k){function j(){this.icon="icon icon-label";this.hoverIcon="icon icon-label-add"}j.prototype={constructor:j,getElement:function(){return f("#label-component")},enabled:function(){this.getElement().attr("disabled",false)},disabled:function(){this.getElement().attr("disabled",true)},dropHandler:function(l){this.createLabel(l)},dragIcon:function(l){return f('<div class="icon icon-label-add"></div>')},createLabel:function(m){var l={revision:c.getRevision({revision:{version:0}}),disconnectedNodeAcknowledged:b.isDisconnectionAcknowledged(),component:{width:h.config.width,height:h.config.height,position:{x:m.x,y:m.y}}};f.ajax({type:"POST",url:k.headerCtrl.toolboxCtrl.config.urls.api+"/process-groups/"+encodeURIComponent(d.getGroupId())+"/labels",data:JSON.stringify(l),dataType:"json",contentType:"application/json"}).done(function(n){a.add({labels:[n]},{selectAll:true});a.updateVisibility();e.refresh()}).fail(g.handleAjaxError)}};var i=new j();return i}}));
(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return(nf.ng.BreadcrumbsDirective=b())})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.BreadcrumbsDirective=b())}else{nf.ng.BreadcrumbsDirective=b()}}}(this,function(){return function(a){return{restrict:"E",templateUrl:"views/nf-ng-breadcrumbs-directive-view.html",scope:{breadcrumbs:"=",clickFunc:"=",highlightCrumbId:"=",separatorFunc:"=",isTracking:"=",getVersionControlClass:"=",getVersionControlTooltip:"="},link:function(d,c,b){a.registerMouseWheelEvent(c)}}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return(nf.ng.DraggableDirective=b())})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.DraggableDirective=b())}else{nf.ng.DraggableDirective=b()}}}(this,function(){return function(){return{restrict:"AE",link:function(c,b,a){b.draggable(c.$eval(a.nfDraggable))}}}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["nf.ng.Bridge","nf.Common","nf.CanvasUtils","nf.ClusterSummary","nf.Actions"],function(e,f,g,c,d){return(nf.ng.AppCtrl=b(e,f,g,c,d))})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.AppCtrl=b(require("nf.ng.Bridge"),require("nf.CanvasUtils"),require("nf.Common"),require("nf.ClusterSummary"),require("nf.Actions")))}else{nf.ng.AppCtrl=b(a.nf.ng.Bridge,a.nf.CanvasUtils,a.nf.Common,a.nf.ClusterSummary,a.nf.Actions)}}}(this,function(c,d,e,a,b){return function(g,i){function f(j){this.nf={Common:e,ClusterSummary:a,Actions:b,CanvasUtils:d,};this.serviceProvider=j}f.prototype={constructor:f};var h=new f(i);g.appCtrl=h;c.rootScope=g}}));
(function(a,b){if(typeof define==="function"&&define.amd){define([],function(){return(nf.ng.AppConfig=b())})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=(nf.ng.AppConfig=b())}else{nf.ng.AppConfig=b()}}}(this,function(){return function(a,b){b.debugInfoEnabled(false);a.definePalette("basePalette",{"50":"728E9B","100":"728E9B","200":"004849","300":"775351","400":"728E9B","500":"728E9B","600":"728E9B","700":"728E9B","800":"728E9B","900":"rgba(249,250,251,0.97)",A100:"728E9B",A200:"728E9B",A400:"728E9B",A700:"728E9B",contrastDefaultColor:"light",contrastDarkColors:["A100"],contrastLightColors:undefined});a.definePalette("tintPalette",{"50":"728E9B","100":"728E9B","200":"CCDADB","300":"728E9B","400":"AABBC3","500":"728E9B","600":"C7D2D7","700":"728E9B","800":"E3E8EB","900":"728E9B",A100:"728E9B",A200:"728E9B",A400:"728E9B",A700:"728E9B",contrastDefaultColor:"light",contrastDarkColors:["A100"],contrastLightColors:undefined});a.definePalette("warnPalette",{"50":"BA554A","100":"BA554A","200":"BA554A","300":"BA554A","400":"BA554A","500":"BA554A","600":"BA554A","700":"BA554A","800":"BA554A","900":"BA554A",A100:"BA554A",A200:"BA554A",A400:"BA554A",A700:"BA554A",contrastDefaultColor:"light",contrastDarkColors:["A100"],contrastLightColors:undefined});a.theme("default").primaryPalette("basePalette",{"default":"500","hue-1":"200","hue-2":"300","hue-3":"900"}).accentPalette("tintPalette",{"default":"200","hue-1":"400","hue-2":"600","hue-3":"800"}).warnPalette("warnPalette",{"default":"500"})}}));
(function(a,b){if(typeof define==="function"&&define.amd){define(["jquery","angular","nf.Common","nf.CanvasUtils","nf.ErrorHandler","nf.Client","nf.Dialog","nf.Storage","nf.Canvas","nf.Graph","nf.ContextMenu","nf.QuickSelect","nf.Shell","nf.ParameterContexts","nf.Settings","nf.Snippet","nf.Actions","nf.QueueListing","nf.VariableRegistry","nf.ComponentState","nf.FlowVersion","nf.ComponentVersion","nf.Draggable","nf.Connectable","nf.StatusHistory","nf.Birdseye","nf.ConnectionConfiguration","nf.ControllerService","nf.ReportingTask","nf.PolicyManagement","nf.ProcessorConfiguration","nf.ProcessGroupConfiguration","nf.ControllerServices","nf.RemoteProcessGroupConfiguration","nf.RemoteProcessGroupPorts","nf.PortConfiguration","nf.LabelConfiguration","nf.ProcessorDetails","nf.PortDetails","nf.ConnectionDetails","nf.RemoteProcessGroupDetails","nf.GoTo","nf.ng.Bridge","nf.ng.AppCtrl","nf.ng.AppConfig","nf.ng.ServiceProvider","nf.ng.BreadcrumbsCtrl","nf.ng.Canvas.HeaderCtrl","nf.ng.Canvas.FlowStatusCtrl","nf.ng.Canvas.GlobalMenuCtrl","nf.ng.Canvas.ToolboxCtrl","nf.ng.ProcessorComponent","nf.ng.InputPortComponent","nf.ng.OutputPortComponent","nf.ng.GroupComponent","nf.ng.RemoteProcessGroupComponent","nf.ng.FunnelComponent","nf.ng.TemplateComponent","nf.ng.LabelComponent","nf.ng.Canvas.GraphControlsCtrl","nf.ng.Canvas.NavigateCtrl","nf.ng.Canvas.OperateCtrl","nf.ng.BreadcrumbsDirective","nf.ng.DraggableDirective"],function(P,D,aa,ak,f,m,q,z,G,x,H,X,Z,am,U,E,al,M,p,h,B,A,C,O,ae,l,v,ab,Q,I,aj,S,V,N,c,R,J,d,y,w,ad,k,t,j,L,ac,o,g,e,s,ag,Y,F,K,an,af,ai,W,u,T,i,ah,n,r){return b(P,D,aa,ak,f,m,q,z,G,x,H,X,Z,am,U,E,al,M,p,h,B,A,C,O,ae,l,v,ab,Q,I,aj,S,V,N,c,R,J,d,y,w,ad,k,t,j,L,ac,o,g,e,s,ag,Y,F,K,an,af,ai,W,u,T,i,ah,n,r)})}else{if(typeof exports==="object"&&typeof module==="object"){module.exports=b(require("jquery"),require("angular"),require("nf.Common"),require("nf.CanvasUtils"),require("nf.ErrorHandler"),require("nf.Client"),require("nf.Dialog"),require("f.Storage"),require("nf.Canvas"),require("nf.Graph"),require("nf.ContextMenu"),require("nf.QuickSelect"),require("nf.Shell"),require("nf.ParameterContexts"),require("nf.Settings"),require("nf.Actions"),require("nf.Snippet"),require("nf.QueueListing"),require("nf.VariableRegistry"),require("nf.ComponentState"),require("nf.FlowVersion"),require("nf.ComponentVersion"),require("nf.Draggable"),require("nf.Connectable"),require("nf.StatusHistory"),require("nf.Birdseye"),require("nf.ConnectionConfiguration"),require("nf.ControllerService"),require("nf.ReportingTask"),require("nf.PolicyManagement"),require("nf.ProcessorConfiguration"),require("nf.ProcessGroupConfiguration"),require("nf.ControllerServices"),require("nf.RemoteProcessGroupConfiguration"),require("nf.RemoteProcessGroupPorts"),require("nf.PortConfiguration"),require("nf.LabelConfiguration"),require("nf.ProcessorDetails"),require("nf.PortDetails"),require("nf.ConnectionDetails"),require("nf.RemoteProcessGroupDetails"),require("nf.GoTo"),require("nf.ng.Bridge"),require("nf.ng.AppCtrl"),require("nf.ng.AppConfig"),require("nf.ng.ServiceProvider"),require("nf.ng.BreadcrumbsCtrl"),require("nf.ng.Canvas.HeaderCtrl"),require("nf.ng.Canvas.FlowStatusCtrl"),require("nf.ng.Canvas.GlobalMenuCtrl"),require("nf.ng.Canvas.ToolboxCtrl"),require("nf.ng.ProcessorComponent"),require("nf.ng.InputPortComponent"),require("nf.ng.OutputPortComponent"),require("nf.ng.GroupComponent"),require("nf.ng.RemoteProcessGroupComponent"),require("nf.ng.FunnelComponent"),require("nf.ng.TemplateComponent"),require("nf.ng.LabelComponent"),require("nf.ng.Canvas.GraphControlsCtrl"),require("nf.ng.Canvas.NavigateCtrl"),require("nf.ng.Canvas.OperateCtrl"),require("nf.ng.BreadcrumbsDirective"),require("nf.ng.DraggableDirective"))}else{b(a.$,a.angular,a.nf.Common,a.nf.CanvasUtils,a.nf.ErrorHandler,a.nf.Client,a.nf.Dialog,a.nf.Storage,a.nf.Canvas,a.nf.Graph,a.nf.ContextMenu,a.nf.QuickSelect,a.nf.Shell,a.nf.ParameterContexts,a.nf.Settings,a.nf.Actions,a.nf.Snippet,a.nf.QueueListing,a.nf.VariableRegistry,a.nf.ComponentState,a.nf.FlowVersion,a.nf.ComponentVersion,a.nf.Draggable,a.nf.Connectable,a.nf.StatusHistory,a.nf.Birdseye,a.nf.ConnectionConfiguration,a.nf.ControllerService,a.nf.ReportingTask,a.nf.PolicyManagement,a.nf.ProcessorConfiguration,a.nf.ProcessGroupConfiguration,a.nf.ControllerServices,a.nf.RemoteProcessGroupConfiguration,a.nf.RemoteProcessGroupPorts,a.nf.PortConfiguration,a.nf.LabelConfiguration,a.nf.ProcessorDetails,a.nf.PortDetails,a.nf.ConnectionDetails,a.nf.RemoteProcessGroupDetails,a.nf.GoTo,a.nf.ng.Bridge,a.nf.ng.AppCtrl,a.nf.ng.AppConfig,a.nf.ng.ServiceProvider,a.nf.ng.BreadcrumbsCtrl,a.nf.ng.Canvas.HeaderCtrl,a.nf.ng.Canvas.FlowStatusCtrl,a.nf.ng.Canvas.GlobalMenuCtrl,a.nf.ng.Canvas.ToolboxCtrl,a.nf.ng.ProcessorComponent,a.nf.ng.InputPortComponent,a.nf.ng.OutputPortComponent,a.nf.ng.GroupComponent,a.nf.ng.RemoteProcessGroupComponent,a.nf.ng.FunnelComponent,a.nf.ng.TemplateComponent,a.nf.ng.LabelComponent,a.nf.ng.Canvas.GraphControlsCtrl,a.nf.ng.Canvas.NavigateCtrl,a.nf.ng.Canvas.OperateCtrl,a.nf.ng.BreadcrumbsDirective,a.nf.ng.DraggableDirective)}}}(this,function(N,B,Z,aj,d,k,o,x,E,v,F,W,Y,al,S,C,ak,K,n,f,z,y,A,M,ad,j,t,aa,O,G,ai,Q,U,L,a,P,H,b,w,u,ac,i,r,h,J,ab,m,e,c,q,af,X,D,I,am,ae,ah,V,s,R,g,ag,l,p){var T={urls:{flowConfig:"../nifi-api/flow/config"}};N(document).ready(function(){if(E.SUPPORTS_SVG){var ao=B.module("ngCanvasApp",["ngResource","ngRoute","ngMaterial","ngMessages"]);J.$inject=["$mdThemingProvider","$compileProvider"];h.$inject=["$scope","serviceProvider","$compile","headerCtrl","graphControlsCtrl"];ab.$inject=[];m.$inject=["serviceProvider"];e.$inject=["serviceProvider","toolboxCtrl","globalMenuCtrl","flowStatusCtrl"];c.$inject=["serviceProvider"];q.$inject=["serviceProvider"];af.$inject=["processorComponent","inputPortComponent","outputPortComponent","groupComponent","remoteGroupComponent","funnelComponent","templateComponent","labelComponent"];X.$inject=["serviceProvider"];D.$inject=["serviceProvider"];I.$inject=["serviceProvider"];am.$inject=["serviceProvider"];ae.$inject=["serviceProvider"];ah.$inject=["serviceProvider"];V.$inject=["serviceProvider"];s.$inject=["serviceProvider"];R.$inject=["serviceProvider","navigateCtrl","operateCtrl"];g.$inject=["$timeout"];ag.$inject=[];l.$inject=["breadcrumbsCtrl"];p.$inject=[];ao.config(J);ao.controller("ngCanvasAppCtrl",h);ao.service("serviceProvider",ab);ao.service("breadcrumbsCtrl",m);ao.service("headerCtrl",e);ao.service("flowStatusCtrl",c);ao.service("globalMenuCtrl",q);ao.service("toolboxCtrl",af);ao.service("processorComponent",X);ao.service("inputPortComponent",D);ao.service("outputPortComponent",I);ao.service("groupComponent",am);ao.service("remoteGroupComponent",ae);ao.service("funnelComponent",ah);ao.service("templateComponent",V);ao.service("labelComponent",s);ao.service("graphControlsCtrl",R);ao.service("navigateCtrl",g);ao.service("operateCtrl",ag);ao.directive("nfBreadcrumbs",l);ao.directive("nfDraggable",p);aj.init(E,C,ak,j,v);r.injector=B.bootstrap(N("body"),["ngCanvasApp"],{strictDi:true});var an=E.init();an.done(function(){var ap=k.init();var aq=N.ajax({type:"GET",url:T.urls.flowConfig,dataType:"json"});N.when(aq,an,ap).done(function(au){var av=au[0];var aw=N("#canvas-container");E.CANVAS_OFFSET=aw.offset().top;var at=av.flowConfiguration;var ar=parseInt(at.autoRefreshIntervalSeconds,10);E.setManagedAuthorizer(at.supportsManagedAuthorizer);E.setConfigurableAuthorizer(at.supportsConfigurableAuthorizer);E.setConfigurableUsersAndGroups(at.supportsConfigurableUsersAndGroups);x.init();E.initCanvas();E.View.init();F.init(C);W.init(C);Y.init(F);r.injector.get("headerCtrl").init();S.init();al.init();C.init();K.init();n.init();f.init();z.init(at.timeOffset);y.init(S);A.init();M.init();ad.init(at.timeOffset);j.init(v);t.init(j,v,at.defaultBackPressureObjectThreshold,at.defaultBackPressureDataSizeThreshold);aa.init(U,O);O.init(S);G.init();ai.init({supportsStatusBar:true,nfActions:C});Q.init(U,al);L.init();a.init();P.init();H.init();b.init({supportsGoTo:true,supportsStatusBar:true,nfCanvasUtils:aj,nfActions:C});w.init();u.init();ac.init();i.init();v.init().done(function(){r.injector.get("graphControlsCtrl").init();var ax=ar/2;setTimeout(function(){E.startPolling(ar)},ax*1000);E.hideSplash()}).fail(d.handleAjaxError)}).fail(d.handleAjaxError)}).fail(d.handleAjaxError);N(".component-button").qtip(N.extend({},Z.config.tooltipConfig,{position:{at:"bottom center",my:"top center",adjust:{y:5}}}))}else{N("#message-title").text("Unsupported Browser");N("#message-content").text("Flow graphs are shown using SVG. Please use a browser that supports rendering SVG.");N("#message-pane").show();E.hideSplash()}})}));
